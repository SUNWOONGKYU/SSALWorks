<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>íšŒì›ê°€ì…ì„ ìœ„í•œ ì´ë©”ì¼ ì¸ì¦ ì‹œìŠ¤í…œ êµ¬ì¶• ë°©ë²• - SSALWorks í•™ìŠµìš© ì½˜í…ì¸ </title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }

        :root {
            --primary: #10B981;
            --secondary: #F59E0B;
            --tertiary: #2C4A8A;
            --tertiary-dark: #1F3563;
            --bg-light: #f8f9fa;
            --border-color: #dee2e6;
            --text-dark: #212529;
            --text-muted: #6c757d;
        }

        body {
            font-family: 'Malgun Gothic', 'ë§‘ì€ ê³ ë”•', 'Apple SD Gothic Neo', -apple-system, BlinkMacSystemFont, sans-serif;
            font-size: 15px;
            line-height: 1.7;
            color: var(--text-dark);
            background: var(--bg-light);
        }

        /* Header */
        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px 40px;
            position: sticky;
            top: 0;
            z-index: 1000;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 2px 10px rgba(0,0,0,0.2);
        }
        .header-title { font-size: 20px; font-weight: 700; }
        .close-btn {
            padding: 6px 14px;
            border-radius: 4px;
            border: 1px solid rgba(255,255,255,0.5);
            background: rgba(255,255,255,0.15);
            color: white;
            cursor: pointer;
            font-size: 12px;
            text-decoration: none;
            transition: all 0.2s;
        }
        .close-btn:hover { background: rgba(255,255,255,0.3); border-color: white; }

        /* Main Content */
        .main-content {
            max-width: 900px;
            margin: 0 auto;
            padding: 40px;
            background: white;
            min-height: calc(100vh - 70px);
        }

        /* Markdown Styles */
        .markdown-body h1 {
            font-size: 32px;
            font-weight: 800;
            color: var(--tertiary);
            margin: 40px 0 20px;
            padding-bottom: 16px;
            border-bottom: 3px solid var(--secondary);
        }
        .markdown-body h1:first-child { margin-top: 0; }
        .markdown-body h2 {
            font-size: 26px;
            font-weight: 700;
            color: var(--tertiary);
            margin: 48px 0 20px;
            padding-bottom: 10px;
            border-bottom: 2px solid var(--border-color);
        }
        .markdown-body h3 {
            font-size: 20px;
            font-weight: 700;
            color: var(--tertiary);
            margin: 32px 0 16px;
        }
        .markdown-body h4 {
            font-size: 17px;
            font-weight: 700;
            color: var(--text-dark);
            margin: 24px 0 12px;
        }
        .markdown-body p { margin-bottom: 16px; color: var(--text-dark); }
        .markdown-body blockquote {
            background: linear-gradient(135deg, rgba(245, 158, 11, 0.1) 0%, rgba(217, 119, 6, 0.1) 100%);
            border-left: 4px solid var(--secondary);
            padding: 16px 20px;
            margin: 20px 0;
            border-radius: 0 8px 8px 0;
        }
        .markdown-body blockquote p { margin: 0; font-style: italic; }
        .markdown-body pre {
            background: #2d2d2d;
            color: #f8f8f2;
            padding: 20px;
            border-radius: 8px;
            overflow-x: auto;
            margin: 16px 0;
            font-family: 'Consolas', 'Monaco', monospace;
            font-size: 14px;
            line-height: 1.5;
        }
        .markdown-body code {
            background: #e9ecef;
            padding: 2px 6px;
            border-radius: 4px;
            font-family: 'Consolas', 'Monaco', monospace;
            font-size: 14px;
            color: #e83e8c;
        }
        .markdown-body pre code { background: none; padding: 0; color: inherit; }
        .markdown-body table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
            font-size: 14px;
        }
        .markdown-body th, .markdown-body td {
            padding: 12px 16px;
            text-align: left;
            border: 1px solid var(--border-color);
        }
        .markdown-body th { background: #f1f3f5; color: var(--text-dark); font-weight: 600; }
        .markdown-body tr:nth-child(even) { background: #f8f9fa; }
        .markdown-body tr:hover { background: #e9ecef; }
        .markdown-body ul, .markdown-body ol { margin: 16px 0; padding-left: 24px; }
        .markdown-body li { margin-bottom: 8px; }
        .markdown-body hr { border: none; border-top: 2px solid var(--border-color); margin: 40px 0; }
        .markdown-body a { color: var(--tertiary); text-decoration: none; }
        .markdown-body a:hover { text-decoration: underline; }
        .markdown-body img { max-width: 100%; height: auto; border-radius: 8px; margin: 16px 0; }

        /* Scrollbar */
        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: #f1f1f1; }
        ::-webkit-scrollbar-thumb { background: #c1c1c1; border-radius: 4px; }
        ::-webkit-scrollbar-thumb:hover { background: #a1a1a1; }

        /* Print */
        @media print {
            .header { display: none; }
            .main-content { padding: 0; max-width: none; }
        }
    </style>
</head>
<body>
    <header class="header">
        <div class="header-title">íšŒì›ê°€ì…ì„ ìœ„í•œ ì´ë©”ì¼ ì¸ì¦ ì‹œìŠ¤í…œ êµ¬ì¶• ë°©ë²•</div>
        <a href="javascript:history.back()" class="close-btn">â† ë’¤ë¡œ ê°€ê¸°</a>
    </header>
    <main class="main-content">
        <article class="markdown-body">
            <h1>íšŒì›ê°€ì…ì„ ìœ„í•œ ì´ë©”ì¼ ì¸ì¦ ì‹œìŠ¤í…œ êµ¬ì¶• ë°©ë²•</h1>
<p><strong>ì‘ì„±ì¼</strong>: 2025-11-20
<strong>ì‘ì„±ì</strong>: Claude Code
<strong>ë‚œì´ë„</strong>: â­â­â­â­ (ìƒê¸‰)
<strong>ì†Œìš”ì‹œê°„</strong>: ì•½ 10ì‹œê°„ (ì‹œí–‰ì°©ì˜¤ í¬í•¨)</p>
<h2>ğŸ“‹ ëª©ì°¨</h2>
<ol>
<li><a href="#%EA%B0%9C%EC%9A%94">ê°œìš”</a></li>
<li><a href="#%EA%B4%80%EB%A0%A8-%EC%84%9C%EB%B9%84%EC%8A%A4-%EB%B0%8F-%EC%97%AD%ED%95%A0">ê´€ë ¨ ì„œë¹„ìŠ¤ ë° ì—­í• </a></li>
<li><a href="#%EC%A0%84%EC%B2%B4-%EA%B5%AC%EC%A1%B0%EB%8F%84">ì „ì²´ êµ¬ì¡°ë„</a></li>
<li><a href="#%EB%8B%A8%EA%B3%84%EB%B3%84-%EA%B5%AC%EC%B6%95-%EA%B3%BC%EC%A0%95">ë‹¨ê³„ë³„ êµ¬ì¶• ê³¼ì •</a></li>
<li><a href="#%EB%B0%9C%EC%83%9D%ED%95%9C-%EB%AC%B8%EC%A0%9C%EC%99%80-%ED%95%B4%EA%B2%B0-%EB%B0%A9%EB%B2%95">ë°œìƒí•œ ë¬¸ì œì™€ í•´ê²° ë°©ë²•</a></li>
<li><a href="#%ED%95%B5%EC%8B%AC-%EA%B5%90%ED%9B%88">í•µì‹¬ êµí›ˆ</a></li>
<li><a href="#%EC%B2%B4%ED%81%AC%EB%A6%AC%EC%8A%A4%ED%8A%B8">ì²´í¬ë¦¬ìŠ¤íŠ¸</a></li>
</ol>
<hr>
<h2>ê°œìš”</h2>
<p>Next.js ì•±ì—ì„œ Supabase Authë¥¼ ì‚¬ìš©í•œ ì´ë©”ì¼ ì¸ì¦ ì‹œìŠ¤í…œì„ êµ¬ì¶•í•˜ë©´ì„œ ê²ªì€ ì‹¤ì „ ê²½í—˜ì„ ì •ë¦¬í•œ ê°€ì´ë“œì…ë‹ˆë‹¤.</p>
<h3>ëª©í‘œ</h3>
<ul>
<li>ì‚¬ìš©ìê°€ íšŒì›ê°€ì…í•˜ë©´ ì¸ì¦ ì´ë©”ì¼ ë°œì†¡</li>
<li>ì´ë©”ì¼ ë§í¬ í´ë¦­ ì‹œ ìë™ ë¡œê·¸ì¸</li>
<li>í”„ë¡œë•ì…˜ í™˜ê²½ì—ì„œ ì•ˆì •ì ì¸ ë™ì‘</li>
</ul>
<h3>ìµœì¢… ê²°ê³¼</h3>
<ul>
<li>âœ… íšŒì›ê°€ì… â†’ ì´ë©”ì¼ ë°œì†¡ â†’ ì¸ì¦ â†’ ë¡œê·¸ì¸ ì „ì²´ í”„ë¡œì„¸ìŠ¤ ì •ìƒ ì‘ë™</li>
<li>âœ… DKIM ì¸ì¦ìœ¼ë¡œ ìŠ¤íŒ¸ ë°©ì§€</li>
<li>âœ… auth.usersì™€ users í…Œì´ë¸” ì™„ì „ ë™ê¸°í™”</li>
</ul>
<hr>
<h2>ê´€ë ¨ ì„œë¹„ìŠ¤ ë° ì—­í• </h2>
<p>ì´ ì‹œìŠ¤í…œì„ êµ¬ì¶•í•˜ë ¤ë©´ <strong>4ê°œì˜ ì„œë¹„ìŠ¤</strong>ê°€ í•„ìš”í•©ë‹ˆë‹¤:</p>
<h3>1. Vercel (ë°°í¬ í”Œë«í¼)</h3>
<p><strong>ì—­í• </strong>: Next.js ì•± í˜¸ìŠ¤íŒ… ë° ë°°í¬</p>
<ul>
<li>í”„ë¡œë•ì…˜ URL ì œê³µ (<code>https://www.politicianfinder.ai.kr</code>)</li>
<li>í™˜ê²½ë³€ìˆ˜ ê´€ë¦¬</li>
<li>ìë™ ë°°í¬ (GitHub ì—°ë™)</li>
</ul>
<h3>2. Supabase (ë°±ì—”ë“œ/ì¸ì¦)</h3>
<p><strong>ì—­í• </strong>: ì‚¬ìš©ì ì¸ì¦ ë° ë°ì´í„°ë² ì´ìŠ¤</p>
<ul>
<li>Auth ì‹œìŠ¤í…œ (íšŒì›ê°€ì…, ë¡œê·¸ì¸, ì´ë©”ì¼ ì¸ì¦)</li>
<li>PostgreSQL ë°ì´í„°ë² ì´ìŠ¤</li>
<li>ì´ë©”ì¼ í…œí”Œë¦¿ ê´€ë¦¬</li>
<li>SMTP ì„¤ì •</li>
</ul>
<h3>3. Resend (ì´ë©”ì¼ ë°œì†¡)</h3>
<p><strong>ì—­í• </strong>: ì‹¤ì œ ì´ë©”ì¼ ì „ì†¡</p>
<ul>
<li>SMTP ì„œë²„ ì œê³µ</li>
<li>DKIM ì¸ì¦ ê´€ë¦¬</li>
<li>ë°œì†¡ í†µê³„ ë° ë¡œê·¸</li>
</ul>
<h3>4. Whois (ë„ë©”ì¸ ë“±ë¡ì—…ì²´)</h3>
<p><strong>ì—­í• </strong>: ë„ë©”ì¸ DNS ê´€ë¦¬</p>
<ul>
<li>DKIM TXT ë ˆì½”ë“œ ë“±ë¡</li>
<li>ë„ë©”ì¸ ì†Œìœ ê¶Œ ì¸ì¦</li>
<li>DNS ì„¤ì • ê´€ë¦¬</li>
</ul>
<hr>
<h2>ì „ì²´ êµ¬ì¡°ë„</h2>
<pre><code>ì‚¬ìš©ì (ë¸Œë¼ìš°ì €)
    â†“ íšŒì›ê°€ì…
Next.js App (Vercel)
    â†“ API ìš”ì²­
Supabase Auth
    â†“ SMTP ìš”ì²­
Resend (SMTP)
    â†“ DKIM ê²€ì¦ (DNS)
Whois (ë„ë©”ì¸ DNS)
    â†“ ì´ë©”ì¼ ë°œì†¡
ì‚¬ìš©ì ì´ë©”ì¼
    â†“ ë§í¬ í´ë¦­
Next.js App (/auth/callback)
    â†“ ì„¸ì…˜ ìƒì„±
ë¡œê·¸ì¸ ì™„ë£Œ
</code></pre>
<hr>
<h2>ë‹¨ê³„ë³„ êµ¬ì¶• ê³¼ì •</h2>
<h3>Phase 1: Resend SMTP ì„¤ì •</h3>
<h4>1-1. Resend ê³„ì • ìƒì„± ë° ë„ë©”ì¸ ë“±ë¡</h4>
<pre><code class="language-bash"># Resend ê°€ì…
https://resend.com

# ë„ë©”ì¸ ë“±ë¡
- Domain: politicianfinder.ai.kr
- ìƒíƒœ: Pending (DKIM ì¸ì¦ ëŒ€ê¸°)
</code></pre>
<h4>1-2. DKIM TXT ë ˆì½”ë“œ ë“±ë¡ (Whois)</h4>
<p>Resendì—ì„œ ì œê³µí•˜ëŠ” DKIM ì •ë³´ë¥¼ ë„ë©”ì¸ DNSì— ë“±ë¡:</p>
<pre><code>ë ˆì½”ë“œ íƒ€ì…: TXT
í˜¸ìŠ¤íŠ¸ëª…: resend._domainkey
ê°’: p=MIGfMA0GCSqGSIb3DQEBAQUAA4GNADCBiQKBgQC... (Resend ì œê³µ)
TTL: 3600
</code></pre>
<p><strong>ì¤‘ìš”</strong>: DNS ì „íŒŒëŠ” ìµœëŒ€ 48ì‹œê°„ ì†Œìš” (ë³´í†µ 1-2ì‹œê°„)</p>
<h4>1-3. DKIM ì¸ì¦ í™•ì¸</h4>
<pre><code class="language-bash"># Resend Dashboardì—ì„œ í™•ì¸
Domain Status: âœ… Verified
</code></pre>
<h3>Phase 2: Supabase SMTP ì—°ë™</h3>
<h4>2-1. Supabaseì— Resend SMTP ì„¤ì •</h4>
<pre><code>Supabase Dashboard â†’ Settings â†’ Auth â†’ SMTP Settings

SMTP Host: smtp.resend.com
SMTP Port: 587
SMTP Username: resend
SMTP Password: [Resend API Key]
Sender Email: noreply@politicianfinder.ai.kr
Sender Name: PoliticianFinder
</code></pre>
<h4>2-2. Site URL ì„¤ì •</h4>
<pre><code>Settings â†’ Auth â†’ URL Configuration

Site URL: https://www.politicianfinder.ai.kr
Redirect URLs:
  - http://localhost:3000/auth/callback
  - https://www.politicianfinder.ai.kr/auth/callback
</code></pre>
<h3>Phase 3: Next.js íšŒì›ê°€ì… API êµ¬í˜„</h3>
<h4>3-1. íšŒì›ê°€ì… API ì‘ì„±</h4>
<pre><code class="language-typescript">// app/api/auth/signup/route.ts
import { createAdminClient } from &#39;@/lib/supabase/admin&#39;;

export async function POST(request: NextRequest) {
  const { email, password, nickname } = await request.json();

  // 1. Supabase Authì— ì‚¬ìš©ì ìƒì„±
  const { data: authData, error: authError } = await supabase.auth.signUp({
    email,
    password,
    options: {
      data: { name: nickname },
      emailRedirectTo: &#39;https://www.politicianfinder.ai.kr/auth/callback&#39;,
    },
  });

  if (authError) {
    // ì—ëŸ¬ ì²˜ë¦¬
  }

  // 2. users í…Œì´ë¸”ì— í”„ë¡œí•„ ìƒì„± (ì¤‘ìš”!)
  const adminClient = createAdminClient();
  const { error: profileError } = await adminClient
    .from(&#39;users&#39;)
    .insert({
      user_id: authData.user.id,  // âš ï¸ ì»¬ëŸ¼ëª… ì£¼ì˜! (idê°€ ì•„ë‹ˆë¼ user_id)
      email,
      nickname,
      name: nickname,
      role: &#39;user&#39;,
      is_active: true,
      terms_agreed: true,
      privacy_agreed: true,
      marketing_agreed: false,
    });

  // 3. users í…Œì´ë¸” ì‚½ì… ì‹¤íŒ¨ ì‹œ ë¡¤ë°± (ì¤‘ìš”!)
  if (profileError) {
    await adminClient.auth.admin.deleteUser(authData.user.id);
    return NextResponse.json({ error: &#39;íšŒì›ê°€ì… ì‹¤íŒ¨&#39; }, { status: 500 });
  }

  return NextResponse.json({ success: true });
}
</code></pre>
<p><strong>í•µì‹¬ í¬ì¸íŠ¸:</strong></p>
<ul>
<li>âœ… <code>emailRedirectTo</code>ë¡œ ì¸ì¦ í›„ ë¦¬ë‹¤ì´ë ‰íŠ¸ URL ì§€ì •</li>
<li>âœ… users í…Œì´ë¸” ì‚½ì… ì‹¤íŒ¨ ì‹œ <strong>ë°˜ë“œì‹œ ë¡¤ë°±</strong> (ë°ì´í„° ì¼ê´€ì„±)</li>
<li>âœ… ì»¬ëŸ¼ëª… í™•ì¸ (<code>user_id</code> vs <code>id</code>)</li>
</ul>
<h4>3-2. ì¸ì¦ ì½œë°± ì²˜ë¦¬</h4>
<pre><code class="language-typescript">// app/auth/callback/route.ts
import { createRouteHandlerClient } from &#39;@supabase/auth-helpers-nextjs&#39;;
import { cookies } from &#39;next/headers&#39;;
import { NextRequest, NextResponse } from &#39;next/server&#39;;

export async function GET(request: NextRequest) {
  const requestUrl = new URL(request.url);
  const code = requestUrl.searchParams.get(&#39;code&#39;);

  if (code) {
    const supabase = createRouteHandlerClient({ cookies });
    await supabase.auth.exchangeCodeForSession(code);
  }

  return NextResponse.redirect(
    new URL(&#39;/auth/login?verified=true&#39;, request.url)
  );
}
</code></pre>
<h3>Phase 4: ì´ë©”ì¼ í…œí”Œë¦¿ ìˆ˜ì • âš ï¸ <strong>ê°€ì¥ ì¤‘ìš”!</strong></h3>
<h4>4-1. ë¬¸ì œ: ì˜ëª»ëœ ë„ë©”ì¸ ë§í¬</h4>
<p>ê¸°ë³¸ Supabase í…œí”Œë¦¿ì€ <code>{{ .SiteURL }}</code> ë³€ìˆ˜ë¥¼ ì‚¬ìš©í•©ë‹ˆë‹¤:</p>
<pre><code class="language-html">&lt;!-- ê¸°ë³¸ í…œí”Œë¦¿ (ë¬¸ì œ ìˆìŒ) --&gt;
&lt;a href=&quot;{{ .SiteURL }}/auth/callback?...&quot;&gt;ì´ë©”ì¼ ì¸ì¦í•˜ê¸°&lt;/a&gt;

&lt;!-- ì‹¤ì œ ìƒì„±ë˜ëŠ” URL --&gt;
https://politicianfinder.ai.kr/auth/callback?...
</code></pre>
<p><strong>ë¬¸ì œì :</strong></p>
<ul>
<li><code>{{ .SiteURL }}</code>ì€ Supabase Dashboardì˜ Site URL ì„¤ì •ê°’ì„ ê·¸ëŒ€ë¡œ ì‚¬ìš©</li>
<li><code>emailRedirectTo</code> íŒŒë¼ë¯¸í„°ë¥¼ <strong>ë¬´ì‹œí•¨</strong></li>
<li>www ì„œë¸Œë„ë©”ì¸ì´ ë¹ ì§ â†’ DNS ì—ëŸ¬</li>
</ul>
<h4>4-2. í•´ê²°: URL í•˜ë“œì½”ë”©</h4>
<pre><code>Supabase Dashboard â†’ Authentication â†’ Email Templates â†’ Confirm signup
</code></pre>
<p><strong>ë³€ê²½ ì „:</strong></p>
<pre><code class="language-html">&lt;a href=&quot;{{ .SiteURL }}/auth/confirm?token_hash={{ .TokenHash }}&amp;type=signup&quot;&gt;
  ì´ë©”ì¼ ì¸ì¦í•˜ê¸°
&lt;/a&gt;
</code></pre>
<p><strong>ë³€ê²½ í›„:</strong></p>
<pre><code class="language-html">&lt;a href=&quot;https://www.politicianfinder.ai.kr/auth/callback?token_hash={{ .TokenHash }}&amp;type=signup&quot;&gt;
  ì´ë©”ì¼ ì¸ì¦í•˜ê¸°
&lt;/a&gt;
</code></pre>
<p><strong>í•µì‹¬:</strong></p>
<ul>
<li>âœ… ë„ë©”ì¸ì„ <strong>ì§ì ‘ í•˜ë“œì½”ë”©</strong> (ê°€ì¥ í™•ì‹¤í•¨)</li>
<li>âœ… <code>{{ .TokenHash }}</code> ë³€ìˆ˜ë§Œ ìœ ì§€</li>
<li>âœ… ë‹¤ë¥¸ í…œí”Œë¦¿ë„ ë™ì¼í•˜ê²Œ ìˆ˜ì • (Magic Link, Password Reset ë“±)</li>
</ul>
<h4>4-3. Send Email Hookì€ ì‚¬ìš© ì•ˆ í•¨!</h4>
<p>ì‹œë„í–ˆìœ¼ë‚˜ ì‹¤íŒ¨í•œ ë°©ë²•:</p>
<ul>
<li>âŒ Send Email Hook (webhook ì¸ì¦ ë¬¸ì œ, ë³µì¡ë„ ì¦ê°€)</li>
<li>âŒ Edge Functionìœ¼ë¡œ ì´ë©”ì¼ ë°œì†¡ (ë””ë²„ê¹… ì–´ë ¤ì›€)</li>
</ul>
<p><strong>ìµœì¢… ì„ íƒ:</strong></p>
<ul>
<li>âœ… SMTP (Resend) + í…œí”Œë¦¿ ìˆ˜ì • = ê°€ì¥ ê°„ë‹¨í•˜ê³  ì•ˆì •ì </li>
</ul>
<h3>Phase 5: ë¡œê·¸ì¸ API ìˆ˜ì •</h3>
<h4>5-1. users í…Œì´ë¸” ì¡°íšŒ ë° ìë™ ìƒì„±</h4>
<pre><code class="language-typescript">// app/api/auth/login/route.ts
export async function POST(request: NextRequest) {
  const { email, password } = await request.json();

  // 1. Supabase Auth ë¡œê·¸ì¸
  const { data: authData, error } = await supabase.auth.signInWithPassword({
    email,
    password,
  });

  // 2. users í…Œì´ë¸”ì—ì„œ í”„ë¡œí•„ ì¡°íšŒ
  const { data: userProfile } = await supabase
    .from(&#39;users&#39;)
    .select(&#39;*&#39;)
    .eq(&#39;user_id&#39;, authData.user.id)  // âš ï¸ user_idë¡œ ì¡°íšŒ!
    .single();

  // 3. í”„ë¡œí•„ ì—†ìœ¼ë©´ ìë™ ìƒì„± (ì´ì¤‘ ì•ˆì „ì¥ì¹˜)
  if (!userProfile) {
    await supabase.from(&#39;users&#39;).insert({
      user_id: authData.user.id,
      email: authData.user.email,
      nickname: authData.user.email.split(&#39;@&#39;)[0],
      // ... ë‚˜ë¨¸ì§€ í•„ë“œ
    });
  }

  return NextResponse.json({ success: true, user: authData.user });
}
</code></pre>
<p><strong>í•µì‹¬:</strong></p>
<ul>
<li>âœ… auth.usersì™€ users í…Œì´ë¸” <strong>ì´ì¤‘ ì•ˆì „ì¥ì¹˜</strong></li>
<li>âœ… íšŒì›ê°€ì… ì‹œ users í…Œì´ë¸” ì‚½ì… ì‹¤íŒ¨í•´ë„ ë¡œê·¸ì¸ ì‹œ ìë™ ìƒì„±</li>
</ul>
<hr>
<h2>ë°œìƒí•œ ë¬¸ì œì™€ í•´ê²° ë°©ë²•</h2>
<h3>ğŸ”´ ë¬¸ì œ 1: ì´ë©”ì¼ ë§í¬ê°€ ì˜ëª»ëœ ë„ë©”ì¸ìœ¼ë¡œ ìƒì„±</h3>
<p><strong>ì¦ìƒ:</strong></p>
<pre><code>ì´ë©”ì¼ ë§í¬: https://politicianfinder.ai.kr/auth/callback?...
ì—ëŸ¬: DNS_PROBE_FINISHED_NXDOMAIN
</code></pre>
<p><strong>ì›ì¸:</strong></p>
<ul>
<li>Supabase ì´ë©”ì¼ í…œí”Œë¦¿ì´ <code>{{ .SiteURL }}</code> ë³€ìˆ˜ ì‚¬ìš©</li>
<li>ì´ ë³€ìˆ˜ëŠ” <code>emailRedirectTo</code> íŒŒë¼ë¯¸í„°ë¥¼ ë¬´ì‹œí•˜ê³  Site URL ì„¤ì •ê°’ë§Œ ì‚¬ìš©</li>
</ul>
<p><strong>ì‹œë„í•œ í•´ê²°ì±… (ëª¨ë‘ ì‹¤íŒ¨):</strong></p>
<ol>
<li>âŒ <code>NEXT_PUBLIC_SITE_URL</code> í™˜ê²½ë³€ìˆ˜ ë³€ê²½ â†’ í…œí”Œë¦¿ì— ì˜í–¥ ì—†ìŒ</li>
<li>âŒ Supabase Site URL ì„¤ì • ë³€ê²½ â†’ ë³€ìˆ˜ê°€ ê·¸ëŒ€ë¡œ ì‚¬ìš©ë¨</li>
<li>âŒ <code>emailRedirectTo</code> í•˜ë“œì½”ë”© â†’ <code>{{ .SiteURL }}</code>ì´ ìš°ì„ </li>
<li>âŒ Send Email Hook êµ¬í˜„ â†’ &quot;Hook requires authorization token&quot; ì—ëŸ¬</li>
<li>âŒ Hook webhook ê²€ì¦ ì œê±° â†’ ì´ë©”ì¼ ë°œì†¡ ì•ˆë¨</li>
</ol>
<p><strong>ìµœì¢… í•´ê²°:</strong></p>
<pre><code class="language-html">&lt;!-- í…œí”Œë¦¿ì—ì„œ ì§ì ‘ í•˜ë“œì½”ë”© --&gt;
&lt;a href=&quot;https://www.politicianfinder.ai.kr/auth/callback?token_hash={{ .TokenHash }}&amp;type=signup&quot;&gt;
</code></pre>
<p><strong>ì†Œìš” ì‹œê°„</strong>: ì•½ 6ì‹œê°„</p>
<hr>
<h3>ğŸ”´ ë¬¸ì œ 2: ì´ë©”ì¼ ì¸ì¦ í›„ ë¡œê·¸ì¸ ì‹¤íŒ¨</h3>
<p><strong>ì¦ìƒ:</strong></p>
<pre><code>- ì´ë©”ì¼ ì¸ì¦ ì™„ë£Œ (auth.usersì— email_confirmed_at ìˆìŒ)
- ì˜¬ë°”ë¥¸ ë¹„ë°€ë²ˆí˜¸ ì…ë ¥
- ë¡œê·¸ì¸ ì‹¤íŒ¨: &quot;ì´ë©”ì¼ ë˜ëŠ” ë¹„ë°€ë²ˆí˜¸ê°€ ì˜¬ë°”ë¥´ì§€ ì•ŠìŠµë‹ˆë‹¤&quot;
</code></pre>
<p><strong>ì›ì¸:</strong></p>
<pre><code class="language-sql">-- auth.usersì—ëŠ” ì¡´ì¬
SELECT * FROM auth.users WHERE email = &#39;test@test.com&#39;;
-- âœ… 1 row

-- users í…Œì´ë¸”ì—ëŠ” ì—†ìŒ!
SELECT * FROM users WHERE email = &#39;test@test.com&#39;;
-- âŒ 0 rows
</code></pre>
<p><strong>ê·¼ë³¸ ì›ì¸:</strong>
íšŒì›ê°€ì… APIì—ì„œ ì˜ëª»ëœ ì»¬ëŸ¼ëª… ì‚¬ìš©:</p>
<pre><code class="language-typescript">// âŒ ì˜ëª»ëœ ì½”ë“œ
.insert({
  id: authData.user.id,  // &#39;id&#39; ì»¬ëŸ¼ì´ ì—†ìŒ!
  email,
  // ...
})

// âœ… ì˜¬ë°”ë¥¸ ì½”ë“œ
.insert({
  user_id: authData.user.id,  // &#39;user_id&#39;ê°€ ì˜¬ë°”ë¥¸ ì»¬ëŸ¼ëª…
  email,
  // ...
})
</code></pre>
<p><strong>í•´ê²° ë°©ë²•:</strong></p>
<ol>
<li>íšŒì›ê°€ì… API: <code>id</code> â†’ <code>user_id</code> ìˆ˜ì •</li>
<li>ë¡œê·¸ì¸ API: <code>user_id</code>ë¡œ ì¡°íšŒí•˜ë„ë¡ ìˆ˜ì •</li>
<li>í”„ë¡œí•„ ì—†ìœ¼ë©´ ìë™ ìƒì„± (ì´ì¤‘ ì•ˆì „ì¥ì¹˜)</li>
<li>users í…Œì´ë¸” ì‚½ì… ì‹¤íŒ¨ ì‹œ auth.users ì‚­ì œ (ë¡¤ë°±)</li>
</ol>
<p><strong>ì†Œìš” ì‹œê°„</strong>: ì•½ 2ì‹œê°„</p>
<hr>
<h3>ğŸ”´ ë¬¸ì œ 3: DKIM ì¸ì¦ ì—†ì–´ì„œ ìŠ¤íŒ¸ ì²˜ë¦¬</h3>
<p><strong>ì¦ìƒ:</strong></p>
<ul>
<li>ì´ë©”ì¼ì´ ìŠ¤íŒ¸ í´ë”ë¡œ ì´ë™</li>
<li>Gmailì—ì„œ &quot;ë°œì‹ ì ì¸ì¦ ì•ˆë¨&quot; ê²½ê³ </li>
</ul>
<p><strong>í•´ê²°:</strong></p>
<ol>
<li>Resendì—ì„œ DKIM TXT ë ˆì½”ë“œ ì •ë³´ ë³µì‚¬</li>
<li>Whois DNS ê´€ë¦¬ í˜ì´ì§€ì—ì„œ TXT ë ˆì½”ë“œ ì¶”ê°€</li>
<li>1-2ì‹œê°„ ëŒ€ê¸° (DNS ì „íŒŒ)</li>
<li>Resendì—ì„œ &quot;Verify&quot; í´ë¦­</li>
</ol>
<p><strong>ì†Œìš” ì‹œê°„</strong>: ì•½ 30ë¶„ (DNS ì „íŒŒ ëŒ€ê¸° ì œì™¸)</p>
<hr>
<h2>í•µì‹¬ êµí›ˆ</h2>
<h3>1. Supabase ì´ë©”ì¼ í…œí”Œë¦¿ ë³€ìˆ˜ì˜ í•¨ì •</h3>
<p><strong>í…œí”Œë¦¿ ë³€ìˆ˜ ë¹„êµ:</strong></p>
<table>
<thead>
<tr>
<th>ë³€ìˆ˜</th>
<th>ë™ì‘</th>
<th>emailRedirectTo ë°˜ì˜</th>
</tr>
</thead>
<tbody><tr>
<td><code>{{ .SiteURL }}</code></td>
<td>Dashboard Site URL ê·¸ëŒ€ë¡œ ì‚¬ìš©</td>
<td>âŒ ë¬´ì‹œí•¨</td>
</tr>
<tr>
<td><code>{{ .ConfirmationURL }}</code></td>
<td>Supabaseê°€ ìë™ ìƒì„± (í† í° í¬í•¨)</td>
<td>âœ… ë°˜ì˜ë¨</td>
</tr>
<tr>
<td><code>{{ .RedirectTo }}</code></td>
<td>emailRedirectTo íŒŒë¼ë¯¸í„° ê°’</td>
<td>âœ… ë°˜ì˜ë¨</td>
</tr>
<tr>
<td>í•˜ë“œì½”ë”©</td>
<td>ì§ì ‘ ì…ë ¥í•œ URL</td>
<td>N/A (ë³€ìˆ˜ ì•„ë‹˜)</td>
</tr>
</tbody></table>
<p><strong>Best Practice:</strong></p>
<ul>
<li>ë„ë©”ì¸ì´ í™•ì •ë˜ë©´ <strong>í•˜ë“œì½”ë”©</strong>ì´ ê°€ì¥ ì•ˆì „</li>
<li><code>{{ .TokenHash }}</code>ë§Œ ë³€ìˆ˜ë¡œ ìœ ì§€</li>
</ul>
<h3>2. Send Email Hookì€ í•„ìš” ì—†ë‹¤</h3>
<p><strong>Hookì„ ì‚¬ìš©í•´ì•¼ í•˜ëŠ” ê²½ìš°:</strong></p>
<ul>
<li>âœ… ì¡°ê±´ë¶€ ì´ë©”ì¼ ë°œì†¡ (íŠ¹ì • ì‚¬ìš©ìë§Œ)</li>
<li>âœ… ë‹¤ë¥¸ ì´ë©”ì¼ ì„œë¹„ìŠ¤ API ì‚¬ìš© (SendGrid, Mailgun ë“±)</li>
<li>âœ… ë³µì¡í•œ ì»¤ìŠ¤í…€ ë¡œì§ í•„ìš”</li>
</ul>
<p><strong>Hookì´ ë¶ˆí•„ìš”í•œ ê²½ìš°:</strong></p>
<ul>
<li>âŒ ë‹¨ìˆœ URL ë³€ê²½ â†’ í…œí”Œë¦¿ ìˆ˜ì •ìœ¼ë¡œ ì¶©ë¶„</li>
<li>âŒ SMTPë§Œ ì‚¬ìš© â†’ Resend SMTPë¡œ ì¶©ë¶„</li>
</ul>
<p><strong>êµí›ˆ:</strong></p>
<blockquote>
<p>ë³µì¡ë„ë¥¼ ë†’ì´ì§€ ë§ˆë¼. SMTP + í…œí”Œë¦¿ ìˆ˜ì •ì´ ê°€ì¥ ê°„ë‹¨í•˜ê³  ì•ˆì •ì ì´ë‹¤.</p>
</blockquote>
<h3>3. ë°ì´í„°ë² ì´ìŠ¤ ìŠ¤í‚¤ë§ˆ ì¼ê´€ì„±</h3>
<p><strong>ë¬¸ì œ ìƒí™©:</strong></p>
<pre><code class="language-typescript">// ì½”ë“œì—ì„œëŠ” &#39;id&#39; ì‚¬ìš©
.insert({ id: user.id })

// ì‹¤ì œ DBëŠ” &#39;user_id&#39;
// âŒ Error: Could not find the &#39;id&#39; column
</code></pre>
<p><strong>í•´ê²°:</strong></p>
<ol>
<li>í”„ë¡œì íŠ¸ ì „ì²´ ì»¬ëŸ¼ëª… í†µì¼ (<code>user_id</code>ë¡œ ê²°ì •)</li>
<li><code>database.types.ts</code> ìë™ ìƒì„± í™œìš©</li>
<li>API ì½”ë“œ ì‘ì„± ì „ ìŠ¤í‚¤ë§ˆ í™•ì¸</li>
</ol>
<p><strong>í™•ì¸ ë°©ë²•:</strong></p>
<pre><code class="language-typescript">// Pythonìœ¼ë¡œ ìŠ¤í‚¤ë§ˆ í™•ì¸
result = supabase.table(&#39;users&#39;).select(&#39;*&#39;).limit(1).execute()
columns = list(result.data[0].keys())
print(columns)  # [&#39;user_id&#39;, &#39;email&#39;, &#39;nickname&#39;, ...]
</code></pre>
<h3>4. auth.users â†” users í…Œì´ë¸” ë™ê¸°í™”</h3>
<p><strong>íŠ¸ëœì­ì…˜ ë¬´ê²°ì„± ë³´ì¥:</strong></p>
<pre><code class="language-typescript">// íšŒì›ê°€ì… API
const { data: authData } = await supabase.auth.signUp({...});

const { error: profileError } = await supabase
  .from(&#39;users&#39;)
  .insert({ user_id: authData.user.id, ... });

// âš ï¸ ì¤‘ìš”: ì‹¤íŒ¨ ì‹œ ë¡¤ë°±!
if (profileError) {
  await supabase.auth.admin.deleteUser(authData.user.id);
  return error;
}
</code></pre>
<pre><code class="language-typescript">// ë¡œê·¸ì¸ API - ì´ì¤‘ ì•ˆì „ì¥ì¹˜
const { data: userProfile } = await supabase
  .from(&#39;users&#39;)
  .select(&#39;*&#39;)
  .eq(&#39;user_id&#39;, authData.user.id)
  .single();

// í”„ë¡œí•„ ì—†ìœ¼ë©´ ìë™ ìƒì„±
if (!userProfile) {
  await supabase.from(&#39;users&#39;).insert({...});
}
</code></pre>
<p><strong>êµí›ˆ:</strong></p>
<blockquote>
<p>auth.usersì™€ users í…Œì´ë¸”ì€ í•­ìƒ 1:1ë¡œ ë™ê¸°í™”ë˜ì–´ì•¼ í•œë‹¤.</p>
</blockquote>
<h3>5. ë””ë²„ê¹… í”„ë¡œì„¸ìŠ¤</h3>
<p><strong>ì˜¬ë°”ë¥¸ ë””ë²„ê¹… ìˆœì„œ:</strong></p>
<ol>
<li>ì¦ìƒ í™•ì¸ (ë¡œê·¸ì¸ ì‹¤íŒ¨, ì´ë©”ì¼ ë§í¬ ì—ëŸ¬ ë“±)</li>
<li><strong>ë°ì´í„° í™•ì¸</strong> (auth.users vs users í…Œì´ë¸” ë¹„êµ)</li>
<li><strong>ìŠ¤í‚¤ë§ˆ í™•ì¸</strong> (ì‹¤ì œ ì»¬ëŸ¼ëª… í™•ì¸)</li>
<li>ì½”ë“œ í™•ì¸ (APIì—ì„œ ì‚¬ìš©í•˜ëŠ” ì»¬ëŸ¼ëª… ê²€ì¦)</li>
<li>ìˆ˜ì • ë° ê²€ì¦</li>
</ol>
<p><strong>ì•ˆí‹°íŒ¨í„´:</strong></p>
<ul>
<li>âŒ ì¦ìƒë§Œ ë³´ê³  ì„ì‹œ í•´ê²°ì±… ì ìš©</li>
<li>âŒ ê·¼ë³¸ ì›ì¸ íŒŒì•… ì—†ì´ ë‹¤ë¥¸ ë°©ë²• ì‹œë„</li>
<li>âŒ ë°ì´í„°/ìŠ¤í‚¤ë§ˆ í™•ì¸ ì—†ì´ ì½”ë“œë§Œ ìˆ˜ì •</li>
</ul>
<p><strong>êµí›ˆ:</strong></p>
<blockquote>
<p>ë¬¸ì œ ë°œìƒ ì‹œ ë°ì´í„°ì™€ ìŠ¤í‚¤ë§ˆë¶€í„° í™•ì¸í•˜ë¼. ì½”ë“œëŠ” ê·¸ ë‹¤ìŒì´ë‹¤.</p>
</blockquote>
<hr>
<h2>ì²´í¬ë¦¬ìŠ¤íŠ¸</h2>
<h3>Phase 1: Resend ì„¤ì •</h3>
<ul>
<li><input disabled="" type="checkbox"> Resend ê³„ì • ìƒì„±</li>
<li><input disabled="" type="checkbox"> ë„ë©”ì¸ ë“±ë¡</li>
<li><input disabled="" type="checkbox"> DKIM TXT ë ˆì½”ë“œ ë“±ë¡ (Whois)</li>
<li><input disabled="" type="checkbox"> DKIM ì¸ì¦ í™•ì¸ (Verified ìƒíƒœ)</li>
</ul>
<h3>Phase 2: Supabase ì„¤ì •</h3>
<ul>
<li><input disabled="" type="checkbox"> SMTP ì„¤ì • (Resend ì •ë³´ ì…ë ¥)</li>
<li><input disabled="" type="checkbox"> Site URL ì„¤ì • (<code>https://www.yourdomain.com</code>)</li>
<li><input disabled="" type="checkbox"> Redirect URLs ë“±ë¡ (<code>/auth/callback</code>)</li>
<li><input disabled="" type="checkbox"> <strong>ì´ë©”ì¼ í…œí”Œë¦¿ ìˆ˜ì •</strong> (URL í•˜ë“œì½”ë”©) â­ ì¤‘ìš”!</li>
<li><input disabled="" type="checkbox"> Send Email Hook ë¹„í™œì„±í™”</li>
</ul>
<h3>Phase 3: Next.js API êµ¬í˜„</h3>
<ul>
<li><input disabled="" type="checkbox"> íšŒì›ê°€ì… API ì‘ì„±<ul>
<li><input disabled="" type="checkbox"> <code>emailRedirectTo</code> ì„¤ì •</li>
<li><input disabled="" type="checkbox"> users í…Œì´ë¸” ì‚½ì…</li>
<li><input disabled="" type="checkbox"> ì‹¤íŒ¨ ì‹œ ë¡¤ë°± ë¡œì§</li>
</ul>
</li>
<li><input disabled="" type="checkbox"> ì¸ì¦ ì½œë°± ì²˜ë¦¬ (<code>/auth/callback</code>)</li>
<li><input disabled="" type="checkbox"> ë¡œê·¸ì¸ API ìˆ˜ì •<ul>
<li><input disabled="" type="checkbox"> <code>user_id</code>ë¡œ ì¡°íšŒ</li>
<li><input disabled="" type="checkbox"> í”„ë¡œí•„ ì—†ìœ¼ë©´ ìë™ ìƒì„±</li>
</ul>
</li>
</ul>
<h3>Phase 4: ìŠ¤í‚¤ë§ˆ í™•ì¸</h3>
<ul>
<li><input disabled="" type="checkbox"> users í…Œì´ë¸” ì»¬ëŸ¼ëª… í™•ì¸ (<code>user_id</code> vs <code>id</code>)</li>
<li><input disabled="" type="checkbox"> ëª¨ë“  í…Œì´ë¸”ì—ì„œ <code>user_id</code> í†µì¼ í™•ì¸</li>
<li><input disabled="" type="checkbox"> í•„ìˆ˜ ì»¬ëŸ¼ í™•ì¸ (nickname, is_active, terms_agreed ë“±)</li>
</ul>
<h3>Phase 5: í…ŒìŠ¤íŠ¸</h3>
<ul>
<li><input disabled="" type="checkbox"> íšŒì›ê°€ì… â†’ ì´ë©”ì¼ ë°œì†¡ í™•ì¸</li>
<li><input disabled="" type="checkbox"> ì´ë©”ì¼ ë§í¬ í´ë¦­ â†’ ì¸ì¦ ì™„ë£Œ í™•ì¸</li>
<li><input disabled="" type="checkbox"> ë¡œê·¸ì¸ ì„±ê³µ í™•ì¸</li>
<li><input disabled="" type="checkbox"> users í…Œì´ë¸”ì— ë°ì´í„° ìƒì„± í™•ì¸</li>
</ul>
<h3>Phase 6: í”„ë¡œë•ì…˜ ë°°í¬</h3>
<ul>
<li><input disabled="" type="checkbox"> í™˜ê²½ë³€ìˆ˜ ì„¤ì • (Vercel)</li>
<li><input disabled="" type="checkbox"> ë°°í¬ ë° í…ŒìŠ¤íŠ¸</li>
<li><input disabled="" type="checkbox"> ì‹¤ì œ ì´ë©”ì¼ ì£¼ì†Œë¡œ í…ŒìŠ¤íŠ¸</li>
<li><input disabled="" type="checkbox"> DKIM ì¸ì¦ í™•ì¸ (ìŠ¤íŒ¸ ë°©ì§€)</li>
</ul>
<hr>
<h2>ì°¸ê³  ìë£Œ</h2>
<h3>Supabase ê³µì‹ ë¬¸ì„œ</h3>
<ul>
<li><a href="https://supabase.com/docs/guides/auth/auth-email-templates">Email Templates</a></li>
<li><a href="https://supabase.com/docs/guides/auth/auth-hooks/send-email-hook">Send Email Hook</a></li>
<li><a href="https://supabase.com/docs/guides/auth/auth-smtp">SMTP Configuration</a></li>
</ul>
<h3>Resend ê³µì‹ ë¬¸ì„œ</h3>
<ul>
<li><a href="https://resend.com/docs/dashboard/domains/introduction">DKIM Setup</a></li>
<li><a href="https://resend.com/docs/send-with-smtp">SMTP Integration</a></li>
</ul>
<h3>ì´ í”„ë¡œì íŠ¸ì˜ ê´€ë ¨ íŒŒì¼</h3>
<ul>
<li><code>1_Frontend/src/app/api/auth/signup/route.ts</code> - íšŒì›ê°€ì… API</li>
<li><code>1_Frontend/src/app/api/auth/login/route.ts</code> - ë¡œê·¸ì¸ API</li>
<li><code>1_Frontend/src/app/auth/callback/route.ts</code> - ì¸ì¦ ì½œë°±</li>
<li><code>0-5_Development_ProjectGrid/action/PROJECT_GRID_REVISED/grid/update_P3BA1_email_verification_complete.json</code> - ì „ì²´ ì‘ì—… ë¡œê·¸</li>
</ul>
<hr>
<h2>ë§ˆë¬´ë¦¬</h2>
<p>ì´ ê°€ì´ë“œëŠ” ì•½ 10ì‹œê°„ì˜ ì‹œí–‰ì°©ì˜¤ ëì— ì–»ì€ ì‹¤ì „ ê²½í—˜ì…ë‹ˆë‹¤.</p>
<p><strong>í•µì‹¬ 3ê°€ì§€:</strong></p>
<ol>
<li><strong>ì´ë©”ì¼ í…œí”Œë¦¿ì€ í•˜ë“œì½”ë”©í•˜ë¼</strong> (<code>{{ .SiteURL }}</code> í•¨ì • ì¡°ì‹¬)</li>
<li><strong>auth.usersì™€ users í…Œì´ë¸”ì„ í•­ìƒ ë™ê¸°í™”í•˜ë¼</strong> (ë¡¤ë°± ë¡œì§ í•„ìˆ˜)</li>
<li><strong>Send Email Hookì€ ë³µì¡ë„ë§Œ ë†’ì¸ë‹¤</strong> (SMTP + í…œí”Œë¦¿ìœ¼ë¡œ ì¶©ë¶„)</li>
</ol>
<p>ì—¬ëŸ¬ë¶„ì˜ í”„ë¡œì íŠ¸ì— ì´ ê°€ì´ë“œê°€ ë„ì›€ì´ ë˜ê¸¸ ë°”ëë‹ˆë‹¤!</p>

        </article>
    </main>
</body>
</html>