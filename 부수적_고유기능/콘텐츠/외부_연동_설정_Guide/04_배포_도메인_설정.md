# 배포 및 도메인 설정 가이드

> Vercel + Whois DNS + 환경변수 통합 설정

**작성일**: 2025-12-17
**버전**: 1.1
**난이도**: ⭐⭐⭐ (중급)

---

## ✅ 현재 설정 상태 (2025-12-17)

| 항목 | 상태 | 비고 |
|------|------|------|
| Vercel 프로젝트 | ✅ 완료 | `ssal-works` |
| 환경변수 설정 | ✅ 완료 | Supabase, Resend |
| 도메인 연결 | ✅ 완료 | www.ssalworks.ai.kr |
| SSL 인증서 | ✅ 완료 | 자동 발급 |
| DNS 전파 | ✅ 완료 | A/TXT 레코드 |

**접속 URL**: https://www.ssalworks.ai.kr

---

## 목차

1. [개요](#1-개요)
2. [전체 구조도](#2-전체-구조도)
3. [Phase 1: Vercel 프로젝트 설정](#3-phase-1-vercel-프로젝트-설정)
4. [Phase 2: 폴더 구조 정리](#4-phase-2-폴더-구조-정리)
5. [Phase 3: vercel.json 설정](#5-phase-3-verceljson-설정)
6. [Phase 4: 환경변수 설정](#6-phase-4-환경변수-설정)
7. [Phase 5: 도메인 연결 (Whois DNS)](#7-phase-5-도메인-연결-whois-dns)
8. [시도했으나 실패한 방법들](#8-시도했으나-실패한-방법들)
9. [트러블슈팅 (실전 경험)](#9-트러블슈팅-실전-경험)
10. [체크리스트](#10-체크리스트)

---

## 1. 개요

### 목표
- SSALWorks 프로젝트를 Vercel에 배포
- ssalworks.ai.kr 도메인 연결
- Serverless Functions (API) 배포
- SSL 인증서 자동 설정

### 관련 서비스
| 서비스 | 역할 |
|--------|------|
| **Vercel** | 호스팅, Serverless Functions |
| **GitHub** | 소스 코드 저장소 |
| **Whois** | 도메인 DNS 관리 |

### ⚠️ 핵심 교훈 (먼저 읽기)

1. **Whois DNS 고급설정을 사용해야 함**
2. **루트 도메인(@) 대신 www 서브도메인 권장**
3. **DNS 전파는 최대 48시간 소요**

### 🕐 소요 시간 안내

> **설정 자체는 어렵지 않습니다.**

| 단계 | 소요 시간 |
|------|----------|
| Vercel 프로젝트 설정 | 10분 |
| 환경변수 설정 | 5분 |
| Whois DNS 레코드 추가 | 10분 |
| DNS 전파 | 보통 5~30분 (최대 48시간) |
| SSL 인증서 발급 | 보통 1~5분 (자동) |

**총 소요 시간**: 약 30분 ~ 1시간 (대부분의 경우)

**팁**: DNS 레코드 설정 후 바로 안 되면 5~10분 기다렸다가 다시 확인하세요!

---

## 2. 전체 구조도

```
GitHub Repository
    ↓ Push
Vercel (자동 빌드/배포)
    ↓ 도메인 연결
Whois DNS (A/CNAME/TXT 레코드)
    ↓ DNS 전파
사용자 → www.ssalworks.ai.kr → Vercel 서버
```

---

## 3. Phase 1: Vercel 프로젝트 설정

### 3.1 Vercel 로그인
```
https://vercel.com → Log In (GitHub 계정)
```

### 3.2 새 프로젝트 추가
```
Dashboard → Add New... → Project
→ Import Git Repository → SSALWorks 선택
```

### 3.3 프로젝트 설정

| 항목 | 값 | 주의사항 |
|------|-----|---------|
| **Project Name** | `ssal-works` | 소문자, 하이픈만 가능! |
| **Framework Preset** | `Other` | |
| **Root Directory** | `Production/Frontend` | |
| **Build Command** | (비워두기) | 정적 사이트 |
| **Output Directory** | (비워두기) | |

**⚠️ Project Name 규칙**:
- ✅ 소문자: `ssal-works`
- ✅ 숫자: `ssal-works-v1`
- ✅ 하이픈: `ssal-works`
- ❌ 대문자: `SSALWorks`
- ❌ 한글: `쌀웍스`
- ❌ 특수문자: `ssal_works`

---

## 4. Phase 2: 폴더 구조 정리

### 4.1 Vercel의 요구사항

Vercel Serverless Functions는 **Root Directory 안에 `api/` 폴더**가 있어야 함.

### 4.2 권장 구조

```
Production/
├── Database/          ← DB 스키마/SQL
└── Frontend/          ← Vercel Root Directory
    ├── api/           ← Serverless Functions (여기!)
    │   ├── auth/
    │   ├── email/
    │   ├── lib/
    │   └── subscription/
    ├── assets/
    ├── pages/
    ├── index.html
    └── vercel.json
```

### 4.3 기존 구조 정리 (필요시)

```bash
# Backend_API/api를 Frontend/api로 이동
cp -r Production/Backend_API/api Production/Frontend/

# 불필요한 폴더 삭제
rm -rf Production/Backend_API
rm -rf Production/Backend_APIs
```

---

## 5. Phase 3: vercel.json 설정

### 5.1 파일 위치
`Production/Frontend/vercel.json`

### 5.2 권장 설정

```json
{
  "version": 2,
  "name": "ssalworks-v1",
  "buildCommand": null,
  "outputDirectory": ".",
  "framework": null,
  "rewrites": [
    {
      "source": "/api/:path*",
      "destination": "/api/:path*"
    }
  ],
  "headers": [
    {
      "source": "/api/(.*)",
      "headers": [
        { "key": "Access-Control-Allow-Credentials", "value": "true" },
        { "key": "Access-Control-Allow-Origin", "value": "*" },
        { "key": "Access-Control-Allow-Methods", "value": "GET,POST,PUT,DELETE,OPTIONS" },
        { "key": "Access-Control-Allow-Headers", "value": "X-CSRF-Token, X-Requested-With, Accept, Accept-Version, Content-Length, Content-MD5, Content-Type, Date, X-Api-Version, Authorization" }
      ]
    }
  ],
  "functions": {
    "api/**/*.js": {
      "maxDuration": 30,
      "memory": 1024
    }
  },
  "env": {
    "NODE_ENV": "production"
  }
}
```

### 5.3 주의사항

**❌ 존재하지 않는 함수 패턴 제거**:
```json
// 에러 발생!
"functions": {
  "api/ai/*.js": { ... },      // ai 폴더 없으면 에러
  "api/payment/*.js": { ... }  // payment 폴더 없으면 에러
}
```

**✅ 실제 존재하는 패턴만**:
```json
"functions": {
  "api/**/*.js": { ... }
}
```

---

## 6. Phase 4: 환경변수 설정

### 6.1 Vercel Dashboard 위치
```
Settings → Environment Variables
```

### 6.2 필수 환경변수

| Key | Value | 설명 |
|-----|-------|------|
| `SUPABASE_URL` | `https://xxx.supabase.co` | Supabase 프로젝트 URL |
| `SUPABASE_ANON_KEY` | `eyJxxx...` | Supabase anon key |
| `SUPABASE_SERVICE_ROLE_KEY` | `eyJxxx...` | Supabase service role key |
| `RESEND_API_KEY` | `re_xxx...` | Resend 이메일 API |

### 6.3 선택 환경변수

| Key | Value | 설명 |
|-----|-------|------|
| `NEXT_PUBLIC_SITE_URL` | 배포 후 도메인 | 사이트 URL |
| `INTERNAL_API_SECRET` | 임의 문자열 | 내부 API 보안 |

### 6.4 Environment 설정

각 환경변수에 대해:
- **Production**: 프로덕션 배포
- **Preview**: PR 미리보기
- **Development**: 개발 환경

보통 모든 환경에 동일하게 설정 (`All` 선택)

---

## 7. Phase 5: 도메인 연결 (Whois DNS)

### 7.1 Vercel에서 도메인 추가 (상세 단계)

**Step 1: Vercel Dashboard 접속**
```
https://vercel.com 접속
→ 로그인 (GitHub 계정)
→ 프로젝트 선택 (예: ssal-works)
```

**Step 2: Domains 설정 페이지 이동**
```
프로젝트 페이지에서:
→ 상단 탭 "Settings" 클릭
→ 좌측 메뉴에서 "Domains" 클릭
```

**Step 3: 도메인 추가**
```
┌─────────────────────────────────────────────────────────────┐
│  Domains                                                    │
│                                                             │
│  Add your custom domain:                                    │
│  [ www.ssalworks.ai.kr          ] [Add]                    │
│    ↑ www 포함해서 입력!                                     │
└─────────────────────────────────────────────────────────────┘

→ "Add" 버튼 클릭
```

**Step 4: DNS 설정 정보 확인**
```
도메인 추가 후 Vercel이 다음 정보를 보여줌:

┌─────────────────────────────────────────────────────────────┐
│ ⚠️ Invalid Configuration                                    │
│                                                             │
│ A Record:                                                   │
│   Name: @ (또는 www)                                        │
│   Value: 76.76.21.21  ← 이 IP를 복사해서 Whois에 입력      │
│                                                             │
│ TXT Record (for verification):                              │
│   Name: _vercel                                             │
│   Value: vc-domain-verify=ssalworks.ai.kr,9fe000...        │
│          ↑ 이 값을 복사해서 Whois에 입력                   │
└─────────────────────────────────────────────────────────────┘

→ 이 정보를 메모해두고 Whois로 이동
```

**⚠️ www 서브도메인 권장 이유**:
- Whois DNS에서 루트 도메인(@) 설정이 어려움
- A 레코드 호스트명에 `@` 입력 불가
- `www.ssalworks.ai.kr`로 설정하면 문제 없음

### 7.2 Vercel이 요구하는 DNS 레코드

```
[A 레코드]
Type: A
Name: www (또는 비워둠)
Value: 76.76.21.21

[TXT 레코드 - 소유권 확인]
Type: TXT
Name: _vercel
Value: vc-domain-verify=ssalworks.ai.kr,xxxxxxxxx
```

### 7.3 Whois DNS 고급설정 접근 (상세 단계)

> **⚠️ 핵심**: 일반 DNS 관리 화면에서는 기능이 제한됩니다!
> 반드시 **네임서버 고급설정**으로 들어가야 합니다.

**Step 1: Whois 로그인**
```
https://whois.co.kr 접속
→ 우측 상단 "로그인" 클릭
→ ID/PW 입력 후 로그인
```

**Step 2: 도메인 관리 페이지 이동**
```
로그인 후 상단 메뉴에서:
"도메인" 클릭 → "도메인 관리" 선택
```

**Step 3: 해당 도메인 선택**
```
도메인 목록에서 설정할 도메인 찾기
→ "ssalworks.ai.kr" 클릭 (또는 체크박스 선택)
```

**Step 4: 부가서비스 메뉴 찾기**
```
도메인 상세 페이지에서:
→ 좌측 메뉴 또는 탭에서 "부가서비스" 찾기
→ "네임서버 변경/부가서비스" 클릭
```

**Step 5: 네임서버 고급설정 진입** ⭐ 핵심!
```
부가서비스 페이지에서:
→ "네임서버 고급설정" 섹션 찾기
→ 다음 3개 메뉴가 보여야 함:
   • A 레코드 관리(네임서버 호스팅)
   • CNAME 레코드 관리
   • SPF(TXT) 레코드 관리
```

**메뉴 구조 요약**:
```
Whois 메인
└── 도메인
    └── 도메인 관리
        └── [도메인 선택]
            └── 부가서비스
                └── 네임서버 변경/부가서비스
                    └── 네임서버 고급설정  ← 여기!
                        ├── A 레코드 관리
                        ├── CNAME 레코드 관리
                        └── SPF(TXT) 레코드 관리
```

### 7.4 A 레코드 추가 (상세 단계)

**Step 1: A 레코드 관리 페이지 열기**
```
네임서버 고급설정에서:
→ "A 레코드 관리(네임서버 호스팅)" 클릭
→ "관리페이지 열기" 버튼 클릭
```

**Step 2: 새 A 레코드 추가**
```
페이지가 열리면 입력 필드가 나타남:

┌─────────────────────────────────────────────────┐
│  호스트명: [ www          ]  ← "www" 입력       │
│  IP 주소:  [ 76.76.21.21  ]  ← Vercel IP 입력   │
│                                                 │
│  [추가] [취소]                                  │
└─────────────────────────────────────────────────┘
```

**Step 3: 저장 확인**
```
→ "추가" 또는 "저장" 버튼 클릭
→ 레코드 목록에 추가된 것 확인
```

**입력값 정리**:
| 필드 | 입력값 | 설명 |
|------|--------|------|
| 호스트명 | `www` | www.ssalworks.ai.kr용 |
| IP 주소 | `76.76.21.21` | Vercel 서버 IP (고정값) |

### 7.5 TXT 레코드 추가 - 소유권 확인 (상세 단계)

> **목적**: Vercel에게 "이 도메인은 내 것"임을 증명

**Step 1: Vercel에서 TXT 값 복사하기** ⭐ 먼저!
```
Vercel Dashboard 열기
→ Settings → Domains
→ 추가한 도메인 옆에 "Verification Needed" 표시 확인
→ TXT 레코드 값이 표시됨:

  "Add a TXT record with the following value:"
  vc-domain-verify=ssalworks.ai.kr,9fe000238421d24d9a02
                                   ↑ 이 전체를 복사!
```

**Step 2: Whois에서 TXT 레코드 관리 페이지 열기**
```
네임서버 고급설정에서:
→ "SPF(TXT) 레코드 관리" 클릭
→ "관리페이지 열기" 버튼 클릭
```

**Step 3: 새 TXT 레코드 추가**
```
┌─────────────────────────────────────────────────────────────┐
│  호스트명: [ _vercel                                   ]    │
│            ↑ 언더스코어(_) 포함해서 정확히 입력!           │
│                                                             │
│  값:       [ vc-domain-verify=ssalworks.ai.kr,9fe00... ]   │
│            ↑ Vercel에서 복사한 값 전체 붙여넣기            │
│                                                             │
│  [추가] [취소]                                              │
└─────────────────────────────────────────────────────────────┘
```

**Step 4: 저장 및 확인**
```
→ "추가" 또는 "저장" 버튼 클릭
→ 레코드 목록에서 확인:
  호스트명: _vercel
  값: vc-domain-verify=ssalworks.ai.kr,xxxxxxxxxx
```

**입력값 정리**:
| 필드 | 입력값 | 주의사항 |
|------|--------|----------|
| 호스트명 | `_vercel` | 언더스코어 필수! |
| 값 | `vc-domain-verify=...` | Vercel에서 복사 (도메인마다 다름) |

### 7.6 CNAME 레코드 추가 (선택)

**경로**: 네임서버 고급설정 → CNAME 레코드 관리 → 관리페이지 열기

```
호스트명: www
별칭(CNAME): cname.vercel-dns.com
```

### 7.7 DNS 전파 대기

**소요 시간**: 5분 ~ 48시간

**확인 방법**:
```bash
# Windows
nslookup www.ssalworks.ai.kr 8.8.8.8

# Mac/Linux
dig www.ssalworks.ai.kr

# 온라인 도구
https://dnschecker.org/
```

**성공 예시**:
```
Server:  dns.google
Address:  8.8.8.8

Name:    www.ssalworks.ai.kr
Address:  76.76.21.21
```

### 7.8 Vercel에서 인증 완료 확인

```
Vercel Dashboard → Settings → Domains

상태 확인:
- ⚠️ "Verification Needed" → DNS 전파 대기
- 🔄 "Generating SSL Certificate" → SSL 생성 중 (1-5분)
- ✅ "Valid Configuration" (초록색) → 성공!
```

---

## 8. 시도했으나 실패한 방법들

### ❌ 방법 1: Vercel DNS 사용 (권한 충돌)

```bash
# 네임서버를 Vercel로 변경
ns1.vercel-dns.com
ns2.vercel-dns.com

# 결과: 403 권한 오류
Error: Not authorized to use ssalworks.ai.kr (403)
This domain is linked to another Vercel account.
```

**실패 이유**: 도메인이 다른 Vercel 계정에 연결되어 있거나 권한 충돌 발생

---

### ❌ 방법 2: Whois 일반 DNS 관리

```
문제:
- CNAME 레코드 입력란에 IP 주소만 입력 가능
- TXT 레코드에 _vercel 입력 불가 (특수문자 제한)
- A 레코드 호스트명에 @ 입력 불가
```

**실패 이유**: 일반 DNS 관리 화면의 기능 제한

---

### ✅ 최종 성공: Whois 네임서버 고급설정

네임서버를 Whois 기본값으로 유지:
```
ns1.whoisdomain.kr
ns2.whoisdomain.kr
ns3.whoisdomain.kr
ns4.whoisdomain.kr
```

**네임서버 고급설정**에서 A/CNAME/TXT 레코드 직접 관리 → 성공!

---

## 9. 트러블슈팅 (실전 경험)

### 🔴 문제 1: Project Name 에러

**증상**:
```
The name contains invalid characters.
```

**해결**: 소문자, 숫자, 하이픈만 사용
- ❌ `SSALWorks` → ✅ `ssal-works`

---

### 🔴 문제 2: 함수 패턴 에러

**증상**:
```
Error: The pattern "api/ai/*.js" doesn't match any Serverless Functions
```

**해결**: vercel.json에서 존재하지 않는 패턴 제거

---

### 🔴 문제 3: Build 에러

**증상**:
```
sh: line 1: vercel: command not found
```

**원인**: package.json에 `"build": "vercel build"` 설정됨

**해결**: build 스크립트 제거 또는 변경
```json
{
  "scripts": {
    "dev": "npx serve . -l 8888"
  }
}
```

---

### 🔴 문제 4: 도메인 소유권 확인

**증상**:
```
This domain is linked to another Vercel account.
```

**해결**:
1. TXT 레코드 추가 (_vercel)
2. DNS 전파 대기 (최대 48시간)
3. Vercel에서 "Refresh" 클릭

---

### 🔴 문제 5: DNS_PROBE_FINISHED_NXDOMAIN

**증상**: 브라우저에서 "사이트에 연결할 수 없음"

**원인**: DNS가 아직 전파되지 않음

**해결**:
1. `nslookup www.ssalworks.ai.kr 8.8.8.8`로 확인
2. 전파 완료까지 대기 (최대 48시간)
3. 레코드 저장 완료 확인

---

### 🔴 문제 6: "특수문자를 입력할 수 없습니다"

**증상**: `@` 또는 `_vercel` 입력 시 에러

**해결**:
- 일반 DNS 관리 아닌 **네임서버 고급설정** 사용
- A 레코드는 `@` 대신 호스트명 비우기 또는 `www` 사용

---

## 10. 체크리스트

### Phase 1: Vercel 프로젝트
- [x] GitHub 연동
- [x] 프로젝트 생성 (Project Name 규칙 준수)
- [x] Root Directory 설정: `Production/Frontend`
- [x] Framework: Other 선택
- [x] Build Command: 비워둠

### Phase 2: 폴더 구조
- [x] `Production/Frontend/api/` 폴더 존재 확인
- [x] Serverless Functions 파일 위치 확인

### Phase 3: vercel.json
- [x] 파일 생성/수정
- [x] 존재하지 않는 함수 패턴 제거
- [x] CORS 헤더 설정

### Phase 4: 환경변수
- [x] SUPABASE_URL 설정
- [x] SUPABASE_ANON_KEY 설정
- [x] SUPABASE_SERVICE_ROLE_KEY 설정
- [x] RESEND_API_KEY 설정

### Phase 5: 도메인 (Whois DNS)
- [x] 네임서버: Whois 기본값 유지
- [x] 네임서버 고급설정 접속
- [x] A 레코드 추가 (76.76.21.21)
- [x] TXT 레코드 추가 (_vercel)
- [x] DNS 전파 확인 (nslookup)
- [x] Vercel 도메인 인증 완료 (✅ 초록색)
- [x] SSL 인증서 생성 확인

### 최종 테스트
- [x] https://www.ssalworks.ai.kr 접속 성공
- [x] API 엔드포인트 동작 확인
- [x] HTTPS 정상 작동

---

## 권장 설정 요약

| 항목 | 권장 값 |
|------|---------|
| **네임서버** | Whois 기본값 (ns1.whoisdomain.kr) |
| **DNS 관리** | Whois 네임서버 고급설정 |
| **도메인** | www.ssalworks.ai.kr (www 포함) |
| **A 레코드** | 76.76.21.21 |
| **호스팅** | Vercel |

**추천하지 않는 방법**:
- ❌ 루트 도메인(@) 직접 설정 (Whois에서 설정 어려움)

---

## 참고 문서

- [Vercel - Adding a Domain](https://vercel.com/docs/projects/domains/add-a-domain)
- [Vercel - Serverless Functions](https://vercel.com/docs/functions)
- [Vercel - Environment Variables](https://vercel.com/docs/projects/environment-variables)

---

**Last Updated**: 2025-12-17 (도메인 연결 완료 확인)
