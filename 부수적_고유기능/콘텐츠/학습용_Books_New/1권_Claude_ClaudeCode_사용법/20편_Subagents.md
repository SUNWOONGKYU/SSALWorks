# 20편 | Subagents

---

Claude Code는 복잡한 작업을 처리할 때 전문화된 서브에이전트를 활용한다. 코드베이스 탐색, 구현 계획 수립, 병렬 작업 처리 등에서 서브에이전트가 자동으로 투입된다. 이 편에서는 서브에이전트의 개념과 활용법을 살펴본다.

## 1. Subagents 개요

### 1.1 Subagents란

Subagents는 특정 작업을 위임받아 독립적으로 수행하는 전문화된 에이전트이다. Main Agent가 복잡한 작업을 만나면 적합한 Subagent에게 작업을 위임한다.

```
[복잡한 요청]
      ↓
[Main Agent 분석]
      ↓
[Subagent 투입]
      ↓
[Subagent 작업 수행]
      ↓
[결과 반환]
      ↓
[Main Agent가 사용자에게 보고]
```

### 1.2 Main Agent vs Subagent

| 구분 | Main Agent | Subagent |
|------|------------|----------|
| 역할 | 대화 관리, 작업 조율 | 특정 작업 수행 |
| 범위 | 전체 대화 컨텍스트 | 위임받은 작업만 |
| 실행 | 항상 활성화 | 필요할 때 투입 |
| 결과 | 사용자에게 직접 응답 | Main Agent에게 반환 |

### 1.3 Task 도구 사용

Subagent는 Task 도구를 통해 호출된다.

```
사용자: 이 코드베이스에서 API 엔드포인트가 어디 있는지 찾아줘

Claude: [Task 도구 - Explore 서브에이전트 투입]
        코드베이스를 탐색하겠습니다...

        [Explore 서브에이전트가 작업 수행]

        API 엔드포인트 위치:
        - src/api/users.js
        - src/api/posts.js
        - src/api/auth.js
```

## 2. Subagent 유형

### 2.1 general-purpose (범용)

복잡한 질문 조사, 코드 검색, 다단계 작업 처리를 위한 범용 에이전트이다.

**용도:**
- 복잡한 질문에 대한 조사
- 코드 검색 (확실하지 않은 경우)
- 다단계 작업 수행

```
사용자: 이 프로젝트에서 인증 로직이 어떻게 구현되어 있는지 분석해줘

Claude: [Task - general-purpose 서브에이전트]
        인증 로직을 조사하겠습니다...

        분석 결과:
        1. JWT 기반 인증 사용
        2. 토큰은 localStorage에 저장
        3. 만료 시간: 24시간
        ...
```

### 2.2 Explore (코드베이스 탐색)

코드베이스를 빠르게 탐색하는 전문 에이전트이다.

**용도:**
- 파일 패턴으로 찾기 (`src/**/*.tsx`)
- 키워드로 코드 검색
- 코드베이스 구조 파악

**탐색 깊이:**
- quick: 기본 검색
- medium: 중간 수준 탐색
- very thorough: 포괄적 분석

```
사용자: API 엔드포인트가 어떻게 동작하는지 알려줘

Claude: [Task - Explore 서브에이전트 (medium)]
        API 구조를 탐색하겠습니다...

        API 동작 방식:
        - 라우팅: Express 사용
        - 미들웨어: 인증, 로깅, 에러 처리
        - 응답 형식: JSON
        ...
```

### 2.3 Plan (설계/계획)

구현 계획을 수립하는 소프트웨어 아키텍트 에이전트이다.

**용도:**
- 구현 전략 설계
- 단계별 계획 수립
- 아키텍처 트레이드오프 분석

```
사용자: 결제 시스템을 추가하려면 어떻게 해야 할까?

Claude: [Task - Plan 서브에이전트]
        구현 계획을 수립하겠습니다...

        결제 시스템 구현 계획:

        1단계: 데이터베이스 스키마
        - payments 테이블 생성
        - subscriptions 테이블 생성

        2단계: API 개발
        - POST /api/payments/create
        - POST /api/payments/confirm
        ...
```

### 2.4 기타 특화 유형

프로젝트에 따라 다양한 특화 유형이 있을 수 있다.

| 유형 | 용도 |
|------|------|
| frontend-developer | 프론트엔드 개발 |
| backend-developer | 백엔드 개발 |
| database-specialist | 데이터베이스 설계 |
| code-reviewer | 코드 리뷰 |
| test-engineer | 테스트 작성 |

## 3. Subagent 호출

### 3.1 Task 도구 파라미터

Task 도구는 다음 파라미터를 사용한다:

| 파라미터 | 설명 | 예시 |
|----------|------|------|
| prompt | 작업 내용 | "API 구조 분석" |
| subagent_type | 서브에이전트 유형 | "Explore" |
| description | 작업 설명 (3-5단어) | "API 구조 탐색" |
| model | 모델 선택 (선택) | "sonnet", "haiku" |
| run_in_background | 백그라운드 실행 | true/false |

### 3.2 동기/비동기 실행

**동기 실행 (기본):**
Subagent 작업이 완료될 때까지 기다린다.

```
[Task 호출]
      ↓
[Subagent 작업 수행] ← 대기
      ↓
[결과 즉시 반환]
```

**비동기 실행 (백그라운드):**
Subagent가 백그라운드에서 작업하고, 다른 작업을 계속할 수 있다.

```
[Task 호출 - run_in_background: true]
      ↓
[Subagent 백그라운드 작업 시작]
      ↓
[다른 작업 계속 진행]
      ↓
[나중에 TaskOutput으로 결과 확인]
```

### 3.3 결과 받기 (TaskOutput)

백그라운드로 실행한 Subagent의 결과를 가져온다.

```
사용자: 아까 요청한 분석 결과 보여줘

Claude: [TaskOutput - task_id: agent_xyz]
        분석 결과:
        ...
```

**옵션:**
- block: true (완료까지 대기) / false (현재 상태만)
- timeout: 최대 대기 시간 (ms)

## 4. 사용자 정의 Subagents

### 4.1 Subagents 파일 위치

프로젝트 루트에 `.claude/subagents/` 폴더를 만들어 사용한다.

```
프로젝트/
└── .claude/
    └── subagents/
        └── agent이름.md
```

### 4.2 파일 구조

마크다운 파일로 Subagent의 역할과 동작을 정의한다.

```markdown
# agent이름.md

[역할 설명]

## 전문 분야
- [분야 1]
- [분야 2]

## 사용 가능한 도구
- [도구 1]
- [도구 2]

## 작업 방식
1. [단계 1]
2. [단계 2]
3. [단계 3]

## 출력 형식
[결과 형식 설명]
```

### 4.3 작성 예시

**코드 리뷰 전문 에이전트:**
```markdown
# code-reviewer.md

코드 품질을 검토하고 개선점을 제안하는 전문 에이전트입니다.

## 전문 분야
- 코드 품질 분석
- 보안 취약점 탐지
- 성능 문제 식별
- 모범 사례 검증

## 사용 가능한 도구
- Read: 코드 파일 읽기
- Grep: 패턴 검색
- Glob: 파일 찾기

## 작업 방식
1. 대상 코드 파일 읽기
2. 구조 및 패턴 분석
3. 문제점 식별
4. 개선 제안 작성

## 출력 형식
- 요약: 전체 평가
- 문제점: 발견된 이슈 목록
- 제안: 구체적인 개선 방안
- 우선순위: 중요도별 정렬
```

**테스트 엔지니어 에이전트:**
```markdown
# test-engineer.md

테스트 코드를 작성하고 검증하는 전문 에이전트입니다.

## 전문 분야
- 단위 테스트 작성
- 통합 테스트 설계
- 테스트 커버리지 분석
- 엣지 케이스 식별

## 사용 가능한 도구
- Read, Write, Edit: 파일 작업
- Bash: 테스트 실행
- Grep: 테스트 대상 검색

## 작업 방식
1. 테스트 대상 분석
2. 테스트 케이스 설계
3. 테스트 코드 작성
4. 테스트 실행 및 검증

## 출력 형식
- 테스트 파일 생성
- 커버리지 보고
- 실행 결과 요약
```

## 5. 실전 활용

### 5.1 병렬 작업 처리

여러 Subagent를 동시에 실행해서 작업 속도를 높인다.

```
사용자: 프론트엔드와 백엔드 코드 동시에 분석해줘

Claude:
[병렬 실행]
├── [Task - Explore] 프론트엔드 분석 (백그라운드)
└── [Task - Explore] 백엔드 분석 (백그라운드)

[결과 수집]
├── 프론트엔드: React 기반, 15개 컴포넌트
└── 백엔드: Express 기반, 8개 API 엔드포인트
```

### 5.2 복잡한 작업 분할

큰 작업을 여러 Subagent에게 분할 위임한다.

```
사용자: 전체 코드베이스 리팩토링 계획 세워줘

Claude:
1. [Task - Explore] 현재 구조 파악
   → 폴더 구조, 의존성, 코드 패턴

2. [Task - Plan] 리팩토링 전략 수립
   → 단계별 계획, 우선순위, 리스크

3. [Task - code-reviewer] 문제 영역 식별
   → 기술 부채, 중복 코드, 개선점

종합 결과:
리팩토링 계획서 완성
```

### 5.3 전문 분야 위임

적합한 전문 에이전트에게 작업을 위임한다.

```
사용자: 이 API에 대한 테스트 코드 작성해줘

Claude: [Task - test-engineer 서브에이전트]
        테스트 코드를 작성하겠습니다...

        생성된 파일:
        - src/api/users.test.js
        - src/api/auth.test.js

        테스트 결과:
        - 24개 테스트 케이스 작성
        - 모든 테스트 통과
        - 커버리지: 92%
```

## 6. 정리

### Subagent 유형 요약

| 유형 | 용도 | 사용 시점 |
|------|------|----------|
| general-purpose | 범용 조사/작업 | 복잡한 질문, 다단계 작업 |
| Explore | 코드베이스 탐색 | 구조 파악, 파일 검색 |
| Plan | 설계/계획 수립 | 구현 전략, 아키텍처 |
| 사용자 정의 | 전문 분야 | 프로젝트 특화 작업 |

### 사용 시점 가이드

| 상황 | 권장 Subagent |
|------|--------------|
| "이 코드가 어디 있어?" | Explore |
| "어떻게 구현하면 좋을까?" | Plan |
| "이 코드 검토해줘" | code-reviewer |
| "테스트 작성해줘" | test-engineer |
| "복잡한 분석이 필요해" | general-purpose |

### 사용자 정의 Subagents 요약

```
위치: .claude/subagents/에이전트.md
내용: 역할, 전문 분야, 도구, 작업 방식
활용: 프로젝트 특화 작업 자동화
```

---

**작성일: 2025-12-20 / 글자수: 약 4,200자 / 작성자: Claude / 프롬프터: 써니**

