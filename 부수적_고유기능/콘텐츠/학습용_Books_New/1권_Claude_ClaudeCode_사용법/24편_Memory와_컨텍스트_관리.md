# 24편 | Memory와 컨텍스트 관리

---

Claude Code는 대화 내용을 컨텍스트로 유지하면서 작업한다. 대화가 길어지면 컨텍스트 한계에 가까워지고 비용도 증가한다. 이 편에서는 컨텍스트를 효율적으로 관리하고 Memory를 활용하는 방법을 살펴본다.

## 1. 컨텍스트 개요

### 1-1 컨텍스트란

컨텍스트는 Claude Code가 기억하고 있는 대화 내용이다. 현재 세션의 모든 대화, 파일 내용, 실행 결과 등이 포함된다.

```
컨텍스트 구성:
├── 시스템 프롬프트
├── 이전 대화 내역
├── 읽은 파일 내용
├── 명령어 실행 결과
└── 현재 요청
```

### 1-2 컨텍스트 한계

컨텍스트에는 최대 용량이 있다. 이를 초과하면 이전 내용이 잘리거나 요약된다.

```
[컨텍스트 상태]

낮음:  ████░░░░░░░░░░░░░░░░  20%  → 여유 있음
중간:  ████████████░░░░░░░░  60%  → 주의 필요
높음:  ████████████████████  95%  → 압축 권장
```

**한계 도달 시:**
- 오래된 대화 내용 요약
- 파일 내용 압축
- 응답 품질 저하 가능

### 1-3 토큰과 비용

컨텍스트는 토큰 단위로 측정된다. 토큰 사용량에 따라 비용이 발생한다.

**토큰 예시:**
- 영어 1단어 ≈ 1~2 토큰
- 한글 1글자 ≈ 2~3 토큰
- 코드 1줄 ≈ 10~20 토큰

**비용 구성:**
- 입력 토큰: 요청에 포함된 모든 내용
- 출력 토큰: Claude의 응답

## 2. 컨텍스트 확인

### 2-1 /context 명령어

현재 컨텍스트 사용량을 시각적으로 보여준다.

```
/context

→ 컨텍스트 사용량
  ████████████░░░░░░░░  58%

  사용: 116,000 토큰
  남음: 84,000 토큰
  한계: 200,000 토큰
```

**확인 시점:**
- 대화가 길어졌을 때
- 큰 파일을 여러 개 읽었을 때
- 응답이 느려졌을 때

### 2-2 /cost 명령어

현재 세션의 토큰 사용량과 예상 비용을 확인한다.

```
/cost

→ 세션 비용
  입력 토큰: 45,000
  출력 토큰: 12,000
  예상 비용: $0.85
```

### 2-3 사용량 모니터링

**높은 사용량 신호:**
- 응답 시간 증가
- 이전 대화 내용 잊어버림
- 파일 내용 다시 요청

**모니터링 습관:**
```
긴 작업 시작 전: /context 확인
중간중간: /cost로 비용 체크
작업 완료 후: /compact 고려
```

## 3. 컨텍스트 관리

### 3-1 /compact (대화 압축)

대화 내용을 요약해서 토큰을 절약한다.

```
/compact

→ 대화 내용을 요약합니다...
  이전: 80,000 토큰
  이후: 25,000 토큰
  절약: 55,000 토큰 (69%)
```

**방향 지정:**
```
/compact "에러 해결 과정만 유지해줘"

→ 에러 해결 관련 내용만 유지하고
  나머지는 요약합니다.
```

**압축 시점:**
- 컨텍스트 60% 이상 사용 시
- 새로운 큰 작업 시작 전
- 주제가 바뀔 때

### 3-2 /clear (초기화)

대화 내역을 완전히 삭제하고 새로 시작한다.

```
/clear

→ 대화가 초기화되었습니다.
  컨텍스트: 0 토큰
```

**주의:** 되돌릴 수 없음

**사용 시점:**
- 완전히 새로운 작업 시작
- 이전 대화가 더 이상 필요 없을 때
- 컨텍스트가 너무 복잡해졌을 때

### 3-3 자동 요약

Claude Code는 컨텍스트 한계에 가까워지면 자동으로 요약한다.

```
[자동 요약 발생]

Claude: 컨텍스트 한계에 가까워져서
        이전 대화를 자동으로 요약했습니다.

        요약된 내용:
        - 프로젝트 설정 완료
        - API 3개 구현
        - 테스트 통과
```

## 4. Memory 활용

### 4-1 CLAUDE.md 파일

프로젝트 정보를 저장하는 파일이다. 새 세션에서도 프로젝트 정보를 유지한다.

**위치:**
```
프로젝트/
└── CLAUDE.md
```

**내용 예시:**
```markdown
# 프로젝트 정보

## 개요
- 프로젝트명: MyApp
- 기술 스택: React, Node.js, PostgreSQL

## 규칙
- 커밋 메시지는 Conventional Commits
- 테스트 커버리지 80% 이상 유지

## 중요 경로
- API: src/api/
- 컴포넌트: src/components/
- 테스트: src/__tests__/
```

**장점:**
- 세션 간 정보 유지
- 프로젝트 규칙 일관성
- 새 세션에서 빠른 시작

### 4-2 /memory 명령어

CLAUDE.md 파일을 편집한다.

```
/memory

→ CLAUDE.md 편집 모드
  프로젝트 정보를 추가/수정합니다.
```

**활용:**
```
/memory

사용자: DB 비밀번호는 .env에 있다고 추가해줘

Claude: CLAUDE.md에 추가했습니다:
        "DB 비밀번호는 .env 파일의 DATABASE_URL 참조"
```

### 4-3 Memory MCP 서버

세션 간에 정보를 저장하고 공유하는 MCP 서버이다.

**설정:**
```json
{
  "mcpServers": {
    "memory": {
      "command": "npx",
      "args": ["-y", "@modelcontextprotocol/server-memory"]
    }
  }
}
```

**사용:**
```
사용자: 이 API 키를 기억해둬: sk-abc123

Claude: [Memory 서버에 저장]
        API 키를 기억했습니다.

--- 다른 세션 ---

사용자: 아까 저장한 API 키 뭐였지?

Claude: [Memory 서버에서 조회]
        저장된 API 키: sk-abc123
```

**CLAUDE.md vs Memory MCP:**

| 구분 | CLAUDE.md | Memory MCP |
|------|-----------|------------|
| 저장 위치 | 프로젝트 폴더 | MCP 서버 |
| 공유 범위 | 해당 프로젝트 | 모든 프로젝트 |
| 형식 | 마크다운 | 구조화된 데이터 |
| 용도 | 프로젝트 규칙 | 임시 정보 저장 |

## 5. 효율적 사용 팁

### 5-1 컨텍스트 절약 방법

**필요한 것만 읽기:**
```
❌ "이 폴더 전체 읽어줘"
✅ "src/api/auth.js 파일만 읽어줘"
```

**결과 요약 요청:**
```
❌ "테스트 결과 전체 보여줘"
✅ "테스트 결과 요약해줘 (실패한 것만)"
```

**주기적 압축:**
```
1시간마다 /context 확인
60% 넘으면 /compact 실행
```

### 5-2 세션 관리 전략

**작업별 세션 분리:**
```
세션 1: 프론트엔드 작업
세션 2: 백엔드 작업
세션 3: 테스트 작업
```

**중요 정보 저장:**
```
작업 완료 후:
1. 중요 결정사항 → CLAUDE.md에 기록
2. 임시 정보 → Memory MCP에 저장
3. /compact로 압축
```

**세션 재개:**
```
/resume

→ 이전 세션 목록
→ 원하는 세션 선택
→ 이어서 작업
```

## 6. 정리

### 명령어 요약

| 명령어 | 기능 | 사용 시점 |
|--------|------|----------|
| /context | 사용량 확인 | 수시로 |
| /cost | 비용 확인 | 작업 중간 |
| /compact | 대화 압축 | 60% 이상 시 |
| /clear | 완전 초기화 | 새 작업 시작 |
| /memory | CLAUDE.md 편집 | 규칙 추가 시 |
| /resume | 세션 재개 | 이전 작업 이어서 |

### 관리 전략

| 상황 | 권장 조치 |
|------|----------|
| 컨텍스트 30% 이하 | 유지 |
| 컨텍스트 60% 이상 | /compact 고려 |
| 컨텍스트 90% 이상 | /compact 필수 |
| 새 주제 시작 | /clear 또는 /compact |
| 중요 정보 저장 | CLAUDE.md 또는 Memory |

---

**작성일: 2025-12-20 / 글자수: 약 3,700자 / 작성자: Claude / 프롬프터: 써니**

