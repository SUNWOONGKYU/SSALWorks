# 환경변수 관리 베스트 프랙티스

## 핵심 요약

.env.example은 Git에 커밋(키 값은 비워두고), .env.local은 gitignore에 추가하세요. 설정 순서: 1) .env.example 복사 → .env.local 생성, 2) 실제 키 입력, 3) 서버 재시작.

## 왜 환경변수를 사용하는가?

### 하드코딩 vs 환경변수

```
❌ 하드코딩:
const apiKey = 'sk-abc123...';  // 코드에 직접 작성
→ Git에 노출됨
→ 환경별 분리 불가
→ 키 변경 시 코드 수정 필요

✅ 환경변수:
const apiKey = process.env.OPENAI_API_KEY;
→ Git에 안전
→ 환경별 다른 값 사용
→ 키 변경 시 환경변수만 수정
```

### 환경변수 사용 이점

| 이점 | 설명 |
|------|------|
| 보안 | 민감한 정보 코드에서 분리 |
| 유연성 | 환경별(개발/스테이징/프로덕션) 다른 설정 |
| 유지보수 | 코드 수정 없이 설정 변경 가능 |
| 협업 | 팀원별 다른 설정 사용 가능 |

## 환경변수 파일 구조

### 파일 종류와 용도

| 파일 | Git 커밋 | 용도 |
|------|----------|------|
| `.env.example` | ✅ 커밋 | 필요한 환경변수 목록 (빈 값) |
| `.env.local` | ❌ gitignore | 로컬 개발용 실제 값 |
| `.env.development` | ❌ gitignore | 개발 환경용 |
| `.env.production` | ❌ gitignore | 프로덕션용 |

### 프로젝트 구조

```
프로젝트/
├── .env.example        # Git에 커밋 ✅
├── .env.local          # Git에 커밋 안 함 ❌
├── .env.development    # Git에 커밋 안 함 ❌
├── .env.production     # Git에 커밋 안 함 ❌
└── .gitignore          # 환경변수 파일 제외 설정
```

## .env 파일 작성

### .env.example (템플릿)

```bash
# .env.example
# 이 파일을 복사하여 .env.local 생성
# 각 항목에 실제 값을 입력하세요

# === Supabase ===
SUPABASE_URL=
SUPABASE_ANON_KEY=
SUPABASE_SERVICE_ROLE_KEY=

# === OpenAI ===
OPENAI_API_KEY=

# === 결제 (토스) ===
TOSS_CLIENT_KEY=
TOSS_SECRET_KEY=

# === 이메일 (Resend) ===
RESEND_API_KEY=

# === 앱 설정 ===
NEXT_PUBLIC_APP_URL=http://localhost:3000
```

### .env.local (실제 값)

```bash
# .env.local
# ⚠️ 이 파일은 절대 Git에 커밋하지 마세요!

# === Supabase ===
SUPABASE_URL=https://abcdefg.supabase.co
SUPABASE_ANON_KEY=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...
SUPABASE_SERVICE_ROLE_KEY=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...

# === OpenAI ===
OPENAI_API_KEY=sk-proj-abc123...

# === 결제 (토스) ===
TOSS_CLIENT_KEY=test_ck_abc123
TOSS_SECRET_KEY=test_sk_abc123

# === 이메일 (Resend) ===
RESEND_API_KEY=re_abc123...

# === 앱 설정 ===
NEXT_PUBLIC_APP_URL=http://localhost:3000
```

## .gitignore 설정

### 환경변수 파일 제외

```gitignore
# 환경변수 파일
.env
.env.*
.env.local
.env.development
.env.production
!.env.example

# 또는 더 구체적으로
.env.local
.env.*.local
```

### 확인 방법

```bash
# .gitignore가 제대로 동작하는지 확인
git status

# .env.local이 표시되면 안 됨
# 표시된다면 .gitignore 확인
```

## 환경변수 설정 순서

### 1단계: .env.example 복사

```bash
# Windows
copy .env.example .env.local

# Mac/Linux
cp .env.example .env.local
```

### 2단계: 실제 값 입력

```bash
# .env.local 파일을 편집기로 열고
# 각 환경변수에 실제 값 입력

# VS Code로 열기
code .env.local
```

### 3단계: 서버 재시작

```bash
# 환경변수 변경 후 반드시 서버 재시작!
# Ctrl+C로 서버 종료 후

npm run dev
# 또는
npx serve
```

## JavaScript에서 환경변수 사용

### Node.js 환경

```javascript
// 기본 사용
const apiKey = process.env.OPENAI_API_KEY;

// 기본값 설정
const port = process.env.PORT || 3000;

// 필수 환경변수 검증
if (!process.env.SUPABASE_URL) {
  throw new Error('SUPABASE_URL 환경변수가 설정되지 않았습니다.');
}
```

### 브라우저 환경 (Next.js)

```javascript
// NEXT_PUBLIC_ 접두사가 있어야 브라우저에서 접근 가능
const appUrl = process.env.NEXT_PUBLIC_APP_URL;

// NEXT_PUBLIC_이 없으면 서버에서만 접근 가능
const secretKey = process.env.SECRET_KEY;  // 브라우저에서 undefined
```

### Vanilla JavaScript (HTML)

```html
<!-- HTML에서 직접 환경변수 사용 불가 -->
<!-- 서버에서 주입하거나 빌드 시 치환 필요 -->

<script>
// 빌드 도구 없이는 환경변수 직접 사용 불가
// 대안 1: 서버에서 HTML 템플릿에 주입
// 대안 2: 별도 config.js 파일 생성
</script>
```

## 환경별 설정 관리

### 개발 vs 프로덕션

```bash
# .env.development
SUPABASE_URL=https://dev-project.supabase.co
NEXT_PUBLIC_APP_URL=http://localhost:3000

# .env.production
SUPABASE_URL=https://prod-project.supabase.co
NEXT_PUBLIC_APP_URL=https://myapp.com
```

### Vercel 환경변수 설정

```
1. Vercel Dashboard → 프로젝트 선택
2. Settings → Environment Variables
3. 환경(Production/Preview/Development) 선택
4. Name과 Value 입력
5. Save
```

### Supabase Edge Function 환경변수

```bash
# CLI로 설정
supabase secrets set OPENAI_API_KEY=sk-xxx

# 확인
supabase secrets list

# Edge Function에서 사용
const apiKey = Deno.env.get('OPENAI_API_KEY');
```

## 환경변수 검증

### 시작 시 검증

```javascript
// config.js
const requiredEnvVars = [
  'SUPABASE_URL',
  'SUPABASE_ANON_KEY',
  'OPENAI_API_KEY'
];

function validateEnv() {
  const missing = requiredEnvVars.filter(
    varName => !process.env[varName]
  );

  if (missing.length > 0) {
    throw new Error(
      `필수 환경변수가 설정되지 않았습니다: ${missing.join(', ')}`
    );
  }
}

// 앱 시작 시 호출
validateEnv();
```

### 타입 안전한 환경변수 (TypeScript)

```typescript
// env.ts
const getEnvVar = (name: string): string => {
  const value = process.env[name];
  if (!value) {
    throw new Error(`환경변수 ${name}이 설정되지 않았습니다.`);
  }
  return value;
};

export const env = {
  supabaseUrl: getEnvVar('SUPABASE_URL'),
  supabaseAnonKey: getEnvVar('SUPABASE_ANON_KEY'),
  openaiApiKey: getEnvVar('OPENAI_API_KEY'),
} as const;

// 사용
import { env } from './env';
const client = new OpenAI({ apiKey: env.openaiApiKey });
```

## 트러블슈팅

### 환경변수가 undefined일 때

```
문제: process.env.XXX가 undefined

체크리스트:
1. .env.local 파일이 프로젝트 루트에 있는가?
2. 변수명 오타 없는가? (대소문자 구분)
3. 서버를 재시작했는가?
4. 값에 따옴표가 필요한가? (공백 포함 시)
5. dotenv 패키지가 필요한가?
```

### 브라우저에서 접근 안 될 때

```
문제: 브라우저에서 환경변수가 undefined

원인:
- Next.js: NEXT_PUBLIC_ 접두사 없음
- Vite: VITE_ 접두사 없음
- CRA: REACT_APP_ 접두사 없음

해결:
// Next.js
NEXT_PUBLIC_API_URL=xxx

// Vite
VITE_API_URL=xxx
```

## Claude Code에게 요청하기

### 환경변수 설정 요청

```
".env.example 파일 만들어줘.
이 프로젝트에 필요한 환경변수 목록 정리해서."
```

### 환경변수 검증 코드 요청

```
"시작 시 필수 환경변수 검증하는 코드 만들어줘.
없으면 에러 메시지 표시하도록."
```

## 체크리스트

### 환경변수 설정 체크리스트

- [ ] .env.example이 Git에 커밋되었는가?
- [ ] .env.local이 .gitignore에 추가되었는가?
- [ ] 모든 필수 환경변수가 설정되었는가?
- [ ] 서버 재시작 후 환경변수 적용 확인했는가?
- [ ] 프로덕션 환경변수가 Vercel에 설정되었는가?
- [ ] 브라우저용 변수에 올바른 접두사가 있는가?

### 새 팀원 온보딩

- [ ] .env.example 파일 공유
- [ ] 각 환경변수 설명 문서화
- [ ] 키 발급 방법 안내
- [ ] .env.local 생성 방법 안내

## 주의사항

- .env 파일을 절대 Git에 커밋하지 않기
- 환경변수 값을 Slack/이메일로 공유하지 않기
- 프로덕션 키를 개발 환경에서 사용하지 않기
- 환경변수 변경 후 반드시 서버 재시작
- 민감한 키는 NEXT_PUBLIC_ 접두사 사용 금지
- .env.example에 실제 값 넣지 않기

