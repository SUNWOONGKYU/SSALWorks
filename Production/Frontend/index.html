<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Permissions-Policy" content="notifications()">
    <title>SSALWorks Dashboard - 프로젝트 관리</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            /* Main Theme - Organic Growth: Emerald Green */
            --primary: #10B981;
            --primary-dark: #059669;

            /* Secondary Theme - Organic Growth: Amber Gold */
            --secondary: #F59E0B;
            --secondary-dark: #D97706;

            /* Tertiary Theme - Organic Growth: Navy Blue */
            --tertiary: #2C4A8A;
            --tertiary-dark: #1F3563;

            /* Status Colors */
            --success: #10B981;
            --warning: #ffc107;
            --danger: #EF4444;
            --info: #3B82F6;
            --neutral: #64748B;

            /* Background */
            --bg-light: #f8f9fa;
            --bg-white: #ffffff;
            --border-color: #dee2e6;

            /* Misc */
            --border-radius: 8px;
            --shadow-sm: 0 1px 3px rgba(0, 0, 0, 0.12);
            --shadow-md: 0 4px 6px rgba(0, 0, 0, 0.1);
            --shadow-lg: 0 10px 20px rgba(0, 0, 0, 0.15);
        }

        /* Footer Styles */
        .footer {
            width: 100%;
            background: white;
            border-top: 1px solid var(--border-color);
            font-size: 11px;
            color: #495057;
            z-index: 10;
        }

        .footer-inner {
            max-width: 1400px;
            width: 100%;
            margin: 0 auto;
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 12px 32px;
        }

        .footer-left {
            display: flex;
            align-items: center;
            gap: 16px;
        }

        .footer-btn {
            display: flex;
            align-items: center;
            gap: 6px;
            padding: 6px 12px;
            background: #f1f3f5;
            border: 1px solid #dee2e6;
            border-radius: 4px;
            color: #495057;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.2s;
        }

        .footer-btn:hover {
            background: #e9ecef;
            color: var(--primary);
            border-color: var(--primary);
        }

        .footer-right {
            display: flex;
            align-items: center;
            gap: 16px;
        }

        body {
            font-family: 'Malgun Gothic', '맑은 고딕', 'Apple SD Gothic Neo', 'Noto Sans KR', sans-serif;
            font-size: 14px;
            line-height: 1.6;
            color: #212529;
            background: var(--bg-light);
            margin: 0;
            padding: 0;
        }

        /* ========== Typography Hierarchy ========== */
        /* H1: 로고 (SSAL Works) - 최상위 등급 */
        h1 {
            font-size: 26px;
            font-weight: 800;
            line-height: 1.2;
            color: white;
            margin: 0;
            letter-spacing: -0.5px;
        }

        /* H2: 워크스페이스, 프로젝트, SAL Grid 등 주요 섹션 타이틀 */
        h2 {
            font-size: 20px;
            font-weight: 700;
            line-height: 1.3;
            color: var(--primary-dark);
            margin-bottom: 13px;  /* 1단계: Section spacing */
            letter-spacing: -0.3px;
        }

        /* H3: 사이드바 1단계 (Project, 진행 프로세스, 학습용 콘텐츠 등), 헤더 태그라인 */
        h3 {
            font-size: 14px;
            font-weight: 700;
            line-height: 1.3;
            color: #495057;
            margin-bottom: 10px;  /* 2단계: Group spacing */
        }

        /* H4: 사이드바 2단계 (사업계획, 기획 등), 헤더/푸터 버튼 */
        h4 {
            font-size: 13px;
            font-weight: 700;
            line-height: 1.5;
            color: #495057;
            margin-bottom: 6px;  /* 3단계: Item spacing */
        }

        /* H5: 사이드바 3단계, 강조 텍스트 */
        h5 {
            font-size: 11px;
            font-weight: 700;
            line-height: 1.5;
            color: #495057;
            margin-bottom: 4px;  /* 4단계: Detail spacing */
        }

        /* H6: 사이드바 4단계, 설명 텍스트, 워크스페이스 버튼, 프로세스 퍼센트 */
        h6 {
            font-size: 11px;
            font-weight: 500;
            line-height: 1.5;
            color: #495057;
            margin-bottom: 4px;
        }

        /* ========== Layout Grid ========== */
        .page-wrapper {
            display: flex;
            flex-direction: column;
            min-height: 100vh;
        }

        .layout-container {
            display: grid;
            grid-template-columns: 250px minmax(500px, 870px) 280px;
            flex: 1;
            gap: 0;
            width: 100%;
            justify-content: center;
        }

        /* ========== Header ========== */
        .header {
            width: 100%;
            background: linear-gradient(135deg, var(--tertiary) 0%, var(--tertiary-dark) 100%);
            color: white;
            box-shadow: var(--shadow-md);
            z-index: 100;
            position: relative;
        }

        .header-inner {
            max-width: 1400px;
            width: 100%;
            margin: 0 auto;
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 32px;
            height: 70px;
        }

        .logo {
            font-size: 28px;
            font-weight: 800;
            display: flex;
            align-items: center;
            gap: 12px;
            font-family: 'Segoe UI', 'Arial', sans-serif;
            letter-spacing: -0.5px;
        }

        .rice-logo {
            display: flex;
            align-items: center;
            gap: 3px;
            transform: rotate(-15deg);
        }

        .rice-grain {
            width: 10px;
            height: 18px;
            background: linear-gradient(135deg, #F59E0B 0%, #D97706 100%);
            border-radius: 40%;
            box-shadow: 0 2px 4px rgba(217, 119, 6, 0.4), inset 0 1px 2px rgba(255, 255, 255, 0.3);
            display: inline-block;
        }

        .rice-grain:nth-child(1) {
            transform: rotate(-5deg);
        }

        .rice-grain:nth-child(2) {
            transform: rotate(5deg);
            margin-top: 2px;
        }

        .rice-grain:nth-child(3) {
            transform: rotate(-3deg);
            margin-top: -1px;
        }

        .header-center {
            flex: 1;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .header-tagline {
            font-size: 16px;
            font-weight: 700;
            letter-spacing: 0.3px;
            opacity: 0.95;
            white-space: nowrap;
            color: white;
        }

        .header-right {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .header-btn {
            padding: 7px 18px;
            background: transparent;
            border: 1px solid rgba(255, 255, 255, 0.4);
            border-radius: 6px;
            color: rgba(255, 255, 255, 0.9);
            font-size: 13px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s;
        }

        .header-btn:hover {
            background: rgba(255, 255, 255, 0.15);
            border-color: rgba(255, 255, 255, 0.6);
            color: white;
        }

        .header-btn:last-child {
            border-color: rgba(255, 255, 255, 0.5);
            font-weight: 600;
        }

        .header-btn:last-child:hover {
            background: rgba(255, 255, 255, 0.15);
            border-color: rgba(255, 255, 255, 0.7);
        }

        .notification-btn {
            width: 36px;
            height: 36px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: rgba(255, 255, 255, 0.15);
            border-radius: 50%;
            cursor: pointer;
            position: relative;
            transition: all 0.2s;
        }

        .notification-btn:hover {
            background: rgba(255, 255, 255, 0.25);
        }

        .notification-badge {
            position: absolute;
            top: 2px;
            right: 2px;
            width: 8px;
            height: 8px;
            background: #ef4444;
            border-radius: 50%;
            border: 2px solid var(--primary);
        }

        /* ========== Left Sidebar: Process ========== */
        .left-sidebar {
            grid-column: 1;
            grid-row: 2;
            overflow-y: auto;
            background: var(--bg-white);
            border-right: 1px solid var(--border-color);
            padding: 16px 8px 16px 12px;
            display: flex;
            flex-direction: column;
        }

        .sidebar-title {
            /* H3 스타일 적용 */
            font-size: 14px;
            font-weight: 700;
            margin-bottom: 12px;
            color: #495057;
        }

        .project-menu {
            margin-bottom: 8px;
        }

        .project-menu-item {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 8px 12px;
            margin-bottom: 4px;
            background: white;
            border: 1px solid #dee2e6;
            border-radius: var(--border-radius);
            cursor: pointer;
            transition: all 0.2s;
            font-size: 11px;
            font-weight: 600;
            color: #495057;
        }

        .project-menu-item:hover {
            background: rgba(32, 128, 141, 0.15);
            border-color: #20808D;
            color: #20808D;
            transform: translateX(3px);
        }

        .project-list {
            display: flex;
            flex-direction: column;
            gap: 6px;
            margin-bottom: 10px;  /* 2단계: Group spacing */
        }

        .project-list-item {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 6px 8px;
            background: #f8f9fa;
            border-left: 3px solid var(--primary);
            border-radius: 4px;
            cursor: pointer;
            transition: all 0.2s;
            font-size: 11px;
        }

        .project-list-item:hover {
            background: #e9ecef;
            transform: translateX(2px);
        }

        .project-list-item.selected {
            background: rgba(16, 185, 129, 0.05);
            border-left-color: var(--primary);
            border-left-width: 4px;
        }

        .project-list-item .project-icon {
            font-size: 14px;
        }

        .project-list-item .project-name {
            flex: 1;
            font-size: 11px;
            font-weight: 600;
            color: #212529;
        }

        .project-list-item .project-status {
            font-size: 11px;
            padding: 3px 7px;
            border-radius: 8px;
            background: var(--success);
            color: white;
            font-weight: 600;
            letter-spacing: -0.3px;
        }

        .project-menu-item span:first-child {
            font-size: 11px;
            color: var(--success);
            font-weight: 600;
        }

        .process-list {
            flex: 1;
        }

        .process-item {
            margin-bottom: 2px;
        }

        .process-major {
            display: flex;
            flex-direction: column;
            gap: 4px;
            padding: 6px 10px;
            background: rgba(16, 185, 129, 0.08); border: 1px solid rgba(16, 185, 129, 0.2);
            border-radius: 6px;
            transition: all 0.2s;
            cursor: pointer;
            margin-bottom: 6px;
        }

        /* 진행률이 0일 때는 기본 회색 배경 유지 */
        .process-major[data-progress="0"] {
            background: rgba(16, 185, 129, 0.08); border: 1px solid rgba(16, 185, 129, 0.2);
        }

        /* 진행률이 0보다 클 때만 연한 틸색 배경 (더 진하게) */
        .process-major[data-progress]:not([data-progress="0"]):not(.completed) {
            background: rgba(16, 185, 129, 0.12);
            border: 1px solid rgba(16, 185, 129, 0.3);
        }

        /* 호버 시 진한 초록색 (가장 높은 우선순위) */
        .process-major:hover {
            background: var(--success) !important;
            color: white !important;
        }

        .process-major:hover .process-icon,
        .process-major:hover .process-status {
            filter: brightness(2);
        }

        .process-major.completed {
            background: rgba(16, 185, 129, 0.25); border: 1px solid rgba(16, 185, 129, 0.5);
        }

        .process-header {
            display: flex;
            align-items: center;
            gap: 8px;
            width: 100%;
        }

        .process-icon {
            font-size: 11px;
            min-width: 18px;
            text-align: center;
        }

        .process-name {
            flex: 1;
            font-size: 11px;
            font-weight: 600;
            color: #212529;
        }

        .process-progress-container {
            display: flex;
            align-items: center;
            gap: 8px;
            width: 100%;
        }

        .process-percent {
            font-size: 11px;
            font-weight: 500;
            color: #495057;
            min-width: 35px;
            text-align: right;
        }

        /* 진행률 > 0%일 때 퍼센티지 진한 녹색 */
        .process-major[data-progress]:not([data-progress="0"]):not(.completed) .process-percent {
            color: var(--success);
            font-weight: 600;
        }

        .process-major.completed .process-percent {
            color: var(--success);
        }

        .process-arrow {
            font-size: 10px;
            transition: transform 0.3s;
            margin-right: 4px;
        }

        .process-arrow.expanded {
            transform: rotate(90deg);
        }

        .process-small-list {
            margin-left: 4px;
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.3s ease;
        }

        .process-small-list.expanded {
            max-height: 600px;
        }

        .process-small {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 4px 8px;
            font-size: 11px;
            font-weight: 700;
            color: #495057;
            margin-bottom: 2px;
            border-radius: 4px;
            transition: all 0.2s;
            cursor: pointer;
        }

        .process-small:hover {
            background: rgba(16, 185, 129, 0.15);
            color: #333;
        }

        .process-small-content {
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .process-small-bullet {
            font-size: 7px;
            color: var(--primary);
        }

        .process-small-arrow {
            font-size: 7px;
            transition: transform 0.3s;
            opacity: 0.5;
        }

        .process-small-arrow.expanded {
            transform: rotate(90deg);
        }

        .process-tiny-list {
            margin-left: 6px;
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.3s ease;
        }

        .process-tiny-list.expanded {
            max-height: 200px;
        }

        .process-tiny {
            display: flex;
            align-items: center;
            gap: 6px;
            padding: 4px 8px;
            font-size: 11px;
            font-weight: 500;
            color: #495057;
            cursor: pointer;
            border-radius: 3px;
            margin-bottom: 1px;
            transition: all 0.2s;
        }

        .process-tiny:hover {
            background: rgba(16, 185, 129, 0.15);
            color: #333;
        }
        .process-tiny-bullet {
            font-size: 5px;
            color: var(--primary);
        }

        /* Process Progress Bar */
        .process-progress {
            flex: 1;
            height: 5px;
            background: #e9ecef;
            border-radius: 2px;
            overflow: hidden;
        }

        .process-progress-fill {
            height: 100%;
            background: #34D399;
            transition: width 0.3s ease;
        }

        /* 진행률 > 0%일 때 진행률 바 진한 녹색 */
        .process-major[data-progress]:not([data-progress="0"]):not(.completed) .process-progress-fill {
            background: var(--success);
        }

        .process-major.completed .process-progress-fill {
            background: var(--success);
        }

        /* ========== 특별단계/준비단계 스타일 ========== */
        /* ☆ 특별단계: 파란색 계열 */
        .process-special {
            display: flex;
            flex-direction: column;
            gap: 1px;
            padding: 3px 6px;
            background: #dbeafe;
            border: 1px solid #60a5fa;
            border-radius: 6px;
            cursor: pointer;
            margin-bottom: 4px;
            transition: all 0.2s;
        }
        .process-special-header {
            display: flex;
            align-items: center;
            gap: 5px;
            width: 100%;
        }
        .process-special-name {
            flex: 1;
            font-size: 10px;
            font-weight: 600;
            color: #212529;
        }
        .process-special:hover {
            background: #bfdbfe;
        }
        .process-special:hover .process-special-name,
        .process-special:hover .process-special-percent {
            color: #1e40af;
        }
        .process-special-icon {
            font-size: 11px;
            color: #2563eb;
            font-weight: bold;
        }
        .process-special-percent {
            font-size: 9px;
            font-weight: 600;
            color: #2563eb;
        }
        .process-special-progress {
            height: 4px;
            background: rgba(37, 99, 235, 0.2);
            border-radius: 2px;
            overflow: hidden;
        }
        .process-special-progress-fill {
            height: 100%;
            background: #2563eb;
            border-radius: 2px;
            transition: width 0.3s ease;
        }
        /* 특별단계 완료 시에도 파란색 유지 */
        .process-special.completed {
            background: #dbeafe;
            border-color: #2563eb;
        }

        /* ☆ 특별단계 - process-major와 동일한 크기, 파란색 유지 */
        .process-special-major {
            display: flex;
            flex-direction: column;
            gap: 4px;
            padding: 6px 10px;
            background: #dbeafe;
            border: 1px solid #60a5fa;
            border-radius: 6px;
            transition: all 0.2s;
            cursor: pointer;
            margin-bottom: 6px;
        }
        .process-special-major:hover {
            background: #2563eb !important;
            color: white !important;
        }
        .process-special-major:hover .process-icon,
        .process-special-major:hover .process-name,
        .process-special-major:hover .process-arrow,
        .process-special-major:hover .process-percent {
            color: white !important;
        }
        .process-special-major[data-progress="100"] {
            background: #bfdbfe;
            border: 1px solid #60a5fa;
        }
        .process-special-major .process-header {
            display: flex;
            align-items: center;
            gap: 6px;
        }
        .process-special-major .process-icon {
            font-size: 11px;
            color: #212529;
            font-weight: 400;
            min-width: 18px;
            text-align: center;
        }
        .process-special-major .process-name {
            flex: 1;
            font-size: 11px;
            font-weight: 600;
            color: #212529;
        }
        .process-special-major .process-arrow {
            font-size: 10px;
            color: #2563eb;
            transition: transform 0.2s;
        }
        .process-special-major .process-progress-container {
            display: flex;
            align-items: center;
            gap: 8px;
            width: 100%;
        }
        .process-special-major .process-progress {
            flex: 1;
            height: 5px;
            background: rgba(37, 99, 235, 0.2);
            border-radius: 2px;
            overflow: hidden;
        }
        .process-special-major .process-progress-fill {
            height: 100%;
            background: #2563eb;
            border-radius: 2px;
            transition: width 0.3s ease;
        }
        .process-special-major .process-percent {
            font-size: 11px;
            font-weight: 500;
            color: #2563eb;
            min-width: 35px;
            text-align: right;
        }

        /* ○ 준비단계: 초록색 계열 */
        .process-prep {
            display: flex;
            flex-direction: column;
            gap: 4px;
            padding: 6px 10px;
            background: rgba(16, 185, 129, 0.08);
            border: 1px solid rgba(16, 185, 129, 0.2);
            border-radius: 6px;
            cursor: pointer;
            margin-bottom: 6px;
            transition: all 0.2s;
        }
        /* P1, P2 예비단계 완료 스타일 */
        .process-prep.completed {
            background: rgba(16, 185, 129, 0.25); border: 1px solid rgba(16, 185, 129, 0.5);
        }
        .process-prep.completed .process-percent {
            color: var(--success);
        }
        .process-prep.completed .process-progress-fill {
            background: var(--success);
        }
        .process-prep:hover {
            background: var(--success);
            color: white;
        }
        .process-prep:hover .process-prep-icon,
        .process-prep:hover .process-prep-name,
        .process-prep:hover .process-arrow {
            color: white;
        }
        .process-prep-header {
            display: flex;
            align-items: center;
            gap: 8px;
            width: 100%;
        }
        .process-prep-icon {
            font-size: 14px;
            color: var(--success);
            font-weight: bold;
        }
        .process-prep-name {
            flex: 1;
            font-size: 11px;
            font-weight: 600;
            color: #212529;
        }

        /* 구분선: 네이비색 - 더 선명하게 */
        .process-divider {
            height: 0;
            border: none;
            border-top: 2px dashed #94a3b8;
            margin: 12px 0;
        }

        /* ========== Center Workspace ========== */
        .center-workspace {
            grid-column: 2;
            grid-row: 2;
            display: flex;
            flex-direction: column;
            background: var(--bg-light);
            overflow: hidden;
        }

        .workspace-top {
            height: 63%;
            background: white;
            border-bottom: 2px solid var(--border-color);
            display: flex;
            flex-direction: column;
        }

        .workspace-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 16px 24px;
            background: linear-gradient(135deg, #667eea15 0%, #764ba215 100%);
            border-bottom: 1px solid var(--border-color);
            position: relative;
        }

        /* Outbox 알림 박스 */
        .outbox-notification {
            position: absolute;
            top: 70px;
            right: 24px;
            background: white;
            border: 2px solid var(--success);
            border-radius: 8px;
            box-shadow: 0 4px 16px rgba(40, 167, 69, 0.2);
            z-index: 1000;
            animation: slideInDown 0.3s ease-out;
        }

        @keyframes slideInDown {
            from {
                opacity: 0;
                transform: translateY(-20px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .outbox-notification-content {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px 16px;
            min-width: 320px;
        }

        .outbox-notification-icon {
            font-size: 24px;
            flex-shrink: 0;
        }

        .outbox-notification-text {
            flex: 1;
        }

        .outbox-notification-title {
            font-size: 13px;
            font-weight: 700;
            color: var(--success);
            margin-bottom: 2px;
        }

        .outbox-notification-message {
            font-size: 11px;
            color: var(--neutral);
        }

        .outbox-notification-btn {
            padding: 6px 12px;
            background: var(--success);
            color: white;
            border: none;
            border-radius: 4px;
            font-size: 11px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
        }

        .outbox-notification-btn:hover {
            background: #218838;
            transform: scale(1.05);
        }

        .outbox-notification-close {
            background: none;
            border: none;
            font-size: 20px;
            color: var(--neutral);
            cursor: pointer;
            padding: 0 4px;
            line-height: 1;
            transition: color 0.2s;
        }

        .outbox-notification-close:hover {
            color: var(--primary-dark);
        }

        .workspace-title {
            font-size: 22px;
            font-weight: 700;
            color: var(--primary-dark);
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .workspace-actions {
            display: flex;
            gap: 12px;
        }

        .action-btn {
            padding: 8px 12px;
            background: rgba(16, 185, 129, 0.1);
            border: 1px solid var(--primary);
            color: #333;
            border-radius: var(--border-radius);
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s;
            font-size: 11px;
            width: 85px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 3px;
            white-space: nowrap;
        }

        .action-btn:hover {
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
            color: white;
            border-color: var(--primary);
            transform: translateY(-2px);
            box-shadow: var(--shadow-md);
        }

        .action-btn.secondary {
            background: rgba(16, 185, 129, 0.1);
            color: #333;
            border: 1px solid var(--primary);
        }

        .action-btn.secondary:hover {
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
            color: white;
            border-color: var(--primary);
        }

        .action-btn.success {
            background: rgba(16, 185, 129, 0.1);
            color: #333;
            border: 1px solid var(--primary);
        }

        .action-btn.success:hover {
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
            color: white;
            border-color: var(--primary);
        }

        .workspace-content {
            display: flex;
            flex-direction: column;
            gap: 8px;
            padding: 12px;
            overflow-y: auto;
            flex: 1;
            max-height: 100%;
            font-family: 'Malgun Gothic', '맑은 고딕', 'Apple SD Gothic Neo', 'Noto Sans KR', sans-serif;
            font-size: 11px;
        }

        .translation-section {
            display: flex;
            flex-direction: column;
            gap: 4px;
            padding: 8px 12px;
            margin-bottom: 6px;
            background: #f8f9fa;
            border-radius: var(--border-radius);
            border-left: 3px solid var(--tertiary);
            flex-shrink: 0;
        }

        .translation-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 8px;
        }

        .translation-title {
            font-size: 16px;
            font-weight: 600;
            color: var(--tertiary);
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .translation-toggle {
            font-size: 13px;
            color: var(--neutral);
            cursor: pointer;
            padding: 4px 8px;
            background: white;
            border-radius: 4px;
            transition: all 0.2s;
        }

        .translation-toggle:hover {
            background: var(--secondary);
            color: white;
        }

        .translation-preview {
            background: white;
            padding: 6px 8px;
            border-radius: 6px;
            font-size: 11px;
            line-height: 1.3;
            color: #495057;
            max-height: 70px;
            overflow-y: auto;
            display: none;
        }

        .translation-preview.expanded {
            max-height: 150px;
            overflow-y: auto;
        }

        .translation-preview pre {
            margin: 0;
            white-space: pre-wrap;
            word-wrap: break-word;
        }

        .translation-info {
            font-size: 13px;
            color: #868e96;
            padding: 6px 0;
            line-height: 1.3;
        }

        .text-editor {
            width: 100%;
            flex: 1;
            min-height: 300px;
            padding: 12px;
            border: 2px solid var(--border-color);
            border-radius: var(--border-radius);
            font-family: 'Malgun Gothic', '맑은 고딕', 'Apple SD Gothic Neo', 'Noto Sans KR', sans-serif;
            font-size: 11px;
            font-weight: 400;
            line-height: 1.6;
            resize: none;
            outline: none;
            transition: border-color 0.2s;
        }

        .text-editor:focus {
            border-color: #495057;
        }

        .text-editor::placeholder {
            color: #adb5bd;
        }

        .workspace-bottom {
            height: 37%;
            min-height: 200px;
            background: white;
            display: flex;
            flex-direction: column;
        }

        .grid-viewer-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 24px;
            background: linear-gradient(135deg, #667eea15 0%, #764ba215 100%);
            border-bottom: 1px solid var(--border-color);
        }

        .grid-viewer-title {
            /* H2 스타일 적용 */
            font-size: 22px;
            font-weight: 700;
            color: var(--primary-dark);
        }

        .view-toggle {
            display: flex;
            gap: 8px;
        }

        .view-btn {
            padding: 6px 14px;
            border: 1px solid var(--border-color);
            background: white;
            border-radius: var(--border-radius);
            cursor: pointer;
            font-size: 11px;
            font-weight: 500;
            transition: all 0.2s;
        }

        .view-btn:hover {
            border-color: var(--primary);
            color: var(--primary);
        }

        .view-btn.active {
            background: var(--primary);
            color: white;
            border-color: var(--primary);
        }

        .grid-content {
            flex: 1;
            overflow-y: auto;
            padding: 15px;
        }

        .stats-bar {
            display: flex;
            gap: 12px;
            padding: 12px;
            background: #f8f9fa;
            border-radius: var(--border-radius);
            margin-bottom: 13px;  /* 1단계: Section spacing */
        }

        .stat-item {
            flex: 1;
            text-align: center;
            padding: 10px;
            background: white;
            border-radius: 6px;
            box-shadow: var(--shadow-sm);
        }

        .stat-label {
            display: block;
            font-size: 11px;
            color: var(--neutral);
            margin-bottom: 4px;
        }

        .stat-value {
            display: block;
            font-size: 14px;
            font-weight: 600;
        }

        .stat-value.completed {
            color: var(--success);
        }

        .stat-value.in-progress {
            color: var(--warning);
        }

        .stat-value.pending {
            color: var(--neutral);
        }

        .grid-area {
            margin-bottom: 13px;  /* 1단계: Section spacing */
        }

        .area-header {
            background: var(--success);
            color: white;
            padding: 10px 14px;
            border-radius: var(--border-radius);
            font-weight: 600;
            margin-bottom: 10px;  /* 2단계: Group spacing */
            font-size: 13px;
        }

        .task-cards {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 12px;
        }

        .task-card {
            background: white;
            border-radius: var(--border-radius);
            padding: 14px;
            box-shadow: var(--shadow-sm);
            cursor: pointer;
            transition: all 0.2s;
            position: relative;
            overflow: hidden;
            border-left: 4px solid;
        }

        .task-card.completed {
            border-left-color: var(--success);
        }

        .task-card.in-progress {
            border-left-color: var(--warning);
        }

        .task-card.pending {
            border-left-color: var(--neutral);
        }

        .task-card:hover {
            transform: translateY(-3px);
            box-shadow: var(--shadow-md);
        }

        .task-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 8px;
        }

        .task-id {
            font-weight: 700;
            color: var(--secondary);
            font-size: 11px;
        }

        .status-badge {
            padding: 3px 8px;
            border-radius: 12px;
            font-size: 11px;
            font-weight: 600;
        }

        .status-badge.completed {
            background: #d4edda;
            color: #155724;
        }

        .status-badge.in-progress {
            background: #fff3cd;
            color: #856404;
        }

        .status-badge.pending {
            background: #e2e3e5;
            color: #383d41;
        }

        .task-title {
            font-weight: 600;
            margin-bottom: 6px;  /* 3단계: Item spacing */
            color: #212529;
            font-size: 11px;
            word-wrap: break-word;
            overflow-wrap: break-word;
            line-height: 1.3;
        }

        .task-progress {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .progress-bar {
            flex: 1;
            height: 5px;
            background: #e9ecef;
            border-radius: 3px;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: var(--success);
            transition: width 0.3s ease;
        }

        .progress-text {
            font-size: 11px;
            font-weight: 600;
            color: var(--neutral);
        }

        /* ========== Right Sidebar ========== */
        .right-sidebar {
            grid-column: 3;
            grid-row: 2;
            overflow-y: auto;
            background: var(--bg-white);
            border-left: 1px solid var(--border-color);
            padding: 14px 15px;
        }

        .sidebar-section {
            margin-bottom: 12px;
            padding-bottom: 12px;
            border-bottom: 1px solid var(--border-color);
        }

        .sidebar-section:last-child {
            border-bottom: none;
            margin-bottom: 0;
            padding-bottom: 0;
        }

        /* 좌측 사이드바 섹션 간격 */
        .left-sidebar-section {
            margin-top: 12px;
            padding-top: 12px;
            border-top: 1px solid var(--border-color);
        }

        .left-sidebar-section:first-child {
            margin-top: 0;
            padding-top: 0;
            border-top: none;
        }

        .sidebar-section h3 {
            /* H3 스타일 적용 */
            font-size: 14px;
            font-weight: 700;
            margin-bottom: 8px;
            color: #495057;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .knowledge-item {
            margin-bottom: 4px;
        }

        .knowledge-major {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 6px 8px;
            background: rgba(245, 158, 11, 0.08); border: 1px solid rgba(245, 158, 11, 0.2);
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .knowledge-major:hover {
            background: var(--secondary); border-color: var(--secondary);
            color: white;
        }

        .knowledge-icon {
            font-size: 14px;
        }

        .knowledge-name {
            flex: 1;
            /* H5 스타일 적용 (사용자 요청: 2단계 크기 축소) */
            font-size: 11px;
            font-weight: 700;
            color: #495057;
        }

        .knowledge-arrow {
            font-size: 10px;
            transition: transform 0.3s;
        }

        .knowledge-arrow.expanded {
            transform: rotate(90deg);
        }

        .knowledge-medium-list {
            margin-left: 12px;
            margin-top: 4px;
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.3s ease;
        }

        .knowledge-medium-list.expanded {
            max-height: 400px;
        }

        .knowledge-medium {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 4px 8px;
            /* H5 스타일 적용 */
            font-size: 11px;
            font-weight: 700;
            color: #495057;
            cursor: pointer;
            border-radius: 4px;
            margin-bottom: 2px;
            transition: all 0.2s;
        }

        .knowledge-medium:hover {
            background: rgba(245, 158, 11, 0.15);
            color: #333;
        }

        .knowledge-medium-content {
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .knowledge-medium-bullet {
            font-size: 7px;
            color: var(--primary);
        }

        .knowledge-medium-arrow {
            font-size: 7px;
            transition: transform 0.3s;
            opacity: 0.5;
        }

        .knowledge-medium-arrow.expanded {
            transform: rotate(90deg);
        }

        .knowledge-small-list {
            margin-left: 12px;
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.3s ease;
        }

        .knowledge-small-list.expanded {
            max-height: 300px;
        }

        .knowledge-small {
            display: flex;
            align-items: center;
            gap: 6px;
            padding: 4px 8px;
            /* H6 스타일 적용 */
            font-size: 11px;
            font-weight: 500;
            color: #495057;
            cursor: pointer;
            border-radius: 3px;
            margin-bottom: 1px;
            transition: all 0.2s;
        }

        .knowledge-small:hover {
            background: rgba(245, 158, 11, 0.15);
            color: #333;
        }

        .knowledge-small-bullet {
            font-size: 5px;
            color: var(--primary);
        }

        /* ========== Quick Links Section ========== */
        .quick-links {
            display: flex;
            flex-direction: column;
            gap: 6px;
        }

        .quick-link-btn {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 10px 12px;
            background: white;
            border: 1px solid var(--border-color);
            border-radius: 6px;
            text-decoration: none;
            color: #495057;
            font-size: 11px;
            font-weight: 500;
            transition: all 0.2s;
            cursor: pointer;
        }

        .quick-link-btn:hover {
            background: var(--bg-light);
            border-color: var(--success);
            transform: translateX(2px);
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
        }

        .quick-link-btn.vscode:hover {
            border-color: #007ACC;
            background: rgba(0, 122, 204, 0.05);
        }

        .quick-link-btn.github:hover {
            border-color: #24292e;
            background: rgba(36, 41, 46, 0.05);
        }

        .quick-link-btn.vercel:hover {
            border-color: #000;
            background: rgba(0, 0, 0, 0.05);
        }

        .quick-link-btn.supabase:hover {
            border-color: #3ECF8E;
            background: rgba(62, 207, 142, 0.05);
        }

        .quick-link-icon {
            width: 20px;
            height: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        /* AI Selector 버튼 스타일 */
        .ai-selector-btn {
            flex: 1;
            min-width: 60px;
            padding: 5px 8px;
            border: 1px solid #999;
            border-radius: var(--border-radius);
            background: rgba(245, 158, 11, 0.08);
            color: #333;
            font-size: 11px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s;
            white-space: nowrap;
        }

        .ai-selector-btn:hover {
            border-color: var(--secondary);
            background: rgba(245, 158, 11, 0.05);
            transform: translateY(-1px);
        }

        .ai-selector-btn.active {
            border-color: var(--secondary);
            background: var(--secondary);
            color: white;
            box-shadow: 0 2px 8px rgba(245, 158, 11, 0.3);
        }

        /* 외부 연동 설정 Guide 스타일 */
        .service-guide-item {
            margin-bottom: 6px;
            border: 1px solid #E5E7EB;
            border-radius: 8px;
            overflow: hidden;
            transition: all 0.2s;
            cursor: pointer;
        }
        .service-guide-item:hover {
            border-color: #F59E0B;
            background: #FFFBEB;
        }
        .service-guide-header {
            padding: 10px 12px;
            background: #FAFAFA;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        .service-guide-icon {
            font-size: 16px;
        }
        .service-guide-title {
            flex: 1;
            font-size: 13px;
            font-weight: 500;
            color: #374151;
        }
        .service-guide-arrow {
            font-size: 10px;
            color: #F59E0B;
            transition: transform 0.2s;
        }

        .quick-link-icon img {
            width: 100%;
            height: 100%;
            object-fit: contain;
        }

        .quick-link-name {
            flex: 1;
            font-weight: 600;
        }

        .ai-input-area {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .ai-input-area textarea {
            width: 100%;
            padding: 12px;
            border: 1px solid var(--border-color);
            border-radius: var(--border-radius);
            font-family: inherit;
            font-size: 11px;
            resize: vertical;
            line-height: 1.5;
            color: #333;
        }

        .ai-input-area textarea::placeholder {
            color: #999;
            font-size: 11px;
        }

        .ai-input-area button {
            padding: 10px;
            background: var(--secondary);
            color: white;
            border: none;
            border-radius: var(--border-radius);
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
        }

        .ai-input-area button:hover {
            background: var(--secondary-dark);
        }

        .credit-info {
            font-size: 11px;
            color: var(--neutral);
            text-align: center;
        }

        .credit-info span {
            font-weight: 700;
            color: var(--primary);
        }

        .support-input-area {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .support-input-area textarea {
            font-size: 11px;
            width: 100%;
            padding: 12px;
            border: 1px solid var(--border-color);
            border-radius: var(--border-radius);
            font-family: inherit;
            line-height: 1.5;
            color: #333;
        }

        .support-input-area textarea::placeholder {
            color: #999;
            font-size: 10px;
        }

        .support-placeholder {
            font-size: 11px;
            color: var(--neutral);
            background: #f8f9fa;
            padding: 10px;
            border-radius: 6px;
            margin-bottom: 8px;
            line-height: 1.5;
        }

        .support-input-area button {
            padding: 10px;
            background: var(--secondary);
            color: white;
            border: none;
            border-radius: var(--border-radius);
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
        }

        .support-input-area button:hover {
            background: var(--secondary-dark);
        }

        /* Support Response Area */
        .support-response {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.3s ease;
            margin-top: 11px;
        }

        .support-response.show {
            max-height: 400px;
            overflow-y: auto;
        }

        .response-header {
            background: var(--success);
            color: white;
            padding: 8px 12px;
            border-radius: 6px 6px 0 0;
            font-size: 11px;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .response-content {
            background: #f8f9fa;
            padding: 12px;
            border: 1px solid #dee2e6;
            border-top: none;
            border-radius: 0 0 6px 6px;
            font-size: 13px;
            line-height: 1.6;
            color: #212529;
        }

        .response-meta {
            font-size: 11px;
            color: #495057;
            margin-top: 8px;
            padding-top: 8px;
            border-top: 1px solid #dee2e6;
        }

        /* ========== Footer ========== */
        .footer {
            width: 100%;
            background: linear-gradient(135deg, var(--tertiary) 0%, var(--tertiary-dark) 100%);
            color: white;
            position: relative;
        }

        .footer-inner {
            width: 100%;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 44px 32px 44px 32px;
            font-size: 11px;
            gap: 9px;
        }

        .footer-links {
            display: flex;
            align-items: center;
            gap: 32px;
        }

        .footer-link {
            color: rgba(255, 255, 255, 0.95);
            text-decoration: none;
            transition: color 0.2s;
            font-size: 14px;
            font-weight: 600;
        }

        .footer-link:hover {
            color: white;
        }

        .footer-copyright {
            display: flex;
            align-items: center;
            gap: 4px;
            font-size: 14px;
            opacity: 0.7;
        }

        .admin-link {
            position: absolute;
            right: 32px;
            bottom: 12px;
            opacity: 0.15;
            font-size: 9px;
            transition: opacity 0.3s;
            color: rgba(255, 255, 255, 0.95);
            text-decoration: none;
        }

        .admin-link:hover {
            opacity: 0.6;
        }

        /* ========== Scrollbar ========== */
        ::-webkit-scrollbar {
            width: 12px;
            height: 12px;
        }

        ::-webkit-scrollbar-track {
            background: #e9ecef;
        }

        ::-webkit-scrollbar-thumb {
            background: #adb5bd;
            border-radius: 6px;
            border: 2px solid #e9ecef;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: #868e96;
        }

        /* Status Indicator */
        .server-status {
            position: fixed;
            bottom: 20px;
            right: 300px;
            padding: 10px 16px;
            background: var(--secondary);
            color: white;
            border-radius: 6px;
            font-size: 11px;
            z-index: 1000;
            display: none;
        }

        .server-status.show {
            display: block;
        }

        .server-status.success {
            background: var(--secondary);
        }

        .server-status.error {
            background: var(--danger);
        }

        /* Project Grid Fullscreen Modal */
        .grid-fullscreen-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: #F3F4F6;
            z-index: 9999;
            padding: 20px;
        }

        .grid-fullscreen-modal.active {
            display: flex;
            flex-direction: column;
        }

        .grid-fullscreen-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 16px 24px;
            background: linear-gradient(135deg, var(--tertiary) 0%, var(--tertiary-dark) 100%);
            border-radius: 8px 8px 0 0;
            margin-bottom: 13px;  /* 1단계: Section spacing */
        }

        .grid-fullscreen-title {
            font-size: 24px;
            font-weight: 700;
            color: white;
        }

        .grid-fullscreen-close {
            padding: 10px 20px;
            background: #495057;
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
            transition: all 0.2s;
        }

        .grid-fullscreen-close:hover {
            background: #5a6268;
            transform: scale(1.05);
        }

        .grid-fullscreen-content {
            flex: 1;
            background: white;
            border-radius: 8px;
            overflow-y: auto;
            padding: 24px;
        }

        .grid-viewer-title-group {
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 12px;
            width: 100%;
        }

        .expand-btn-inline {
            padding: 8px 12px;
            border: 1px solid var(--primary);
            background: rgba(16, 185, 129, 0.1);
            color: #333;
            border-radius: var(--border-radius);
            cursor: pointer;
            font-size: 11px;
            font-weight: 500;
            transition: all 0.2s;
            width: 85px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 3px;
            white-space: nowrap;
        }

        .expand-btn-inline:hover {
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
            color: white;
            border-color: var(--primary);
            transform: translateY(-2px);
            box-shadow: var(--shadow-md);
        }

        .manual-btn-inline {
            padding: 8px 12px;
            border: 1px solid var(--primary);
            background: rgba(16, 185, 129, 0.1);
            color: #333;
            border-radius: var(--border-radius);
            cursor: pointer;
            font-size: 11px;
            font-weight: 500;
            transition: all 0.2s;
            width: 85px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 3px;
            white-space: nowrap;
        }

        .manual-btn-inline:hover {
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
            color: white;
            border-color: var(--primary);
            transform: translateY(-2px);
            box-shadow: var(--shadow-md);
        }

        /* 공지사항 스타일 */
        .notice-item {
            display: flex;
            flex-direction: column;
            align-items: flex-start;
            display: flex;
            REMOVED
            gap: 6px;
            padding: 4px 8px;
            font-size: 11px;
            font-weight: 700;
            color: #495057;
            cursor: pointer;
            border-radius: 4px;
            margin-bottom: 2px;
            transition: all 0.2s;
            background: rgba(245, 158, 11, 0.08);
        }

        .notice-item:hover {
            background: rgba(245, 158, 11, 0.15) !important;
            color: #333;
        }

        .notice-bullet {
            font-size: 7px;
            color: #D97706;
        }

        .notice-title {
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
            text-overflow: ellipsis;
            line-height: 1.3;
            flex: 1;
        }

        .notice-date {
            font-size: 10px;
            color: #868e96;
            font-weight: 400;
            white-space: nowrap;
            margin-left: 4px;
        }

    </style>

    <!-- Supabase JS Client -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

    <!-- DOMPurify -->
    <script src="https://cdn.jsdelivr.net/npm/dompurify@3.0.6/dist/purify.min.js"></script>
</head>

<body>
    <div class="page-wrapper">
        <!-- Header -->
        <header class="header">
            <div class="header-inner">
                <div class="logo">
                    <span class="rice-logo">
                        <span class="rice-grain"></span>
                        <span class="rice-grain"></span>
                        <span class="rice-grain"></span>
                    </span>
                    <h1>SSAL Works</h1>
                </div>
                <div class="header-center">
                    <div class="header-tagline">Claude Code를 활용한 SAL Grid 기반 풀스택
      웹사이트 개발 플랫폼</div>
                </div>
                <div class="header-right">
                    <!-- 로그인 전 -->
                    <div id="headerGuestBtns" style="display: flex; gap: 12px;">
                        <a href="pages/auth/login.html" class="header-btn" style="text-decoration: none;">로그인</a>
                        <a href="pages/auth/signup.html" class="header-btn" style="text-decoration: none;">회원가입</a>
                    </div>
                    <!-- 로그인 후 -->
                    <div id="headerUserBtns" style="display: none; align-items: center; gap: 12px;">
                        <span id="userNickname" style="font-weight: 600; color: var(--primary);"></span>
                        <button class="header-btn" onclick="logoutFromMain()">로그아웃</button>
                    </div>
                </div>
            </div>
        </header>

        <!-- Main Content Area -->
        <div class="layout-container">
            <!-- Left Sidebar: Process -->
        <aside class="left-sidebar">
            <!-- Project Section -->
            <div class="left-sidebar-section">
                <h2 class="sidebar-title" style="margin-bottom: 13px;">📦 PROJECT</h2>

                <!-- 1. 예시 Project (3개) -->
                <div style="margin-bottom: 6px;">
                    <div style="display: flex; justify-content: space-between; align-items: center; font-size: 11px; font-weight: 600; color: var(--primary); padding: 6px 8px; background: rgba(16, 185, 129, 0.08); border-radius: 4px; cursor: pointer;"
                        onclick="toggleExampleProjects()">
                        <span>📚 예시 Project (3개)</span>
                        <span id="exampleProjectsArrow" style="font-size: 10px;">▶</span>
                    </div>
                    <div id="exampleProjectsList" style="display: none; flex-direction: column; gap: 4px; margin-top: 4px; padding-left: 8px;">
                        <div class="project-list-item" onclick="window.open('https://drive.google.com/drive/folders/POLITICIAN_FINDER_FOLDER_ID', '_blank')" style="border-left-color: var(--primary);">
                            <span class="project-name">PoliticianFinder</span>
                            <span class="project-status" style="background: rgba(16, 185, 129, 0.15); color: var(--primary);">예시</span>
                        </div>
                        <div class="project-list-item" onclick="window.open('https://drive.google.com/drive/folders/SSAL_WORKS_FOLDER_ID', '_blank')" style="border-left-color: var(--primary);">
                            <span class="project-name">SSAL Works</span>
                            <span class="project-status" style="background: rgba(16, 185, 129, 0.15); color: var(--primary);">예시</span>
                        </div>
                        <div class="project-list-item" onclick="window.open('https://drive.google.com/drive/folders/HDH_FINTECH_FOLDER_ID', '_blank')" style="border-left-color: var(--primary);">
                            <span class="project-name">HDH Fintech</span>
                            <span class="project-status" style="background: rgba(16, 185, 129, 0.15); color: var(--primary);">예시</span>
                        </div>
                    </div>
                </div>

                <!-- 2. 완료 Project -->
                <div style="margin-bottom: 6px;">
                    <div style="display: flex; justify-content: space-between; align-items: center; font-size: 11px; font-weight: 600; color: #495057; padding: 6px 8px; background: rgba(16, 185, 129, 0.05); border-radius: 4px; cursor: pointer;"
                        onclick="toggleCompletedProjects()">
                        <span>✅ 완료 Project (<span id="completedProjectsCount">3</span>개)</span>
                        <span id="completedProjectsArrow" style="font-size: 10px;">▶</span>
                    </div>
                    <div id="completedProjectsList" style="display: none; flex-direction: column; gap: 4px; margin-top: 4px; padding-left: 8px; max-height: 200px; overflow-y: auto;">
                        <!-- 완료 프로젝트들 (DB에서 동적 로드) -->
                        <div class="project-list-item" onclick="selectProject('포트폴리오')" style="opacity: 0.7;">
                            <span class="project-name">포트폴리오</span>
                            <span class="project-status" style="background: var(--success); color: white;">완료</span>
                        </div>
                        <div class="project-list-item" onclick="selectProject('쇼핑몰 프로젝트')" style="opacity: 0.7;">
                            <span class="project-name">쇼핑몰 프로젝트</span>
                            <span class="project-status" style="background: var(--success); color: white;">완료</span>
                        </div>
                        <div class="project-list-item" onclick="selectProject('회사 홈페이지')" style="opacity: 0.7;">
                            <span class="project-name">회사 홈페이지</span>
                            <span class="project-status" style="background: var(--success); color: white;">완료</span>
                        </div>
                    </div>
                </div>

                <!-- 3. 진행중 Project (1개만) -->
                <div style="margin-bottom: 6px;">
                    <div style="display: flex; justify-content: space-between; align-items: center; font-size: 11px; font-weight: 600; color: #495057; padding: 6px 8px; background: rgba(16, 185, 129, 0.05); border-radius: 4px; cursor: pointer;"
                        onclick="toggleCurrentProject()">
                        <span>🔄 진행중 Project</span>
                        <span id="currentProjectArrow" style="font-size: 10px;">▼</span>
                    </div>
                    <div id="currentProjectList" style="display: flex; flex-direction: column; gap: 4px; margin-top: 4px; padding-left: 8px;">
                        <div class="project-list-item selected" onclick="loadProcessStage('project_work', 'SSAL Works', '프로젝트'); selectProject('SSAL Works')">
                            <span class="project-name">SSAL Works</span>
                            <span class="project-status">진행중</span>
                        </div>
                    </div>
                </div>

                <!-- 4. 새로운 Project 등록 -->
                <div style="margin-top: 8px;">
                    <div style="display: flex; align-items: center; gap: 6px; padding: 6px 8px; background: rgba(16, 185, 129, 0.08); border: 1px dashed var(--primary); border-radius: 4px; cursor: pointer; font-size: 11px; font-weight: 600; color: var(--primary); transition: all 0.2s;"
                        onclick="openAddProjectModal()"
                        onmouseover="this.style.background='rgba(16, 185, 129, 0.15)'; this.style.borderStyle='solid'"
                        onmouseout="this.style.background='rgba(16, 185, 129, 0.08)'; this.style.borderStyle='dashed'">
                        <span style="font-size: 14px;">+</span>
                        <span>새로운 Project 등록</span>
                    </div>
                </div>
            </div>

            <!-- Process Section -->
            <div class="left-sidebar-section">
                <h2 class="sidebar-title" style="margin-bottom: 13px;">📊 진행 프로세스</h2>

                <div class="process-list">
                    <!-- P0. 작업 디렉토리 구조 생성 (특별단계) -->
                    <div class="process-item">
                        <div class="process-special-major" onclick="toggleProcess(this)" data-progress="100">
                            <div class="process-header">
                                <span class="process-icon">P0.</span>
                                <span class="process-name">작업 디렉토리 구조 생성</span>
                                <span class="process-arrow">▶</span>
                            </div>
                            <div class="process-progress-container">
                                <div class="process-progress">
                                    <div class="process-progress-fill" style="width: 100%"></div>
                                </div>
                                <span class="process-percent">100%</span>
                            </div>
                        </div>
                        <div class="process-small-list">
                            <div class="process-small">
                                <div class="process-small-content">
                                    <span class="process-small-bullet">●</span>
                                    <span>Project_Directory_Structure</span>
                                </div>
                            </div>
                            <div class="process-small">
                                <div class="process-small-content">
                                    <span class="process-small-bullet">●</span>
                                    <span>Project_Status</span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- P1 사업계획 -->
                    <div class="process-item">
                        <div class="process-major completed" onclick="toggleProcess(this)" data-progress="100">
                            <div class="process-header">
                                <span class="process-icon">P1.</span>
                                <span class="process-name">사업계획</span>
                                <span class="process-arrow">▶</span>
                            </div>
                            <div class="process-progress-container">
                                <div class="process-progress">
                                    <div class="process-progress-fill" style="width: 100%"></div>
                                </div>
                                <span class="process-percent">100%</span>
                            </div>
                        </div>
                        <div class="process-small-list">
                            <div class="process-small" onclick="loadProcessStage('biz_0_1', 'Vision & Mission', 'P1')">
                                <div class="process-small-content">
                                    <span class="process-small-bullet">●</span>
                                    <span>Vision_Mission</span>
                                </div>
                            </div>
                            <div class="process-small" onclick="loadProcessStage('biz_0_2', 'Market Analysis', 'P1')">
                                <div class="process-small-content">
                                    <span class="process-small-bullet">●</span>
                                    <span>Market_Analysis</span>
                                </div>
                            </div>
                            <div class="process-small" onclick="loadProcessStage('biz_0_3', 'Business Model', 'P1')">
                                <div class="process-small-content">
                                    <span class="process-small-bullet">●</span>
                                    <span>Business_Model</span>
                                </div>
                            </div>
                            <div class="process-small" onclick="loadProcessStage('biz_0_1', 'Patent', 'P1')">
                                <div class="process-small-content">
                                    <span class="process-small-bullet">●</span>
                                    <span>Patent</span>
                                </div>
                            </div>
                            <div class="process-small" onclick="loadProcessStage('biz_0_3', 'Business Plan', 'P1')">
                                <div class="process-small-content">
                                    <span class="process-small-bullet">●</span>
                                    <span>BusenessPlan</span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- P2 프로젝트 기획 -->
                    <div class="process-item">
                        <div class="process-major completed" onclick="toggleProcess(this)" data-progress="100">
                            <div class="process-header">
                                <span class="process-icon">P2.</span>
                                <span class="process-name">프로젝트 기획</span>
                                <span class="process-arrow">▶</span>
                            </div>
                            <div class="process-progress-container">
                                <div class="process-progress">
                                    <div class="process-progress-fill" style="width: 100%"></div>
                                </div>
                                <span class="process-percent">100%</span>
                            </div>
                        </div>
                        <div class="process-small-list">
                            <div class="process-small" onclick="loadProcessStage('plan_1_1', 'Project Plan', 'P2')">
                                <div class="process-small-content">
                                    <span class="process-small-bullet">●</span>
                                    <span>Project_Plan</span>
                                </div>
                            </div>
                            <div class="process-small" onclick="loadProcessStage('plan_1_3', 'User Flows', 'P2')">
                                <div class="process-small-content">
                                    <span class="process-small-bullet">●</span>
                                    <span>User_Flows</span>
                                </div>
                            </div>
                            <div class="process-small" onclick="loadProcessStage('plan_1_2', 'Requirements', 'P2')">
                                <div class="process-small-content">
                                    <span class="process-small-bullet">●</span>
                                    <span>Requirements</span>
                                </div>
                            </div>
                            <div class="process-small" onclick="loadProcessStage('plan_1_4', 'Design System', 'P2')">
                                <div class="process-small-content">
                                    <span class="process-small-bullet">●</span>
                                    <span>Design_System</span>
                                </div>
                            </div>
                            <div class="process-small" onclick="loadProcessStage('plan_mockup', 'UI/UX Mockup', 'P2')">
                                <div class="process-small-content">
                                    <span class="process-small-bullet">●</span>
                                    <span>UI_UX_Mockup</span>
                                </div>
                            </div>
                            <div class="process-small" onclick="loadProcessStage('plan_1_5', 'Tech Stack', 'P2')">
                                <div class="process-small-content">
                                    <span class="process-small-bullet">●</span>
                                    <span>Tech_Stack</span>
                                </div>
                            </div>
                            <div class="process-small" onclick="loadProcessStage('plan_1_6', 'Workflows', 'P2')">
                                <div class="process-small-content">
                                    <span class="process-small-bullet">●</span>
                                    <span>Workflows</span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- P3. 프로토타입 제작 -->
                    <div class="process-item">
                        <div class="process-major completed" onclick="toggleProcess(this)" data-progress="100">
                            <div class="process-header">
                                <span class="process-icon">P3.</span>
                                <span class="process-name">프로토타입 제작</span>
                                <span class="process-arrow">▶</span>
                            </div>
                            <div class="process-progress-container">
                                <div class="process-progress">
                                    <div class="process-progress-fill" style="width: 100%"></div>
                                </div>
                                <span class="process-percent">100%</span>
                            </div>
                        </div>
                        <div class="process-small-list">
                            <div class="process-small" onclick="loadProcessStage('proto_scripts', 'Documentation', 'P3')">
                                <div class="process-small-content">
                                    <span class="process-small-bullet">●</span>
                                    <span>Documentation</span>
                                </div>
                            </div>
                            <div class="process-small" onclick="loadProcessStage('proto_pages', 'Frontend', 'P3')">
                                <div class="process-small-content">
                                    <span class="process-small-bullet">●</span>
                                    <span>Frontend</span>
                                </div>
                            </div>
                            <div class="process-small" onclick="loadProcessStage('proto_database', 'Database', 'P3')">
                                <div class="process-small-content">
                                    <span class="process-small-bullet">●</span>
                                    <span>Database</span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- S0. Project SAL Grid 생성 -->
                    <div class="process-item">
                        <div class="process-special-major" onclick="toggleProcess(this)" data-progress="100">
                            <div class="process-header">
                                <span class="process-icon">S0.</span>
                                <span class="process-name">Project SAL Grid 생성</span>
                                <span class="process-arrow">▶</span>
                            </div>
                            <div class="process-progress-container">
                                <div class="process-progress">
                                    <div class="process-progress-fill" style="width: 100%"></div>
                                </div>
                                <span class="process-percent">100%</span>
                            </div>
                        </div>
                        <div class="process-small-list">
                            <div class="process-small" onclick="loadProcessStage('ssal_grid', 'SAL Grid', 'SAL Grid')">
                                <div class="process-small-content">
                                    <span class="process-small-bullet">●</span>
                                    <span>ssal-grid</span>
                                </div>
                            </div>
                            <div class="process-small" onclick="loadProcessStage('sal_grid_manual', 'Manual', 'SAL Grid')">
                                <div class="process-small-content">
                                    <span class="process-small-bullet">●</span>
                                    <span>manual</span>
                                </div>
                            </div>
                            <div class="process-small" onclick="loadProcessStage('sal_grid_supabase', 'Supabase', 'SAL Grid')">
                                <div class="process-small-content">
                                    <span class="process-small-bullet">●</span>
                                    <span>supabase</span>
                                </div>
                            </div>
                            <div class="process-small" onclick="loadProcessStage('sal_grid_viewer', 'Viewer', 'SAL Grid')">
                                <div class="process-small-content">
                                    <span class="process-small-bullet">●</span>
                                    <span>viewer</span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- S1. 개발 준비 (Stage Gate 완료) -->
                    <div class="process-item">
                        <div id="process-s1" class="process-major completed" onclick="loadProcessStage('s2_dev_prep', 'S1. 개발 준비', '개발단계'); toggleProcess(this)" data-progress="100">
                            <div class="process-header">
                                <span class="process-icon">S1.</span>
                                <span class="process-name">개발 준비</span>
                                <span class="process-arrow">▶</span>
                            </div>
                            <div class="process-progress-container">
                                <div class="process-progress">
                                    <div class="process-progress-fill" style="width: 100%"></div>
                                </div>
                                <span class="process-percent">100%</span>
                            </div>
                        </div>
                        <div class="process-small-list">
                            <div class="process-small">
                                <div class="process-small-content">
                                    <span class="process-small-bullet">●</span>
                                    <span>Documentation</span>
                                </div>
                            </div>
                            <div class="process-small">
                                <div class="process-small-content">
                                    <span class="process-small-bullet">●</span>
                                    <span>Frontend</span>
                                </div>
                            </div>
                            <div class="process-small">
                                <div class="process-small-content">
                                    <span class="process-small-bullet">●</span>
                                    <span>Backend_Infra</span>
                                </div>
                            </div>
                            <div class="process-small">
                                <div class="process-small-content">
                                    <span class="process-small-bullet">●</span>
                                    <span>Database</span>
                                </div>
                            </div>
                            <div class="process-small">
                                <div class="process-small-content">
                                    <span class="process-small-bullet">●</span>
                                    <span>Security</span>
                                </div>
                            </div>
                            <div class="process-small">
                                <div class="process-small-content">
                                    <span class="process-small-bullet">●</span>
                                    <span>Testing</span>
                                </div>
                            </div>
                            <div class="process-small">
                                <div class="process-small-content">
                                    <span class="process-small-bullet">●</span>
                                    <span>DevOps</span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- S2. 개발 1차 -->
                    <div class="process-item">
                        <div id="process-s2" class="process-major" onclick="loadProcessStage('s3_dev_1', 'S2. 개발 1차', '개발단계'); toggleProcess(this)" data-progress="0">
                            <div class="process-header">
                                <span class="process-icon">S2.</span>
                                <span class="process-name">개발 1차</span>
                                <span class="process-arrow">▶</span>
                            </div>
                            <div class="process-progress-container">
                                <div class="process-progress">
                                    <div class="process-progress-fill" style="width: 0%"></div>
                                </div>
                                <span class="process-percent">0%</span>
                            </div>
                        </div>
                        <div class="process-small-list">
                            <div class="process-small">
                                <div class="process-small-content">
                                    <span class="process-small-bullet">●</span>
                                    <span>Documentation</span>
                                </div>
                            </div>
                            <div class="process-small">
                                <div class="process-small-content">
                                    <span class="process-small-bullet">●</span>
                                    <span>Frontend</span>
                                </div>
                            </div>
                            <div class="process-small">
                                <div class="process-small-content">
                                    <span class="process-small-bullet">●</span>
                                    <span>Backend_Infra</span>
                                </div>
                            </div>
                            <div class="process-small">
                                <div class="process-small-content">
                                    <span class="process-small-bullet">●</span>
                                    <span>Backend_API</span>
                                </div>
                            </div>
                            <div class="process-small">
                                <div class="process-small-content">
                                    <span class="process-small-bullet">●</span>
                                    <span>Database</span>
                                </div>
                            </div>
                            <div class="process-small">
                                <div class="process-small-content">
                                    <span class="process-small-bullet">●</span>
                                    <span>Security</span>
                                </div>
                            </div>
                            <div class="process-small">
                                <div class="process-small-content">
                                    <span class="process-small-bullet">●</span>
                                    <span>Testing</span>
                                </div>
                            </div>
                            <div class="process-small">
                                <div class="process-small-content">
                                    <span class="process-small-bullet">●</span>
                                    <span>Content_System</span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- S3. 개발 2차 -->
                    <div class="process-item">
                        <div id="process-s3" class="process-major" onclick="loadProcessStage('s4_dev_2', 'S3. 개발 2차', '개발단계'); toggleProcess(this)" data-progress="0">
                            <div class="process-header">
                                <span class="process-icon">S3.</span>
                                <span class="process-name">개발 2차</span>
                                <span class="process-arrow">▶</span>
                            </div>
                            <div class="process-progress-container">
                                <div class="process-progress">
                                    <div class="process-progress-fill" style="width: 0%"></div>
                                </div>
                                <span class="process-percent">0%</span>
                            </div>
                        </div>
                        <div class="process-small-list">
                            <div class="process-small">
                                <div class="process-small-content">
                                    <span class="process-small-bullet">●</span>
                                    <span>Backend_Infra</span>
                                </div>
                            </div>
                            <div class="process-small">
                                <div class="process-small-content">
                                    <span class="process-small-bullet">●</span>
                                    <span>Backend_API</span>
                                </div>
                            </div>
                            <div class="process-small">
                                <div class="process-small-content">
                                    <span class="process-small-bullet">●</span>
                                    <span>Security</span>
                                </div>
                            </div>
                            <div class="process-small">
                                <div class="process-small-content">
                                    <span class="process-small-bullet">●</span>
                                    <span>External</span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- S4. 개발 3차 -->
                    <div class="process-item">
                        <div id="process-s4" class="process-major" onclick="loadProcessStage('s5_dev_3', 'S4. 개발 3차', '개발단계'); toggleProcess(this)" data-progress="0">
                            <div class="process-header">
                                <span class="process-icon">S4.</span>
                                <span class="process-name">개발 3차</span>
                                <span class="process-arrow">▶</span>
                            </div>
                            <div class="process-progress-container">
                                <div class="process-progress">
                                    <div class="process-progress-fill" style="width: 0%"></div>
                                </div>
                                <span class="process-percent">0%</span>
                            </div>
                        </div>
                        <div class="process-small-list">
                            <div class="process-small">
                                <div class="process-small-content">
                                    <span class="process-small-bullet">●</span>
                                    <span>Documentation</span>
                                </div>
                            </div>
                            <div class="process-small">
                                <div class="process-small-content">
                                    <span class="process-small-bullet">●</span>
                                    <span>Frontend</span>
                                </div>
                            </div>
                            <div class="process-small">
                                <div class="process-small-content">
                                    <span class="process-small-bullet">●</span>
                                    <span>Backend_Infra</span>
                                </div>
                            </div>
                            <div class="process-small">
                                <div class="process-small-content">
                                    <span class="process-small-bullet">●</span>
                                    <span>Backend_API</span>
                                </div>
                            </div>
                            <div class="process-small">
                                <div class="process-small-content">
                                    <span class="process-small-bullet">●</span>
                                    <span>Security</span>
                                </div>
                            </div>
                            <div class="process-small">
                                <div class="process-small-content">
                                    <span class="process-small-bullet">●</span>
                                    <span>Testing</span>
                                </div>
                            </div>
                            <div class="process-small">
                                <div class="process-small-content">
                                    <span class="process-small-bullet">●</span>
                                    <span>DevOps</span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- S5. 운영 -->
                    <div class="process-item">
                        <div id="process-s5" class="process-major" onclick="loadProcessStage('s6_operation', 'S5. 운영', '개발단계'); toggleProcess(this)" data-progress="0">
                            <div class="process-header">
                                <span class="process-icon">S5.</span>
                                <span class="process-name">운영</span>
                                <span class="process-arrow">▶</span>
                            </div>
                            <div class="process-progress-container">
                                <div class="process-progress">
                                    <div class="process-progress-fill" style="width: 0%"></div>
                                </div>
                                <span class="process-percent">0%</span>
                            </div>
                        </div>
                        <div class="process-small-list">
                            <div class="process-small">
                                <div class="process-small-content">
                                    <span class="process-small-bullet">●</span>
                                    <span>Documentation</span>
                                </div>
                            </div>
                            <div class="process-small">
                                <div class="process-small-content">
                                    <span class="process-small-bullet">●</span>
                                    <span>Frontend</span>
                                </div>
                            </div>
                            <div class="process-small">
                                <div class="process-small-content">
                                    <span class="process-small-bullet">●</span>
                                    <span>Backend_API</span>
                                </div>
                            </div>
                            <div class="process-small">
                                <div class="process-small-content">
                                    <span class="process-small-bullet">●</span>
                                    <span>Database</span>
                                </div>
                            </div>
                            <div class="process-small">
                                <div class="process-small-content">
                                    <span class="process-small-bullet">●</span>
                                    <span>Security</span>
                                </div>
                            </div>
                            <div class="process-small">
                                <div class="process-small-content">
                                    <span class="process-small-bullet">●</span>
                                    <span>DevOps</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Quick Links Section -->
            <div class="left-sidebar-section">
                <h2 class="sidebar-title">🔗 연계 서비스 바로가기</h2>

                <div class="quick-links">
                    <a href="antigravity://" class="quick-link-btn antigravity" title="Antigravity 열기">
                        <span class="quick-link-icon">
                            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                <!-- Antigravity Logo - Two legs with thick rounded top cap -->
                                <path d="M8 4 L10 4 C9 10, 8 16, 7 22 L2 22 C4 16, 6 10, 8 4 Z" fill="#1a1a1a"/>
                                <path d="M14 4 L16 4 C18 10, 20 16, 22 22 L17 22 C16 16, 15 10, 14 4 Z" fill="#1a1a1a"/>
                                <ellipse cx="12" cy="3" rx="6" ry="3" fill="#1a1a1a"/>
                            </svg>
                        </span>
                        <span class="quick-link-name">Antigravity</span>
                    </a>

                    <a href="vscode://" class="quick-link-btn vscode" title="VS Code 열기">
                        <span class="quick-link-icon">
                            <img src="https://cdn.jsdelivr.net/gh/devicons/devicon/icons/vscode/vscode-original.svg"
                                alt="VS Code">
                        </span>
                        <span class="quick-link-name">VS Code</span>
                    </a>

                    <a href="https://github.com" target="_blank" class="quick-link-btn github" title="GitHub 열기">
                        <span class="quick-link-icon">
                            <img src="https://cdn.jsdelivr.net/gh/devicons/devicon/icons/github/github-original.svg"
                                alt="GitHub">
                        </span>
                        <span class="quick-link-name">GitHub</span>
                    </a>

                    <a href="https://vercel.com/dashboard" target="_blank" class="quick-link-btn vercel"
                        title="Vercel 대시보드 열기">
                        <span class="quick-link-icon">
                            <svg viewBox="0 0 76 65" fill="none" xmlns="http://www.w3.org/2000/svg">
                                <path d="M37.5274 0L75.0548 65H0L37.5274 0Z" fill="#000" />
                            </svg>
                        </span>
                        <span class="quick-link-name">Vercel</span>
                    </a>

                    <a href="https://supabase.com/dashboard" target="_blank" class="quick-link-btn supabase"
                        title="Supabase 대시보드 열기">
                        <span class="quick-link-icon">
                            <svg viewBox="0 0 109 113" fill="none" xmlns="http://www.w3.org/2000/svg">
                                <path
                                    d="M63.7076 110.284C60.8481 113.885 55.0502 111.912 54.9813 107.314L53.9738 40.0627H99.1935C103.711 40.0627 106.305 45.3117 103.447 48.9134L63.7076 110.284Z"
                                    fill="url(#paint0_linear)" />
                                <path
                                    d="M63.7076 110.284C60.8481 113.885 55.0502 111.912 54.9813 107.314L53.9738 40.0627H99.1935C103.711 40.0627 106.305 45.3117 103.447 48.9134L63.7076 110.284Z"
                                    fill="url(#paint1_linear)" fill-opacity="0.2" />
                                <path
                                    d="M45.317 2.07103C48.1765 -1.53037 53.9745 0.442937 54.0434 5.041L54.4849 72.2922H9.83113C5.31361 72.2922 2.71933 66.6679 5.58119 63.0663L45.317 2.07103Z"
                                    fill="#3ECF8E" />
                                <defs>
                                    <linearGradient id="paint0_linear" x1="53.9738" y1="54.974" x2="94.1635"
                                        y2="71.8295" gradientUnits="userSpaceOnUse">
                                        <stop stop-color="#249361" />
                                        <stop offset="1" stop-color="#3ECF8E" />
                                    </linearGradient>
                                    <linearGradient id="paint1_linear" x1="36.1558" y1="30.578" x2="54.4844"
                                        y2="65.0806" gradientUnits="userSpaceOnUse">
                                        <stop />
                                        <stop offset="1" stop-opacity="0" />
                                    </linearGradient>
                                </defs>
                            </svg>
                        </span>
                        <span class="quick-link-name">Supabase</span>
                    </a>

                    <a href="https://resend.com/emails" target="_blank" class="quick-link-btn resend"
                        title="Resend 대시보드 열기">
                        <span class="quick-link-icon">
                            <img src="https://cdn.resend.com/brand/resend-icon-black.svg" alt="Resend">
                        </span>
                        <span class="quick-link-name">Resend</span>
                    </a>
                </div>
            </div>
        </aside>

        <!-- Center Workspace -->
        <main class="center-workspace">
            <!-- Top: Workspace (75%) -->
            <div class="workspace-top">
                <div class="workspace-header">
                    <div class="workspace-title">
                        <span>Workspace</span>
                    </div>
                    <!-- Outbox 알림 박스 제거됨 -->
                    <div class="workspace-actions">
                        <button class="action-btn secondary" onclick="clearEditor()">
                            <span style="display: flex; flex-direction: column; line-height: 1.3;">
                                <span>Workspace</span>
                                <span>지우기</span>
                            </span>
                        </button>
                        <button class="action-btn success" onclick="copyOrderSheet()">
                            <span style="display: flex; flex-direction: column; line-height: 1.3;">
                                <span>Order Sheet</span>
                                <span>복사하기</span>
                            </span>
                        </button>
                        <button class="action-btn" onclick="loadFromReports()" style="background: #bfdbfe; border: 1px solid #60a5fa; color: #000;">
                            <span style="display: flex; flex-direction: column; line-height: 1.3;">
                                <span>Reports</span>
                                <span>불러오기</span>
                            </span>
                        </button>
                    </div>
                </div>
                <div class="workspace-content">
                    <textarea id="textEditor" class="text-editor" placeholder="여기에 Order Sheet를 작성하세요...

예시:
# Order Sheet: 회원가입 API 구현

## 요구사항
- Email 중복 확인
- 비밀번호 암호화
- Supabase Auth 연동

## 산출물
- /api/auth/signup.ts
- 테스트 코드

## 참고사항
- 비밀번호 최소 8자, 영문+숫자+특수문자 포함
- Task ID: P1BA1
" oninput="translateToEnglish()"></textarea>

                    <!-- Translation Preview -->
                    <div class="translation-section" id="translationSection">
                        <div class="translation-header">
                            <div class="translation-title" onclick="toggleTranslation()"
                                style="cursor: pointer; user-select: none;">
                                <span>English Translation</span>
                                <span id="toggleText" style="margin-left: 8px; font-size: 11px;">▼</span>
                            </div>
                            <button class="action-btn" onclick="openTranslationFullview()" style="padding: 4px 10px; font-size: 11px;">
                                전체 보기
                            </button>
                        </div>
                        <div class="translation-preview" id="translationPreview" style="display: block; max-height: 65px; overflow: hidden;">
                            <pre id="translatedText" style="margin: 0; font-size: 11px; color: #868e96;">[Claude Code Only] This English translation section is for Claude Code.
The Korean content from the workspace above is translated here for Claude Code to read.
────────────────────────────────────────
Workspace에 입력한 내용이 여기에 표시됩니다.
The content you enter in the workspace will be displayed here.</pre>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Bottom: Grid Viewer (25%) -->
            <div class="workspace-bottom">
                <div class="grid-viewer-header">
                    <div class="grid-viewer-title-group">
                        <div class="grid-viewer-title">Project SAL Grid</div>
                        <div style="display: flex; gap: 12px; margin-left: auto;">
                            <button class="action-btn" onclick="openViewer()">
                                <span style="display: flex; flex-direction: column; line-height: 1.3;">
                                    <span>Viewer</span>
                                    <span>열기</span>
                                </span>
                            </button>
                            <button class="action-btn" onclick="openManual()">
                                <span style="display: flex; flex-direction: column; line-height: 1.3;">
                                    <span>매뉴얼</span>
                                    <span>보기</span>
                                </span>
                            </button>
                        </div>
                    </div>
                </div>

                <div class="grid-content">
                    <!-- Task Status -->
                    <div class="stats-bar" style="margin-bottom: 8px;">
                        <div style="font-weight: 700; font-size: 13px; color: #495057; min-width: 100px; display: flex; align-items: center;">실행 상태</div>
                        <div class="stat-item">
                            <span class="stat-label">○ Pending</span>
                            <span class="stat-value pending">45</span>
                        </div>
                        <div class="stat-item">
                            <span class="stat-label">● In Progress</span>
                            <span class="stat-value in-progress">12</span>
                        </div>
                        <div class="stat-item">
                            <span class="stat-label">✓ Completed</span>
                            <span class="stat-value completed">8</span>
                        </div>
                        <div class="stat-item">
                            <span class="stat-label">⚠ Fixing</span>
                            <span class="stat-value" style="color: #f59e0b;">1</span>
                        </div>
                    </div>
                    <!-- Verification Status -->
                    <div class="stats-bar">
                        <div style="font-weight: 700; font-size: 13px; color: #495057; min-width: 100px; display: flex; align-items: center;">검증 상태</div>
                        <div class="stat-item">
                            <span class="stat-label">○ Not Verified</span>
                            <span class="stat-value pending">50</span>
                        </div>
                        <div class="stat-item">
                            <span class="stat-label">✓ Passed</span>
                            <span class="stat-value completed">14</span>
                        </div>
                        <div class="stat-item">
                            <span class="stat-label">✗ Failed</span>
                            <span class="stat-value" style="color: #ef4444;">2</span>
                        </div>
                    </div>
                </div>
            </div>
        </main>

        <!-- Right Sidebar: Content & Support -->
        <aside class="right-sidebar">
            <!-- 마이페이지 메뉴 -->
            <div class="sidebar-section" id="mypageMenuSection">
                <h3 style="display: flex; justify-content: space-between; align-items: center;">
                    👤 마이페이지
                    <span id="mypageMoreBtn" onclick="toggleMypageMenu()" style="cursor: pointer; font-size: 11px; font-weight: 400; color: #6c757d; transition: color 0.2s;" onmouseover="this.style.color='#F59E0B'" onmouseout="this.style.color='#6c757d'">더보기 →</span>
                </h3>
                <!-- 기본 노출: 내 프로필 -->
                <div>
                    <a href="pages/mypage/profile.html" style="display: block; padding: 4px 8px; color: #495057; text-decoration: none; font-size: 11px; font-weight: 700; border-radius: 4px; background: rgba(245, 158, 11, 0.08); transition: all 0.2s;" onmouseover="this.style.background='rgba(245, 158, 11, 0.15)'" onmouseout="this.style.background='rgba(245, 158, 11, 0.08)'">
                        내 프로필
                    </a>
                </div>
                <!-- 펼쳐지는 추가 메뉴들 -->
                <div id="mypageLinks" style="display: none; margin-top: 4px;">
                    <div style="display: flex; flex-direction: column; gap: 4px;">
                        <a href="pages/mypage/subscription.html" style="display: block; padding: 4px 8px; color: #495057; text-decoration: none; font-size: 11px; font-weight: 700; border-radius: 4px; background: rgba(245, 158, 11, 0.08); transition: all 0.2s;" onmouseover="this.style.background='rgba(245, 158, 11, 0.15)'" onmouseout="this.style.background='rgba(245, 158, 11, 0.08)'">
                            구독 정보
                        </a>
                        <a href="pages/mypage/credit.html" style="display: block; padding: 4px 8px; color: #495057; text-decoration: none; font-size: 11px; font-weight: 700; border-radius: 4px; background: rgba(245, 158, 11, 0.08); transition: all 0.2s;" onmouseover="this.style.background='rgba(245, 158, 11, 0.15)'" onmouseout="this.style.background='rgba(245, 158, 11, 0.08)'">
                            크레딧 관리
                        </a>
                        <a href="pages/mypage/security.html" style="display: block; padding: 4px 8px; color: #495057; text-decoration: none; font-size: 11px; font-weight: 700; border-radius: 4px; background: rgba(245, 158, 11, 0.08); transition: all 0.2s;" onmouseover="this.style.background='rgba(245, 158, 11, 0.15)'" onmouseout="this.style.background='rgba(245, 158, 11, 0.08)'">
                            보안 설정
                        </a>
                    </div>
                </div>
            </div>

            <!-- Notices Section (공지사항 - 상단 배치) -->
            <div class="sidebar-section">
                <h3 style="display: flex; justify-content: space-between; align-items: center;">
                    📢 공지사항
                    <a href="admin-dashboard.html" style="font-size: 11px; font-weight: 400; color: #6c757d; text-decoration: none; transition: color 0.2s;" onmouseover="this.style.color='#F59E0B'" onmouseout="this.style.color='#6c757d'">더보기 →</a>
                </h3>
                <div id="noticesList">
                    <div style="text-align: center; padding: 20px; color: #6c757d;">
                        공지사항을 불러오는 중...
                    </div>
                </div>
            </div>

            <!-- Knowledge Content -->
            <div class="sidebar-section">
                <h3 style="display: flex; justify-content: space-between; align-items: center;">
                    📚 학습용 Books
                    <button onclick="openLearningViewer()" style="font-size: 11px; padding: 4px 8px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; border: none; border-radius: 4px; cursor: pointer;">전체 보기 →</button>
                </h3>
                <!-- 검색창 -->
                <div>
                    <input type="text"
                           id="learningSearchInput"
                           placeholder="학습용 Books 검색하기"
                           oninput="searchLearningContentsLocal(this.value)"
                           style="width: 100%; padding: 8px 12px; border: 1px solid #667eea; border-radius: 6px; font-size: 13px;">
                </div>
                <!-- 검색 결과 -->
                <div id="learningSearchResults" style="max-height: 300px; overflow-y: auto;"></div>
            </div>
            <!-- 학습용 콘텐츠 섹션 끝 -->

            <!-- Tips -->
            <div class="sidebar-section" id="tipsSection">
                <h3 style="display: flex; justify-content: space-between; align-items: center;">
                    💡 Tips
                    <button onclick="openTipsViewer()" style="font-size: 11px; padding: 4px 8px; background: linear-gradient(135deg, #8B5CF6 0%, #7C3AED 100%); color: white; border: none; border-radius: 4px; cursor: pointer;">전체 보기 →</button>
                </h3>

                <!-- Tips 검색창 -->
                <div>
                    <input type="text"
                           id="tipsSearchInput"
                           placeholder="Tips 검색하기"
                           oninput="searchTipsLocal(this.value)"
                           style="width: 100%; padding: 8px 12px; border: 1px solid #8B5CF6; border-radius: 6px; font-size: 13px; font-family: 'Noto Sans KR', sans-serif; transition: all 0.2s;">
                </div>

                <!-- Tips 검색 결과 영역 -->
                <div id="tipsSearchResults" style="max-height: 300px; overflow-y: auto;">
                    <!-- 검색 결과가 여기에 동적으로 추가됨 -->
                </div>

                <!-- 기존 정적 FAQ (백업용 - 삭제 예정) -->
                <div id="faqStaticBackup" style="display: none;">
                <!-- 1. 로그인/회원가입 -->
                <div class="knowledge-item">
                    <div class="knowledge-major" onclick="toggleKnowledge(this)">
                        <span class="knowledge-icon"></span>
                        <span class="knowledge-name">로그인/회원가입</span>
                        <span class="knowledge-arrow">▶</span>
                    </div>
                    <div class="knowledge-medium-list">
                        <!-- Depth 2-1: 계정 관리 -->
                        <div class="knowledge-medium" onclick="toggleKnowledgeSmall(this)">
                            <div class="knowledge-medium-content">
                                <span class="knowledge-medium-bullet">●</span>
                                <span>계정 관리</span>
                            </div>
                            <span class="knowledge-medium-arrow">▶</span>
                        </div>
                        <div class="knowledge-small-list">
                            <div class="knowledge-small">
                                <span class="knowledge-small-bullet">●</span>
                                <span>비밀번호 재설정</span>
                            </div>
                            <div class="knowledge-small">
                                <span class="knowledge-small-bullet">●</span>
                                <span>이메일 인증 오류</span>
                            </div>
                            <div class="knowledge-small">
                                <span class="knowledge-small-bullet">●</span>
                                <span>계정 삭제 방법</span>
                            </div>
                            <div class="knowledge-small">
                                <span class="knowledge-small-bullet">●</span>
                                <span>프로필 수정</span>
                            </div>
                            <div class="knowledge-small">
                                <span class="knowledge-small-bullet">●</span>
                                <span>로그인 오류 해결</span>
                            </div>
                        </div>

                        <!-- Depth 2-2: 회원가입 -->
                        <div class="knowledge-medium" onclick="toggleKnowledgeSmall(this)">
                            <div class="knowledge-medium-content">
                                <span class="knowledge-medium-bullet">●</span>
                                <span>회원가입</span>
                            </div>
                            <span class="knowledge-medium-arrow">▶</span>
                        </div>
                        <div class="knowledge-small-list">
                            <div class="knowledge-small">
                                <span class="knowledge-small-bullet">●</span>
                                <span>가입 절차</span>
                            </div>
                            <div class="knowledge-small">
                                <span class="knowledge-small-bullet">●</span>
                                <span>이메일 인증</span>
                            </div>
                            <div class="knowledge-small">
                                <span class="knowledge-small-bullet">●</span>
                                <span>약관 동의</span>
                            </div>
                            <div class="knowledge-small">
                                <span class="knowledge-small-bullet">●</span>
                                <span>프로필 설정</span>
                            </div>
                            <div class="knowledge-small">
                                <span class="knowledge-small-bullet">●</span>
                                <span>가입 오류</span>
                            </div>
                        </div>

                        <!-- Depth 2-3: 보안 설정 -->
                        <div class="knowledge-medium" onclick="toggleKnowledgeSmall(this)">
                            <div class="knowledge-medium-content">
                                <span class="knowledge-medium-bullet">●</span>
                                <span>보안 설정</span>
                            </div>
                            <span class="knowledge-medium-arrow">▶</span>
                        </div>
                        <div class="knowledge-small-list">
                            <div class="knowledge-small">
                                <span class="knowledge-small-bullet">●</span>
                                <span>2단계 인증</span>
                            </div>
                            <div class="knowledge-small">
                                <span class="knowledge-small-bullet">●</span>
                                <span>비밀번호 정책</span>
                            </div>
                            <div class="knowledge-small">
                                <span class="knowledge-small-bullet">●</span>
                                <span>로그인 기록</span>
                            </div>
                            <div class="knowledge-small">
                                <span class="knowledge-small-bullet">●</span>
                                <span>기기 관리</span>
                            </div>
                            <div class="knowledge-small">
                                <span class="knowledge-small-bullet">●</span>
                                <span>보안 경고</span>
                            </div>
                        </div>

                        <!-- Depth 2-4: 소셜 로그인 -->
                        <div class="knowledge-medium" onclick="toggleKnowledgeSmall(this)">
                            <div class="knowledge-medium-content">
                                <span class="knowledge-medium-bullet">●</span>
                                <span>소셜 로그인</span>
                            </div>
                            <span class="knowledge-medium-arrow">▶</span>
                        </div>
                        <div class="knowledge-small-list">
                            <div class="knowledge-small">
                                <span class="knowledge-small-bullet">●</span>
                                <span>Google 연동</span>
                            </div>
                            <div class="knowledge-small">
                                <span class="knowledge-small-bullet">●</span>
                                <span>GitHub 연동</span>
                            </div>
                            <div class="knowledge-small">
                                <span class="knowledge-small-bullet">●</span>
                                <span>계정 연결 해제</span>
                            </div>
                            <div class="knowledge-small">
                                <span class="knowledge-small-bullet">●</span>
                                <span>연동 오류</span>
                            </div>
                            <div class="knowledge-small">
                                <span class="knowledge-small-bullet">●</span>
                                <span>권한 관리</span>
                            </div>
                        </div>

                        <!-- Depth 2-5: 계정 복구 -->
                        <div class="knowledge-medium" onclick="toggleKnowledgeSmall(this)">
                            <div class="knowledge-medium-content">
                                <span class="knowledge-medium-bullet">●</span>
                                <span>계정 복구</span>
                            </div>
                            <span class="knowledge-medium-arrow">▶</span>
                        </div>
                        <div class="knowledge-small-list">
                            <div class="knowledge-small">
                                <span class="knowledge-small-bullet">●</span>
                                <span>잠긴 계정 복구</span>
                            </div>
                            <div class="knowledge-small">
                                <span class="knowledge-small-bullet">●</span>
                                <span>이메일 분실</span>
                            </div>
                            <div class="knowledge-small">
                                <span class="knowledge-small-bullet">●</span>
                                <span>복구 코드</span>
                            </div>
                            <div class="knowledge-small">
                                <span class="knowledge-small-bullet">●</span>
                                <span>고객 지원 요청</span>
                            </div>
                            <div class="knowledge-small">
                                <span class="knowledge-small-bullet">●</span>
                                <span>본인 인증</span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- 2. Order 작성 -->
                <div class="knowledge-item">
                    <div class="knowledge-major" onclick="toggleKnowledge(this)">
                        <span class="knowledge-icon"></span>
                        <span class="knowledge-name">Order 작성</span>
                        <span class="knowledge-arrow">▶</span>
                    </div>
                    <div class="knowledge-medium-list">
                        <!-- Depth 2-1: 작성 가이드 -->
                        <div class="knowledge-medium" onclick="toggleKnowledgeSmall(this)">
                            <div class="knowledge-medium-content">
                                <span class="knowledge-medium-bullet">●</span>
                                <span>작성 가이드</span>
                            </div>
                            <span class="knowledge-medium-arrow">▶</span>
                        </div>
                        <div class="knowledge-small-list">
                            <div class="knowledge-small">
                                <span class="knowledge-small-bullet">●</span>
                                <span>Order 작성 기본</span>
                            </div>
                            <div class="knowledge-small">
                                <span class="knowledge-small-bullet">●</span>
                                <span>마크다운 문법</span>
                            </div>
                            <div class="knowledge-small">
                                <span class="knowledge-small-bullet">●</span>
                                <span>템플릿 활용</span>
                            </div>
                            <div class="knowledge-small">
                                <span class="knowledge-small-bullet">●</span>
                                <span>자동 저장 기능</span>
                            </div>
                            <div class="knowledge-small">
                                <span class="knowledge-small-bullet">●</span>
                                <span>저장 오류 해결</span>
                            </div>
                        </div>

                        <!-- Depth 2-2: Order 보내기 -->
                        <div class="knowledge-medium" onclick="toggleKnowledgeSmall(this)">
                            <div class="knowledge-medium-content">
                                <span class="knowledge-medium-bullet">●</span>
                                <span>Order 보내기</span>
                            </div>
                            <span class="knowledge-medium-arrow">▶</span>
                        </div>
                        <div class="knowledge-small-list">
                            <div class="knowledge-small">
                                <span class="knowledge-small-bullet">●</span>
                                <span>전송 방법</span>
                            </div>
                            <div class="knowledge-small">
                                <span class="knowledge-small-bullet">●</span>
                                <span>전송 확인</span>
                            </div>
                            <div class="knowledge-small">
                                <span class="knowledge-small-bullet">●</span>
                                <span>전송 취소</span>
                            </div>
                            <div class="knowledge-small">
                                <span class="knowledge-small-bullet">●</span>
                                <span>재전송</span>
                            </div>
                            <div class="knowledge-small">
                                <span class="knowledge-small-bullet">●</span>
                                <span>전송 오류</span>
                            </div>
                        </div>

                        <!-- Depth 2-3: 템플릿 관리 -->
                        <div class="knowledge-medium" onclick="toggleKnowledgeSmall(this)">
                            <div class="knowledge-medium-content">
                                <span class="knowledge-medium-bullet">●</span>
                                <span>템플릿 관리</span>
                            </div>
                            <span class="knowledge-medium-arrow">▶</span>
                        </div>
                        <div class="knowledge-small-list">
                            <div class="knowledge-small">
                                <span class="knowledge-small-bullet">●</span>
                                <span>기본 템플릿</span>
                            </div>
                            <div class="knowledge-small">
                                <span class="knowledge-small-bullet">●</span>
                                <span>커스텀 템플릿</span>
                            </div>
                            <div class="knowledge-small">
                                <span class="knowledge-small-bullet">●</span>
                                <span>템플릿 저장</span>
                            </div>
                            <div class="knowledge-small">
                                <span class="knowledge-small-bullet">●</span>
                                <span>템플릿 공유</span>
                            </div>
                            <div class="knowledge-small">
                                <span class="knowledge-small-bullet">●</span>
                                <span>템플릿 삭제</span>
                            </div>
                        </div>

                        <!-- Depth 2-4: Order 히스토리 -->
                        <div class="knowledge-medium" onclick="toggleKnowledgeSmall(this)">
                            <div class="knowledge-medium-content">
                                <span class="knowledge-medium-bullet">●</span>
                                <span>Order 히스토리</span>
                            </div>
                            <span class="knowledge-medium-arrow">▶</span>
                        </div>
                        <div class="knowledge-small-list">
                            <div class="knowledge-small">
                                <span class="knowledge-small-bullet">●</span>
                                <span>히스토리 보기</span>
                            </div>
                            <div class="knowledge-small">
                                <span class="knowledge-small-bullet">●</span>
                                <span>히스토리 검색</span>
                            </div>
                            <div class="knowledge-small">
                                <span class="knowledge-small-bullet">●</span>
                                <span>히스토리 필터</span>
                            </div>
                            <div class="knowledge-small">
                                <span class="knowledge-small-bullet">●</span>
                                <span>히스토리 내보내기</span>
                            </div>
                            <div class="knowledge-small">
                                <span class="knowledge-small-bullet">●</span>
                                <span>히스토리 삭제</span>
                            </div>
                        </div>

                        <!-- Depth 2-5: 첨부 파일 -->
                        <div class="knowledge-medium" onclick="toggleKnowledgeSmall(this)">
                            <div class="knowledge-medium-content">
                                <span class="knowledge-medium-bullet">●</span>
                                <span>첨부 파일</span>
                            </div>
                            <span class="knowledge-medium-arrow">▶</span>
                        </div>
                        <div class="knowledge-small-list">
                            <div class="knowledge-small">
                                <span class="knowledge-small-bullet">●</span>
                                <span>파일 업로드</span>
                            </div>
                            <div class="knowledge-small">
                                <span class="knowledge-small-bullet">●</span>
                                <span>파일 크기 제한</span>
                            </div>
                            <div class="knowledge-small">
                                <span class="knowledge-small-bullet">●</span>
                                <span>지원 파일 형식</span>
                            </div>
                            <div class="knowledge-small">
                                <span class="knowledge-small-bullet">●</span>
                                <span>파일 미리보기</span>
                            </div>
                            <div class="knowledge-small">
                                <span class="knowledge-small-bullet">●</span>
                                <span>파일 삭제</span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- 3. AI 기능 -->
                <div class="knowledge-item">
                    <div class="knowledge-major" onclick="toggleKnowledge(this)">
                        <span class="knowledge-icon"></span>
                        <span class="knowledge-name">AI 기능</span>
                        <span class="knowledge-arrow">▶</span>
                    </div>
                    <div class="knowledge-medium-list">
                        <!-- Depth 2-1: Perplexity -->
                        <div class="knowledge-medium" onclick="toggleKnowledgeSmall(this)">
                            <div class="knowledge-medium-content">
                                <span class="knowledge-medium-bullet">●</span>
                                <span>Perplexity 사용법</span>
                            </div>
                            <span class="knowledge-medium-arrow">▶</span>
                        </div>
                        <div class="knowledge-small-list">
                            <div class="knowledge-small">
                                <span class="knowledge-small-bullet">●</span>
                                <span>사용 방법</span>
                            </div>
                            <div class="knowledge-small">
                                <span class="knowledge-small-bullet">●</span>
                                <span>크레딧 충전</span>
                            </div>
                            <div class="knowledge-small">
                                <span class="knowledge-small-bullet">●</span>
                                <span>답변 품질 개선</span>
                            </div>
                            <div class="knowledge-small">
                                <span class="knowledge-small-bullet">●</span>
                                <span>API 연동</span>
                            </div>
                            <div class="knowledge-small">
                                <span class="knowledge-small-bullet">●</span>
                                <span>오류 해결</span>
                            </div>
                        </div>

                        <!-- Depth 2-2: ChatGPT -->
                        <div class="knowledge-medium" onclick="toggleKnowledgeSmall(this)">
                            <div class="knowledge-medium-content">
                                <span class="knowledge-medium-bullet">●</span>
                                <span>ChatGPT 사용법</span>
                            </div>
                            <span class="knowledge-medium-arrow">▶</span>
                        </div>
                        <div class="knowledge-small-list">
                            <div class="knowledge-small">
                                <span class="knowledge-small-bullet">●</span>
                                <span>기본 사용</span>
                            </div>
                            <div class="knowledge-small">
                                <span class="knowledge-small-bullet">●</span>
                                <span>프롬프트 작성</span>
                            </div>
                            <div class="knowledge-small">
                                <span class="knowledge-small-bullet">●</span>
                                <span>대화 기록</span>
                            </div>
                            <div class="knowledge-small">
                                <span class="knowledge-small-bullet">●</span>
                                <span>모델 선택</span>
                            </div>
                            <div class="knowledge-small">
                                <span class="knowledge-small-bullet">●</span>
                                <span>사용량 확인</span>
                            </div>
                        </div>

                        <!-- Depth 2-3: Gemini -->
                        <div class="knowledge-medium" onclick="toggleKnowledgeSmall(this)">
                            <div class="knowledge-medium-content">
                                <span class="knowledge-medium-bullet">●</span>
                                <span>Gemini 사용법</span>
                            </div>
                            <span class="knowledge-medium-arrow">▶</span>
                        </div>
                        <div class="knowledge-small-list">
                            <div class="knowledge-small">
                                <span class="knowledge-small-bullet">●</span>
                                <span>Gemini 소개</span>
                            </div>
                            <div class="knowledge-small">
                                <span class="knowledge-small-bullet">●</span>
                                <span>이미지 분석</span>
                            </div>
                            <div class="knowledge-small">
                                <span class="knowledge-small-bullet">●</span>
                                <span>코드 생성</span>
                            </div>
                            <div class="knowledge-small">
                                <span class="knowledge-small-bullet">●</span>
                                <span>멀티모달 기능</span>
                            </div>
                            <div class="knowledge-small">
                                <span class="knowledge-small-bullet">●</span>
                                <span>제한 사항</span>
                            </div>
                        </div>

                        <!-- Depth 2-4: AI 비교 -->
                        <div class="knowledge-medium" onclick="toggleKnowledgeSmall(this)">
                            <div class="knowledge-medium-content">
                                <span class="knowledge-medium-bullet">●</span>
                                <span>AI 비교</span>
                            </div>
                            <span class="knowledge-medium-arrow">▶</span>
                        </div>
                        <div class="knowledge-small-list">
                            <div class="knowledge-small">
                                <span class="knowledge-small-bullet">●</span>
                                <span>성능 비교</span>
                            </div>
                            <div class="knowledge-small">
                                <span class="knowledge-small-bullet">●</span>
                                <span>가격 비교</span>
                            </div>
                            <div class="knowledge-small">
                                <span class="knowledge-small-bullet">●</span>
                                <span>특징 비교</span>
                            </div>
                            <div class="knowledge-small">
                                <span class="knowledge-small-bullet">●</span>
                                <span>추천 사용 사례</span>
                            </div>
                            <div class="knowledge-small">
                                <span class="knowledge-small-bullet">●</span>
                                <span>선택 가이드</span>
                            </div>
                        </div>

                        <!-- Depth 2-5: API 설정 -->
                        <div class="knowledge-medium" onclick="toggleKnowledgeSmall(this)">
                            <div class="knowledge-medium-content">
                                <span class="knowledge-medium-bullet">●</span>
                                <span>API 설정</span>
                            </div>
                            <span class="knowledge-medium-arrow">▶</span>
                        </div>
                        <div class="knowledge-small-list">
                            <div class="knowledge-small">
                                <span class="knowledge-small-bullet">●</span>
                                <span>API 키 발급</span>
                            </div>
                            <div class="knowledge-small">
                                <span class="knowledge-small-bullet">●</span>
                                <span>환경 변수 설정</span>
                            </div>
                            <div class="knowledge-small">
                                <span class="knowledge-small-bullet">●</span>
                                <span>보안 설정</span>
                            </div>
                            <div class="knowledge-small">
                                <span class="knowledge-small-bullet">●</span>
                                <span>사용량 모니터링</span>
                            </div>
                            <div class="knowledge-small">
                                <span class="knowledge-small-bullet">●</span>
                                <span>오류 처리</span>
                            </div>
                        </div>
                    </div>
                </div>
                </div>
                <!-- faqStaticBackup 끝 -->
            </div>

            <!-- 외부 연동 설정 Guide -->
            <div class="sidebar-section" id="serviceGuideSection">
                <h3 style="display: flex; justify-content: space-between; align-items: center;">
                    🔗 외부 연동 설정 Guide
                    <span id="serviceGuideMoreBtn" onclick="toggleServiceGuideMenu()" style="cursor: pointer; font-size: 11px; font-weight: 400; color: #6c757d; transition: color 0.2s;" onmouseover="this.style.color='#F59E0B'" onmouseout="this.style.color='#6c757d'">더보기 →</span>
                </h3>
                <!-- 기본 노출: 데이터베이스 설정 (클릭 시 펼침 + 가이드 열기) -->
                <div>
                    <a onclick="toggleServiceGuideMenu(); openServiceGuide('database')" style="display: block; padding: 4px 8px; color: #495057; text-decoration: none; font-size: 11px; font-weight: 700; border-radius: 4px; background: rgba(245, 158, 11, 0.08); transition: all 0.2s; cursor: pointer;" onmouseover="this.style.background='rgba(245, 158, 11, 0.15)'" onmouseout="this.style.background='rgba(245, 158, 11, 0.08)'">
                        데이터베이스 설정
                    </a>
                </div>
                <!-- 펼쳐지는 추가 메뉴들 -->
                <div id="serviceGuideLinks" style="display: none; margin-top: 4px;">
                    <div style="display: flex; flex-direction: column; gap: 4px;">
                        <a onclick="openServiceGuide('auth')" style="display: block; padding: 4px 8px; color: #495057; text-decoration: none; font-size: 11px; font-weight: 700; border-radius: 4px; background: rgba(245, 158, 11, 0.08); transition: all 0.2s; cursor: pointer;" onmouseover="this.style.background='rgba(245, 158, 11, 0.15)'" onmouseout="this.style.background='rgba(245, 158, 11, 0.08)'">
                            회원인증 설정
                        </a>
                        <a onclick="openServiceGuide('email')" style="display: block; padding: 4px 8px; color: #495057; text-decoration: none; font-size: 11px; font-weight: 700; border-radius: 4px; background: rgba(245, 158, 11, 0.08); transition: all 0.2s; cursor: pointer;" onmouseover="this.style.background='rgba(245, 158, 11, 0.15)'" onmouseout="this.style.background='rgba(245, 158, 11, 0.08)'">
                            이메일 시스템 설정
                        </a>
                        <a onclick="openServiceGuide('deploy')" style="display: block; padding: 4px 8px; color: #495057; text-decoration: none; font-size: 11px; font-weight: 700; border-radius: 4px; background: rgba(245, 158, 11, 0.08); transition: all 0.2s; cursor: pointer;" onmouseover="this.style.background='rgba(245, 158, 11, 0.15)'" onmouseout="this.style.background='rgba(245, 158, 11, 0.08)'">
                            배포/도메인 설정
                        </a>
                        <a onclick="openServiceGuide('payment')" style="display: block; padding: 4px 8px; color: #495057; text-decoration: none; font-size: 11px; font-weight: 700; border-radius: 4px; background: rgba(245, 158, 11, 0.08); transition: all 0.2s; cursor: pointer;" onmouseover="this.style.background='rgba(245, 158, 11, 0.15)'" onmouseout="this.style.background='rgba(245, 158, 11, 0.08)'">
                            결제 시스템 설정
                        </a>
                    </div>
                </div>
            </div>

            <!-- Claude Code 업데이트 -->
            <div class="sidebar-section" id="claudeCodeUpdateSection">
                <h3 style="display: flex; justify-content: space-between; align-items: center;">
                    <span>
                        <svg width="18" height="18" viewBox="0 0 12 10" fill="none" xmlns="http://www.w3.org/2000/svg" style="vertical-align: middle; margin-right: 4px;">
                            <rect x="1" y="0" width="2" height="1" fill="#D4926A"/>
                            <rect x="9" y="0" width="2" height="1" fill="#D4926A"/>
                            <rect x="0" y="1" width="3" height="1" fill="#D4926A"/>
                            <rect x="3" y="1" width="6" height="1" fill="#E8A882"/>
                            <rect x="9" y="1" width="3" height="1" fill="#D4926A"/>
                            <rect x="0" y="2" width="1" height="3" fill="#D4926A"/>
                            <rect x="1" y="2" width="10" height="3" fill="#E8A882"/>
                            <rect x="11" y="2" width="1" height="3" fill="#D4926A"/>
                            <rect x="3" y="3" width="1" height="1" fill="#1a1a1a"/>
                            <rect x="8" y="3" width="1" height="1" fill="#1a1a1a"/>
                            <rect x="5" y="4" width="2" height="1" fill="#C4836A"/>
                            <rect x="1" y="5" width="10" height="1" fill="#E8A882"/>
                            <rect x="2" y="6" width="2" height="3" fill="#E8A882"/>
                            <rect x="8" y="6" width="2" height="3" fill="#E8A882"/>
                        </svg>
                        Claude Code 업데이트
                    </span>
                    <span id="claudeCodeMoreBtn" onclick="toggleClaudeCodeMenu()" style="cursor: pointer; font-size: 11px; font-weight: 400; color: #6c757d; transition: color 0.2s;" onmouseover="this.style.color='#F59E0B'" onmouseout="this.style.color='#6c757d'">더보기 →</span>
                </h3>
                <!-- 기본 노출: Anthropic 공식 문서 -->
                <div>
                    <a onclick="window.open('https://docs.anthropic.com/en/docs/claude-code', '_blank')" style="display: block; padding: 4px 8px; color: #495057; text-decoration: none; font-size: 11px; font-weight: 700; border-radius: 4px; background: rgba(245, 158, 11, 0.08); transition: all 0.2s; cursor: pointer;" onmouseover="this.style.background='rgba(245, 158, 11, 0.15)'" onmouseout="this.style.background='rgba(245, 158, 11, 0.08)'">
                        Anthropic 공식 문서
                    </a>
                </div>
                <!-- 펼쳐지는 추가 메뉴들 -->
                <div id="claudeCodeLinks" style="display: none; margin-top: 4px;">
                    <div style="display: flex; flex-direction: column; gap: 4px;">
                        <a onclick="window.open('https://www.anthropic.com/blog', '_blank')" style="display: block; padding: 4px 8px; color: #495057; text-decoration: none; font-size: 11px; font-weight: 700; border-radius: 4px; background: rgba(245, 158, 11, 0.08); transition: all 0.2s; cursor: pointer;" onmouseover="this.style.background='rgba(245, 158, 11, 0.15)'" onmouseout="this.style.background='rgba(245, 158, 11, 0.08)'">
                            Anthropic 뉴스룸
                        </a>
                        <a onclick="window.open('https://github.com/anthropics/claude-code', '_blank')" style="display: block; padding: 4px 8px; color: #495057; text-decoration: none; font-size: 11px; font-weight: 700; border-radius: 4px; background: rgba(245, 158, 11, 0.08); transition: all 0.2s; cursor: pointer;" onmouseover="this.style.background='rgba(245, 158, 11, 0.15)'" onmouseout="this.style.background='rgba(245, 158, 11, 0.08)'">
                            GitHub의 Claude Code 리포지토리
                        </a>
                        <a onclick="window.open('https://www.aitimes.com', '_blank')" style="display: block; padding: 4px 8px; color: #495057; text-decoration: none; font-size: 11px; font-weight: 700; border-radius: 4px; background: rgba(245, 158, 11, 0.08); transition: all 0.2s; cursor: pointer;" onmouseover="this.style.background='rgba(245, 158, 11, 0.15)'" onmouseout="this.style.background='rgba(245, 158, 11, 0.08)'">
                            국내 뉴스 - AI타임즈
                        </a>
                    </div>
                </div>
            </div>

            <!-- 다른 AI에게 묻기 -->
            <div class="sidebar-section">
                <h3>
                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none"
                        style="display: inline-block; vertical-align: middle;">
                        <path d="M12 2L14.5 9.5L22 12L14.5 14.5L12 22L9.5 14.5L2 12L9.5 9.5L12 2Z"
                            fill="var(--secondary)" stroke="var(--secondary)" stroke-width="1"/>
                        <path d="M19 3L20 6L23 7L20 8L19 11L18 8L15 7L18 6L19 3Z"
                            fill="var(--secondary)" opacity="0.7"/>
                    </svg>
                    다른 AI에게 묻기
                </h3>

                <!-- AI 선택 버튼 -->
                <div style="display: flex; gap: 4px; margin-bottom: 10px; flex-wrap: nowrap;">
                    <button class="ai-selector-btn active" data-ai="chatgpt"
                        onclick="selectAI('chatgpt', event)">ChatGPT</button>
                    <button class="ai-selector-btn" data-ai="gemini" onclick="selectAI('gemini', event)">Gemini</button>
                    <button class="ai-selector-btn" data-ai="perplexity"
                        onclick="selectAI('perplexity', event)">Perplexity</button>
                </div>

                <!-- 로딩 메시지 -->
                <div id="aiLoading"
                    style="display: none; padding: 8px; margin-bottom: 8px; background: #e3f2fd; border-left: 3px solid #2196f3; border-radius: 4px; font-size: 13px; color: #1976d2;">
                    <span style="display: inline-block; margin-right: 6px;">⏳</span>
                    <span id="aiLoadingText">AI에게 질문 중...</span>
                </div>

                <div class="ai-input-area">
                    <textarea id="aiQuestion" placeholder="질문을 입력하세요..." rows="4"></textarea>
                    <button onclick="askAI()">질문하기</button>
                    <div class="perplexity-credit-display"
                        style="margin-top: 8px; font-size: 11px; color: #666; text-align: center; display: flex; align-items: center; justify-content: center; gap: 10px;">
                        <span>크레딧 잔액: <span style="color: #333;">₩<span
                                    id="perplexityCreditBalance">10,000</span></span></span>
                        <button onclick="rechargeCredit()"
                            style="padding: 4px 12px; font-size: 11px; background: var(--secondary); color: white; border: none; border-radius: 4px; cursor: pointer; font-weight: 600;">충전하기</button>
                    </div>

                    <!-- 질문 이력 버튼 -->
                    <div style="margin-top: 6px;">
                        <button onclick="openQuestionHistoryModal()"
                            style="width: 100%; padding: 9px; font-size: 11px; font-weight: 500; background: rgba(245, 158, 11, 0.08); border: 1px solid #999; border-radius: 8px; cursor: pointer; color: #333; transition: all 0.2s;"
                            onmouseover="this.style.background='rgba(245, 158, 11, 0.15)'; this.style.borderColor='#F59E0B';"
                            onmouseout="this.style.background='rgba(245, 158, 11, 0.08)'; this.style.borderColor='#999';">질문 / 답변 이력 보기</button>
                    </div>
                </div>
            </div>

            <!-- Support -->
            <div class="sidebar-section">
                <h3>☀️ Sunny에게 묻기</h3>
                <div class="support-input-area">
                    <textarea id="supportQuestion"
                        placeholder="사용법 문의, 문제 해결, 버그 신고, 기능 제안, 사업계획서 검토, 비즈니스 멘토링까지! AI 활용 능력 고수 + 공인회계사 + 엑셀러레이터 인 Sunny에게 자유롭게 문의하세요!"
                        rows="4"></textarea>
                    <div style="display: flex; gap: 8px;">
                        <button onclick="document.getElementById('supportFile').click()"
                            style="flex: 1; padding: 9px; font-size: 11px; background: rgba(245, 158, 11, 0.08); border: 1px solid #999; border-radius: 8px; cursor: pointer; color: #333; font-weight: 500; transition: all 0.2s;"
                            onmouseover="this.style.background='rgba(245, 158, 11, 0.15)'; this.style.borderColor='#F59E0B';"
                            onmouseout="this.style.background='rgba(245, 158, 11, 0.08)'; this.style.borderColor='#999';">파일 첨부</button>
                        <button onclick="submitSupport()"
                            style="flex: 2; padding: 9px; font-size: 11px; background: var(--secondary); color: white; border: none; border-radius: var(--border-radius); font-weight: 600; cursor: pointer; transition: all 0.2s;">제출하기</button>
                    </div>
                    <input type="file" id="supportFile" multiple accept="image/*,.pdf,.doc,.docx,.xls,.xlsx"
                        style="display: none;" onchange="handleSupportFileSelect(event)">
                    <div id="supportFileList" style="font-size: 11px; color: #666; max-height: 60px; overflow-y: auto;">
                    </div>
                </div>
            </div>
        </aside>
        </div>

        <!-- Footer -->
        <footer class="footer">
            <div class="footer-inner">
                <div class="footer-links">
                    <a href="#" class="footer-link" onclick="openServiceIntro(); return false;">서비스 소개</a>
                    <a href="pages/legal/terms.html" class="footer-link">이용약관</a>
                    <a href="pages/legal/privacy.html" class="footer-link">개인정보처리방침</a>
                    <a href="pages/legal/customer_service.html" class="footer-link">고객센터</a>
                </div>
                <div class="footer-copyright">
                    <span>© 2025 SSAL Works, All Rights Reserved</span>
                    <a href="admin-dashboard.html" class="admin-link" style="margin-left: 16px;">Admin</a>
                </div>
            </div>
        </footer>
    </div>

    <!-- Server Status Indicator -->
    <div id="serverStatus" class="server-status"></div>

    <script>
        // 환경 감지 - 배포 환경에서는 localhost 서버 기능 비활성화
        const IS_PRODUCTION = window.location.hostname !== 'localhost' && window.location.hostname !== '127.0.0.1';
        const BRIDGE_SERVER_URL = 'http://localhost:3030';
        const PROGRESS_SERVER_URL = 'http://localhost:3032';
        const AI_SERVER_URL = 'http://localhost:3031';

        // 프로젝트별 Orders 경로 설정
        const PROJECT_CONFIGS = {
            'PoliticianFinder': {
                name: 'PoliticianFinder',
                ordersPath: 'C:\\Development_PoliticianFinder_copy\\Human_ClaudeCode_Bridge\\Orders',
                status: '완료'
            },
            'SSAL Works': {
                name: 'SSAL Works',
                ordersPath: 'C:\\!SSAL_Works_Private\\Human_ClaudeCode_Bridge\\Orders',
                status: '진행중'
            }
        };

        // 현재 선택된 프로젝트 (전역 변수)
        // 진행중인 프로젝트를 기본값으로 자동 설정
        let currentSelectedProject = 'SSAL Works';

        // Sidebar structure data (updated 2025-12-12)
        const SIDEBAR_STRUCTURE = {
            "metadata": { "lastUpdate": "2025-12-12", "source": "PROJECT_DIRECTORY_STRUCTURE.md" },
            "specialStages": [
                { "id": "dir_structure", "name": "작업 디렉토리 구조 생성", "icon": "☆", "type": "special" },
                { "id": "sal_grid", "name": "Project SAL GRID 생성", "icon": "☆", "type": "special" }
            ],
            "gridStages": [
                { "id": "SSAL-Grid", "name": "SAL Grid", "icon": "◈", "path": "SSAL-Grid", "categories": ["task-planning", "grid"] },
                { "id": "Project-SSAL-Grid", "name": "Project SAL Grid", "icon": "◈", "path": "Project-SSAL-Grid", "categories": ["manual", "supabase", "viewer"] }
            ],
            "prepStages": [
                { "id": "P1_사업계획", "name": "사업계획", "icon": "○", "path": "P1_사업계획", "categories": ["0-1_Vision_Mission", "0-2_Market_Analysis", "0-3_Business_Model"] },
                { "id": "P2_프로젝트_기획", "name": "프로젝트 기획", "icon": "○", "path": "P2_프로젝트_기획", "categories": ["1-1_Project_Plan", "1-2_Requirements", "1-3_User_Flows", "1-4_Workflows", "1-5_Design_System", "1-6_UI_UX_Mockup"] }
            ],
            "executionStages": [
                { "id": "S1", "name": "프로토타입 제작", "path": "P3_프로토타입_제작", "areas": ["Documentation", "Design", "Frontend", "Database"] },
                { "id": "S2", "name": "개발 준비", "path": "S1_개발_준비", "areas": ["Documentation", "Backend_Infra", "Database", "Security"] },
                { "id": "S3", "name": "개발 1차", "path": "S2_개발-1차", "areas": ["Documentation", "Design", "Frontend", "Backend_Infra", "Backend_API", "Database", "Security", "Testing", "DevOps", "External", "Content_System"] },
                { "id": "S4", "name": "개발 2차", "path": "S3_개발-2차", "areas": ["Documentation", "Design", "Frontend", "Backend_Infra", "Backend_API", "Database", "Security", "Testing", "DevOps", "External", "Content_System"] },
                { "id": "S5", "name": "개발 3차", "path": "S4_개발-3차", "areas": ["Documentation", "Design", "Frontend", "Backend_Infra", "Backend_API", "Database", "Security", "Testing", "DevOps", "External", "Content_System"] },
                { "id": "S6", "name": "운영", "path": "S5_운영", "areas": ["Documentation", "Frontend", "Backend_API", "Database", "Security", "Testing", "DevOps", "External", "Content_System"] }
            ]
        };

        // Load sidebar structure
        function loadSidebarStructure() {
            console.log('✅ Sidebar structure loaded from embedded data');
            renderSidebarFromJSON(SIDEBAR_STRUCTURE);
        }

        // Render sidebar from JSON data
        function renderSidebarFromJSON(data) {
            const processListContainer = document.querySelector('.process-list');
            if (!processListContainer) {
                console.error('❌ .process-list container not found');
                return;
            }

            // Clear existing content
            processListContainer.innerHTML = '';

            data.structure.forEach((phase, index) => {
                const phaseHTML = generatePhaseHTML(phase, index);
                processListContainer.insertAdjacentHTML('beforeend', phaseHTML);
            });

            console.log('✅ Sidebar rendered from JSON');
        }

        // Generate HTML for a phase
        function generatePhaseHTML(phase, index) {
            const progress = 0; // Default progress
            const status = index === 0 ? 'completed' : index === 1 ? 'active' : '';

            let html = `
                <div class="process-item">
                    <div class="process-major ${status}" onclick="toggleProcess(this)" data-progress="${progress}">
                        <div class="process-header">
                            <span class="process-name">${phase.name}</span>
                            <span class="process-arrow">▶</span>
                        </div>
                        <div class="process-progress-container">
                            <div class="process-progress">
                                <div class="process-progress-fill" style="width: ${progress}%"></div>
                            </div>
                            <span class="process-percent">${progress}%</span>
                        </div>
                    </div>
                    <div class="process-small-list">`;

            // Direct items (소분류 directly under phase)
            if (phase.items) {
                phase.items.forEach(item => {
                    html += generateDirectItemHTML(item, phase.id);
                });
            }

            // Categories (중분류)
            if (phase.categories) {
                phase.categories.forEach(category => {
                    html += generateCategoryHTML(category, phase.id);
                });
            }

            html += `
                    </div>
                </div>`;

            return html;
        }

        // Generate HTML for direct items (소분류 - phase 직속)
        function generateDirectItemHTML(item, phaseId) {
            return `
                <div class="process-small" onclick="loadTemplate('${item.id}')" ondblclick="openFolder('${phaseId}/${item.id}'); event.stopPropagation();" title="${item.name_ko}">
                    <div class="process-small-content">
                        <span class="process-small-bullet">▪</span>
                        <span>${item.name_en}</span>
                    </div>
                </div>`;
        }

        // Generate HTML for a category (중분류)
        function generateCategoryHTML(category, phaseId) {
            let html = `
                <div class="process-small" onclick="loadTemplate('${category.id}'); toggleProcessTiny(this)" ondblclick="openFolder('${phaseId}/${category.id}'); event.stopPropagation();" title="${category.name_ko}">
                    <div class="process-small-content">
                        <span style="font-weight: 600;">${category.name_en}</span>
                    </div>
                    <span class="process-small-arrow">▼</span>
                </div>
                <div class="process-tiny-list">`;

            if (category.items) {
                category.items.forEach(item => {
                    html += `
                    <div class="process-tiny" title="${item.name_ko}">
                        <span style="opacity: 0.5; margin-right: 4px;">▫</span>
                        <span>${item.name_en}</span>
                    </div>`;
                });
            }

            html += `</div>`;
            return html;
        }

        // Load sidebar on page load
        document.addEventListener('DOMContentLoaded', () => {
            // loadSidebarStructure(); // ❌ 비활성화 - HTML에 직접 작성된 진행률(55%) 사용
            console.log('✅ Using static HTML structure with progress data');
            updateProgressBackgrounds();
        function updateProgressBackgrounds() {
            document.querySelectorAll('.process-major').forEach(el => {
                const progress = parseInt(el.getAttribute('data-progress') || 0);
                if (el.classList.contains('completed')) return;
                const minOpacity = 0.08;
                const maxOpacity = 0.25;
                const opacity = minOpacity + (maxOpacity - minOpacity) * (progress / 100);
                const minBorderOpacity = 0.2;
                const maxBorderOpacity = 0.5;
                const borderOpacity = minBorderOpacity + (maxBorderOpacity - minBorderOpacity) * (progress / 100);
                el.style.backgroundColor = `rgba(16, 185, 129, ${opacity})`;
                el.style.borderColor = `rgba(16, 185, 129, ${borderOpacity})`;
            });
        }

        });

        // Toggle process prep sub-items (준비단계 ○)
        function toggleProcessPrep(el) {
            const item = el.parentElement;
            const smallList = item.querySelector('.process-small-list');
            const arrow = el.querySelector('.process-arrow');

            if (smallList) {
                smallList.classList.toggle('expanded');
                if (arrow) {
                    arrow.classList.toggle('expanded');
                }
            }
        }

        // Toggle process sub-items
        function toggleProcess(el) {
            const item = el.parentElement;
            const smallList = item.querySelector('.process-small-list');
            const arrow = el.querySelector('.process-arrow');

            console.log('toggleProcess called', { item, smallList, arrow });

            if (smallList) {
                const wasExpanded = smallList.classList.contains('expanded');
                smallList.classList.toggle('expanded');
                console.log('smallList toggled, now expanded:', !wasExpanded);

                if (arrow) {
                    arrow.classList.toggle('expanded');
                }
            }

            document.querySelectorAll('.process-major').forEach(major => {
                if (major !== el) major.classList.remove('active');
            });
            if (!el.classList.contains('completed')) {
                el.classList.toggle('active');
            }
        }

        // Toggle knowledge sub-items (2nd level)
        function toggleKnowledge(el) {
            const item = el.parentElement;
            const mediumList = item.querySelector('.knowledge-medium-list');
            const arrow = el.querySelector('.knowledge-arrow');

            console.log('toggleKnowledge called', { item, mediumList, arrow });

            if (mediumList) {
                const wasExpanded = mediumList.classList.contains('expanded');
                mediumList.classList.toggle('expanded');
                console.log('mediumList toggled, now expanded:', !wasExpanded);

                if (arrow) {
                    arrow.classList.toggle('expanded');
                }
            }
        }

        // Toggle knowledge small items (3rd level)
        function toggleKnowledgeSmall(el) {
            const nextSibling = el.nextElementSibling;
            const arrow = el.querySelector('.knowledge-medium-arrow');

            if (nextSibling && nextSibling.classList.contains('knowledge-small-list')) {
                nextSibling.classList.toggle('expanded');
                if (arrow) {
                    arrow.classList.toggle('expanded');
                }
            }
        }

        // Toggle process tiny items (3rd level)
        function toggleProcessTiny(el) {
            const nextSibling = el.nextElementSibling;
            const arrow = el.querySelector('.process-small-arrow');

            if (nextSibling && nextSibling.classList.contains('process-tiny-list')) {
                nextSibling.classList.toggle('expanded');
                if (arrow) {
                    arrow.classList.toggle('expanded');
                }
            }
        }

        // Clear editor
        function clearEditor() {
            if (confirm('Workspace에 작성 중인 내용을 지우시겠습니까?')) {
                document.getElementById('textEditor').value = '';
            }
        }

        // Show status message
        function showStatus(message, type = 'info', duration = 3000) {
            const status = document.getElementById('serverStatus');
            status.textContent = message;
            status.className = 'server-status show ' + type;

            setTimeout(() => {
                status.className = 'server-status';
            }, duration);
        }

        // Order Sheet Template Loading
        let ordersheetTemplates = null;

        // Load templates on page load
        async function loadOrderSheetTemplates() {
            try {
                const response = await fetch('http://localhost:3030/ordersheet-templates');
                if (!response.ok) {
                    console.error('Failed to load ordersheet templates');
                    return;
                }
                const data = await response.json();
                if (data.success) {
                    ordersheetTemplates = data.templates;
                    console.log('✅ Order Sheet templates loaded:', Object.keys(ordersheetTemplates).length);
                }
            } catch (error) {
                console.error('Error loading ordersheet templates:', error);
            }
        }

        // Load template when category is clicked
        async function loadTemplate(categoryKey) {
            if (!ordersheetTemplates || !ordersheetTemplates[categoryKey]) {
                console.warn('Template not found for:', categoryKey);
                // 템플릿이 없는 경우 안내 메시지 표시
                showStatus(`📂 "${categoryKey}" 폴더를 열려면 더블클릭하세요 (Antigravity 또는 VS Code 선택)`, 'info');
                return;
            }

            const template = ordersheetTemplates[categoryKey];
            const editor = document.getElementById('textEditor');

            // Ask user if they want to replace current content
            if (editor.value.trim() && !(await customConfirm('현재 Workspace에서 작성 중인 내용을 지우고 해당 항목에 대한 템플릿으로 바꾸시겠습니까?'))) {
                return;
            }

            editor.value = template.template;
            showStatus(`✅ "${template.name}" 템플릿이 로드되었습니다`, 'success');
        }

        // Load welcome message on page load
        // Load welcome message on page load (서버에서 마크다운 파일 로드)
        async function loadWelcomeMessage() {
            const editor = document.getElementById('textEditor');

            try {
                // Bridge 서버에서 안내문 로드
                const guideName = encodeURIComponent('Welcome_시작안내');
                const response = await fetch(`http://localhost:3030/guide/${guideName}`);

                if (response.ok) {
                    const data = await response.json();
                    if (data.success && data.markdown) {
                        editor.value = data.markdown;
                        console.log('✅ Welcome 안내문 로드 완료');
                        return;
                    }
                }

                // 서버 연결 실패 시 기본 메시지
                editor.value = `# 🚀 SSAL Works Dashboard

## 환영합니다!

Bridge 서버에 연결할 수 없습니다.
서버가 실행 중인지 확인해주세요.

**서버 시작 방법:**
\`\`\`bash
cd Web_ClaudeCode_Bridge
node inbox_server.js
\`\`\`

서버가 실행되면 새로고침 해주세요.
`;
                console.warn('⚠️ Bridge 서버 연결 실패, 기본 메시지 표시');

            } catch (error) {
                console.error('❌ Welcome 안내문 로드 실패:', error);
                editor.value = `# 🚀 SSAL Works Dashboard

## 서버 연결 오류

Bridge 서버(localhost:3030)에 연결할 수 없습니다.

**해결 방법:**
1. Web_ClaudeCode_Bridge 폴더로 이동
2. \`node inbox_server.js\` 실행
3. 페이지 새로고침
`;
            }
        }

        // 안내문 로드 함수 (다양한 안내문 지원)
        async function loadGuide(guideName) {
            const editor = document.getElementById('textEditor');

            try {
                const encodedName = encodeURIComponent(guideName);
                const response = await fetch(`http://localhost:3030/guide/${encodedName}`);

                if (response.ok) {
                    const data = await response.json();
                    if (data.success && data.markdown) {
                        editor.value = data.markdown;
                        showStatus(`✅ "${data.name}" 안내문 로드 완료`, 'success');
                        return true;
                    }
                }

                showStatus(`❌ "${guideName}" 안내문을 찾을 수 없습니다`, 'error');
                return false;

            } catch (error) {
                console.error('안내문 로드 실패:', error);
                showStatus('❌ 서버 연결 실패', 'error');
                return false;
            }
        }

        // Order Sheet 템플릿 로드 함수 (서버에서)
        async function loadOrderTemplate(category, templateName) {
            const editor = document.getElementById('textEditor');

            try {
                const encodedCategory = encodeURIComponent(category);
                const encodedTemplate = encodeURIComponent(templateName);
                const response = await fetch(`http://localhost:3030/order-template/${encodedCategory}/${encodedTemplate}`);

                if (response.ok) {
                    const data = await response.json();
                    if (data.success && data.markdown) {
                        // 현재 내용이 있으면 확인
                        if (editor.value.trim() && !(await customConfirm('현재 Workspace 내용을 템플릿으로 교체하시겠습니까?'))) {
                            return false;
                        }

                        editor.value = data.markdown;
                        showStatus(`✅ "${data.name}" 템플릿 로드 완료`, 'success');
                        return true;
                    }
                }

                showStatus(`❌ "${templateName}" 템플릿을 찾을 수 없습니다`, 'error');
                return false;

            } catch (error) {
                console.error('템플릿 로드 실패:', error);
                showStatus('❌ 서버 연결 실패', 'error');
                return false;
            }
        }

        // 현재 선택된 단계 데이터 저장
        let currentStageData = null;

        // ========== 전체 Stage 데이터 정의 ==========
        const STAGE_DATA = {
            // ===== 로그인 시 환영 =====
            'welcome': {
                stageId: 'welcome',
                stageName: '환영합니다',
                hasAction: false,  // 단순 안내 - [확인] 버튼만
                confirmMessage: '',
                orderSheetAfterExecute: `# SSAL Works 시작 가이드

## ✅ 환영합니다!

SSAL Works에 오신 것을 환영합니다.
AI와 함께 웹사이트를 개발하는 여정을 시작해보세요.

---

## 📝 첫 번째 할 일

1. 좌측 사이드바에서 프로젝트를 선택하세요
2. 진행 프로세스에서 현재 단계를 확인하세요
3. Order Sheet를 작성하여 작업을 요청하세요

---

## 추가 요청사항

[여기에 추가 요청사항을 작성하세요]

`,
                orderSheet: `# Order Sheet - 시작 가이드

## 기본 정보
- **작성일**: ${new Date().toISOString().split('T')[0]}

---

## 요청사항

[여기에 요청사항을 작성하세요]

`,
                guideUrl: 'guides/Welcome.html'
            },

            // ===== 예시 프로젝트 (SSAL Works 예시) =====
            'project_example': {
                stageId: 'project_example',
                stageName: 'SSAL Works (예시)',
                hasAction: false,  // 단순 안내 - [확인] 버튼만
                confirmMessage: '',
                orderSheetAfterExecute: '',
                orderSheet: '',
                guideUrl: 'guides/Project_Example.html'
            },

            // ===== 실제 프로젝트 선택 =====
            'project_work': {
                stageId: 'project_work',
                stageName: '프로젝트 작업',
                hasAction: true,  // 실제 행위 - [예]/[아니오] 버튼
                confirmMessage: '이 프로젝트에 Order Sheet를 발행하시겠습니까?',
                orderSheetAfterExecute: `# 프로젝트 작업 Order Sheet

## ✅ 프로젝트가 선택되었습니다

선택한 프로젝트에서 작업을 진행합니다.

---

## 📝 추가 요청사항

[프로젝트 관련 추가 요청사항을 작성하세요]

`,
                orderSheet: `# Order Sheet - 프로젝트 작업 요청

## 기본 정보
- **Order ID**: OS-PRJ-[SEQ]
- **프로젝트명**: [프로젝트명]
- **작성일**: ${new Date().toISOString().split('T')[0]}
- **우선순위**: 보통

---

## 작업 요청 내용

### 요청 유형
- [ ] 새로운 기능 개발
- [ ] 기존 기능 수정
- [ ] 버그 수정
- [ ] 디자인 변경
- [ ] 문서 작성
- [ ] 기타

### 상세 요청사항

[구체적인 작업 내용을 작성하세요]

---

## 참고 자료

- 관련 파일: [파일 경로]
- 참고 링크: [URL]

---

## 추가 지시사항

[추가 요구사항이 있으면 여기에 작성]
`,
                guideUrl: 'guides/Project_Work.html'
            },

            // ===== ☆ 특별단계: 디렉토리 구조 생성 =====
            'dir_structure': {
                stageId: 'dir_structure',
                stageName: '작업 디렉토리 구조 생성',
                hasAction: true,  // 실제 행위 - [예]/[아니오] 버튼
                confirmMessage: '디렉토리 구조를 위와 같이 생성하시겠습니까?',
                orderSheetAfterExecute: `# 추가 Order Sheet - 디렉토리 구조 생성

## 기본 정보
- **Order ID**: OS-SP-01-A-002
- **작성일**: ${new Date().toISOString().split('T')[0]}
- **관련 작업**: ☆ 디렉토리 구조 생성

---

## ✅ 자동 실행된 항목

- [x] 사업계획 폴더 (0-1 ~ 0-3)
- [x] 프로젝트_기획 폴더 (1-1 ~ 1-6)
- [x] 프로토타입_제작 폴더
- [x] 개발_준비 폴더
- [x] 개발_1차~3차 폴더
- [x] 운영 폴더
- [x] Web_ClaudeCode_Bridge 폴더

---

## 📝 추가 요청사항

[추가로 필요한 작업을 작성하세요]

`,
                orderSheet: `# Order Sheet - 디렉토리 구조 생성

## 기본 정보
- **Order ID**: OS-SP-01-A-001
- **단계 유형**: ☆ 특별단계
- **작성일**: ${new Date().toISOString().split('T')[0]}

---

## 상세 요구사항

### 프로젝트 기본 정보
- **프로젝트 이름**: [프로젝트명 입력]
- **프로젝트 경로**: [경로 입력]

### 생성할 디렉토리 구조
- [ ] 사업계획 폴더 (0-1 ~ 0-3)
- [ ] 프로젝트_기획 폴더 (1-1 ~ 1-6)
- [ ] 프로토타입_제작 폴더
- [ ] 개발_준비 폴더
- [ ] 개발_1차~3차 폴더
- [ ] 운영 폴더
- [ ] Web_ClaudeCode_Bridge 폴더

---

## 추가 지시사항

[추가 요구사항이 있으면 여기에 작성]
`,
                guideUrl: 'guides/SP-1_디렉토리_구조_생성.html',
                orderSheetUrl: 'templates/SP-1_디렉토리_구조_생성.md'
            },

            // ===== ☆ 특별단계: SAL Grid 생성 =====
            'sal_grid': {
                stageId: 'sal_grid',
                stageName: 'Project SAL Grid 생성',
                hasAction: true,  // 실제 행위 - [예]/[아니오] 버튼
                confirmMessage: 'SAL Grid를 위와 같이 생성하시겠습니까?',
                orderSheetAfterExecute: `# 추가 Order Sheet - SAL Grid 생성

## ✅ 자동 실행된 항목

- [x] SAL Grid 기본 구조 생성
- [x] Stage(단계) 정의
- [x] Area(영역) 정의
- [x] Level(레벨) 정의

---

## 📝 추가 요청사항

[추가로 필요한 작업을 작성하세요]

`,
                orderSheet: `# Order Sheet - SAL Grid 생성

## 기본 정보
- **Order ID**: OS-SP-02-A-001
- **단계 유형**: ☆ 특별단계
- **작성일**: ${new Date().toISOString().split('T')[0]}

---

## SAL Grid 설정

### Stage (단계)
- [ ] S1: 프로토타입 제작
- [ ] S2: 개발 준비
- [ ] S3: 개발 1차
- [ ] S4: 개발 2차
- [ ] S5: 개발 3차
- [ ] S6: 운영

### Area (영역)
- [ ] Frontend
- [ ] Backend
- [ ] Database
- [ ] DevOps

### Level (레벨)
- [ ] L1: 기본
- [ ] L2: 중급
- [ ] L3: 고급

---

## 추가 지시사항

[추가 요구사항이 있으면 여기에 작성]
`,
                guideUrl: 'guides/SP-2_SAL_GRID_생성.html',
                orderSheetUrl: 'templates/SP-2_SAL_GRID_생성.md'
            },

            // ===== SAL Grid 하위 항목 =====
            'sal_grid_manual': {
                stageId: 'sal_grid_manual',
                stageName: 'SAL Grid Manual',
                hasAction: true,
                confirmMessage: 'SAL Grid Manual 작업을 진행하시겠습니까?',
                orderSheetAfterExecute: '',
                orderSheet: '',
                guideUrl: 'guides/SAL_Grid_Manual.html',
                orderSheetUrl: 'templates/SAL_Grid_Manual.md'
            },

            'sal_grid_supabase': {
                stageId: 'sal_grid_supabase',
                stageName: 'SAL Grid Supabase',
                hasAction: true,
                confirmMessage: 'SAL Grid Supabase 연동 작업을 진행하시겠습니까?',
                orderSheetAfterExecute: '',
                orderSheet: '',
                guideUrl: 'guides/SAL_Grid_Supabase.html',
                orderSheetUrl: 'templates/SAL_Grid_Supabase.md'
            },

            'sal_grid_task_instructions': {
                stageId: 'sal_grid_task_instructions',
                stageName: 'Task Instructions',
                hasAction: true,
                confirmMessage: 'Task Instructions 작업을 진행하시겠습니까?',
                orderSheetAfterExecute: '',
                orderSheet: '',
                guideUrl: 'guides/SAL_Grid_Task_Instructions.html'
            },

            'sal_grid_verification_instructions': {
                stageId: 'sal_grid_verification_instructions',
                stageName: 'Verification Instructions',
                hasAction: true,
                confirmMessage: 'Verification Instructions 작업을 진행하시겠습니까?',
                orderSheetAfterExecute: '',
                orderSheet: '',
                guideUrl: 'guides/SAL_Grid_Verification_Instructions.html'
            },

            'sal_grid_viewer': {
                stageId: 'sal_grid_viewer',
                stageName: 'SAL Grid Viewer',
                hasAction: true,
                confirmMessage: 'SAL Grid Viewer 개발 작업을 진행하시겠습니까?',
                orderSheetAfterExecute: '',
                orderSheet: '',
                guideUrl: 'guides/SAL_Grid_Viewer.html',
                orderSheetUrl: 'templates/SAL_Grid_Viewer.md'
            },

            // ===== ◈ SAL Grid (Task 기획 + Grid 생성) =====
            'ssal_grid': {
                stageId: 'ssal_grid',
                stageName: 'SAL Grid',
                hasAction: true,
                confirmMessage: 'SAL Grid 작업을 진행하시겠습니까?',
                orderSheetAfterExecute: '',
                orderSheet: '',
                guideUrl: 'guides/SSAL_Grid.html',
                orderSheetUrl: 'templates/SSAL_Grid.md'
            },

            // ===== ○ 사업계획: 0-1 시장조사 =====
            'biz_0_1': {
                stageId: 'biz_0_1',
                stageName: '0-1 시장조사',
                hasAction: true,
                confirmMessage: '시장조사를 위와 같이 진행하시겠습니까?',
                orderSheetAfterExecute: `# 추가 Order Sheet - 시장조사

## ✅ 자동 실행된 항목

- [x] 시장 규모 조사
- [x] 타겟 고객 분석
- [x] 트렌드 분석

---

## 📝 추가 요청사항

[추가로 필요한 조사 항목을 작성하세요]

`,
                orderSheet: `# Order Sheet - 시장조사

## 기본 정보
- **Order ID**: OS-0-1-A-001
- **단계 유형**: ○ 사업계획
- **작성일**: ${new Date().toISOString().split('T')[0]}

---

## 조사 항목

- [ ] 시장 규모 조사
- [ ] 타겟 고객 분석
- [ ] 트렌드 분석
- [ ] 진입 장벽 분석

---

## 추가 지시사항

[추가 요구사항이 있으면 여기에 작성]
`,
                guideUrl: 'guides/P1-1_Vision_Mission.html',
                orderSheetUrl: 'templates/P1-1_Vision_Mission.md'
            },

            // ===== ○ 사업계획: 0-2 경쟁분석 =====
            'biz_0_2': {
                stageId: 'biz_0_2',
                stageName: '0-2 경쟁분석',
                hasAction: true,
                confirmMessage: '경쟁분석을 위와 같이 진행하시겠습니까?',
                orderSheetAfterExecute: `# 추가 Order Sheet - 경쟁분석

## ✅ 자동 실행된 항목

- [x] 경쟁사 목록 조사
- [x] 경쟁사 강약점 분석
- [x] 차별화 포인트 도출

---

## 📝 추가 요청사항

[추가로 필요한 분석 항목을 작성하세요]

`,
                orderSheet: `# Order Sheet - 경쟁분석

## 기본 정보
- **Order ID**: OS-0-2-A-001
- **단계 유형**: ○ 사업계획
- **작성일**: ${new Date().toISOString().split('T')[0]}

---

## 분석 항목

- [ ] 경쟁사 목록 조사
- [ ] 경쟁사 강약점 분석
- [ ] 차별화 포인트 도출

---

## 추가 지시사항

[추가 요구사항이 있으면 여기에 작성]
`,
                guideUrl: 'guides/P1-2_Market_Analysis.html',
                orderSheetUrl: 'templates/P1-2_Market_Analysis.md'
            },

            // ===== ○ 사업계획: 0-3 사업계획서 =====
            'biz_0_3': {
                stageId: 'biz_0_3',
                stageName: '0-3 사업계획서',
                hasAction: true,
                confirmMessage: '사업계획서를 위와 같이 작성하시겠습니까?',
                orderSheetAfterExecute: `# 추가 Order Sheet - 사업계획서

## ✅ 자동 실행된 항목

- [x] 사업 개요 작성
- [x] 수익 모델 정의
- [x] 마케팅 전략 수립

---

## 📝 추가 요청사항

[추가로 필요한 항목을 작성하세요]

`,
                orderSheet: `# Order Sheet - 사업계획서

## 기본 정보
- **Order ID**: OS-0-3-A-001
- **단계 유형**: ○ 사업계획
- **작성일**: ${new Date().toISOString().split('T')[0]}

---

## 작성 항목

- [ ] 사업 개요
- [ ] 수익 모델
- [ ] 마케팅 전략
- [ ] 재무 계획

---

## 추가 지시사항

[추가 요구사항이 있으면 여기에 작성]
`,
                guideUrl: 'guides/P1-3_Business_Model.html',
                orderSheetUrl: 'templates/P1-3_Business_Model.md'
            },

            // ===== ○ 프로젝트 기획: 1-1 ~ 1-6 =====
            'plan_1_1': {
                stageId: 'plan_1_1',
                stageName: '1-1 Project Plan',
                hasAction: true,
                confirmMessage: 'Project Plan을 위와 같이 작성하시겠습니까?',
                orderSheetAfterExecute: `# 추가 Order Sheet - Project Plan

## ✅ 자동 실행된 항목

- [x] 프로젝트 목표 정의
- [x] 범위 설정
- [x] 일정 계획

---

## 📝 추가 요청사항

[추가 요청사항을 작성하세요]

`,
                orderSheet: `# Order Sheet - Project Plan

## 기본 정보
- **Order ID**: OS-1-1-A-001
- **단계 유형**: ○ 프로젝트 기획
- **작성일**: ${new Date().toISOString().split('T')[0]}

---

## 작성 항목

- [ ] 프로젝트 목표
- [ ] 범위 설정
- [ ] 일정 계획
- [ ] 리소스 계획

---

## 추가 지시사항

[추가 요구사항이 있으면 여기에 작성]
`,
                guideUrl: 'guides/P2-1_Directory_Structure.html',
                orderSheetUrl: 'templates/P2-1_Directory_Structure.md'
            },

            'plan_1_2': {
                stageId: 'plan_1_2',
                stageName: '1-2 Requirements',
                hasAction: true,
                confirmMessage: '요구사항을 위와 같이 정의하시겠습니까?',
                orderSheetAfterExecute: `# 추가 Order Sheet - Requirements

## ✅ 자동 실행된 항목

- [x] 기능 요구사항 정의
- [x] 비기능 요구사항 정의

---

## 📝 추가 요청사항

[추가 요청사항을 작성하세요]

`,
                orderSheet: `# Order Sheet - Requirements

## 기본 정보
- **Order ID**: OS-1-2-A-001
- **작성일**: ${new Date().toISOString().split('T')[0]}

---

## 기능 요구사항

- [ ] [기능 1]
- [ ] [기능 2]

## 비기능 요구사항

- [ ] 성능
- [ ] 보안

---

## 추가 지시사항

[추가 요구사항이 있으면 여기에 작성]
`,
                guideUrl: 'guides/P2-2-1_Requirements.html',
                orderSheetUrl: 'templates/P2-2-1_Requirements.md'
            },

            'plan_1_3': {
                stageId: 'plan_1_3',
                stageName: '1-3 Architecture',
                hasAction: true,
                confirmMessage: '아키텍처를 위와 같이 설계하시겠습니까?',
                orderSheetAfterExecute: `# 추가 Order Sheet - Architecture

## ✅ 자동 실행된 항목

- [x] 시스템 아키텍처 설계
- [x] 기술 스택 선정

---

## 📝 추가 요청사항

[추가 요청사항을 작성하세요]

`,
                orderSheet: `# Order Sheet - Architecture

## 기본 정보
- **Order ID**: OS-1-3-A-001
- **작성일**: ${new Date().toISOString().split('T')[0]}

---

## 설계 항목

- [ ] 시스템 아키텍처
- [ ] 기술 스택 선정
- [ ] 인프라 설계

---

## 추가 지시사항

[추가 요구사항이 있으면 여기에 작성]
`,
                guideUrl: 'guides/P2-2-2_User_Flows.html',
                orderSheetUrl: 'templates/P2-2-2_User_Flows.md'
            },

            'plan_1_4': {
                stageId: 'plan_1_4',
                stageName: '1-4 UI/UX',
                hasAction: true,
                confirmMessage: 'UI/UX를 위와 같이 설계하시겠습니까?',
                orderSheetAfterExecute: `# 추가 Order Sheet - UI/UX

## ✅ 자동 실행된 항목

- [x] 와이어프레임 작성
- [x] UI 디자인

---

## 📝 추가 요청사항

[추가 요청사항을 작성하세요]

`,
                orderSheet: `# Order Sheet - UI/UX

## 기본 정보
- **Order ID**: OS-1-4-A-001
- **작성일**: ${new Date().toISOString().split('T')[0]}

---

## 설계 항목

- [ ] 와이어프레임
- [ ] UI 디자인
- [ ] UX 플로우

---

## 추가 지시사항

[추가 요구사항이 있으면 여기에 작성]
`,
                guideUrl: 'guides/P2-3-1_Design_Guidelines.html',
                orderSheetUrl: 'templates/P2-3-1_Design_Guidelines.md'
            },

            'plan_1_5': {
                stageId: 'plan_1_5',
                stageName: '1-5 DB Design',
                hasAction: true,
                confirmMessage: 'DB를 위와 같이 설계하시겠습니까?',
                orderSheetAfterExecute: `# 추가 Order Sheet - DB Design

## ✅ 자동 실행된 항목

- [x] ERD 작성
- [x] 테이블 설계

---

## 📝 추가 요청사항

[추가 요청사항을 작성하세요]

`,
                orderSheet: `# Order Sheet - DB Design

## 기본 정보
- **Order ID**: OS-1-5-A-001
- **작성일**: ${new Date().toISOString().split('T')[0]}

---

## 설계 항목

- [ ] ERD 작성
- [ ] 테이블 설계
- [ ] 인덱스 설계

---

## 추가 지시사항

[추가 요구사항이 있으면 여기에 작성]
`,
                guideUrl: 'guides/P2-4_Database_Design.html',
                orderSheetUrl: 'templates/P2-4_Database_Design.md'
            },

            'plan_1_6': {
                stageId: 'plan_1_6',
                stageName: '1-6 API Design',
                hasAction: true,
                confirmMessage: 'API를 위와 같이 설계하시겠습니까?',
                orderSheetAfterExecute: `# 추가 Order Sheet - API Design

## ✅ 자동 실행된 항목

- [x] API 엔드포인트 정의
- [x] API 명세서 작성

---

## 📝 추가 요청사항

[추가 요청사항을 작성하세요]

`,
                orderSheet: `# Order Sheet - API Design

## 기본 정보
- **Order ID**: OS-1-6-A-001
- **작성일**: ${new Date().toISOString().split('T')[0]}

---

## 설계 항목

- [ ] API 엔드포인트 정의
- [ ] 요청/응답 형식
- [ ] 인증 방식

---

## 추가 지시사항

[추가 요구사항이 있으면 여기에 작성]
`,
                guideUrl: 'guides/P2-2-3_Workflows.html',
                orderSheetUrl: 'templates/P2-2-3_Workflows.md'
            },

            // ===== P2 추가 단계 =====
            'plan_mockup': {
                stageId: 'plan_mockup',
                stageName: '목업 제작',
                hasAction: true,
                confirmMessage: '목업을 위와 같이 제작하시겠습니까?',
                orderSheetAfterExecute: `# 추가 Order Sheet - 목업 제작

## ✅ 자동 실행된 항목

- [x] 화면 목업 디자인
- [x] 레이아웃 구성

---

## 📝 추가 요청사항

[추가 요청사항을 작성하세요]

`,
                orderSheet: `# Order Sheet - 목업 제작

## 기본 정보
- **Order ID**: OS-P2-MK-001
- **작성일**: ${new Date().toISOString().split('T')[0]}

---

## 작업 항목

- [ ] 주요 화면 목업 디자인
- [ ] 레이아웃 구성
- [ ] 반응형 디자인 고려

---

## 추가 지시사항

[추가 요구사항이 있으면 여기에 작성]
`,
                guideUrl: 'guides/P2-3-2_Mockup.html',
                orderSheetUrl: 'templates/P2-3-2_Mockup.md'
            },

            'plan_prototype': {
                stageId: 'plan_prototype',
                stageName: '프로토타입 설계',
                hasAction: true,
                confirmMessage: '프로토타입을 위와 같이 설계하시겠습니까?',
                orderSheetAfterExecute: `# 추가 Order Sheet - 프로토타입 설계

## ✅ 자동 실행된 항목

- [x] 인터랙션 정의
- [x] 화면 전환 흐름

---

## 📝 추가 요청사항

[추가 요청사항을 작성하세요]

`,
                orderSheet: `# Order Sheet - 프로토타입 설계

## 기본 정보
- **Order ID**: OS-P2-PT-001
- **작성일**: ${new Date().toISOString().split('T')[0]}

---

## 작업 항목

- [ ] 인터랙션 정의
- [ ] 화면 전환 흐름
- [ ] 사용성 테스트 계획

---

## 추가 지시사항

[추가 요구사항이 있으면 여기에 작성]
`,
                guideUrl: 'guides/P2-3-3_Prototype.html',
                orderSheetUrl: 'templates/P2-3-3_Prototype.md'
            },

            // ===== P3 추가 단계 =====
            'proto_pages': {
                stageId: 'proto_pages',
                stageName: '프론트엔드 페이지 개발',
                hasAction: true,
                confirmMessage: '페이지를 위와 같이 개발하시겠습니까?',
                orderSheetAfterExecute: `# 추가 Order Sheet - 프론트엔드 페이지

## ✅ 자동 실행된 항목

- [x] 페이지 컴포넌트 개발
- [x] 상태 관리 구현

---

## 📝 추가 요청사항

[추가 요청사항을 작성하세요]

`,
                orderSheet: `# Order Sheet - 프론트엔드 페이지 개발

## 기본 정보
- **Order ID**: OS-P3-FP-001
- **작성일**: ${new Date().toISOString().split('T')[0]}

---

## 작업 항목

- [ ] 페이지 컴포넌트 개발
- [ ] 상태 관리 구현
- [ ] API 연동 준비

---

## 추가 지시사항

[추가 요구사항이 있으면 여기에 작성]
`,
                guideUrl: 'guides/P3-1-2_Frontend_Pages.html',
                orderSheetUrl: 'templates/P3-1-2_Frontend_Pages.md'
            },

            'proto_database': {
                stageId: 'proto_database',
                stageName: '데이터베이스 구축',
                hasAction: true,
                confirmMessage: '데이터베이스를 위와 같이 구축하시겠습니까?',
                orderSheetAfterExecute: `# 추가 Order Sheet - 데이터베이스 구축

## ✅ 자동 실행된 항목

- [x] 테이블 생성
- [x] RLS 정책 적용

---

## 📝 추가 요청사항

[추가 요청사항을 작성하세요]

`,
                orderSheet: `# Order Sheet - 데이터베이스 구축

## 기본 정보
- **Order ID**: OS-P3-DB-001
- **작성일**: ${new Date().toISOString().split('T')[0]}

---

## 작업 항목

- [ ] 테이블 생성 SQL 작성
- [ ] RLS 정책 적용
- [ ] 초기 데이터 투입

---

## 추가 지시사항

[추가 요구사항이 있으면 여기에 작성]
`,
                guideUrl: 'guides/P3-2_Database.html',
                orderSheetUrl: 'templates/P3-2_Database.md'
            },

            'proto_scripts': {
                stageId: 'proto_scripts',
                stageName: '스크립트 개발',
                hasAction: true,
                confirmMessage: '스크립트를 위와 같이 개발하시겠습니까?',
                orderSheetAfterExecute: `# 추가 Order Sheet - 스크립트 개발

## ✅ 자동 실행된 항목

- [x] 빌드 스크립트 작성
- [x] 유틸리티 함수 개발

---

## 📝 추가 요청사항

[추가 요청사항을 작성하세요]

`,
                orderSheet: `# Order Sheet - 스크립트 개발

## 기본 정보
- **Order ID**: OS-P3-SC-001
- **작성일**: ${new Date().toISOString().split('T')[0]}

---

## 작업 항목

- [ ] 빌드 스크립트 작성
- [ ] 데이터 마이그레이션 스크립트
- [ ] 유틸리티 함수 개발

---

## 추가 지시사항

[추가 요구사항이 있으면 여기에 작성]
`,
                guideUrl: 'guides/P3-3_Scripts.html',
                orderSheetUrl: 'templates/P3-3_Scripts.md'
            },

            // ===== S1 ~ S6 개발 단계 =====
            's1_prototype': {
                stageId: 's1_prototype',
                stageName: 'S1. 프로토타입 제작',
                hasAction: false,
                confirmMessage: '프로토타입 제작을 위와 같이 진행하시겠습니까?',
                orderSheetAfterExecute: `# 추가 Order Sheet - 프로토타입 제작

## ✅ 자동 실행된 항목

- [x] 프로토타입 기본 구조 생성
- [x] 핵심 기능 구현

---

## 📝 추가 요청사항

[추가 요청사항을 작성하세요]

`,
                orderSheet: `# Order Sheet - S1. 프로토타입 제작

## 기본 정보
- **Order ID**: OS-S1-A-001
- **작성일**: ${new Date().toISOString().split('T')[0]}

---

## 작업 항목

- [ ] 프로토타입 기본 구조
- [ ] 핵심 기능 구현
- [ ] UI 프로토타입

---

## 추가 지시사항

[추가 요구사항이 있으면 여기에 작성]
`,
                guideUrl: 'guides/P3-1-1_Frontend_Prototype.html',
                orderSheetUrl: 'templates/P3-1-1_Frontend_Prototype.md'
            },

            's2_dev_prep': {
                stageId: 's2_dev_prep',
                stageName: 'S2. 개발 준비',
                hasAction: true,
                confirmMessage: '개발 준비를 위와 같이 진행하시겠습니까?',
                orderSheetAfterExecute: `# 추가 Order Sheet - 개발 준비

## ✅ 자동 실행된 항목

- [x] 개발 환경 구축
- [x] 프로젝트 초기 설정

---

## 📝 추가 요청사항

[추가 요청사항을 작성하세요]

`,
                orderSheet: `# Order Sheet - S2. 개발 준비

## 기본 정보
- **Order ID**: OS-S2-A-001
- **작성일**: ${new Date().toISOString().split('T')[0]}

---

## 작업 항목

- [ ] 개발 환경 구축
- [ ] 프로젝트 초기 설정
- [ ] CI/CD 파이프라인 구성

---

## 추가 지시사항

[추가 요구사항이 있으면 여기에 작성]
`,
                guideUrl: 'guides/S1_개발_준비.html',
                orderSheetUrl: 'templates/S1_개발_준비.md'
            },

            's3_dev_1': {
                stageId: 's3_dev_1',
                stageName: 'S3. 개발 1차',
                hasAction: true,
                confirmMessage: '개발 1차를 위와 같이 진행하시겠습니까?',
                orderSheetAfterExecute: `# 추가 Order Sheet - 개발 1차

## ✅ 자동 실행된 항목

- [x] 핵심 기능 개발
- [x] 기본 테스트

---

## 📝 추가 요청사항

[추가 요청사항을 작성하세요]

`,
                orderSheet: `# Order Sheet - S3. 개발 1차

## 기본 정보
- **Order ID**: OS-S3-A-001
- **작성일**: ${new Date().toISOString().split('T')[0]}

---

## 작업 항목

- [ ] 핵심 기능 개발
- [ ] 기본 테스트
- [ ] 코드 리뷰

---

## 추가 지시사항

[추가 요구사항이 있으면 여기에 작성]
`,
                guideUrl: 'guides/S2_개발_1차.html',
                orderSheetUrl: 'templates/S2_개발_1차.md'
            },

            's4_dev_2': {
                stageId: 's4_dev_2',
                stageName: 'S4. 개발 2차',
                hasAction: true,
                confirmMessage: '개발 2차를 위와 같이 진행하시겠습니까?',
                orderSheetAfterExecute: `# 추가 Order Sheet - 개발 2차

## ✅ 자동 실행된 항목

- [x] 추가 기능 개발
- [x] 통합 테스트

---

## 📝 추가 요청사항

[추가 요청사항을 작성하세요]

`,
                orderSheet: `# Order Sheet - S4. 개발 2차

## 기본 정보
- **Order ID**: OS-S4-A-001
- **작성일**: ${new Date().toISOString().split('T')[0]}

---

## 작업 항목

- [ ] 추가 기능 개발
- [ ] 통합 테스트
- [ ] 버그 수정

---

## 추가 지시사항

[추가 요구사항이 있으면 여기에 작성]
`,
                guideUrl: 'guides/S3_개발_2차.html',
                orderSheetUrl: 'templates/S3_개발_2차.md'
            },

            's5_dev_3': {
                stageId: 's5_dev_3',
                stageName: 'S5. 개발 3차',
                hasAction: true,
                confirmMessage: '개발 3차를 위와 같이 진행하시겠습니까?',
                orderSheetAfterExecute: `# 추가 Order Sheet - 개발 3차

## ✅ 자동 실행된 항목

- [x] 최종 기능 완성
- [x] 성능 최적화

---

## 📝 추가 요청사항

[추가 요청사항을 작성하세요]

`,
                orderSheet: `# Order Sheet - S5. 개발 3차

## 기본 정보
- **Order ID**: OS-S5-A-001
- **작성일**: ${new Date().toISOString().split('T')[0]}

---

## 작업 항목

- [ ] 최종 기능 완성
- [ ] 성능 최적화
- [ ] 보안 점검

---

## 추가 지시사항

[추가 요구사항이 있으면 여기에 작성]
`,
                guideUrl: 'guides/S4_개발_3차.html',
                orderSheetUrl: 'templates/S4_개발_3차.md'
            },

            's6_operation': {
                stageId: 's6_operation',
                stageName: 'S6. 운영',
                hasAction: true,
                confirmMessage: '운영 단계를 위와 같이 진행하시겠습니까?',
                orderSheetAfterExecute: `# 추가 Order Sheet - 운영

## ✅ 자동 실행된 항목

- [x] 배포
- [x] 모니터링 설정

---

## 📝 추가 요청사항

[추가 요청사항을 작성하세요]

`,
                orderSheet: `# Order Sheet - S6. 운영

## 기본 정보
- **Order ID**: OS-S6-A-001
- **작성일**: ${new Date().toISOString().split('T')[0]}

---

## 작업 항목

- [ ] 배포
- [ ] 모니터링 설정
- [ ] 유지보수 계획

---

## 추가 지시사항

[추가 요구사항이 있으면 여기에 작성]
`,
                guideUrl: 'guides/S5_운영.html',
                orderSheetUrl: 'templates/S5_운영.md'
            }
        };

        // 진행 프로세스 단계 클릭 시 호출되는 함수
        // 안내문 팝업 + [예][아니오] 버튼 표시
        function loadProcessStage(stageId, stageName, category) {
            const stageData = STAGE_DATA[stageId];

            if (!stageData) {
                showStatus(`❌ "${stageName}" 단계의 데이터가 없습니다`, 'error');
                return;
            }

            // 현재 단계 데이터 저장
            currentStageData = stageData;

            // guideUrl이 있으면 GUIDE_CONTENTS에서 로드, 없으면 기존 guideContent 사용
            if (stageData.guideUrl) {
                openGuideModalFromUrl(stageName, stageData.guideUrl, stageData.confirmMessage, stageData.hasAction);
            } else if (stageData.guideContent) {
                openGuideModalWithConfirm(stageName, stageData.guideContent, stageData.confirmMessage, stageData.hasAction);
            } else {
                showStatus(`❌ "${stageName}" 안내문이 없습니다`, 'error');
            }
        }

        // 외부 HTML 파일에서 안내문 로드하여 팝업 표시
        // guideUrl 형식: 'guides/S1_개발_준비.html' -> GUIDE_CONTENTS['S1_개발_준비']
        function openGuideModalFromUrl(title, guideUrl, confirmMessage, hasAction = true) {
            const popup = document.getElementById('guidePopup');
            const popupTitle = document.getElementById('guidePopupTitle');
            const popupContent = document.getElementById('guidePopupContent');

            popupTitle.textContent = `📖 ${title} 안내`;

            // guideUrl에서 키 추출: 'guides/S1_개발_준비.html' -> 'S1_개발_준비'
            const guideKey = guideUrl.replace('guides/', '').replace('.html', '');

            // GUIDE_CONTENTS에서 HTML 콘텐츠 가져오기
            const htmlContent = (typeof GUIDE_CONTENTS !== 'undefined') ? GUIDE_CONTENTS[guideKey] : null;

            if (htmlContent) {
                // 버튼 섹션 생성
                let buttonSection = '';
                if (hasAction) {
                    buttonSection = `
                    <div style="margin-top: 24px; padding-top: 16px; border-top: 1px solid #dee2e6;">
                        <p style="font-weight: 600; color: #333; margin-bottom: 10px;">Order Sheet를 Workspace에 로드하시겠습니까?</p>
                        <div style="display: flex; gap: 12px;">
                            <button onclick="executeStageAction()" style="flex: 1; padding: 10px 16px; background: var(--primary); color: white; border: none; border-radius: 6px; font-weight: 600; cursor: pointer; font-size: 13px;">확인</button>
                            <button onclick="closeGuidePopup()" style="flex: 1; padding: 10px 16px; background: #6c757d; color: white; border: none; border-radius: 6px; font-weight: 600; cursor: pointer; font-size: 13px;">취소</button>
                        </div>
                    </div>
                    `;
                } else {
                    buttonSection = `
                    <div style="margin-top: 24px; padding-top: 16px; border-top: 1px solid #dee2e6;">
                        <div style="display: flex; justify-content: center;">
                            <button onclick="closeGuidePopup()" style="padding: 10px 32px; background: var(--primary); color: white; border: none; border-radius: 6px; font-weight: 600; cursor: pointer; font-size: 13px;">확인</button>
                        </div>
                    </div>
                    `;
                }

                popupContent.innerHTML = htmlContent + buttonSection;
            } else {
                console.error('안내문 로드 오류: GUIDE_CONTENTS에서 찾을 수 없음 -', guideKey);
                popupContent.innerHTML = `
                    <div style="text-align: center; padding: 40px; color: #dc3545;">
                        <p>❌ 안내문을 불러오지 못했습니다.</p>
                        <p style="font-size: 11px; color: #666; margin-top: 8px;">키: ${guideKey}</p>
                    </div>
                    <div style="margin-top: 24px; padding-top: 16px; border-top: 1px solid #dee2e6;">
                        <div style="display: flex; justify-content: center;">
                            <button onclick="closeGuidePopup()" style="padding: 10px 32px; background: #6c757d; color: white; border: none; border-radius: 6px; font-weight: 600; cursor: pointer; font-size: 13px;">닫기</button>
                        </div>
                    </div>
                `;
            }

            popup.style.display = 'block';
            initDragPopup();
        }

        // [확인] 버튼 클릭 시 - Order Sheet 표준 템플릿을 워크스페이스에 로드
        async function executeStageAction() {
            if (!currentStageData) return;

            // orderSheetUrl이 있으면 ORDER_SHEET_TEMPLATES에서 로드
            // 없으면 기존 orderSheetAfterExecute 사용 (하위 호환)
            let templateContent = '';

            if (currentStageData.orderSheetUrl) {
                // orderSheetUrl에서 키 추출: 'templates/P1-1_Vision_Mission.md' -> 'P1-1_Vision_Mission'
                const templateKey = currentStageData.orderSheetUrl.replace('templates/', '').replace('.md', '');
                templateContent = (typeof ORDER_SHEET_TEMPLATES !== 'undefined')
                    ? ORDER_SHEET_TEMPLATES[templateKey]
                    : null;

                if (!templateContent) {
                    console.error('Order Sheet 템플릿 로드 오류:', templateKey);
                    templateContent = currentStageData.orderSheetAfterExecute || '';
                }
            } else {
                templateContent = currentStageData.orderSheetAfterExecute || '';
            }

            // 워크스페이스에 Order Sheet 템플릿 로드
            document.getElementById('textEditor').value = templateContent;
            showStatus(`✅ Order Sheet 템플릿이 워크스페이스에 로드되었습니다.`, 'success');

            closeGuidePopup();
        }

        // 안내문 드래그 가능 팝업 열기 (hasAction에 따라 버튼 표시)
        function openGuideModalWithConfirm(title, content, confirmMessage, hasAction = true) {
            const popup = document.getElementById('guidePopup');
            const popupTitle = document.getElementById('guidePopupTitle');
            const popupContent = document.getElementById('guidePopupContent');

            popupTitle.textContent = `📖 ${title} 안내`;

            // hasAction이 true면 [예]/[아니오] 버튼, false면 [확인] 버튼만
            let buttonSection = '';
            if (hasAction) {
                buttonSection = `
                <div style="margin-top: 24px; padding-top: 16px; border-top: 1px solid #dee2e6;">
                    <p style="font-weight: 600; color: #333; margin-bottom: 10px;">${confirmMessage}</p>
                    <div style="display: flex; gap: 12px;">
                        <button onclick="executeStageAction()" style="flex: 1; padding: 10px 16px; background: var(--primary); color: white; border: none; border-radius: 6px; font-weight: 600; cursor: pointer; font-size: 13px;">예</button>
                        <button onclick="loadOrderSheetToWorkspace()" style="flex: 1; padding: 10px 16px; background: #6c757d; color: white; border: none; border-radius: 6px; font-weight: 600; cursor: pointer; font-size: 13px;">아니오</button>
                    </div>
                </div>
                `;
            } else {
                buttonSection = `
                <div style="margin-top: 24px; padding-top: 16px; border-top: 1px solid #dee2e6;">
                    <div style="display: flex; justify-content: center;">
                        <button onclick="closeGuidePopup()" style="padding: 10px 32px; background: var(--primary); color: white; border: none; border-radius: 6px; font-weight: 600; cursor: pointer; font-size: 13px;">확인</button>
                    </div>
                </div>
                `;
            }

            popupContent.innerHTML = content + buttonSection;

            popup.style.display = 'block';

            // 드래그 기능 초기화
            initDragPopup();
        }

        // [아니오] 버튼 클릭 시 - Order Sheet를 워크스페이스에 로드
        function loadOrderSheetToWorkspace() {
            if (!currentStageData) return;

            document.getElementById('textEditor').value = currentStageData.orderSheet;
            showStatus(`✅ "${currentStageData.stageName}" Order Sheet를 워크스페이스에 로드했습니다. 수정 후 발행하세요.`, 'info');
            closeGuidePopup();
        }

        // 안내문 팝업 닫기
        function closeGuidePopup() {
            const popup = document.getElementById('guidePopup');
            popup.style.display = 'none';
        }

        // 드래그 기능
        function initDragPopup() {
            const popup = document.getElementById('guidePopup');
            const header = document.getElementById('guidePopupHeader');

            let isDragging = false;
            let offsetX, offsetY;

            header.onmousedown = function(e) {
                isDragging = true;
                offsetX = e.clientX - popup.offsetLeft;
                offsetY = e.clientY - popup.offsetTop;

                document.onmousemove = function(e) {
                    if (isDragging) {
                        popup.style.left = (e.clientX - offsetX) + 'px';
                        popup.style.top = (e.clientY - offsetY) + 'px';
                        popup.style.right = 'auto';
                    }
                };

                document.onmouseup = function() {
                    isDragging = false;
                    document.onmousemove = null;
                    document.onmouseup = null;
                };
            };
        }

        // Call this when page loads
        window.addEventListener('DOMContentLoaded', () => {
            loadOrderSheetTemplates();
            loadWelcomeMessage();
        });

        // Translation functionality
        let translationTimeout;

        function toggleTranslation() {
            const preview = document.getElementById('translationPreview');
            const toggleText = document.getElementById('toggleText');

            if (preview.style.display === 'none') {
                preview.style.display = 'block';
                toggleText.textContent = '▲';
            } else {
                preview.style.display = 'none';
                toggleText.textContent = '▼';
            }
        }

        async function translateToEnglish() {
            clearTimeout(translationTimeout);

            const content = document.getElementById('textEditor').value;
            const translationSection = document.getElementById('translationSection');
            const translatedText = document.getElementById('translatedText');

            // 한글이 있는지 확인
            const hasKorean = /[ㄱ-ㅎ|ㅏ-ㅣ|가-힣]/.test(content);

            if (!content.trim() || !hasKorean) {
                translationSection.style.display = 'none';
                return;
            }

            translationSection.style.display = 'flex';

            // 즉시 번역 시작 (300ms debounce만 적용)
            translationTimeout = setTimeout(async () => {
                translatedText.textContent = '번역 중...';

                try {
                    // AI 기반 번역 + 문법 교정
                    const translated = await translateWithAI(content);
                    // 병기 마크다운 형식으로 미리보기
                    const bilingualMd = generateBilingualMarkdown(content, translated);
                    translatedText.textContent = bilingualMd;
                } catch (error) {
                    translatedText.textContent = '번역 실패. 다시 시도해주세요.';
                }
            }, 300);
        }

        // AI 기반 번역 + 문법 교정 (Perplexity API 사용)
        async function translateWithAI(text) {
            try {
                const response = await fetch('http://localhost:3030/translate', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        text: text,
                        mode: 'translate_and_fix'  // 번역 + 문법 교정 모드
                    })
                });

                if (!response.ok) {
                    throw new Error('Translation failed');
                }

                const data = await response.json();
                return data.translated;

            } catch (error) {
                console.error('AI 번역 실패, 기본 번역으로 전환:', error);
                // Fallback: 간단한 번역
                return await mockTranslate(text);
            }
        }

        // Mock translation (Fallback용)
        async function mockTranslate(text) {
            // 시뮬레이션: 짧은 딜레이
            await new Promise(resolve => setTimeout(resolve, 200));

            // 간단한 키워드 매핑 (데모용)
            const translations = {
                '회원가입': 'Sign Up',
                '로그인': 'Login',
                '비밀번호': 'Password',
                '이메일': 'Email',
                '요구사항': 'Requirements',
                '산출물': 'Deliverables',
                '참고사항': 'Notes',
                '구현': 'Implementation',
                'API': 'API',
                '연동': 'Integration',
                '중복': 'Duplicate',
                '확인': 'Verification',
                '암호화': 'Encryption',
                '테스트': 'Test',
                '코드': 'Code',
                '최소': 'Minimum',
                '영문': 'English',
                '숫자': 'Number',
                '특수문자': 'Special Character',
                '포함': 'Include'
            };

            let translated = text;
            for (const [kr, en] of Object.entries(translations)) {
                translated = translated.replace(new RegExp(kr, 'g'), en);
            }

            return translated;
        }

        // 한영 병기 마크다운 생성 (Claude Code는 영어만 읽음)
        function generateBilingualMarkdown(koreanText, englishText) {
            const lines = koreanText.split('\n');
            const translatedLines = englishText.split('\n');
            let result = [];

            result.push('<!-- Claude Code: Read English only -->');
            result.push('');

            for (let i = 0; i < lines.length; i++) {
                const korLine = lines[i];
                const engLine = translatedLines[i] || '';

                // 한글이 있는 줄만 처리
                if (/[ㄱ-ㅎ|ㅏ-ㅣ|가-힣]/.test(korLine)) {
                    // 한글은 HTML 주석으로 감싸기 (Claude Code가 무시)
                    result.push(`<!-- 🇰🇷 ${korLine} -->`);
                    // 영어는 일반 텍스트로 (Claude Code가 읽음)
                    result.push(engLine);
                } else {
                    // 한글이 없으면 그대로
                    result.push(korLine);
                }
            }

            return result.join('\n');
        }

        // Order Sheet 복사하기 (클립보드에 복사)
        async function copyOrderSheet() {
            const content = document.getElementById('textEditor').value;

            if (!content.trim()) {
                alert('작성된 내용이 없습니다!');
                return;
            }

            try {
                await navigator.clipboard.writeText(content);
                showStatus('✅ Order Sheet 복사 완료', 'success');
                alert('Order Sheet가 클립보드에 복사되었습니다!\n\nClaude Code에 붙여넣기 하세요.');
            } catch (e) {
                console.error('복사 실패:', e);
                showStatus('❌ 복사 실패', 'error');
                alert('복사에 실패했습니다. 직접 선택해서 복사해주세요.');
            }
        }

        // Report 내용을 HTML 모달로 표시
        function showReportModal(title, htmlContent) {
            const overlay = document.createElement('div');
            overlay.className = 'report-modal-overlay';
            overlay.style.cssText = 'position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0, 0, 0, 0.6); display: flex; align-items: center; justify-content: center; z-index: 10001;';

            const modal = document.createElement('div');
            modal.style.cssText = 'background: white; border-radius: 12px; max-width: 900px; width: 95%; max-height: 90vh; overflow: hidden; box-shadow: 0 10px 40px rgba(0, 0, 0, 0.3);';

            modal.innerHTML = `
                <div style="display: flex; justify-content: space-between; align-items: center; padding: 16px 24px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white;">
                    <h3 style="margin: 0; font-size: 18px; font-weight: 600;">📄 ${title}</h3>
                    <button onclick="this.closest('.report-modal-overlay').remove()"
                            style="background: rgba(255, 255, 255, 0.2); border: none; color: white; font-size: 20px; cursor: pointer; width: 28px; height: 28px; border-radius: 50%; display: flex; align-items: center; justify-content: center; flex-shrink: 0;">
                        ×
                    </button>
                </div>
                <div class="report-content" style="padding: 24px; line-height: 1.7; color: #495057; font-size: 14px; overflow-y: auto; max-height: calc(90vh - 140px);">
                    ${htmlContent}
                </div>
                <div style="padding: 16px 24px; border-top: 1px solid #e9ecef; display: flex; justify-content: flex-end;">
                    <button onclick="this.closest('.report-modal-overlay').remove()"
                            style="padding: 8px 20px; background: #667eea; color: white; border: none; border-radius: 6px; cursor: pointer; font-size: 13px; font-weight: 500;">
                        닫기
                    </button>
                </div>
            `;

            overlay.appendChild(modal);
            overlay.onclick = (e) => {
                if (e.target === overlay) {
                    overlay.remove();
                }
            };
            document.body.appendChild(overlay);
        }

        // JSON을 보기 좋은 HTML로 변환
        function renderJsonAsHtml(data, filename) {
            const escapeHtml = (str) => {
                if (typeof str !== 'string') return str;
                return str.replace(/&/g, '&amp;').replace(/</g, '&lt;').replace(/>/g, '&gt;').replace(/"/g, '&quot;');
            };

            const renderValue = (value, depth = 0) => {
                if (value === null) return '<span style="color: #999;">null</span>';
                if (typeof value === 'boolean') return `<span style="color: #d73a49;">${value}</span>`;
                if (typeof value === 'number') return `<span style="color: #005cc5;">${value}</span>`;
                if (typeof value === 'string') {
                    if (value.startsWith('✅') || value.startsWith('❌') || value.startsWith('⚠️') || value.startsWith('📄')) {
                        return `<span style="font-size: 14px;">${escapeHtml(value)}</span>`;
                    }
                    return `<span style="color: #22863a;">"${escapeHtml(value)}"</span>`;
                }
                if (Array.isArray(value)) {
                    if (value.length === 0) return '<span style="color: #999;">[]</span>';
                    const items = value.map((v, i) => `<li style="margin: 4px 0;">${renderValue(v, depth + 1)}</li>`).join('');
                    return `<ul style="margin: 8px 0 8px 16px; padding: 0; list-style: disc;">${items}</ul>`;
                }
                if (typeof value === 'object') {
                    const entries = Object.entries(value);
                    if (entries.length === 0) return '<span style="color: #999;">{}</span>';
                    const rows = entries.map(([k, v]) => `
                        <tr>
                            <td style="padding: 8px 12px; font-weight: 600; color: #24292e; vertical-align: top; white-space: nowrap; border-bottom: 1px solid #e9ecef;">${escapeHtml(k)}</td>
                            <td style="padding: 8px 12px; color: #586069; border-bottom: 1px solid #e9ecef;">${renderValue(v, depth + 1)}</td>
                        </tr>
                    `).join('');
                    return `<table style="width: 100%; border-collapse: collapse; background: #f8f9fa; border-radius: 8px; overflow: hidden; margin: 8px 0;">${rows}</table>`;
                }
                return escapeHtml(String(value));
            };

            // 메인 카드 생성
            let html = `
                <div style="margin-bottom: 16px; padding: 16px; background: linear-gradient(135deg, #f5f7fa 0%, #e9ecef 100%); border-radius: 8px;">
                    <div style="font-size: 12px; color: #6c757d; margin-bottom: 4px;">파일명</div>
                    <div style="font-size: 16px; font-weight: 600; color: #212529;">${escapeHtml(filename)}</div>
                </div>
            `;

            // task_id, status 등 주요 필드가 있으면 상단에 표시
            if (data.task_id || data.status || data.task_name) {
                html += `<div style="display: flex; gap: 12px; flex-wrap: wrap; margin-bottom: 16px;">`;
                if (data.task_id) {
                    html += `<div style="padding: 8px 16px; background: #667eea; color: white; border-radius: 20px; font-weight: 500;">${escapeHtml(data.task_id)}</div>`;
                }
                if (data.task_name) {
                    html += `<div style="padding: 8px 16px; background: #28a745; color: white; border-radius: 20px; font-weight: 500;">${escapeHtml(data.task_name)}</div>`;
                }
                if (data.status) {
                    const statusColor = data.status === '완료' ? '#28a745' : data.status === '진행중' ? '#ffc107' : '#6c757d';
                    html += `<div style="padding: 8px 16px; background: ${statusColor}; color: white; border-radius: 20px; font-weight: 500;">${escapeHtml(data.status)}</div>`;
                }
                html += `</div>`;
            }

            // 나머지 데이터 표시
            html += renderValue(data);

            return html;
        }

        // File System Access API로 Reports 불러오기 (프로덕션용)
        async function loadFromReportsWithFileAPI() {
            try {
                // File System Access API 지원 확인
                if (!('showOpenFilePicker' in window)) {
                    alert('이 브라우저는 파일 선택 기능을 지원하지 않습니다.\n\nChrome, Edge 등 최신 브라우저를 사용해주세요.');
                    return;
                }

                alert('📂 Report 파일 선택 안내\n\n경로: [프로젝트폴더]/Human_ClaudeCode_Bridge/Reports/\n\n위 폴더에서 Report 파일(.json 또는 .md)을 선택하시면\nHTML 파일로 보기 좋게 변환하여 볼 수 있습니다.');

                // 파일 선택 다이얼로그 열기
                const [fileHandle] = await window.showOpenFilePicker({
                    types: [
                        {
                            description: 'Report 파일',
                            accept: {
                                'application/json': ['.json'],
                                'text/markdown': ['.md']
                            }
                        }
                    ],
                    multiple: false
                });

                showStatus(`📄 ${fileHandle.name} 로딩 중...`, 'info');

                // 파일 내용 읽기
                const file = await fileHandle.getFile();
                const content = await file.text();
                const filename = fileHandle.name;

                if (filename.endsWith('.json')) {
                    // JSON 파일: HTML 카드로 렌더링하여 모달에 표시
                    try {
                        const data = JSON.parse(content);
                        const htmlContent = renderJsonAsHtml(data, filename);
                        showReportModal(filename, htmlContent);
                    } catch (e) {
                        // JSON 파싱 실패 시 원본 텍스트 표시
                        showReportModal(filename, `<pre style="background: #f8f9fa; padding: 16px; border-radius: 8px; overflow-x: auto; white-space: pre-wrap;">${content.replace(/</g, '&lt;').replace(/>/g, '&gt;')}</pre>`);
                    }
                } else if (filename.endsWith('.md')) {
                    // MD 파일: marked.js로 HTML 변환하여 모달에 표시
                    try {
                        const htmlContent = marked.parse(content);
                        const styledHtml = `
                            <style>
                                .report-content h1 { font-size: 24px; margin: 0 0 16px 0; color: #212529; border-bottom: 2px solid #e9ecef; padding-bottom: 8px; }
                                .report-content h2 { font-size: 20px; margin: 24px 0 12px 0; color: #212529; }
                                .report-content h3 { font-size: 16px; margin: 20px 0 10px 0; color: #495057; }
                                .report-content p { margin: 12px 0; }
                                .report-content ul, .report-content ol { margin: 12px 0; padding-left: 24px; }
                                .report-content li { margin: 6px 0; }
                                .report-content code { background: #f1f3f4; padding: 2px 6px; border-radius: 4px; font-family: 'Consolas', monospace; font-size: 13px; }
                                .report-content pre { background: #1e1e1e; color: #d4d4d4; padding: 16px; border-radius: 8px; overflow-x: auto; }
                                .report-content pre code { background: transparent; padding: 0; color: inherit; }
                                .report-content blockquote { border-left: 4px solid #667eea; margin: 16px 0; padding: 12px 16px; background: #f8f9fa; }
                                .report-content table { width: 100%; border-collapse: collapse; margin: 16px 0; }
                                .report-content th, .report-content td { border: 1px solid #e9ecef; padding: 10px 12px; text-align: left; }
                                .report-content th { background: #f8f9fa; font-weight: 600; }
                            </style>
                            ${htmlContent}
                        `;
                        showReportModal(filename, styledHtml);
                    } catch (e) {
                        // Markdown 파싱 실패 시 원본 텍스트 표시
                        showReportModal(filename, `<pre style="background: #f8f9fa; padding: 16px; border-radius: 8px; overflow-x: auto; white-space: pre-wrap;">${content.replace(/</g, '&lt;').replace(/>/g, '&gt;')}</pre>`);
                    }
                } else {
                    // 기타 파일: 원본 텍스트로 표시
                    showReportModal(filename, `<pre style="background: #f8f9fa; padding: 16px; border-radius: 8px; overflow-x: auto; white-space: pre-wrap;">${content.replace(/</g, '&lt;').replace(/>/g, '&gt;')}</pre>`);
                }

                showStatus(`✅ ${filename} 로드 완료`, 'success');

            } catch (error) {
                if (error.name === 'AbortError') {
                    // 사용자가 취소함
                    showStatus('파일 선택 취소됨', 'info');
                    return;
                }
                console.error('파일 로드 실패:', error);
                showStatus(`❌ 파일 로드 실패: ${error.message}`, 'error');
                alert(`❌ 파일 로드에 실패했습니다.\n\n${error.message}`);
            }
        }

        // Load from Reports (Claude Code 작업 결과 가져오기)
        // 프로덕션: File System Access API 사용
        // 로컬: Bridge 서버 사용
        async function loadFromReports() {
            // 프로덕션 환경에서는 File System Access API 사용
            if (IS_PRODUCTION) {
                await loadFromReportsWithFileAPI();
                return;
            }

            showStatus('Reports 확인 중...', 'info');

            try {
                // Reports 파일 목록 가져오기 (백엔드는 /outbox/files 유지)
                const response = await fetch(BRIDGE_SERVER_URL + '/outbox/files');
                const result = await response.json();

                if (!result.success || result.files.length === 0) {
                    alert('📭 Reports가 비어있습니다.\n\nClaude Code가 작업을 완료하면 결과물이 Human_ClaudeCode_Bridge/Reports/에 저장됩니다.');
                    showStatus('📭 Reports 비어있음', 'info');
                    return;
                }

                // 모달에 파일 목록 표시
                const filesList = document.getElementById('outboxFilesList');
                filesList.innerHTML = '';

                // JSON 파일들의 내용을 미리 읽어서 매핑
                const jsonData = {};
                for (const file of result.files) {
                    if (file.filename.endsWith('.json')) {
                        try {
                            const contentRes = await fetch(`${BRIDGE_SERVER_URL}/outbox/read/${file.filename}`);
                            const contentResult = await contentRes.json();
                            if (contentResult.success) {
                                const data = JSON.parse(contentResult.content);
                                jsonData[file.filename] = data;
                            }
                        } catch (e) {
                            // 무시
                        }
                    }
                }

                // 파일 목록을 처리하여 배열에 저장
                const fileItems = [];

                result.files.forEach((file) => {
                    // _ack.json 파일은 숨기기
                    if (file.filename.includes('_ack.json')) return;

                    // 파일 유형에 따른 아이콘 및 표시 정보 설정
                    const fileExt = file.filename.split('.').pop().toLowerCase();
                    let displayIcon = '📄';
                    let displayName = file.filename;
                    let displayMeta = '';
                    let badgeClass = '';

                    // JSON 파일 처리
                    if (fileExt === 'json') {
                        const data = jsonData[file.filename];
                        if (data) {
                            displayIcon = data.response_type === 'final' ? '✅' : '📋';
                            displayName = data.order_name || data.task_name || file.filename;
                            displayMeta = data.status || '';
                        }
                        badgeClass = 'json';
                    }
                    // MD 파일 처리
                    else if (fileExt === 'md') {
                        displayIcon = '📝';
                        displayName = file.filename.replace('.md', '');
                        badgeClass = 'markdown';
                    }

                    // 시간 정보 추가
                    const modDate = new Date(file.modified);
                    const timeStr = modDate.toLocaleString('ko-KR', {
                        month: 'short', day: 'numeric',
                        hour: '2-digit', minute: '2-digit'
                    });
                    displayMeta = displayMeta ? `${displayMeta} · ${timeStr}` : timeStr;

                    fileItems.push({
                        file: file,
                        displayIcon,
                        displayName,
                        displayMeta,
                        fileExt,
                        badgeClass,
                        modified: file.modified
                    });
                });

                // 최신순 정렬
                fileItems.sort((a, b) => new Date(b.modified) - new Date(a.modified));

                // HTML 생성
                fileItems.forEach(item => {
                    const fileItem = document.createElement('div');
                    fileItem.className = 'outbox-file-item';
                    fileItem.onclick = () => selectReportFile(item.file);
                    fileItem.innerHTML = `
                        <div class="outbox-file-icon">${item.displayIcon}</div>
                        <div class="outbox-file-info">
                            <div class="outbox-file-name">${item.displayName}</div>
                            <div class="outbox-file-meta">${item.displayMeta}</div>
                        </div>
                        <div class="outbox-file-badge ${item.badgeClass}">${item.fileExt.toUpperCase()}</div>
                    `;
                    filesList.appendChild(fileItem);
                });

                // 모달 열기
                const modal = document.getElementById('outboxFilesModal');
                modal.style.display = 'flex';
                modal.querySelector('.grid-fullscreen-title').textContent = '📤 Reports - 파일 선택';

                showStatus('📤 Reports 파일 목록 표시', 'info');

            } catch (error) {
                console.error('Reports 로드 실패:', error);
                showStatus('❌ Reports 로드 실패', 'error');
                alert(`❌ Bridge 서버에 연결할 수 없습니다.\n\n서버가 실행 중인지 확인하세요:\ncd Human_ClaudeCode_Bridge\nnode inbox_server.js`);
            }
        }

        // Reports 파일 선택
        async function selectReportFile(file) {
            closeOutboxModal();

            showStatus(`📄 ${file.filename} 로딩 중...`, 'info');

            try {
                // 파일 내용 가져오기
                const contentResponse = await fetch(`${BRIDGE_SERVER_URL}/outbox/read/${file.filename}`);
                const contentResult = await contentResponse.json();

                if (!contentResult.success) {
                    throw new Error(contentResult.error || '파일 로드 실패');
                }

                // 에디터에 표시
                const editor = document.getElementById('textEditor');

                if (file.filename.endsWith('.md')) {
                    // MD 파일: 원본 마크다운을 가져오기 위해 다시 파싱
                    const data = JSON.parse(contentResult.content);
                    editor.value = `# ${data.title}\n\n${data.content}`;
                } else {
                    // JSON 파일: 보기 좋게 포맷팅
                    const data = JSON.parse(contentResult.content);
                    editor.value = JSON.stringify(data, null, 2);
                }

                showStatus(`✅ ${file.filename} 로드 완료`, 'success');

            } catch (error) {
                console.error('파일 로드 실패:', error);
                showStatus(`❌ 파일 로드 실패: ${error.message}`, 'error');
                alert(`❌ 파일 로드에 실패했습니다.\n\n${error.message}`);
            }
        }

        // 기존 함수 유지 (호환성)
        // Load from Outbox (Claude Code 작업 결과 가져오기)
        async function loadFromOutbox() {
            // 배포 환경에서는 로컬 서버 기능 비활성화
            if (IS_PRODUCTION) {
                alert('이 기능은 로컬 개발 환경에서만 사용 가능합니다.\n\n로컬에서 Bridge 서버를 실행한 후 사용해주세요.');
                return;
            }

            showStatus('Outbox 확인 중...', 'info');

            try {
                // Outbox 파일 목록 가져오기
                const response = await fetch(BRIDGE_SERVER_URL + '/outbox/files');
                const result = await response.json();

                if (!result.success || result.files.length === 0) {
                    alert('📭 Outbox가 비어있습니다.\n\nClaude Code가 작업을 완료하면 결과물이 Outbox/에 저장됩니다.');
                    showStatus('📭 Outbox 비어있음', 'info');
                    return;
                }

                // 모달에 파일 목록 표시
                const filesList = document.getElementById('outboxFilesList');
                filesList.innerHTML = '';

                // JSON 파일들의 내용을 미리 읽어서 매핑
                const jsonData = {};
                for (const file of result.files) {
                    if (file.filename.endsWith('.json')) {
                        try {
                            const contentRes = await fetch(`http://localhost:3030/outbox/read/${file.filename}`);
                            const contentResult = await contentRes.json();
                            if (contentResult.success) {
                                const data = JSON.parse(contentResult.content);
                                jsonData[file.filename] = data;
                            }
                        } catch (e) {
                            // 무시
                        }
                    }
                }

                // 파일 목록을 처리하여 배열에 저장 (최신순 정렬을 위해)
                const fileItems = [];

                result.files.forEach((file) => {
                    // _ack.json 파일은 숨기기
                    if (file.filename.includes('_ack.json')) return;

                    const fileExt = file.filename.split('.').pop();

                    // JSON과 MD 파일만 표시
                    if (fileExt !== 'json' && fileExt !== 'md') return;

                    let displayName = file.filename;
                    let displayMeta = `수정: ${new Date(file.modified).toLocaleString('ko-KR')}`;
                    let displayIcon = fileExt === 'md' ? '📄' : '📋';
                    let badgeClass = fileExt === 'md' ? 'markdown' : 'json';

                    // JSON 파일의 질문 내용 표시
                    if (fileExt === 'json' && jsonData[file.filename]) {
                        const data = jsonData[file.filename];
                        const question = data.question || data.content_korean || data.content || '';
                        if (question) {
                            const questionPreview = question.length > 60 ? question.substring(0, 60) + '...' : question;
                            displayName = `📋 ${questionPreview}`;
                            displayMeta = `${data.order_id || 'N/A'} | ${new Date(file.modified).toLocaleString('ko-KR')}`;
                        }
                    }

                    // MD 파일의 제목 추출 (파일명에서)
                    if (fileExt === 'md') {
                        const title = file.filename.replace('.md', '').replace(/_/g, ' ');
                        displayName = `📄 ${title}`;
                        displayMeta = `Markdown | ${new Date(file.modified).toLocaleString('ko-KR')}`;
                    }

                    fileItems.push({
                        file,
                        displayIcon,
                        displayName,
                        displayMeta,
                        badgeClass,
                        fileExt,
                        modified: file.modified
                    });
                });

                // 최신순으로 정렬 (modified 날짜 기준 내림차순)
                fileItems.sort((a, b) => new Date(b.modified) - new Date(a.modified));

                // 정렬된 순서대로 DOM에 추가
                fileItems.forEach(item => {
                    const fileItem = document.createElement('div');
                    fileItem.className = 'outbox-file-item';
                    fileItem.onclick = () => selectOutboxFile(item.file);

                    fileItem.innerHTML = `
                        <div class="outbox-file-icon">${item.displayIcon}</div>
                        <div class="outbox-file-info">
                            <div class="outbox-file-name">${item.displayName}</div>
                            <div class="outbox-file-meta">${item.displayMeta}</div>
                        </div>
                        <div class="outbox-file-badge ${item.badgeClass}">${item.fileExt.toUpperCase()}</div>
                    `;

                    filesList.appendChild(fileItem);
                });

                // 모달 열기
                const modal = document.getElementById('outboxFilesModal');
                modal.classList.add('active');
                document.body.style.overflow = 'hidden';
                showStatus('📤 Outbox 파일 목록 표시', 'info');

            } catch (error) {
                console.error('Outbox 로드 실패:', error);
                showStatus('❌ Outbox 로드 실패', 'error');
                alert(`❌ Outbox 서버에 연결할 수 없습니다.\n\n서버가 실행 중인지 확인하세요:\ncd Web_ClaudeCode_Bridge\nnode inbox_server.js`);
            }
        }

        // Outbox 모달 닫기
        function closeOutboxModal() {
            const modal = document.getElementById('outboxFilesModal');
            modal.classList.remove('active');
            document.body.style.overflow = 'auto';
        }

        // JSON 데이터로 HTML 생성
        function generateHTMLFromJSON(data) {
            const question = data.question || '질문 없음';
            const answer = data.answer || '답변 없음';
            const orderId = data.order_id || 'Unknown';
            const orderName = data.order_name || '제목 없음';
            const respondedAt = data.responded_at ? new Date(data.responded_at).toLocaleString('ko-KR') : '시간 정보 없음';

            return `<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>${orderName} - 답변</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Noto Sans KR', sans-serif;
            line-height: 1.6;
            color: #333;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            padding: 20px;
            min-height: 100vh;
        }

        .container {
            max-width: 900px;
            margin: 0 auto;
            background: white;
            border-radius: 16px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 40px;
            text-align: center;
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            font-weight: 700;
        }

        .badge {
            display: inline-block;
            background: rgba(255,255,255,0.2);
            padding: 8px 16px;
            border-radius: 20px;
            margin-top: 15px;
            font-size: 0.9em;
        }

        .content {
            padding: 40px;
        }

        .section {
            margin-bottom: 35px;
        }

        .section-title {
            font-size: 1.8em;
            color: #667eea;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 3px solid #667eea;
            font-weight: 600;
        }

        .question-box {
            background: #f8f9fa;
            padding: 25px;
            border-radius: 12px;
            margin-bottom: 20px;
            border-left: 5px solid #667eea;
        }

        .answer-box {
            background: #f8f9fa;
            padding: 25px;
            border-radius: 12px;
            margin-bottom: 20px;
            border-left: 5px solid #764ba2;
            white-space: pre-wrap;
            line-height: 1.8;
        }

        .footer {
            background: #f8f9fa;
            padding: 30px;
            text-align: center;
            color: #666;
            border-top: 1px solid #e0e0e0;
        }

        .footer .meta {
            display: inline-block;
            margin: 0 15px;
            font-size: 0.9em;
        }

        @media (max-width: 768px) {
            .header h1 {
                font-size: 1.8em;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>📝 ${orderName}</h1>
            <span class="badge">Order ID: ${orderId}</span>
        </div>

        <div class="content">
            <div class="section">
                <h2 class="section-title">❓ 질문</h2>
                <div class="question-box">
                    ${question}
                </div>
            </div>

            <div class="section">
                <h2 class="section-title">💡 답변</h2>
                <div class="answer-box">${answer}</div>
            </div>
        </div>

        <div class="footer">
            <div class="meta">📅 답변 시간: ${respondedAt}</div>
            <div class="meta">✅ 처리: Claude Code</div>
        </div>
    </div>
</body>
</html>`;
        }

        // Outbox 파일 선택
        async function selectOutboxFile(file) {
            closeOutboxModal();

            const fileExt = file.filename.split('.').pop();

            try {
                showStatus(`📄 ${file.filename} 읽는 중...`, 'info');

                const contentResponse = await fetch(`http://localhost:3030/outbox/read/${file.filename}`);
                const contentResult = await contentResponse.json();

                if (!contentResult.success) {
                    throw new Error(contentResult.error || '파일 읽기 실패');
                }

                // MD 파일 처리
                if (fileExt === 'md') {
                    const mdData = JSON.parse(contentResult.content);

                    // 새 창에서 Markdown을 HTML로 렌더링
                    const newWindow = window.open('', '_blank');
                    newWindow.document.write(`
<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>${mdData.title || file.filename}</title>
    <style>
        body {
            font-family: 'Pretendard', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            line-height: 1.6;
            color: #333;
            max-width: 900px;
            margin: 0 auto;
            padding: 40px 20px;
            background: #f9fafb;
        }
        .markdown-body {
            background: white;
            padding: 40px;
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        h1 { color: #1f2937; border-bottom: 3px solid #10B981; padding-bottom: 10px; }
        h2 { color: #374151; margin-top: 30px; border-left: 4px solid #10B981; padding-left: 12px; }
        h3 { color: #4b5563; }
        pre { background: #1e1e1e; color: #d4d4d4; padding: 15px; border-radius: 8px; overflow-x: auto; }
        code { background: #f3f4f6; padding: 2px 6px; border-radius: 4px; font-family: 'Consolas', monospace; }
        pre code { background: transparent; padding: 0; }
        table { border-collapse: collapse; width: 100%; margin: 20px 0; }
        th, td { border: 1px solid #e5e7eb; padding: 12px; text-align: left; }
        th { background: #f3f4f6; font-weight: 600; }
        blockquote { border-left: 4px solid #10B981; padding-left: 16px; color: #6b7280; margin: 20px 0; }
        a { color: #10B981; text-decoration: none; }
        a:hover { text-decoration: underline; }
        .meta { text-align: right; color: #6b7280; font-size: 14px; margin-top: 40px; padding-top: 20px; border-top: 1px solid #e5e7eb; }
    </style>
</head>
<body>
    <div class="markdown-body">
        ${mdData.content}
        <div class="meta">📅 ${mdData.date} | 📄 Markdown Document</div>
    </div>
</body>
</html>
                    `);
                    newWindow.document.close();
                    showStatus(`✅ ${file.filename} 렌더링 완료!`, 'success');
                    return;
                }

                // JSON 파일 처리
                const data = JSON.parse(contentResult.content);
                const htmlContent = generateHTMLFromJSON(data);

                // 새 창에서 열기
                const newWindow = window.open('', '_blank');
                newWindow.document.write(htmlContent);
                newWindow.document.close();

                showStatus(`✅ ${file.filename} HTML로 렌더링 완료!`, 'success');

            } catch (error) {
                console.error('파일 읽기 실패:', error);
                showStatus('❌ 파일 읽기 실패', 'error');
                alert(`❌ 파일을 읽을 수 없습니다: ${file.filename}`);
            }
        }

        // Perplexity에 질문 보내기
        async function askPerplexity() {
            const question = document.getElementById('perplexityQuestion').value;
            const workspace = document.getElementById('textEditor');

            if (!question.trim()) {
                alert('질문을 입력하세요!');
                return;
            }

            // Workspace에 로딩 표시
            workspace.value = '🔮 Perplexity가 생각 중입니다...\n\n';

            try {
                // TODO: 실제 API 연결 시 아래 코드 활성화
                // const response = await fetch('http://localhost:3030/perplexity/ask', {
                //     method: 'POST',
                //     headers: { 'Content-Type': 'application/json' },
                //     body: JSON.stringify({ question })
                // });
                // const result = await response.json();

                // 임시 응답 (테스트용)
                setTimeout(() => {
                    workspace.value = `📝 질문: ${question}\n\n`;
                    workspace.value += `🔮 Perplexity의 답변:\n\n`;
                    workspace.value += `[여기에 Perplexity의 실제 답변이 표시됩니다]\n\n`;
                    workspace.value += `이 기능을 사용하려면 Perplexity API를 연결하세요.\n`;
                    workspace.value += `자세한 내용은 'PERPLEXITY_API_연결_가이드.md'를 참고하세요.\n\n`;
                    workspace.value += `---\n`;
                    workspace.value += `시간: ${new Date().toLocaleString('ko-KR')}`;

                    // 질문창 초기화
                    document.getElementById('perplexityQuestion').value = '';
                }, 1000);

            } catch (error) {
                console.error('Perplexity 요청 실패:', error);
                alert('Perplexity API 연결 실패!');
                workspace.value = '';
            }
        }

        // 파일 선택 핸들러
        let supportFiles = [];
        function handleSupportFileSelect(event) {
            const files = Array.from(event.target.files);
            supportFiles = files;

            const fileList = document.getElementById('supportFileList');
            if (files.length > 0) {
                fileList.innerHTML = files.map((file, idx) => {
                    const sizeKB = (file.size / 1024).toFixed(1);
                    return '<div style="padding: 2px 0;">📎 ' + file.name + ' (' + sizeKB + 'KB) <span onclick="removeSupportFile(' + idx + ')" style="cursor: pointer; color: #dc3545;">✕</span></div>';
                }).join('');
            } else {
                fileList.innerHTML = '';
            }
        }

        function removeSupportFile(index) {
            supportFiles.splice(index, 1);
            const dt = new DataTransfer();
            supportFiles.forEach(file => dt.items.add(file));
            document.getElementById('supportFile').files = dt.files;
            handleSupportFileSelect({ target: { files: dt.files } });
        }

        // 써니에게 문의 제출
        async function submitSupport() {
            console.log('submitSupport 함수 실행됨');
            const question = document.getElementById('supportQuestion').value;
            const workspace = document.getElementById('textEditor');

            console.log('질문 내용:', question);
            console.log('workspace 요소:', workspace);

            if (!question.trim()) {
                alert('문의 내용을 입력하세요!');
                return;
            }

            try {
                // Workspace에 접수 확인 표시
                let fileInfo = supportFiles.length > 0 ? '\n📎 첨부 파일: ' + supportFiles.map(f => f.name).join(', ') : '';
                const currentContent = workspace.value;
                const newContent = '☀️ 써니에게 문의\n\n📝 문의 내용:\n' + question + fileInfo + '\n\n✅ 문의가 접수되었습니다!\n관리자가 확인 후 답변을 드립니다.\n\n접수 시간: ' + new Date().toLocaleString('ko-KR') + '\n\n━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━\n\n' + currentContent;

                workspace.value = newContent;
                console.log('workspace에 내용 추가됨');

                // 문의창 및 파일 초기화
                document.getElementById('supportQuestion').value = '';
                document.getElementById('supportFile').value = '';
                supportFiles = [];
                document.getElementById('supportFileList').innerHTML = '';

                showStatus('✅ 문의가 접수되었습니다!', 'success');
                console.log('제출 완료');

            } catch (error) {
                console.error('문의 제출 실패:', error);
                alert('문의 제출 중 오류가 발생했습니다: ' + error.message);
            }
        }

        // 푸터에서 써니에게 묻기 클릭
        function openSunnySupport(event) {
            event.preventDefault();
            // 우측 사이드바로 스크롤
            const supportSection = document.querySelector('.sidebar-section');
            if (supportSection) {
                supportSection.scrollIntoView({ behavior: 'smooth', block: 'start' });
                // 문의 입력창 포커스
                setTimeout(() => {
                    document.getElementById('supportQuestion').focus();
                }, 500);
            }
        }

        // Supabase Realtime으로 답변 도착 감지 및 표시
        // TODO: 실제 구현 시 활성화
        /*
        const supabase = createClient(SUPABASE_URL, SUPABASE_KEY);

        // 답변 실시간 구독
        const channel = supabase
            .channel('support-answers')
            .on(
                'postgres_changes',
                {
                    event: 'UPDATE',
                    schema: 'public',
                    table: 'support_requests',
                    filter: `user_id=eq.${currentUser.id}`
                },
                (payload) => {
                    if (payload.new.answered_at) {
                        displaySupportResponse(
                            payload.new.question_text,
                            payload.new.answer_text,
                            payload.new.answered_at
                        );
                    }
                }
            )
            .subscribe();
        */

        // 관리자 답변 표시 (Realtime으로 자동 호출됨)
        function displaySupportResponse(question, answer, answeredAt) {
            const workspace = document.getElementById('textEditor');

            // AI Q&A와 동일한 형식으로 답변 표시
            workspace.value = `☀️ 써니의 답변\n\n📝 질문:\n${question}\n\n✅ 답변:\n${answer}\n\n답변 시간: ${new Date(answeredAt).toLocaleString('ko-KR')}\n\n━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━\n\n${workspace.value}`;

            // 알림 표시
            showStatus('☀️ 써니님의 답변이 도착했습니다!', 'success', 3000);
        }

        // 페이지 로드 시 서버 상태 체크
        window.addEventListener('load', async () => {
            try {
                const response = await fetch('http://localhost:3030/ping');
                const result = await response.json();
                if (result.status === 'ok') {
                    showStatus('🟢 Inbox 서버 연결됨', 'success', 2000);
                }
            } catch (error) {
                showStatus('🔴 Inbox 서버 미실행', 'error', 2000);
            }
        });

        // ESC 키로 모달 닫기
        document.addEventListener('keydown', (e) => {
            if (e.key === 'Escape') {
                const gridModal = document.getElementById('gridFullscreenModal');
                const translationModal = document.getElementById('translationFullviewModal');
                const addProjectModal = document.getElementById('addProjectModal');

                if (gridModal.classList.contains('active')) {
                    closeGridFullscreen();
                }
                if (translationModal.classList.contains('active')) {
                    closeTranslationFullview();
                }
                if (addProjectModal.classList.contains('active')) {
                    closeAddProjectModal();
                }
            }
        });

        // 프로젝트 그리드 전체화면 열기
        function openGridFullscreen() {
            const modal = document.getElementById('gridFullscreenModal');
            const gridContent = document.querySelector('.workspace-bottom .grid-content');
            const fullscreenContent = document.getElementById('fullscreenGridContent');

            // 그리드 콘텐츠 복사
            fullscreenContent.innerHTML = gridContent.innerHTML;

            // 모달 표시
            modal.classList.add('active');
            document.body.style.overflow = 'hidden';
        }

        // 프로젝트 그리드 전체화면 닫기
        function closeGridFullscreen() {
            const modal = document.getElementById('gridFullscreenModal');
            modal.classList.remove('active');
            document.body.style.overflow = 'auto';
        }

        // 번역 전체보기 열기
        function openTranslationFullview() {
            const modal = document.getElementById('translationFullviewModal');
            const translatedText = document.getElementById('translatedText').textContent;
            const fullviewText = document.getElementById('fullviewTranslatedText');

            fullviewText.textContent = translatedText || '번역된 내용이 없습니다.';

            modal.classList.add('active');
            document.body.style.overflow = 'hidden';
        }

        // 번역 전체보기 닫기
        function closeTranslationFullview() {
            const modal = document.getElementById('translationFullviewModal');
            modal.classList.remove('active');
            document.body.style.overflow = 'auto';
        }

        // 2D/3D 뷰 전환
        function switchView(viewType) {
            const buttons = document.querySelectorAll('.view-btn');
            buttons.forEach(btn => {
                btn.classList.remove('active');
            });
            event.currentTarget.classList.add('active');

            // TODO: 실제 2D/3D 뷰 전환 로직 구현
            console.log('View switched to:', viewType);
        }

        // 매뉴얼 보기
        function openManual() {
            // PROJECT SAL GRID 매뉴얼 뷰어 열기
            window.open('manual.html', '_blank');
        }

        function openLearningViewer() {
            // 학습용 콘텐츠 뷰어 열기
            window.open('learning-viewer.html', '_blank');
        }

        // 학습용 콘텐츠 목록 (로컬 검색용)
        const LEARNING_CONTENTS = [
            { name: '1편 - Claude란 무엇인가', path: '부수적_고유기능/콘텐츠/학습용_Books/1. Claude&ClaudeCode사용법/1편_Claude란_무엇인가.md', category: 'Claude 사용법' },
            { name: '2편 - 프롬프트 엔지니어링 기초', path: '부수적_고유기능/콘텐츠/학습용_Books/1. Claude&ClaudeCode사용법/2편_프롬프트_엔지니어링_기초편_보강.md', category: 'Claude 사용법' },
            { name: '3편 - 프롬프트 엔지니어링 고급', path: '부수적_고유기능/콘텐츠/학습용_Books/1. Claude&ClaudeCode사용법/3편_프롬프트_엔지니어링_고급편_10개.md', category: 'Claude 사용법' },
            { name: '4편 - Claude Code 첫 만남', path: '부수적_고유기능/콘텐츠/학습용_Books/1. Claude&ClaudeCode사용법/4편_Claude_Code_첫_만남_수정.md', category: 'Claude 사용법' },
            { name: '5편 - Claude Code 직접 실행 기능', path: '부수적_고유기능/콘텐츠/학습용_Books/1. Claude&ClaudeCode사용법/5편_Claude_Code의_직접_실행_기능.md', category: 'Claude 사용법' },
            { name: '6편 - 자동화 워크플로우 구축', path: '부수적_고유기능/콘텐츠/학습용_Books/1. Claude&ClaudeCode사용법/6편_Claude_Code의_자동화_워크플로우_구축용_코드_생성_기능.md', category: 'Claude 사용법' },
            { name: '7편 - 서브 에이전트 이해', path: '부수적_고유기능/콘텐츠/학습용_Books/1. Claude&ClaudeCode사용법/7편_Claude_Code_서브_에이전트_이해.md', category: 'Claude 사용법' },
            { name: '8편 - 서브 에이전트 생성과 관리', path: '부수적_고유기능/콘텐츠/학습용_Books/1. Claude&ClaudeCode사용법/8편_Claude_Code_서브_에이전트_생성과_관리.md', category: 'Claude 사용법' },
            { name: '9편 - 서브 에이전트 기본 활용 패턴', path: '부수적_고유기능/콘텐츠/학습용_Books/1. Claude&ClaudeCode사용법/9편_Claude_Code_서브_에이전트의_기본_활용_패턴.md', category: 'Claude 사용법' },
            { name: '10편 - 서브 에이전트 개발분야 활용법', path: '부수적_고유기능/콘텐츠/학습용_Books/1. Claude&ClaudeCode사용법/10편_Claude Code 서브 에이전트의 개발분야 활용법.md', category: 'Claude 사용법' },
            { name: '11편 - 서브 에이전트 비개발분야 활용법', path: '부수적_고유기능/콘텐츠/학습용_Books/1. Claude&ClaudeCode사용법/11편_Claude Code 서브 에이전트의 비개발분야 활용법.md', category: 'Claude 사용법' },
            { name: '12편 - MCP 기초', path: '부수적_고유기능/콘텐츠/학습용_Books/1. Claude&ClaudeCode사용법/12편_MCP_기초_외부_서비스와_연결하기.md', category: 'Claude 사용법' },
            { name: '13편 - MCP 실전 활용법', path: '부수적_고유기능/콘텐츠/학습용_Books/1. Claude&ClaudeCode사용법/13편_MCP_실전_활용법_및_다른_AI_확장_시스템과의_비교.md', category: 'Claude 사용법' },
            { name: '14편 - API를 통한 AI 연동', path: '부수적_고유기능/콘텐츠/학습용_Books/1. Claude&ClaudeCode사용법/14편_API를_통한_AI_연동과_협업_여러_AI를_조화롭게_활용하기.md', category: 'Claude 사용법' },
            { name: '15편 - VS Code 완전 정복', path: '부수적_고유기능/콘텐츠/학습용_Books/1. Claude&ClaudeCode사용법/15편_VS_Code_완전_정복_초보자_필수_가이드.md', category: 'Claude 사용법' },
            { name: '16편 - Claude Code와 VS Code 결합 기초', path: '부수적_고유기능/콘텐츠/학습용_Books/1. Claude&ClaudeCode사용법/16편_Claude_Code와_VS_Code_결합_기초.md', category: 'Claude 사용법' },
            { name: '17편 - Claude Code와 VS Code 결합 심화', path: '부수적_고유기능/콘텐츠/학습용_Books/1. Claude&ClaudeCode사용법/17편_Claude_Code와_VS_Code_결합_심화.md', category: 'Claude 사용법' },
            { name: '18편 - Claude 토큰 사용료 구조', path: '부수적_고유기능/콘텐츠/학습용_Books/1. Claude&ClaudeCode사용법/18편_Claude 토큰 사용료 구조 및 최적화 방안.md', category: 'Claude 사용법' },
            { name: '19편 - 작업환경 최적화', path: '부수적_고유기능/콘텐츠/학습용_Books/1. Claude&ClaudeCode사용법/19편_작업환경_최적화_3개_최종.md', category: 'Claude 사용법' },
            { name: '20편 - 세션 기억 관리 완벽 가이드', path: '부수적_고유기능/콘텐츠/학습용_Books/1. Claude&ClaudeCode사용법/20편_Claude_Code_세션_기억_관리_완벽_가이드.md', category: 'Claude 사용법' },
            { name: 'Claude Code 설치 가이드', path: '부수적_고유기능/콘텐츠/학습용_Books/1. Claude&ClaudeCode사용법/Claude_Code_설치_단계별_가이드.md', category: 'Claude 사용법' },
            { name: 'Claude 파일 생성 기능 핵심 정리', path: '부수적_고유기능/콘텐츠/학습용_Books/1. Claude&ClaudeCode사용법/Claude 파일 생성 기능 - 혁신적 업데이트 핵심 정리.md', category: 'Claude 사용법' },
            { name: '1편 - 웹개발 핵심 개념 이해하기', path: '부수적_고유기능/콘텐츠/학습용_Books/2. 웹개발 기초지식/1편 웹개발 핵심 개념 & 용어 이해하기.md', category: '웹개발 기초' },
            { name: '2편 - 웹사이트 작동 원리와 구조', path: '부수적_고유기능/콘텐츠/학습용_Books/2. 웹개발 기초지식/2편 웹사이트가 작동하는 원리와 구조.md', category: '웹개발 기초' },
            { name: '3편 - 명령줄(CLI)와 개발 환경', path: '부수적_고유기능/콘텐츠/학습용_Books/2. 웹개발 기초지식/3편 명령줄(CLI)와 개발 환경 설정.md', category: '웹개발 기초' },
            { name: '4편 - 코드 에디터와 IDE', path: '부수적_고유기능/콘텐츠/학습용_Books/2. 웹개발 기초지식/4편 코드 에디터와 IDE 이해하기.md', category: '웹개발 기초' },
            { name: '5편 - HTML 이해하기', path: '부수적_고유기능/콘텐츠/학습용_Books/2. 웹개발 기초지식/5편 웹사이트 언어 HTML 이해하기.md', category: '웹개발 기초' },
            { name: '6편 - CSS 웹사이트 스타일링', path: '부수적_고유기능/콘텐츠/학습용_Books/2. 웹개발 기초지식/6편 CSS - 웹사이트 스타일링 원리.md', category: '웹개발 기초' },
            { name: '7편 - JavaScript 기초', path: '부수적_고유기능/콘텐츠/학습용_Books/2. 웹개발 기초지식/7편 JavaScript - 웹사이트에 생명을 불어넣기.md', category: '웹개발 기초' },
            { name: '8편 - Git과 GitHub', path: '부수적_고유기능/콘텐츠/학습용_Books/2. 웹개발 기초지식/8편-Git과-GitHub.md', category: '웹개발 기초' },
            { name: '9편 - 라이브러리와 프레임워크', path: '부수적_고유기능/콘텐츠/학습용_Books/2. 웹개발 기초지식/9편-라이브러리와-프레임워크.md', category: '웹개발 기초' },
            { name: '10편 - 패키지 관리와 빌드 도구', path: '부수적_고유기능/콘텐츠/학습용_Books/2. 웹개발 기초지식/10편-패키지-관리와-빌드-도구.md', category: '웹개발 기초' },
            { name: '11편 - 백엔드 기초와 Node.js', path: '부수적_고유기능/콘텐츠/학습용_Books/2. 웹개발 기초지식/11편-백엔드-기초와-Node.js.md', category: '웹개발 기초' },
            { name: '12편 - 데이터베이스 기초', path: '부수적_고유기능/콘텐츠/학습용_Books/2. 웹개발 기초지식/12편-데이터베이스-기초.md', category: '웹개발 기초' },
            { name: '13편 - 데이터베이스 실무', path: '부수적_고유기능/콘텐츠/학습용_Books/2. 웹개발 기초지식/13편-데이터베이스-실무.md', category: '웹개발 기초' },
            { name: '14편 - API와 서버 통신', path: '부수적_고유기능/콘텐츠/학습용_Books/2. 웹개발 기초지식/14편.API와 서버 통신.md', category: '웹개발 기초' },
            { name: '15편 - 도메인과 호스팅', path: '부수적_고유기능/콘텐츠/학습용_Books/2. 웹개발 기초지식/15편-도메인과-호스팅.md', category: '웹개발 기초' },
            { name: '16편 - DevOps 기초', path: '부수적_고유기능/콘텐츠/학습용_Books/2. 웹개발 기초지식/16편-개발-워크플로우-자동화와-DevOps-기초.md', category: '웹개발 기초' },
            { name: '17편 - 웹 보안과 성능 최적화', path: '부수적_고유기능/콘텐츠/학습용_Books/2. 웹개발 기초지식/17편-웹-보안과-성능-최적화.md', category: '웹개발 기초' },
            { name: '18편 - SEO와 웹 접근성', path: '부수적_고유기능/콘텐츠/학습용_Books/2. 웹개발 기초지식/18편-SEO와-웹-접근성.md', category: '웹개발 기초' },
            { name: '19편 - 전체 개발 프로세스 통합 가이드', path: '부수적_고유기능/콘텐츠/학습용_Books/2. 웹개발 기초지식/19편-전체-개발-프로세스-통합-가이드.md', category: '웹개발 기초' },
            { name: '20편 - 종합 실습 프로젝트 Part1', path: '부수적_고유기능/콘텐츠/학습용_Books/2. 웹개발 기초지식/20편-종합-실습-프로젝트-Part1.md', category: '웹개발 기초' },
            { name: '21편 - 종합 실습 프로젝트 Part2', path: '부수적_고유기능/콘텐츠/학습용_Books/2. 웹개발 기초지식/21편-종합-실습-프로젝트-Part2.md', category: '웹개발 기초' },
            { name: '웹개발 용어 사전', path: '부수적_고유기능/콘텐츠/학습용_Books/2. 웹개발 기초지식/웹개발-용어-사전-빠른참조.md', category: '웹개발 기초' },
            { name: 'Inbox/Outbox JSON 시스템', path: '부수적_고유기능/콘텐츠/학습용_Books/3_프로젝트관리방법/Inbox_Outbox_JSON_시스템.md', category: 'AI 도구 활용' }
        ];

        // 로컬 검색 함수
        function searchLearningContentsLocal(query) {
            const resultsDiv = document.getElementById('learningSearchResults');

            if (!query || query.trim() === '') {
                resultsDiv.innerHTML = '';
                return;
            }

            const searchTerm = query.toLowerCase();
            const results = LEARNING_CONTENTS.filter(item =>
                item.name.toLowerCase().includes(searchTerm) ||
                item.category.toLowerCase().includes(searchTerm)
            );

            if (results.length === 0) {
                resultsDiv.innerHTML = '<div style="text-align: center; padding: 12px; color: #6c757d; font-size: 11px;">검색 결과가 없습니다</div>';
                return;
            }

            let html = '';
            results.forEach(item => {
                html += `
                    <div onclick="openLearningContent('${item.path}')" style="
                        padding: 10px 12px;
                        margin-bottom: 6px;
                        background: white;
                        border: 1px solid #dee2e6;
                        border-radius: 6px;
                        cursor: pointer;
                        transition: all 0.2s;
                    " onmouseover="this.style.borderColor='#667eea'; this.style.background='#f8f9ff';"
                       onmouseout="this.style.borderColor='#dee2e6'; this.style.background='white';">
                        <div style="font-size: 13px; font-weight: 600; color: #212529; margin-bottom: 2px;">${item.name}</div>
                        <div style="font-size: 11px; color: #6c757d;">📂 ${item.category}</div>
                    </div>
                `;
            });

            resultsDiv.innerHTML = `
                <div style="font-size: 11px; color: #667eea; margin-bottom: 8px; padding: 4px 0;">🔍 ${results.length}개 결과</div>
                ${html}
            `;
        }

        // 특정 콘텐츠 열기
        function openLearningContent(path) {
            window.open('learning-viewer.html?path=' + encodeURIComponent(path), '_blank');
        }

        // ================================================
        // FAQ & Tip 로컬 데이터 및 검색
        // ================================================

        // FAQ & Tip 콘텐츠 배열 (로컬 관리) - 실제 개발 경험 기반
        const FAQ_CONTENTS = [
            // ========== FAQ (15개) ==========
            // 회원/로그인
            { type: 'FAQ', category: '회원/로그인', question: 'Google OAuth Redirect URL 설정 문제', answer: 'Google 로그인 시 다른 사이트로 리다이렉트되면 Supabase Dashboard → Authentication → URL Configuration에서 Redirect URLs를 설정하세요. 개발환경: http://localhost:8888/**, 프로덕션: https://ssalworks.com/**' },
            { type: 'FAQ', category: '회원/로그인', question: '로그인 후 닉네임이 표시되지 않아요', answer: 'users 테이블에서 닉네임을 조회하는 로직이 필요합니다. checkAuthStatus() 함수에서 supabase.from("users").select("nickname")으로 닉네임을 가져와 표시하세요.' },
            { type: 'FAQ', category: '회원/로그인', question: '비밀번호 재설정 이메일이 안 와요', answer: '스팸 메일함을 확인하세요. 발신자: noreply@mail.app.supabase.io입니다. 계속 안 오면 Resend API 설정을 확인하세요.' },

            // 구독/결제
            { type: 'FAQ', category: '구독/결제', question: '토스 페이먼트 빌링키 설정', answer: '프로토타입은 더미 빌링키(test_billing_key_001) 사용 중입니다. 본개발 시 토스 가맹점 등록(1-2주), 빌링키 발급 API, 자동결제 API 연동이 필요합니다.' },
            { type: 'FAQ', category: '구독/결제', question: '구독 상태 관리 방법', answer: 'users 테이블의 subscription_status 컬럼 사용: active(정상), paused(일시정지), cancelled(해지), expired(만료). 마이페이지 > 구독 정보에서 관리합니다.' },
            { type: 'FAQ', category: '구독/결제', question: 'PG 이용약관 동의 구현', answer: '결제 시 전자금융거래 이용약관, 개인정보 제3자 제공 동의 체크박스가 법적 필수입니다. 프로토타입에는 미구현, 본개발 시 추가 필요합니다.' },

            // 크레딧
            { type: 'FAQ', category: '크레딧', question: '크레딧 사용처와 충전 방법', answer: 'AI 질문(1크레딧), 코드 생성(3-5크레딧), 문서 자동화(2크레딧). 마이페이지 > 크레딧 관리에서 카드 결제로 충전. 유효기간: 충전일로부터 1년.' },
            { type: 'FAQ', category: '크레딧', question: 'API 키 보안 관리', answer: 'API 키는 절대 코드에 하드코딩하지 마세요. 환경변수(process.env)로 관리하고, .env 파일은 .gitignore에 추가하세요. SERVICE_ROLE_KEY는 서버에서만 사용!' },

            // Claude Code
            { type: 'FAQ', category: 'Claude Code', question: 'Claude Code 설치 오류 해결', answer: 'Node.js 18 이상 필수! npm install -g @anthropic-ai/claude-code로 설치. 권한 오류 시 sudo 사용(Mac/Linux). API 키는 console.anthropic.com에서 발급.' },
            { type: 'FAQ', category: 'Claude Code', question: 'MCP 서버 설정 방법', answer: 'claude mcp add [서버명]으로 추가. 자주 사용: @modelcontextprotocol/server-filesystem(파일), server-memory(세션 기억), server-github(GitHub 연동).' },
            { type: 'FAQ', category: 'Claude Code', question: '세션이 끊어졌을 때 작업 복구', answer: '"이전 작업 이어서 해줘"라고 말하면 Claude Code가 이전 대화를 기억합니다. SSAL Works는 .claude/work_logs/current.md에 작업 로그가 저장되어 있어 더 정확한 복구가 가능합니다.' },

            // 기술지원
            { type: 'FAQ', category: '기술지원', question: 'Supabase RLS 정책 오류', answer: 'INSERT/UPDATE/DELETE 권한 오류는 RLS 정책 때문입니다. 개발용 _dev.sql은 anon 허용, 프로덕션은 authenticated만 허용. 배포 전 반드시 프로덕션 정책으로 교체!' },
            { type: 'FAQ', category: '기술지원', question: '환경변수 설정 순서', answer: '1순위: Supabase(URL, ANON_KEY), 2순위: Google OAuth, 3순위: 토스 페이먼트, 4순위: Resend. 클라이언트용(공개가능)과 서버용(비공개)을 구분하세요.' },
            { type: 'FAQ', category: '기술지원', question: 'Production vs Prototype 폴더 차이', answer: 'Production: 실제 배포용, Prototype: 개발/테스트용. OAuth Redirect URL 등 경로 설정 시 혼동 주의! 실제 오류 사례: Prototype 경로로 설정되어 Google 로그인 실패.' },
            { type: 'FAQ', category: '기술지원', question: '로컬 서버 실행 방법', answer: 'file:// 프로토콜로는 OAuth 작동 안 함! npx serve . -l 8888로 로컬 서버 실행 후 http://localhost:8888에서 테스트하세요.' },

            // ========== Tip (15개) ==========
            // Claude Code 활용
            { type: 'Tip', category: 'Claude Code 활용', question: 'CLAUDE.md로 프로젝트 컨텍스트 설정하기', answer: '💡 프로젝트 루트에 CLAUDE.md 파일을 만들어 프로젝트 규칙, 디렉토리 구조, 주의사항을 적어두세요. Claude Code가 자동으로 읽어 더 정확한 작업을 수행합니다.' },
            { type: 'Tip', category: 'Claude Code 활용', question: 'work_logs로 세션 연속성 유지하기', answer: '💡 .claude/work_logs/current.md에 작업 내용을 기록하면 세션이 끊어져도 "work_logs 확인하고 이어서 해줘"로 복구할 수 있습니다. 50KB 초과 시 자동 아카이브됩니다.' },
            { type: 'Tip', category: 'Claude Code 활용', question: '서브에이전트 효과적으로 활용하기', answer: '💡 backend-developer, frontend-developer, code-reviewer 등 서브에이전트를 활용하세요. 작업자와 검증자를 분리하면 품질이 향상됩니다.' },
            { type: 'Tip', category: 'Claude Code 활용', question: 'Slash Commands 활용하기', answer: '💡 .claude/commands/ 폴더에 커스텀 명령어를 만들 수 있습니다. /commit, /review, /test 등 자주 사용하는 작업을 명령어로 만들어두면 효율적입니다.' },

            // SAL Grid 활용
            { type: 'Tip', category: 'SAL Grid 활용', question: 'Task를 작게 나누는 기준', answer: '💡 하나의 Task는 2시간 이내에 완료할 수 있는 크기로! 너무 크면 진행 파악이 어렵고, 너무 작으면 관리 오버헤드가 커집니다. 예: "회원인증 시스템" → 회원가입 API, 로그인 API, OAuth API로 분리.' },
            { type: 'Tip', category: 'SAL Grid 활용', question: 'Phase Gate 검증 체크리스트', answer: '💡 Phase 완료 시 필수 검증: 1) Task ID 주석 있음 2) 테스트 80% 이상 통과 3) 린트 오류 없음 4) 문서 업데이트. 검증 결과는 stage-gates/ 폴더에 저장.' },
            { type: 'Tip', category: 'SAL Grid 활용', question: 'Task ID로 파일 관리하기', answer: '💡 모든 파일 첫 줄에 Task ID 주석을 넣으세요. /* Task ID: S2BA1 */ 형식으로. 나중에 어떤 작업에서 만든 파일인지 추적하기 쉽습니다.' },
            { type: 'Tip', category: 'SAL Grid 활용', question: '검증 완료 후 문서화하기', answer: '💡 작업 → 검증 → 문서화 → 보고 순서! outbox에 {task_id}_completed.json, {task_id}_verification.json 저장을 잊지 마세요.' },

            // 효율적인 질문법
            { type: 'Tip', category: '효율적인 질문법', question: '구체적으로 질문하는 방법', answer: '💡 "안 돼요" 대신 구체적으로! 1) 무엇을 하려 했는가 2) 실제로 무슨 일이 일어났는가 3) 오류 메시지 4) 파일 위치. 브라우저 콘솔(F12)에서 오류 확인 필수!' },
            { type: 'Tip', category: '효율적인 질문법', question: '코드 블록 활용하기', answer: '💡 코드 공유 시 ```javascript 처럼 언어 태그와 함께 코드 블록으로 감싸세요. 문법 강조가 되어 가독성이 좋아지고, 복사도 쉬워집니다.' },
            { type: 'Tip', category: '효율적인 질문법', question: '단계별로 요청하기', answer: '💡 한 번에 큰 작업보다 작은 단계로 나눠서 요청하세요. 중간에 방향 수정이 쉽고, 각 단계별로 검증할 수 있습니다. "먼저 API 설계해줘" → "구현해줘" → "테스트해줘"' },

            // 개발 생산성
            { type: 'Tip', category: '개발 생산성', question: 'Git 커밋 메시지 작성법', answer: '💡 Conventional Commits 형식: feat(새기능), fix(버그수정), docs(문서), refactor(리팩토링). 예: "feat: Google OAuth 로그인 구현". Claude Code에게 "커밋해줘"라고 하면 자동 작성!' },
            { type: 'Tip', category: '개발 생산성', question: '파일 저장 위치 확인하기', answer: '💡 파일 생성 전 PROJECT_DIRECTORY_STRUCTURE.md 확인 필수! Stage+Area 기반으로 저장 (S2BA1 → S2_개발-1차/Backend_API/). 모르겠으면 Claude Code에게 물어보세요.' },
            { type: 'Tip', category: '개발 생산성', question: '환경변수 관리 베스트 프랙티스', answer: '💡 .env.example(템플릿, Git 커밋), .env.local(실제 값, Git 무시). Vercel에서는 Dashboard > Environment Variables에서 환경별로 설정. SECRET_KEY는 절대 클라이언트 노출 금지!' },
            { type: 'Tip', category: '개발 생산성', question: 'Supabase 쿼리 최적화', answer: '💡 select("*") 대신 필요한 컬럼만! 페이지네이션(.range(0,9)), 서버 필터링(.eq("status","active")) 활용. 자주 검색하는 컬럼에 인덱스 추가하면 성능 향상.' }
        ];

        // FAQ 로컬 검색 함수
        function searchFaqLocal(query) {
            const resultsDiv = document.getElementById('faqSearchResults');

            if (!query || query.trim() === '') {
                resultsDiv.innerHTML = '';
                return;
            }

            const searchTerm = query.toLowerCase();
            const results = FAQ_CONTENTS.filter(item =>
                item.question.toLowerCase().includes(searchTerm) ||
                item.answer.toLowerCase().includes(searchTerm) ||
                item.category.toLowerCase().includes(searchTerm)
            );

            if (results.length === 0) {
                resultsDiv.innerHTML = '<div style="text-align: center; padding: 12px; color: #6c757d; font-size: 11px;">검색 결과가 없습니다</div>';
                return;
            }

            let html = '';
            results.forEach((item, index) => {
                html += `
                    <div onclick="showFaqAnswer(${index}, '${searchTerm}')" style="
                        padding: 10px 12px;
                        margin-bottom: 6px;
                        background: white;
                        border: 1px solid #dee2e6;
                        border-radius: 6px;
                        cursor: pointer;
                        transition: all 0.2s;
                    " onmouseover="this.style.borderColor='#F59E0B'; this.style.background='#fffbeb';"
                       onmouseout="this.style.borderColor='#dee2e6'; this.style.background='white';">
                        <div style="font-size: 13px; font-weight: 600; color: #212529; margin-bottom: 2px;">${item.question}</div>
                        <div style="font-size: 11px; color: #6c757d;">📂 ${item.category}</div>
                    </div>
                `;
            });

            resultsDiv.innerHTML = `
                <div style="font-size: 11px; color: #F59E0B; margin-bottom: 8px; padding: 4px 0;">🔍 ${results.length}개 결과</div>
                ${html}
            `;
        }

        // FAQ 답변 모달 표시
        function showFaqAnswer(index, searchTerm) {
            const item = FAQ_CONTENTS.filter(faq =>
                faq.question.toLowerCase().includes(searchTerm) ||
                faq.answer.toLowerCase().includes(searchTerm) ||
                faq.category.toLowerCase().includes(searchTerm)
            )[index];

            if (!item) return;

            // 모달 생성
            const overlay = document.createElement('div');
            overlay.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: rgba(0, 0, 0, 0.5);
                z-index: 10000;
                display: flex;
                align-items: center;
                justify-content: center;
            `;

            const modal = document.createElement('div');
            modal.style.cssText = `
                background: white;
                border-radius: 12px;
                max-width: 500px;
                width: 90%;
                max-height: 80vh;
                overflow-y: auto;
                box-shadow: 0 10px 40px rgba(0, 0, 0, 0.2);
            `;

            modal.innerHTML = `
                <div style="padding: 20px; border-bottom: 1px solid #dee2e6;">
                    <div style="font-size: 11px; color: #F59E0B; margin-bottom: 8px;">📂 ${item.category}</div>
                    <h3 style="margin: 0; font-size: 18px; color: #212529;">
                        🙋 ${item.question}
                    </h3>
                </div>
                <div style="padding: 20px; line-height: 1.7; color: #495057; font-size: 14px;">
                    ${item.answer}
                </div>
                <div style="padding: 16px 20px; border-top: 1px solid #dee2e6; text-align: right;">
                    <button onclick="this.closest('div').parentElement.parentElement.remove()"
                            style="padding: 8px 20px; background: #6c757d; color: white; border: none; border-radius: 6px; cursor: pointer; font-size: 14px;">
                        닫기
                    </button>
                </div>
            `;

            overlay.appendChild(modal);
            overlay.onclick = (e) => {
                if (e.target === overlay) {
                    overlay.remove();
                }
            };

            document.body.appendChild(overlay);
        }

        // FAQ & Tip 전체 보기 (모달)
        function openFaqViewer() {
            // 카테고리별로 그룹화
            const faqItems = FAQ_CONTENTS.filter(item => item.type === 'FAQ');
            const tipItems = FAQ_CONTENTS.filter(item => item.type === 'Tip');

            const faqByCategory = {};
            faqItems.forEach(item => {
                if (!faqByCategory[item.category]) faqByCategory[item.category] = [];
                faqByCategory[item.category].push(item);
            });

            const tipByCategory = {};
            tipItems.forEach(item => {
                if (!tipByCategory[item.category]) tipByCategory[item.category] = [];
                tipByCategory[item.category].push(item);
            });

            // 모달 생성
            const overlay = document.createElement('div');
            overlay.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: rgba(0, 0, 0, 0.6);
                z-index: 10000;
                display: flex;
                align-items: center;
                justify-content: center;
            `;

            const modal = document.createElement('div');
            modal.style.cssText = `
                background: white;
                border-radius: 12px;
                width: 90%;
                max-width: 800px;
                max-height: 85vh;
                overflow-y: auto;
                box-shadow: 0 10px 40px rgba(0, 0, 0, 0.3);
            `;

            let faqHtml = '';
            Object.keys(faqByCategory).forEach(category => {
                faqHtml += `<div style="margin-bottom: 10px;">
                    <div style="font-weight: 600; color: #F59E0B; margin-bottom: 6px; font-size: 14px;">📂 ${category}</div>`;
                faqByCategory[category].forEach((item, idx) => {
                    faqHtml += `<div style="padding: 8px 12px; margin-bottom: 4px; background: #f8f9fa; border-radius: 6px; cursor: pointer; font-size: 13px;"
                        onclick="this.nextElementSibling.style.display = this.nextElementSibling.style.display === 'none' ? 'block' : 'none'">
                        ❓ ${item.question}
                    </div>
                    <div style="display: none; padding: 12px; margin-bottom: 8px; background: #fff3cd; border-radius: 6px; font-size: 13px; line-height: 1.6;">
                        ${item.answer.replace(/\n/g, '<br>')}
                    </div>`;
                });
                faqHtml += `</div>`;
            });

            let tipHtml = '';
            Object.keys(tipByCategory).forEach(category => {
                tipHtml += `<div style="margin-bottom: 10px;">
                    <div style="font-weight: 600; color: #10B981; margin-bottom: 6px; font-size: 14px;">📂 ${category}</div>`;
                tipByCategory[category].forEach((item, idx) => {
                    tipHtml += `<div style="padding: 8px 12px; margin-bottom: 4px; background: #f0fdf4; border-radius: 6px; cursor: pointer; font-size: 13px;"
                        onclick="this.nextElementSibling.style.display = this.nextElementSibling.style.display === 'none' ? 'block' : 'none'">
                        💡 ${item.question}
                    </div>
                    <div style="display: none; padding: 12px; margin-bottom: 8px; background: #d1fae5; border-radius: 6px; font-size: 13px; line-height: 1.6;">
                        ${item.answer.replace(/\n/g, '<br>')}
                    </div>`;
                });
                tipHtml += `</div>`;
            });

            modal.innerHTML = `
                <div style="padding: 20px; border-bottom: 1px solid #dee2e6; display: flex; justify-content: space-between; align-items: center;">
                    <h2 style="margin: 0; font-size: 20px; color: #212529;">🙋 FAQ & Tip 전체 보기</h2>
                    <button onclick="this.closest('div').parentElement.parentElement.remove()"
                            style="background: none; border: none; font-size: 24px; cursor: pointer; color: #6c757d;">&times;</button>
                </div>
                <div style="padding: 20px;">
                    <div style="display: flex; gap: 20px; margin-bottom: 10px;">
                        <button id="faqTabBtn" onclick="showFaqTab('faq')" style="flex: 1; padding: 10px; background: #F59E0B; color: white; border: none; border-radius: 6px; cursor: pointer; font-weight: 600;">
                            ❓ FAQ (${faqItems.length}개)
                        </button>
                        <button id="tipTabBtn" onclick="showFaqTab('tip')" style="flex: 1; padding: 10px; background: #e5e7eb; color: #374151; border: none; border-radius: 6px; cursor: pointer; font-weight: 600;">
                            💡 Tips (${tipItems.length}개)
                        </button>
                    </div>
                    <div id="faqTabContent" style="display: block;">
                        ${faqHtml}
                    </div>
                    <div id="tipTabContent" style="display: none;">
                        ${tipHtml}
                    </div>
                </div>
            `;

            overlay.appendChild(modal);
            overlay.onclick = (e) => {
                if (e.target === overlay) {
                    overlay.remove();
                }
            };

            document.body.appendChild(overlay);
        }

        // FAQ/Tip 탭 전환
        function showFaqTab(tab) {
            const faqContent = document.getElementById('faqTabContent');
            const tipContent = document.getElementById('tipTabContent');
            const faqBtn = document.getElementById('faqTabBtn');
            const tipBtn = document.getElementById('tipTabBtn');

            if (tab === 'faq') {
                faqContent.style.display = 'block';
                tipContent.style.display = 'none';
                faqBtn.style.background = '#F59E0B';
                faqBtn.style.color = 'white';
                tipBtn.style.background = '#e5e7eb';
                tipBtn.style.color = '#374151';
            } else {
                faqContent.style.display = 'none';
                tipContent.style.display = 'block';
                faqBtn.style.background = '#e5e7eb';
                faqBtn.style.color = '#374151';
                tipBtn.style.background = '#10B981';
                tipBtn.style.color = 'white';
            }
        }

        // Viewer 열기
        function openViewer() {
            // viewer.html 페이지 열기 (S0_Project-SSAL-Grid_생성 폴더)
            window.open('viewer.html', '_blank');
        }

        // 폴더 열기 함수 (비활성화됨 - 폴더 편집 안내 기능 제거)
        function openFolder(folderPath) {
            // 기능 제거됨 - 아무 동작 안 함
        }

        // Claude Code 소식 펼치기/접기
        function toggleClaudeNews(element) {
            const newsList = element.nextElementSibling;
            const arrow = element.querySelector('.knowledge-arrow');

            if (newsList.style.display === 'none') {
                newsList.style.display = 'block';
                arrow.textContent = '▼';
            } else {
                newsList.style.display = 'none';
                arrow.textContent = '▶';
            }
        }

        // 예시 Project 펼치기/접기
        function toggleExampleProjects() {
            const list = document.getElementById('exampleProjectsList');
            const arrow = document.getElementById('exampleProjectsArrow');

            if (list.style.display === 'none') {
                list.style.display = 'flex';
                arrow.textContent = '▼';
                // 안내문 표시
                showExampleProjectGuide();
            } else {
                list.style.display = 'none';
                arrow.textContent = '▶';
            }
        }

        // 예시 Project 안내문 표시
        function showExampleProjectGuide() {
            const popup = document.getElementById('guidePopup');
            const title = document.getElementById('guidePopupTitle');
            const content = document.getElementById('guidePopupContent');

            if (popup && title && content) {
                title.textContent = '📚 예시 Project 안내';
                content.innerHTML = `
                    <h2 style="color: var(--primary-dark); border-bottom: 2px solid var(--primary); padding-bottom: 8px;">📚 예시 Project 안내</h2>
                    <p style="margin-top: 16px; line-height: 1.8;">SSAL Works 개발자인 <strong>Sunny</strong>가 직접 진행한 3개 Project와 관련한 모든 문서 및 소스코드 파일을 열람하실 수 있습니다.</p>

                    <h3 style="margin-top: 24px; color: #333;">제공되는 예시 Project</h3>
                    <ul style="padding-left: 20px; line-height: 2;">
                        <li><strong>PoliticianFinder</strong> - AI 기반 정치인 평가 플랫폼</li>
                        <li><strong>SSAL Works</strong> - Claude Code를 활용한 SAL Grid 기반 풀스택
      웹사이트 개발 플랫폼</li>
                        <li><strong>HDH Fintech</strong> - HDH 핀테크 솔루션 운영 지원 플랫폼</li>
                    </ul>

                    <h3 style="margin-top: 24px; color: #333;">열람 방법</h3>
                    <p style="line-height: 1.8;">각 Project를 클릭하시면 <strong>Google Drive</strong>로 바로 연결됩니다.</p>

                    <div style="margin-top: 20px; padding: 12px 16px; background: #f0fdf4; border-radius: 8px; border-left: 4px solid var(--primary);">
                        <strong>💡 Tip:</strong> 자유롭게 참고하세요! 실제 작업을 시작하려면 "새로운 Project 등록" 버튼을 클릭하세요.
                    </div>
                `;
                popup.style.display = 'block';
            }
        }

        // 완료 프로젝트 펼치기/접기
        function toggleCompletedProjects() {
            const list = document.getElementById('completedProjectsList');
            const arrow = document.getElementById('completedProjectsArrow');

            if (list.style.display === 'none') {
                list.style.display = 'flex';
                arrow.textContent = '▼';
            } else {
                list.style.display = 'none';
                arrow.textContent = '▶';
            }
        }

        // 진행중 프로젝트 펼치기/접기
        function toggleCurrentProject() {
            const list = document.getElementById('currentProjectList');
            const arrow = document.getElementById('currentProjectArrow');

            if (list.style.display === 'none') {
                list.style.display = 'flex';
                arrow.textContent = '▼';
            } else {
                list.style.display = 'none';
                arrow.textContent = '▶';
            }
        }

        // 프로젝트 선택

        // 예시 프로젝트 보기
        function showExampleProject() {
            const workspace = document.getElementById('textEditor');
            
            workspace.value = `📚 SSAL Works (예시) 프로젝트

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

SSAL Works를 실제로 개발하면서 작성된 
모든 폴더와 파일을 그대로 저장해 놓았습니다.

참고용으로 자유롭게 둘러보세요!

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

📥 전체 파일 다운로드

Google Drive에서 프로젝트 전체를 다운로드하실 수 있습니다.

🔗 다운로드 링크: [준비 중]

※ 링크를 클릭하면 Google Drive 폴더가 열립니다.
   우측 상단 ⋮ 버튼 → "다운로드"를 클릭하면 
   ZIP 파일로 자동 압축되어 다운로드됩니다.

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

📂 포함 내용:

• 전체 프로젝트 디렉토리 구조
• 모든 Order Sheet
• 개발 과정 문서
• 작업 결과물
• 설정 파일

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

💡 TIP: 이 예시를 참고하여 
    자신만의 프로젝트를 시작해보세요!
`;
        }

        function selectProject(projectName) {
            const workspace = document.getElementById('textEditor');
            const projectConfig = PROJECT_CONFIGS[projectName];

            // 선택된 프로젝트 전역 변수에 저장
            currentSelectedProject = projectName;

            // 모든 프로젝트에서 selected 클래스 제거
            document.querySelectorAll('.project-list-item').forEach(item => {
                item.classList.remove('selected');
            });

            // 클릭된 프로젝트에 selected 클래스 추가
            event.currentTarget.classList.add('selected');

            workspace.value = `📋 Project: ${projectName}\n\n`;
            workspace.value += `⚠️ 프로젝트 설정 확인\n\n`;
            workspace.value += `1. ${projectName} 프로젝트의 Inbox/ 폴더가 설치되어 있는지 확인하세요\n`;
            workspace.value += `   경로: ${projectConfig.inboxPath}\n\n`;
            workspace.value += `2. Inbox/ 폴더가 있다면 아래에 Order Sheet를 작성하세요\n\n`;
            workspace.value += `3. 작성 완료 후 "Download Order Sheet" 버튼을 클릭하면\n`;
            workspace.value += `   자동으로 해당 프로젝트의 Inbox/에 저장됩니다\n\n`;
            workspace.value += `━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━\n\n`;
            workspace.value += `여기에 Order Sheet를 작성하세요:\n\n`;

            console.log('Selected project:', projectName, 'Inbox path:', projectConfig.inboxPath);
        }

        // 프로젝트 목록에 새 프로젝트 추가
        function addProjectToList(name) {
            const projectList = document.getElementById('projectList');

            const newProject = document.createElement('div');
            newProject.className = 'project-list-item';
            newProject.onclick = function () { selectProject(name); };

            newProject.innerHTML = `
                <span class="project-name">${name}</span>
                <span class="project-status">진행중</span>
            `;

            projectList.appendChild(newProject);
        }

        // 프로젝트 추가 모달 열기
        function openAddProjectModal() {
            // 진행 중인 프로젝트가 있는지 확인
            const projectItems = document.querySelectorAll('.project-list-item');
            let hasInProgress = false;

            projectItems.forEach(item => {
                const status = item.querySelector('.project-status');
                if (status && status.textContent === '진행중') {
                    hasInProgress = true;
                }
            });

            if (hasInProgress) {
                alert('⚠️ 이미 진행 중인 Project가 있습니다!\n\n현재 Project를 완료한 후 새로운 Project를 추가할 수 있습니다.');
                return;
            }

            const modal = document.getElementById('addProjectModal');
            modal.classList.add('active');
            document.body.style.overflow = 'hidden';
        }

        // 프로젝트 추가 모달 닫기
        function closeAddProjectModal() {
            const modal = document.getElementById('addProjectModal');
            modal.classList.remove('active');
            document.body.style.overflow = 'auto';

            // 폼 초기화
            document.getElementById('newProjectForm').reset();
        }

        // 프로젝트 완료 여부 확인 함수
        function isProjectCompleted() {
            // 모든 진행 프로세스의 완료율 확인
            const processItems = document.querySelectorAll('.process-major');
            let allCompleted = true;

            processItems.forEach(item => {
                const progress = item.getAttribute('data-progress');
                if (progress && parseInt(progress) < 100) {
                    allCompleted = false;
                }
            });

            return allCompleted;
        }

        // 새 프로젝트 추가 처리
        document.getElementById('newProjectForm')?.addEventListener('submit', async function (e) {
            e.preventDefault();

            const name = document.getElementById('projectName').value;
            const description = document.getElementById('projectDescription').value;

            if (!name) {
                alert('Project명을 입력해주세요!');
                return;
            }

            // 진행 중인 프로젝트가 있는지 확인
            const projectItems = document.querySelectorAll('.project-list-item');
            let hasInProgress = false;
            projectItems.forEach(item => {
                const status = item.querySelector('.project-status');
                if (status && status.textContent === '진행중') {
                    hasInProgress = true;
                }
            });

            if (hasInProgress) {
                // 현재 프로젝트의 개발이 완료되었는지 확인
                if (!isProjectCompleted()) {
                    alert('⚠️ 현재 Project의 개발이 완료되지 않았습니다!\n\n모든 진행 프로세스가 100%가 되어야 새로운 Project를 시작할 수 있습니다.\n현재 진행 중인 Project를 먼저 완료해주세요.');
                    return;
                }

                alert('⚠️ 진행 중인 Project가 이미 있습니다!\n\n한 번에 하나의 Project만 진행할 수 있습니다.\n현재 Project를 완료한 후 새로운 Project를 시작해주세요.\n\n💡 여러 Project를 동시에 진행하시려면 새로운 계정으로 로그인하세요.');
                return;
            }

            // Project 구조 생성 중 표시
            showStatus('🚀 표준 Project 구조 생성 중...', 'info');

            try {
                // 서버에 프로젝트 생성 요청
                const response = await fetch('http://localhost:3030/create-project', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        projectName: name,
                        projectPath: null  // 기본 경로 사용 (서버에서 결정)
                    })
                });

                const result = await response.json();

                if (result.success) {
                    // 프로젝트 목록에 추가
                    addProjectToList(name);

                    // 성공 안내 메시지를 에디터에 표시
                    const editor = document.getElementById('textEditor');
                    editor.value = `# ✅ 새로운 Project 생성 완료!

## Project 정보
- **Project명**: ${name}
- **생성 경로**: ${result.projectPath}
- **상태**: 진행중

---

## 🎉 생성된 표준 Project 구조

표준 Project 디렉토리가 자동으로 생성되었습니다!

### 📁 생성된 폴더 및 파일:

\`\`\`
${name}/
├── .claude/
│   └── CLAUDE.md               (Claude Code 프로젝트 설정)
│
├── P1_사업계획/
│   ├── 0-1_Vision_Mission/
│   ├── 0-2_Market_Analysis/
│   └── 0-3_Business_Model/
│
├── 1_기획/
│   ├── 1-1_Project_Plan/
│   ├── 1-2_UI_UX_Design/
│   └── 1-3_Database_Design/
│
├── 2_개발준비/
│   ├── 2-1_Tech_Stack/
│   ├── 2-2_Architecture/
│   ├── 2-3_Development_Setup/
│   └── 2-4_Project_Grid/
│
├── 3_개발/
│   ├── 3-1_Frontend/
│   ├── 3-2_Engines/
│   ├── 3-3_Authentication/
│   ├── 3-4_Backend_Infrastructure/
│   ├── 3-5_Backend_APIs/
│   ├── 3-6_Database/
│   ├── 3-7_External_Services/
│   ├── 3-8_Test/
│   ├── 3-9_Deployment/
│   └── 3-10_Stabilization/
│
├── 4_운영/
│   ├── 4-1_Monitoring/
│   ├── 4-2_Maintenance/
│   ├── 4-3_Backup/
│   └── 4-4_Security/
│
├── Web_ClaudeCode_Bridge/
│   ├── Inbox/                  (대시보드 → Claude Code)
│   ├── Outbox/                 (Claude Code → 대시보드)
│   ├── inbox_server.js
│   ├── package.json
│   └── .env.example
│
├── .gitignore
├── README.md
└── PROJECT_STRUCTURE.md
\`\`\`

---

## 💡 중요: 표준 구조는 자유롭게 수정 가능합니다!

위에 생성된 표준 프로젝트 구조는 **기본 템플릿**입니다.

### ✏️ 자유롭게 변경하세요:
- **폴더 추가/삭제**: 프로젝트 성격에 맞게 폴더를 추가하거나 불필요한 폴더를 삭제하세요
- **폴더 이름 변경**: 팀의 용어나 표준에 맞게 폴더명을 변경하세요
- **구조 재구성**: 프로젝트 규모와 복잡도에 따라 폴더 계층을 조정하세요
- **파일 수정**: README.md, GUIDE.md 등 모든 파일을 프로젝트에 맞게 수정하세요

**이 구조는 시작점일 뿐입니다!** 프로젝트의 특성과 팀의 워크플로우에 맞게 자유롭게 커스터마이징하세요.

---

## 🚀 다음 단계

### 1. 프로젝트 폴더로 이동
\`\`\`bash
cd "${result.projectPath}"
\`\`\`

### 2. Web_ClaudeCode_Bridge 설정
\`\`\`bash
cd Web_ClaudeCode_Bridge
npm install
\`\`\`

### 3. 환경 변수 설정
\`\`\`bash
cp .env.example .env
# .env 파일을 열어서 API 키 등을 설정하세요
\`\`\`

### 4. Inbox Server 시작
\`\`\`bash
node inbox_server.js
\`\`\`

### 5. Claude Code CLI 실행
프로젝트 루트 폴더에서:
\`\`\`bash
claude
\`\`\`

---

## 📬 Inbox/Outbox를 통한 Claude Code 대화

### Inbox (대시보드 → Claude Code)
이 대시보드에서 Order Sheet를 작성하고 "전송" 버튼을 누르면:
- \`Inbox/\` 폴더에 마크다운 파일로 저장됩니다
- Claude Code가 이 파일을 읽고 작업을 수행합니다

### Outbox (Claude Code → 대시보드)
Claude Code가 작업을 완료하면:
- 결과물을 \`Outbox/\` 폴더에 저장합니다
- 대시보드의 "📭 Outbox" 탭에서 확인할 수 있습니다

---

## 📚 참고 문서

각 폴더에는 다음 문서들이 자동 생성되어 있습니다:
- **README.md**: 해당 단계/카테고리의 목적과 개요
- **GUIDE.md**: 구체적인 작업 가이드 (소분류 폴더)
- **CLAUDE.md**: Claude Code 프로젝트 설정 (.claude/ 폴더)

---

## 🎯 지금 바로 시작하세요!

1. 왼쪽 사이드바에서 작업하려는 프로세스를 선택하세요
2. Order Sheet 템플릿이 자동으로 로드됩니다
3. 작업 내용을 작성하고 "Claude Code로 전송" 버튼을 클릭하세요
4. Claude Code가 자동으로 작업을 시작합니다!

**행운을 빕니다! 🚀**
`;

                    showStatus('✅ 프로젝트 생성 완료!', 'success');
                    closeAddProjectModal();

                } else {
                    throw new Error(result.error || '프로젝트 생성 실패');
                }

            } catch (error) {
                console.error('프로젝트 생성 오류:', error);
                showStatus(`❌ 프로젝트 생성 실패: ${error.message}`, 'error');
                alert(`프로젝트 생성 중 오류가 발생했습니다:\n\n${error.message}\n\n서버(inbox_server.js)가 실행 중인지 확인해주세요.`);
            }
        });

        // ==================== Service Introduction Modal ====================
        function openServiceIntro() {
            const modal = document.getElementById('serviceIntroModal');
            modal.classList.add('active');
            document.body.style.overflow = 'hidden';
        }

        function closeServiceIntro() {
            const modal = document.getElementById('serviceIntroModal');
            modal.classList.remove('active');
            document.body.style.overflow = 'auto';
        }

        // 우측 사이드바 학습용 콘텐츠로 스크롤
        function scrollToLearningContent() {
            const rightSidebar = document.querySelector('.right-sidebar');
            const learningSection = document.querySelector('.right-sidebar .sidebar-section h3');
            if (rightSidebar && learningSection) {
                // 학습용 콘텐츠 섹션 찾기 (📚 학습용 Books)
                const sections = rightSidebar.querySelectorAll('.sidebar-section');
                sections.forEach(section => {
                    const h3 = section.querySelector('h3');
                    if (h3 && h3.textContent.includes('학습용 Books')) {
                        section.scrollIntoView({ behavior: 'smooth', block: 'start' });
                    }
                });
            }
        }

        // 우측 사이드바 FAQ로 스크롤
        function scrollToFaq() {
            const rightSidebar = document.querySelector('.right-sidebar');
            if (rightSidebar) {
                const sections = rightSidebar.querySelectorAll('.sidebar-section');
                sections.forEach(section => {
                    const h3 = section.querySelector('h3');
                    if (h3 && h3.textContent.includes('FAQ')) {
                        section.scrollIntoView({ behavior: 'smooth', block: 'start' });
                    }
                });
            }
        }

        // ESC 키로 닫기
        document.addEventListener('keydown', (e) => {
            if (e.key === 'Escape') {
                closeGridFullscreen();
            }
        });

        // ==================== Multi-AI 질문 시스템 ====================

        // 현재 선택된 AI (기본값: chatgpt)
        let selectedAI = 'chatgpt';

        // AI 선택 함수
        function selectAI(aiType, event) {
            selectedAI = aiType;

            // 모든 버튼에서 active 클래스 제거
            document.querySelectorAll('.ai-selector-btn').forEach(btn => {
                btn.classList.remove('active');
            });

            // 클릭된 버튼에 active 클래스 추가
            if (event && event.target) {
                event.target.classList.add('active');
            }
        }

        // 크레딧 충전 함수
        function rechargeCredit() {
            const currentBalance = parseInt(document.getElementById('perplexityCreditBalance').textContent.replace(/,/g, ''));
            const rechargeAmount = prompt('충전할 금액을 입력하세요 (원):', '10000');

            if (rechargeAmount === null) {
                return; // 취소
            }

            const amount = parseInt(rechargeAmount);

            if (isNaN(amount) || amount <= 0) {
                alert('올바른 금액을 입력해주세요!');
                return;
            }

            // 크레딧 충전
            const newBalance = currentBalance + amount;
            document.getElementById('perplexityCreditBalance').textContent = newBalance.toLocaleString();

            showStatus(`✅ ₩${amount.toLocaleString()} 충전 완료! 현재 잔액: ₩${newBalance.toLocaleString()}`, 'success');
        }

        // AI에게 질문하기 (통합 함수)
        async function askAI() {
            const questionInput = document.getElementById('aiQuestion');
            const question = questionInput.value.trim();
            const button = event.target;
            const loadingDiv = document.getElementById('aiLoading');
            const loadingText = document.getElementById('aiLoadingText');

            if (!question) {
                alert('질문을 입력해주세요!');
                return;
            }

            // AI 이름 매핑
            const aiNames = {
                'chatgpt': 'ChatGPT',
                'gemini': 'Gemini',
                'perplexity': 'Perplexity'
            };

            // AI 아이콘 매핑
            const aiIcons = {
                'chatgpt': '💬',
                'gemini': '🔷',
                'perplexity': '🔍'
            };

            const aiName = aiNames[selectedAI];
            const aiIcon = aiIcons[selectedAI];

            // 버튼 비활성화 및 로딩 표시
            const originalButtonText = button.textContent;
            button.disabled = true;
            button.textContent = '⏳ 질문 중...';
            button.style.opacity = '0.6';
            button.style.cursor = 'not-allowed';

            // 로딩 메시지 표시 (제거됨 - 버튼에만 표시)
            // loadingText.textContent = `${aiName}에게 질문 중...`;
            // loadingDiv.style.display = "block";

            // showStatus(`${aiIcon} ${aiName}에게 질문 중...`, "info");

            try {
                const response = await fetch(`http://localhost:3031/ask-${selectedAI}`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ question })
                });

                const result = await response.json();

                if (result.success) {
                    // Workspace에 질문과 답변 표시
                    const workspace = document.getElementById('textEditor');
                    workspace.value = `${aiIcon} ${aiName}에게 질문:
${result.question}

✅ ${aiName}의 답변:
${result.answer}`;

                    // 질문 이력 저장 (localStorage)
                    saveQuestionHistory(aiName, aiIcon, result.question, result.answer);

                    // showStatus(`✅ ${aiName} 응답 완료!`, "success");
                    questionInput.value = '';
                } else {
                    alert(`❌ 오류: ${result.error}`);
                    // showStatus(`❌ ${aiName} 질문 실패`, "error");
                }
            } catch (error) {
                alert(`❌ ${aiName} 서버에 연결할 수 없습니다.\n\n${aiName} API 키를 설정했는지 확인하세요.`);
                // showStatus(`❌ ${aiName} 서버 연결 실패`, "error");
            } finally {
                // 로딩 메시지 숨기기 (제거됨)
                // loadingDiv.style.display = "none";

                // 버튼 복원
                button.disabled = false;
                button.textContent = originalButtonText;
                button.style.opacity = '1';
                button.style.cursor = 'pointer';
            }
        }

        // ==================== 질문 이력 기능 (localStorage) ====================

        // 질문 이력 저장
        function saveQuestionHistory(aiName, aiIcon, question, answer) {
            // 기존 이력 불러오기
            const history = getQuestionHistory();

            // 새 항목 추가 (최신 항목이 맨 위)
            const newItem = {
                date: new Date().toISOString(),
                ai: aiName,
                icon: aiIcon,
                question: question,
                answer: answer
            };

            history.unshift(newItem); // 맨 앞에 추가

            // 최대 50개까지만 저장
            if (history.length > 50) {
                history.pop();
            }

            // localStorage에 저장
            localStorage.setItem('ai_question_history', JSON.stringify(history));

            // 질문 이력 UI 업데이트
            if (document.getElementById('questionHistoryList').style.display !== 'none') {
                renderQuestionHistory();
            }
        }

        // 질문 이력 불러오기
        function getQuestionHistory() {
            const data = localStorage.getItem('ai_question_history');
            return data ? JSON.parse(data) : [];
        }

        // 질문 이력 모달 열기
        function openQuestionHistoryModal() {
            const history = getQuestionHistory();
            const modalList = document.getElementById('questionHistoryModalList');

            if (history.length === 0) {
                modalList.innerHTML = `
                    <div style="text-align: center; padding: 60px 20px; color: #6c757d;">
                        <div style="font-size: 48px; margin-bottom: 13px;">📋</div>
                        <div style="font-size: 18px; font-weight: 600; margin-bottom: 8px;">질문 / 답변 이력이 없습니다</div>
                        <div style="font-size: 14px;">AI에게 질문을 하면 질문과 답변이 이곳에 저장됩니다.</div>
                    </div>
                `;
            } else {
                modalList.innerHTML = history.map((item, index) => {
                    const date = new Date(item.date);
                    const dateStr = `${date.getFullYear()}-${String(date.getMonth() + 1).padStart(2, '0')}-${String(date.getDate()).padStart(2, '0')} ${String(date.getHours()).padStart(2, '0')}:${String(date.getMinutes()).padStart(2, '0')}`;

                    return `
                        <div class="outbox-file-item" style="display: block; cursor: default;">
                            <div style="display: flex; align-items: center; gap: 16px; margin-bottom: 10px;">
                                <div class="outbox-file-icon" style="font-size: 32px;">${item.icon}</div>
                                <div class="outbox-file-info" style="flex: 1;">
                                    <div class="outbox-file-name" style="font-size: 16px; font-weight: 700; color: var(--primary);">${item.ai}에게 질문한 이력</div>
                                    <div class="outbox-file-meta" style="font-size: 11px; color: #6c757d;">${dateStr}</div>
                                </div>
                                <button onclick="deleteHistoryItem(${index})"
                                    style="padding: 8px 16px; background: #dc3545; color: white; border: none; border-radius: 6px; font-size: 13px; font-weight: 600; cursor: pointer; transition: all 0.2s;">
                                    삭제
                                </button>
                            </div>
                            <div style="margin-bottom: 10px; padding: 15px; background: #f8f9fa; border-radius: 8px; border-left: 4px solid var(--primary);">
                                <div style="font-size: 13px; font-weight: 600; color: #495057; margin-bottom: 8px;">${item.ai}에게 질문:</div>
                                <div style="font-size: 14px; color: #212529; white-space: pre-wrap; line-height: 1.6;">${item.question}</div>
                            </div>
                            <div style="padding: 15px; background: #e3f2fd; border-radius: 8px; border-left: 4px solid #2196F3;">
                                <div style="font-size: 13px; font-weight: 600; color: #1565C0; margin-bottom: 8px;">${item.ai}의 답변:</div>
                                <div style="font-size: 14px; color: #212529; white-space: pre-wrap; line-height: 1.6;">${item.answer}</div>
                            </div>
                        </div>
                    `;
                }).join('');
            }

            // 모달 열기
            const modal = document.getElementById('questionHistoryModal');
            modal.classList.add('active');
            document.body.style.overflow = 'hidden';
        }

        // 질문 이력 모달 닫기
        function closeQuestionHistoryModal() {
            const modal = document.getElementById('questionHistoryModal');
            modal.classList.remove('active');
            document.body.style.overflow = 'auto';
        }

        // 질문 이력 삭제
        function deleteHistoryItem(index) {
            if (!confirm('이 질문 이력을 삭제하시겠습니까?')) return;

            const history = getQuestionHistory();
            history.splice(index, 1);
            localStorage.setItem('ai_question_history', JSON.stringify(history));

            // 모달이 열려있으면 다시 렌더링
            const modal = document.getElementById('questionHistoryModal');
            if (modal.classList.contains('active')) {
                openQuestionHistoryModal();
            }
        }

        // ==================== Outbox 알림 시스템 ====================

        // Outbox 알림 박스 표시
        function showOutboxNotification(fileCount, files) {
            const notification = document.getElementById('outboxNotification');
            const message = document.getElementById('outboxNotificationMessage');

            const filenames = files.map(f => f.filename).join(', ');
            message.textContent = `새 파일 ${fileCount}개: ${filenames}`;

            notification.style.display = 'block';

            // 10초 후 자동 숨김
            setTimeout(() => {
                closeOutboxNotification();
            }, 10000);
        }

        // Outbox 알림 박스 닫기
        function closeOutboxNotification() {
            const notification = document.getElementById('outboxNotification');
            notification.style.display = 'none';
        }

        // 알림 박스에서 "열기" 버튼 클릭
        function loadFromOutboxNotification() {
            closeOutboxNotification();
            loadFromOutbox();
        }

        // Outbox 파일 개수 추적
        let lastOutboxCount = 0;
        let outboxCheckerInterval = null;

        // Outbox 감시 시작
        async function startOutboxWatcher() {
            // 배포 환경에서는 실행하지 않음
            if (IS_PRODUCTION) return;

            try {
                // 초기 파일 개수 로드
                const response = await fetch(BRIDGE_SERVER_URL + '/outbox/files');
                const result = await response.json();
                if (result.success) {
                    lastOutboxCount = result.count;
                    console.log(`Outbox Watcher 시작 - 현재 파일 ${lastOutboxCount}개`);
                }
            } catch (error) {
                console.log('Outbox 서버 연결 실패 - 서버가 실행 중인지 확인하세요');
            }

            // 5초마다 Outbox 체크
            outboxCheckerInterval = setInterval(async () => {
                try {
                    const response = await fetch(BRIDGE_SERVER_URL + '/outbox/files');
                    const result = await response.json();

                    if (result.success && result.count > lastOutboxCount) {
                        const newFilesCount = result.count - lastOutboxCount;
                        const allNewFiles = result.files.slice(0, newFilesCount);

                        // _ack.json 파일은 알림에서 제외
                        const newFiles = allNewFiles.filter(file => !file.filename.includes('_ack.json'));

                        // 실제 알림할 파일이 있을 때만 콘솔 로그 표시
                        if (newFiles.length > 0) {
                            // 콘솔 로그만 표시 (알림 박스 제거)
                            console.log(`\n✨ Claude Code 작업 완료! 새 파일 ${newFiles.length}개 감지됨!`);
                            newFiles.forEach(file => {
                                console.log(`   📄 ${file.filename}`);
                            });
                            console.log(`\n👉 "Load from Outbox" 버튼을 클릭하세요!\n`);
                        }

                        lastOutboxCount = result.count;
                    }
                } catch (error) {
                    // 조용히 무시 (서버가 꺼져있을 수 있음)
                }
            }, 5000); // 5초마다 체크
        }

        // Outbox 감시 중지
        function stopOutboxWatcher() {
            if (outboxCheckerInterval) {
                clearInterval(outboxCheckerInterval);
                outboxCheckerInterval = null;
                console.log('📤 Outbox Watcher 중지됨');
            }
        }

        // 페이지 로드 시 자동 시작
        window.addEventListener('load', () => {
            startOutboxWatcher();
        });

        // 페이지 종료 시 감시 중지
        window.addEventListener('beforeunload', () => {
            stopOutboxWatcher();
        });

        // ============================================
        // Order 상태 추적 시스템
        // ============================================

        let orderStatusIntervals = {}; // Order ID별 polling interval 저장

        // Order 상태 추적 시작
        function startOrderStatusTracking(orderId) {
            console.log(`🔍 Order 상태 추적 시작: ${orderId}`);

            // 이미 추적 중이면 중지
            if (orderStatusIntervals[orderId]) {
                clearInterval(orderStatusIntervals[orderId]);
            }

            // 즉시 한 번 확인
            checkOrderStatus(orderId);

            // 3초마다 상태 확인
            orderStatusIntervals[orderId] = setInterval(() => {
                checkOrderStatus(orderId);
            }, 3000);
        }

        // Order 상태 확인
        async function checkOrderStatus(orderId) {
            try {
                const response = await fetch(`http://localhost:3030/order-status/${orderId}`);

                if (!response.ok) {
                    throw new Error(`Status check failed: ${response.status}`);
                }

                const result = await response.json();

                if (result.success) {
                    console.log(`📊 Order ${orderId} 상태:`, result.status);

                    // 상태에 따라 UI 업데이트
                    updateOrderStatus(orderId, result.status, result.message);

                    // 완료되면 polling 중지
                    if (result.status === '✅ 완료') {
                        stopOrderStatusTracking(orderId);

                        // 완료 알림
                        showStatus(`✅ Order ${orderId} 완료!`, 'success');

                        // 사용자에게 알림 (선택적)
                        if (Notification.permission === 'granted') {
                            new Notification('Order 완료!', {
                                body: `Order ${orderId}이(가) 완료되었습니다.`,
                                icon: '📬'
                            });
                        }
                    }
                }

            } catch (error) {
                console.error(`❌ Order ${orderId} 상태 확인 실패:`, error);
            }
        }

        // Order 상태 추적 중지
        function stopOrderStatusTracking(orderId) {
            if (orderStatusIntervals[orderId]) {
                clearInterval(orderStatusIntervals[orderId]);
                delete orderStatusIntervals[orderId];
                console.log(`⏹️  Order ${orderId} 상태 추적 중지`);
            }
        }

        // Order 상태 UI 업데이트
        function updateOrderStatus(orderId, status, message) {
            // Status 바에 표시 (#serverStatus 활용)
            const statusElement = document.querySelector('#serverStatus');
            if (statusElement) {
                statusElement.textContent = `📬 ${status} ${orderId}: ${message}`;
                statusElement.style.display = 'block';

                // 상태에 따라 색상 변경
                if (status === '✅ 완료') {
                    statusElement.style.background = 'linear-gradient(135deg, #667eea 0%, #764ba2 100%)';
                } else if (status === '⏳ 처리 중') {
                    statusElement.style.background = 'linear-gradient(135deg, #f093fb 0%, #f5576c 100%)';
                } else {
                    statusElement.style.background = 'linear-gradient(135deg, #4facfe 0%, #00f2fe 100%)';
                }
            }

            // Console에 로그
            console.log(`📬 ${orderId}: ${status} - ${message}`);
        }

        // 페이지 로드 시 알림 권한 요청 (선택적)
        if ('Notification' in window && Notification.permission === 'default') {
            Notification.requestPermission();
        }

    </script>

    <!-- Project SAL Grid Fullscreen Modal -->
    <div id="gridFullscreenModal" class="grid-fullscreen-modal">
        <div class="grid-fullscreen-header">
            <div class="grid-fullscreen-title">📋 Project SAL Grid - Full View</div>
            <div class="view-toggle">
                <button class="view-btn active" onclick="switchView('2d')">2D Card</button>
                <button class="view-btn" onclick="switchView('3d')">3D Block</button>
            </div>
            <button class="grid-fullscreen-close" onclick="closeGridFullscreen()">✕ 닫기</button>
        </div>
        <div class="grid-fullscreen-content" id="fullscreenGridContent">
            <!-- 그리드 콘텐츠가 여기에 복사됩니다 -->
        </div>
    </div>

    <!-- Translation Fullview Modal -->
    <div id="translationFullviewModal" class="grid-fullscreen-modal">
        <div class="grid-fullscreen-header">
            <div class="grid-fullscreen-title">🌐 English Translation - Full View</div>
            <button class="grid-fullscreen-close" onclick="closeTranslationFullview()">✕ 닫기</button>
        </div>
        <div class="grid-fullscreen-content" style="padding: 40px;">
            <pre id="fullviewTranslatedText"
                style="font-family: 'Consolas', 'Monaco', monospace; font-size: 14px; line-height: 1.8; color: #495057; white-space: pre-wrap; word-wrap: break-word;"></pre>
        </div>
    </div>

    <!-- Service Introduction Modal -->
    <div id="serviceIntroModal" class="grid-fullscreen-modal" style="background: #F3F4F6;">
        <!-- Navigation Bar -->
        <nav style="background: linear-gradient(135deg, #2C4A8A 0%, #1F3563 100%); padding: 0 32px; height: 70px; display: flex; justify-content: space-between; align-items: center; box-shadow: 0 4px 6px rgba(0,0,0,0.1);">
            <a href="#" onclick="closeServiceIntro(); return false;" style="display: flex; align-items: center; gap: 12px; text-decoration: none;">
                <div style="display: flex; align-items: center; gap: 3px; transform: rotate(-15deg);">
                    <span style="width: 10px; height: 18px; background: linear-gradient(135deg, #F59E0B 0%, #D97706 100%); border-radius: 40%; transform: rotate(-5deg);"></span>
                    <span style="width: 10px; height: 18px; background: linear-gradient(135deg, #F59E0B 0%, #D97706 100%); border-radius: 40%; transform: rotate(5deg); margin-top: 2px;"></span>
                    <span style="width: 10px; height: 18px; background: linear-gradient(135deg, #F59E0B 0%, #D97706 100%); border-radius: 40%; transform: rotate(-3deg); margin-top: -1px;"></span>
                </div>
                <span style="font-size: 28px; font-weight: 800; color: white;">SSAL Works</span>
            </a>
            <button onclick="closeServiceIntro()" style="padding: 10px 20px; background: #6B7280; color: white; border: none; border-radius: 8px; cursor: pointer; font-size: 14px; font-weight: 600; font-family: inherit; transition: all 0.2s;">✕ 닫기</button>
        </nav>
        <div class="grid-fullscreen-content" style="padding: 40px; max-width: 800px; margin: 0 auto; background: white; border-radius: 12px; box-shadow: 0 1px 3px rgba(0,0,0,0.1);">
            <div style="line-height: 1.8; color: #333;">
                <h1 style="font-size: 28px; margin-bottom: 16px; color: #1F3563;">SSAL Works Platform:
                    Claude Code를 활용한 SAL Grid 기반 풀스택 웹사이트 개발 실행 및 관리 플랫폼</h1>

                <blockquote
                    style="border-left: 4px solid #2C4A8A; padding-left: 16px; margin: 20px 0; color: #555; font-style: italic;">
                    "기술은 몰라도, 내 사이트는 내가 만든다."<br>
                    AI를 트랙터처럼 운전하며, 나만의 디지털 밭을 일구는 곳.
                </blockquote>

                <hr style="margin: 30px 0; border: 0; border-top: 1px solid #eee;">

                <h2 style="font-size: 20px; margin-bottom: 10px; color: #333;">1. SSAL Works(쌀웍스)란?</h2>
                <p style="margin-bottom: 16px;">
                    <strong>SSAL Works</strong>는 비개발자가 AI(Claude Code)를 활용하여 웹사이트를 직접 개발할 수 있도록 돕는
                    <strong>"Claude Code를 활용한 SAL Grid 기반 풀스택 웹사이트 개발 실행 및 관리 플랫폼"</strong>입니다.
                </p>

                <div style="background: #f8f9fa; padding: 20px; border-radius: 8px; margin-bottom: 30px;">
                    <h3 style="font-size: 16px; margin-bottom: 10px; color: #2C4A8A;">🌾 이름의 유래 (Etymology)</h3>
                    <p style="margin-bottom: 10px; font-weight: 600;">SSAL은 단순한 곡식이 아닙니다. 창립자 Sunny와 3차원 좌표계의 결합입니다.</p>
                    <ul style="padding-left: 20px; margin: 0;">
                        <li style="margin-bottom: 8px;"><strong>S</strong> (Sunny): 창립자이자 모든 사용자를 대변하는 페르소나</li>
                        <li style="margin-bottom: 8px;"><strong>SAL</strong> (Spatial Coordinates): 프로젝트를 관리하는 3차원 좌표
                            <ul style="margin-top: 4px; color: #666; font-size: 13px;">
                                <li><strong>S</strong> (Stage): X축 (단계)</li>
                                <li><strong>A</strong> (Area): Y축 (영역)</li>
                                <li><strong>L</strong> (Level): Z축 (작업 레벨)</li>
                            </ul>
                        </li>
                        <li><strong>Rice (쌀)</strong>: 한국인에게 밥심이 필요하듯, <strong>"디지털 창작의 주식(主食)"</strong>이 되겠다는 의지를
                            담았습니다. 로고의 쌀알 3개는 이 3차원 좌표(S, A, L)를 상징합니다.</li>
                    </ul>
                </div>

                <div style="background: #e3f5f8; padding: 20px; border-radius: 8px; margin-bottom: 30px;">
                    <h3 style="font-size: 16px; margin-bottom: 10px; color: #20808D;">🚀 확장성 (Scalability)</h3>
                    <p style="margin-bottom: 0;">
                        SSAL Works는 <strong>"작업(Works)을 하는 공간"</strong>입니다. 현재는 웹사이트 개발(<strong>v1.0</strong>)에 집중하고 있지만,
                        이 PROJECT SAL Grid 시스템은 모든 프로젝트에 적용 가능합니다.
                        <br>
                        (예: 회계 감사, 책 집필, 다양한 프로젝트 관리 등)
                    </p>
                </div>

                <h2 style="font-size: 20px; margin-bottom: 10px; color: #333;">2. 핵심 철학: "머슬 메모리(Muscle Memory)의 외주화"
                </h2>
                <ul style="padding-left: 20px; margin-bottom: 30px;">
                    <li style="margin-bottom: 8px;"><strong>기존의 문제</strong>: 개발을 하려면 수많은 단축키, 문법, 툴 사용법을 손가락이 기억할 때까지
                        익혀야 했습니다. (높은 진입장벽)</li>
                    <li><strong>SSAL Works의 해답</strong>:
                        <ul style="margin-top: 4px; color: #555;">
                            <li>기술적인 <strong>"근육 기억(Muscle Memory)"</strong>은 AI(Claude Code)에게 전적으로 맡깁니다.</li>
                            <li>사용자는 <strong>"무엇을 만들 것인가(What to Build)"</strong>라는 본질적인 <strong>기획과 지시</strong>에만
                                집중합니다.</li>
                        </ul>
                    </li>
                </ul>

                <h2 style="font-size: 20px; margin-bottom: 10px; color: #333;">3. SSAL Works의 4대 핵심 기능</h2>
                <p style="margin-bottom: 16px;"><strong>실행이 가장 핵심입니다.</strong> 화면은 4분할되어 각 기능을 담당합니다.</p>

                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 30px;">
                    <div style="border: 2px solid #2C4A8A; padding: 15px; border-radius: 8px; background: #EEF2F7;">
                        <h3 style="font-size: 16px; margin-bottom: 8px; color: #1F3563;">1. 실행 (Execution) 🛠️</h3>
                        <p style="font-size: 13px; color: #666; margin-bottom: 8px;"><strong>② 중앙 Workspace "작업대"</strong></p>
                        <p style="font-size: 13px; color: #666;">
                            <strong>SSAL Works의 가장 핵심 기능입니다.</strong><br>
                            Order Sheet로 Claude Code에게 작업 지시 → AI가 실제 코드 작성/수정.<br>
                            Inbox/Outbox로 소통.
                        </p>
                    </div>
                    <div style="border: 1px solid #eee; padding: 15px; border-radius: 8px;">
                        <h3 style="font-size: 16px; margin-bottom: 8px; color: #333;">2. 관리 (Management) 🗺️🏗️</h3>
                        <p style="font-size: 13px; color: #666; margin-bottom: 8px;"><strong>① 좌측 사이드바 + ③ 하단 Grid</strong></p>
                        <p style="font-size: 13px; color: #666;">
                            프로젝트 네비게이션 + PROJECT SAL Grid.<br>
                            Stage(X)-Area(Y)-Level(Z)의 3차원 블록으로 Task 관리.
                        </p>
                    </div>
                    <div style="border: 1px solid #eee; padding: 15px; border-radius: 8px;">
                        <h3 style="font-size: 16px; margin-bottom: 8px; color: #333;">3. 학습 (Learning) 🎓</h3>
                        <p style="font-size: 13px; color: #666; margin-bottom: 8px;"><strong>④ 우측 사이드바 상단</strong></p>
                        <p style="font-size: 13px; color: #666;">
                            Books + FAQ + AI Q&A (ChatGPT, Gemini, Perplexity).<br>
                            프로젝트를 진행하면서 학습.
                        </p>
                    </div>
                    <div style="border: 1px solid #eee; padding: 15px; border-radius: 8px;">
                        <h3 style="font-size: 16px; margin-bottom: 8px; color: #333;">4. 멘토링 (Mentoring) 👨‍🏫</h3>
                        <p style="font-size: 13px; color: #666; margin-bottom: 8px;"><strong>④ 우측 사이드바 하단</strong></p>
                        <p style="font-size: 13px; color: #666;">
                            써니에게 묻기 - CPA + 엑셀러레이터의 비즈니스 자문.<br>
                            Human 멘토가 실시간으로 문제 해결.
                        </p>
                    </div>
                </div>

                <h2 style="font-size: 20px; margin-bottom: 10px; color: #333;">4. 왜 SSAL Works인가?</h2>
                <ul style="padding-left: 20px; margin-bottom: 30px;">
                    <li style="margin-bottom: 10px;"><strong>✅ DB 없는 가벼움</strong>: "내 컴퓨터가 곧 서버다." 복잡한 DB 설치 없이 폴더와
                        파일만으로 작동합니다.</li>
                    <li style="margin-bottom: 10px;"><strong>✅ 실패 없는 가이드</strong>: 막막한 흰 화면은 없습니다. 단계별 템플릿이 전문가 수준의 결과물로
                        인도합니다.</li>
                    <li><strong>✅ 강력한 동기부여</strong>: "당신의 성공이 우리의 목표입니다." 성공 시 50% 환불 정책으로 완주를 응원합니다.</li>
                </ul>

                <div
                    style="text-align: center; margin-top: 40px; padding: 20px; background: #f1f3f5; border-radius: 8px;">
                    <p style="font-weight: 600; color: #1F3563; margin: 0;">SSAL Works Platform<br><span
                            style="font-weight: 400; font-size: 14px; color: #666;">"기술은 몰라도, 내 사이트는 내가 만든다"<br>
                            <strong>AI 기반 웹사이트 개발 프로젝트 실행 및 관리 플랫폼</strong>입니다.</span></p>
                </div>
            </div>
        </div>
    </div>

    <!-- 안내문 드래그 가능 팝업 -->
    <div id="guidePopup" style="display: none; position: fixed; top: 80px; right: 50px; width: 748px; max-height: calc(100vh - 150px); background: white; border-radius: 12px; box-shadow: 0 8px 32px rgba(0,0,0,0.25); z-index: 1000; overflow: hidden; font-family: 'Malgun Gothic', '맑은 고딕', 'Apple SD Gothic Neo', 'Noto Sans KR', sans-serif;">
        <div id="guidePopupHeader" style="background: linear-gradient(135deg, var(--tertiary) 0%, var(--tertiary-dark) 100%); color: white; padding: 12px 16px; cursor: move; display: flex; justify-content: space-between; align-items: center; user-select: none;">
            <span id="guidePopupTitle" style="font-weight: 700; font-size: 14px;">📖 안내문</span>
            <button onclick="closeGuidePopup()" style="background: none; border: none; color: white; font-size: 18px; cursor: pointer; padding: 0 4px;">&times;</button>
        </div>
        <div id="guidePopupContent" style="padding: 20px; max-height: calc(100vh - 210px); overflow-y: auto; font-size: 11px; font-weight: 400; line-height: 1.6; color: #212529;">
            <!-- 안내문 내용이 여기에 로드됩니다 -->
        </div>
    </div>

    <!-- Add New Project Modal -->
    <div id="addProjectModal" class="grid-fullscreen-modal">
        <div class="grid-fullscreen-header">
            <div class="grid-fullscreen-title"><span style="color: #10B981; font-weight: 600;">➕</span> 새로운 Project 등록
            </div>
            <button class="grid-fullscreen-close" onclick="closeAddProjectModal()">✕ 닫기</button>
        </div>
        <div class="grid-fullscreen-content" style="padding: 40px; max-width: 600px; margin: 0 auto;">
            <form id="newProjectForm" style="display: flex; flex-direction: column; gap: 20px;">
                <div>
                    <label style="display: block; margin-bottom: 8px; font-weight: 600; color: #495057;">프로젝트명</label>
                    <input type="text" id="projectName" placeholder="예: My Awesome Project"
                        style="width: 100%; padding: 12px; border: 2px solid #dee2e6; border-radius: 6px; font-size: 14px;">
                </div>
                <div>
                    <label style="display: block; margin-bottom: 8px; font-weight: 600; color: #495057;">설명</label>
                    <textarea id="projectDescription" placeholder="프로젝트에 대한 간단한 설명을 입력하세요..."
                        style="width: 100%; padding: 12px; border: 2px solid #dee2e6; border-radius: 6px; font-size: 14px; min-height: 100px; font-family: inherit;"></textarea>
                </div>
                <div style="display: flex; gap: 12px; justify-content: flex-end;">
                    <button type="button" onclick="closeAddProjectModal()"
                        style="padding: 12px 24px; background: #495057; border: none; border-radius: 6px; cursor: pointer; font-size: 14px; font-weight: 600; color: white;">취소</button>
                    <button type="submit"
                        style="padding: 12px 24px; background: var(--success); border: none; border-radius: 6px; cursor: pointer; font-size: 14px; font-weight: 600; color: white;">등록하기</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Outbox Files Modal -->
    <div id="outboxFilesModal" class="grid-fullscreen-modal">
        <div class="grid-fullscreen-header">
            <div class="grid-fullscreen-title">📤 Outbox - 파일 선택</div>
            <button class="grid-fullscreen-close" onclick="closeOutboxModal()">✕ 닫기</button>
        </div>
        <div class="grid-fullscreen-content" style="padding: 40px;">
            <div id="outboxFilesList" style="display: grid; gap: 12px;"></div>
        </div>
    </div>

    <!-- Question History Modal -->
    <div id="questionHistoryModal" class="grid-fullscreen-modal">
        <div class="grid-fullscreen-header">
            <div class="grid-fullscreen-title">📋 질문 / 답변 이력</div>
            <button class="grid-fullscreen-close" onclick="closeQuestionHistoryModal()">✕ 닫기</button>
        </div>
        <div class="grid-fullscreen-content" style="padding: 40px;">
            <div id="questionHistoryModalList" style="display: grid; gap: 12px;"></div>
        </div>
    </div>

    <style>
        .outbox-file-item {
            background: white;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            padding: 20px;
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            gap: 16px;
        }

        .outbox-file-item:hover {
            border-color: var(--primary);
            background: #f8f9ff;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(107, 92, 204, 0.15);
        }

        .outbox-file-icon {
            font-size: 40px;
            flex-shrink: 0;
        }

        .outbox-file-info {
            flex: 1;
        }

        .outbox-file-name {
            font-size: 16px;
            font-weight: 600;
            color: #333;
            margin-bottom: 4px;
        }

        .outbox-file-meta {
            font-size: 13px;
            color: #666;
        }

        .outbox-file-badge {
            background: var(--primary);
            color: white;
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 11px;
            font-weight: 600;
        }

        .outbox-file-badge.html {
            background: #20808D;
        }

        .outbox-file-badge.json {
            background: #CC785C;
        }

        .outbox-file-badge.markdown {
            background: #10B981;
        }
    </style>


    <!-- Custom Confirm Dialog -->
    <div id="customConfirmDialog" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0, 0, 0, 0.5); z-index: 9999; align-items: center; justify-content: center;">
        <div style="background: white; border-radius: 12px; padding: 32px; max-width: 400px; box-shadow: 0 10px 40px rgba(0, 0, 0, 0.3);">
            <h3 id="confirmDialogTitle" style="margin: 0 0 16px 0; font-size: 18px; font-weight: 600; color: #212529;">확인</h3>
            <p id="confirmDialogMessage" style="margin: 0 0 24px 0; font-size: 14px; color: #495057; line-height: 1.6;"></p>
            <div style="display: flex; gap: 12px; justify-content: flex-end;">
                <button id="confirmDialogCancel" 
                    style="padding: 12px 24px; background: #6c757d; border: none; border-radius: 6px; cursor: pointer; font-size: 14px; font-weight: 600; color: white; transition: background 0.2s;"
                    onmouseover="this.style.background='#5a6268'" 
                    onmouseout="this.style.background='#6c757d'">취소</button>
                <button id="confirmDialogConfirm" 
                    style="padding: 12px 24px; background: var(--tertiary); border: none; border-radius: 6px; cursor: pointer; font-size: 14px; font-weight: 600; color: white; transition: background 0.2s;"
                    onmouseover="this.style.background='var(--tertiary-dark)'" 
                    onmouseout="this.style.background='var(--tertiary)'">확인</button>
            </div>
        </div>
    </div>

    <script>
        // Custom confirm dialog function
        function customConfirm(message, title = '확인') {
            return new Promise((resolve) => {
                const dialog = document.getElementById('customConfirmDialog');
                const titleEl = document.getElementById('confirmDialogTitle');
                const messageEl = document.getElementById('confirmDialogMessage');
                const confirmBtn = document.getElementById('confirmDialogConfirm');
                const cancelBtn = document.getElementById('confirmDialogCancel');

                titleEl.textContent = title;
                messageEl.textContent = message;
                dialog.style.display = 'flex';

                const handleConfirm = () => {
                    dialog.style.display = 'none';
                    cleanup();
                    resolve(true);
                };

                const handleCancel = () => {
                    dialog.style.display = 'none';
                    cleanup();
                    resolve(false);
                };

                const cleanup = () => {
                    confirmBtn.removeEventListener('click', handleConfirm);
                    cancelBtn.removeEventListener('click', handleCancel);
                };

                confirmBtn.addEventListener('click', handleConfirm);
                cancelBtn.addEventListener('click', handleCancel);
            });
        }

        // ================================================================
        // 사이드바 진행률 자동 업데이트 (Sidebar-Process-Tools 연동)
        // ================================================================
        // PROGRESS_SERVER는 상단에서 PROGRESS_SERVER_URL로 정의됨

        async function calculateFolderProgress() {
            // 배포 환경에서는 실행하지 않음
            if (IS_PRODUCTION) return;

            try {
                const response = await fetch(`${PROGRESS_SERVER_URL}/check-folder-progress`);
                if (!response.ok) throw new Error('서버 연결 실패');
                const data = await response.json();

                if (data.business) updatePrepProgress('사업계획', data.business.progress);
                if (data.planning) updatePrepProgress('프로젝트 기획', data.planning.progress);

                console.log('폴더 진행률:', `사업계획 ${data.business.progress}%, 프로젝트기획 ${data.planning.progress}%`);
            } catch (error) {
                // 로컬 환경에서만 경고 표시
                if (!IS_PRODUCTION) console.warn('진행률 서버 미연결:', error.message);
            }
        }

        function updatePrepProgress(stageName, progress) {
            document.querySelectorAll('.process-prep').forEach(el => {
                const nameEl = el.querySelector('.process-prep-name');
                if (nameEl && nameEl.textContent.includes(stageName)) {
                    el.setAttribute('data-progress', progress);
                    const fillEl = el.querySelector('.process-progress-fill');
                    if (fillEl) fillEl.style.width = `${progress}%`;
                    const percentEl = el.querySelector('.process-percent');
                    if (percentEl) percentEl.textContent = `${progress}%`;
                    if (progress === 100) el.classList.add('completed');
                }
            });
        }

        async function calculateStageProgress() {
            // 배포 환경에서는 실행하지 않음
            if (IS_PRODUCTION) return;

            try {
                const response = await fetch(`${PROGRESS_SERVER_URL}/check-stage-progress`);
                if (!response.ok) return;
                const data = await response.json();
                Object.entries(data).forEach(([key, val]) => updateMajorProgressFromServer(key, val.progress));
            } catch (e) { /* 무시 */ }
        }

        function updateMajorProgressFromServer(stageKey, progress) {
            const map = { 's1': 'S1.', 's2': 'S2.', 's3': 'S3.', 's4': 'S4.', 's5': 'S5.', 's6': 'S6.' };
            const icon = map[stageKey];
            if (!icon) return;
            document.querySelectorAll('.process-major').forEach(el => {
                const iconEl = el.querySelector('.process-icon');
                if (iconEl && iconEl.textContent === icon) {
                    el.setAttribute('data-progress', progress);
                    const fillEl = el.querySelector('.process-progress-fill');
                    if (fillEl) fillEl.style.width = `${progress}%`;
                    const percentEl = el.querySelector('.process-percent');
                    if (percentEl) percentEl.textContent = `${progress}%`;
                    if (progress === 100) el.classList.add('completed');
                }
            });
        }

        // 페이지 로드 시 진행률 자동 업데이트 (Stage Gate 기반)
        window.addEventListener('load', () => {
            setTimeout(() => {
                calculateFolderProgress();
                calculateStageProgress();
            }, 1500);
        });

        // 60초마다 자동 갱신
        setInterval(() => {
            calculateFolderProgress();
            calculateStageProgress();
        }, 60000);
    </script>

    <!-- Socket.io for real-time Order Sheet notifications -->
    <script src="https://cdn.socket.io/4.7.2/socket.io.min.js"></script>
    <script>
        // Socket.io 연결
        const notificationSocket = io('http://localhost:3030', {
            reconnection: true,
            reconnectionDelay: 1000,
            reconnectionAttempts: 10
        });

        notificationSocket.on('connect', () => {
            console.log('✅ Notification server connected');
        });

        notificationSocket.on('disconnect', () => {
            console.log('❌ Notification server disconnected');
        });

        // 새 Order 알림 수신
        notificationSocket.on('new-order-alert', (data) => {
            console.log('📩 New order notification:', data);
            showOrderNotification(data);
        });

        // 팝업 알림 표시 (중앙 모달 스타일)
        function showOrderNotification(data) {
            // 중앙 모달 팝업 생성
            const popup = document.createElement('div');
            popup.style.cssText = `
                position: fixed;
                top: 50%;
                left: 50%;
                transform: translate(-50%, -50%);
                width: 420px;
                background: white;
                border-radius: 16px;
                box-shadow: 0 10px 40px rgba(0,0,0,0.2);
                z-index: 10001;
                overflow: hidden;
                font-family: 'Malgun Gothic', '맑은 고딕', 'Apple SD Gothic Neo', 'Noto Sans KR', sans-serif;
                animation: modalZoomIn 0.3s ease-out;
            `;

            popup.innerHTML = `
                <div style="padding: 32px 24px 24px 24px; text-align: center;">
                    <div style="margin-bottom: 20px; font-size: 14px; font-weight: 400; line-height: 1.7; color: #333;">
                        <strong style="display: block; margin-bottom: 10px; font-size: 15px; color: #111;">이 페이지 내용:</strong>
                        <div style="text-align: left; background: #f8f9fa; padding: 14px; border-radius: 8px; margin-bottom: 10px;">
                            Order Sheet가 Inbox에 저장되었습니다.
                        </div>
                        <div style="text-align: left; background: #fff3cd; padding: 14px; border-radius: 8px; margin-bottom: 10px; border-left: 4px solid #ffc107;">
                            <div style="margin-bottom: 8px;">원하는 Claude Code 세션에 가서</div>
                            <div style="font-weight: 600; color: #856404;">"Inbox에 저장된 Order Sheet를 확인해줘"</div>
                            <div style="margin-top: 8px;">라고 말씀해주세요.</div>
                        </div>
                        <div style="text-align: left; background: #f8f9fa; padding: 14px; border-radius: 8px;">
                            <strong>Order ID:</strong> <span style="color: #007bff; font-family: monospace;">${data.orderId}</span>
                        </div>
                    </div>
                    <button class="order-confirm-btn"
                        style="width: 100%; padding: 12px 24px; border: none; border-radius: 8px; background: #007bff; color: white; font-size: 14px; font-weight: 600; cursor: pointer; transition: background 0.2s;"
                        onmouseover="this.style.background='#0056b3';"
                        onmouseout="this.style.background='#007bff';">
                        확인
                    </button>
                </div>
            `;

            // 오버레이 (반투명 배경)
            const overlay = document.createElement('div');
            overlay.className = 'order-notification-overlay';
            overlay.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: rgba(0, 0, 0, 0.5);
                z-index: 10000;
                animation: fadeIn 0.3s ease-out;
            `;

            function closeModal() {
                overlay.style.animation = 'fadeOut 0.2s ease-in';
                popup.style.animation = 'modalZoomOut 0.2s ease-in';
                setTimeout(() => {
                    if (document.body.contains(overlay)) overlay.remove();
                    if (document.body.contains(popup)) popup.remove();
                }, 200);
            }

            overlay.onclick = (e) => {
                if (e.target === overlay) {
                    closeModal();
                }
            };

            document.body.appendChild(overlay);
            document.body.appendChild(popup);

            // 확인 버튼 클릭 시
            popup.querySelector('.order-confirm-btn').addEventListener('click', closeModal);

            // 사운드 재생
            playNotificationSound();

            // 10초 후 자동 닫기
            setTimeout(() => {
                if (document.body.contains(overlay)) {
                    closeModal();
                }
            }, 10000);
        }

        function playNotificationSound() {
            try {
                const audioContext = new (window.AudioContext || window.webkitAudioContext)();
                const oscillator = audioContext.createOscillator();
                const gainNode = audioContext.createGain();

                oscillator.connect(gainNode);
                gainNode.connect(audioContext.destination);

                oscillator.frequency.value = 800;
                oscillator.type = 'sine';

                gainNode.gain.setValueAtTime(0.3, audioContext.currentTime);
                gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.5);

                oscillator.start(audioContext.currentTime);
                oscillator.stop(audioContext.currentTime + 0.5);
            } catch (e) {
                console.log('Sound play failed:', e);
            }
        }

        // CSS 애니메이션 추가
        const style = document.createElement('style');
        style.textContent = `
            @keyframes modalZoomIn {
                from {
                    transform: translate(-50%, -50%) scale(0.7);
                    opacity: 0;
                }
                to {
                    transform: translate(-50%, -50%) scale(1);
                    opacity: 1;
                }
            }
            @keyframes modalZoomOut {
                from {
                    transform: translate(-50%, -50%) scale(1);
                    opacity: 1;
                }
                to {
                    transform: translate(-50%, -50%) scale(0.7);
                    opacity: 0;
                }
            }
            @keyframes fadeIn {
                from { opacity: 0; }
                to { opacity: 1; }
            }
            @keyframes fadeOut {
                from { opacity: 1; }
                to { opacity: 0; }
            }
        `;
        document.head.appendChild(style);

        // ========================================
        // 공지사항 기능 (Supabase 연동)
        // ========================================

        // Supabase 설정
        const SUPABASE_URL = 'https://zwjmfewyshhwpgwdtrus.supabase.co';
        const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Inp3am1mZXd5c2hod3Bnd2R0cnVzIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjM1NzE1NTEsImV4cCI6MjA3OTE0NzU1MX0.AJy34h5VR8QS6WFEcUcBeJJu8I3bBQ6UCk1I84Wb7y4';

        let supabaseClient;

        // Supabase 클라이언트 초기화
        function initSupabase() {
            if (typeof supabase !== 'undefined') {
                supabaseClient = supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);
                console.log('✅ Supabase 클라이언트 초기화 완료 (Frontend)');
                loadNotices();
                loadAndRenderLearningContents(); // 학습 콘텐츠도 로드
                // FAQ는 로컬 배열 사용 (Supabase 로드 제거)
                checkAuthStatus(); // 로그인 상태 확인
                loadStageGateStatus(); // Stage Gate 상태 확인 및 진행률 업데이트
            } else {
                console.warn('⚠️ Supabase 라이브러리가 로드되지 않았습니다.');
                setTimeout(initSupabase, 1000); // 1초 후 재시도
            }
        }

        // Stage Gate 상태 확인 및 진행 프로세스 업데이트
        async function loadStageGateStatus() {
            try {
                const { data, error } = await supabaseClient
                    .from('stage_verification')
                    .select('stage_name, stage_gate_status')
                    .eq('stage_gate_status', 'Approved');

                if (error) {
                    console.warn('Stage Gate 조회 오류:', error);
                    return;
                }

                if (data && data.length > 0) {
                    data.forEach(stage => {
                        updateProcessProgress(stage.stage_name);
                    });
                    console.log('✅ Stage Gate 상태 반영 완료:', data.map(s => s.stage_name));
                }
            } catch (e) {
                console.warn('Stage Gate 로드 실패:', e);
            }
        }

        // 특정 Stage의 진행률을 100%로 업데이트하고 completed 클래스 추가
        function updateProcessProgress(stageName) {
            // Stage Name을 HTML 요소 ID로 매핑
            const stageMapping = {
                'Stage 1': 'process-s1',
                'Stage 2': 'process-s2',
                'Stage 3': 'process-s3',
                'Stage 4': 'process-s4',
                'Stage 5': 'process-s5'
            };

            const elementId = stageMapping[stageName];
            if (!elementId) return;

            const processElement = document.getElementById(elementId);
            if (!processElement) return;

            // 이미 completed면 스킵
            if (processElement.classList.contains('completed')) return;

            // completed 클래스 추가 및 스타일 직접 적용
            processElement.classList.add('completed');
            processElement.setAttribute('data-progress', '100');

            // CSS specificity 문제로 인라인 스타일로 직접 적용
            processElement.style.background = 'rgba(16, 185, 129, 0.25)';
            processElement.style.border = '1px solid rgba(16, 185, 129, 0.5)';

            // 진행률 바 업데이트
            const progressFill = processElement.querySelector('.process-progress-fill');
            if (progressFill) {
                progressFill.style.width = '100%';
            }

            // 퍼센트 텍스트 업데이트
            const percentText = processElement.querySelector('.process-percent');
            if (percentText) {
                percentText.textContent = '100%';
            }

            console.log(`✅ ${stageName} 진행률 100%로 업데이트 완료`);
        }

        // ========================================
        // 외부 연동 설정 Guide 메뉴 토글
        // ========================================
        function toggleServiceGuideMenu() {
            const links = document.getElementById('serviceGuideLinks');
            const btn = document.getElementById('serviceGuideMoreBtn');

            if (!links) {
                console.error('serviceGuideLinks 요소를 찾을 수 없습니다.');
                return;
            }

            const currentDisplay = window.getComputedStyle(links).display;

            if (currentDisplay === 'none') {
                links.style.display = 'block';
                if (btn) btn.textContent = '접기 ←';
            } else {
                links.style.display = 'none';
                if (btn) btn.textContent = '더보기 →';
            }
        }

        // ========================================
        // Claude Code 업데이트 메뉴 토글
        // ========================================
        function toggleClaudeCodeMenu() {
            const links = document.getElementById('claudeCodeLinks');
            const btn = document.getElementById('claudeCodeMoreBtn');

            if (!links) {
                console.error('claudeCodeLinks 요소를 찾을 수 없습니다.');
                return;
            }

            const currentDisplay = window.getComputedStyle(links).display;

            if (currentDisplay === 'none') {
                links.style.display = 'block';
                if (btn) btn.textContent = '접기 ←';
            } else {
                links.style.display = 'none';
                if (btn) btn.textContent = '더보기 →';
            }
        }

        // ========================================
        // 마이페이지 메뉴 토글
        // ========================================
        function toggleMypageMenu() {
            console.log('마이페이지 메뉴 토글 클릭');
            const links = document.getElementById('mypageLinks');
            const btn = document.getElementById('mypageMoreBtn');

            if (!links) {
                console.error('mypageLinks 요소를 찾을 수 없습니다.');
                return;
            }

            // 현재 display 상태 확인 (computed style 사용)
            const currentDisplay = window.getComputedStyle(links).display;
            console.log('현재 display:', currentDisplay);

            if (currentDisplay === 'none') {
                links.style.display = 'block';
                if (btn) btn.textContent = '접기 ←';
            } else {
                links.style.display = 'none';
                if (btn) btn.textContent = '더보기 →';
            }
        }

        // ========================================
        // 로그인 상태 관리
        // ========================================
        async function checkAuthStatus() {
            try {
                const { data: { session }, error } = await supabaseClient.auth.getSession();

                if (session && session.user) {
                    console.log('✅ 로그인 상태:', session.user.email);

                    // 사용자 닉네임 가져오기
                    const { data: userData, error: userError } = await supabaseClient
                        .from('users')
                        .select('nickname')
                        .eq('id', session.user.id)
                        .single();

                    let nickname = '사용자';
                    if (userData && userData.nickname) {
                        nickname = userData.nickname;
                    } else if (session.user.user_metadata?.nickname) {
                        nickname = session.user.user_metadata.nickname;
                    } else if (session.user.email) {
                        nickname = session.user.email.split('@')[0];
                    }

                    showLoggedInUI(nickname);
                } else {
                    console.log('ℹ️ 로그인되지 않은 상태');
                    showLoggedOutUI();
                }
            } catch (error) {
                console.error('❌ 인증 상태 확인 실패:', error);
                showLoggedOutUI();
            }
        }

        function showLoggedInUI(nickname = '사용자') {
            const guestBtns = document.getElementById('headerGuestBtns');
            const userBtns = document.getElementById('headerUserBtns');
            const nicknameEl = document.getElementById('userNickname');
            if (guestBtns) guestBtns.style.display = 'none';
            if (userBtns) userBtns.style.display = 'flex';
            if (nicknameEl) nicknameEl.textContent = nickname + '님';
        }

        function showLoggedOutUI() {
            const guestBtns = document.getElementById('headerGuestBtns');
            const userBtns = document.getElementById('headerUserBtns');
            if (guestBtns) guestBtns.style.display = 'flex';
            if (userBtns) userBtns.style.display = 'none';
        }

        async function logoutFromMain() {
            try {
                await supabaseClient.auth.signOut();
                console.log('✅ 로그아웃 완료');
                showLoggedOutUI();
            } catch (error) {
                console.error('❌ 로그아웃 실패:', error);
                alert('로그아웃에 실패했습니다.');
            }
        }

        // 공지사항 로드
        async function loadNotices() {
            console.log('📋 공지사항 로드 시작 (Frontend)');
            console.log('  - supabaseClient:', supabaseClient);
            console.log('  - URL:', SUPABASE_URL);

            try {
                if (!supabaseClient) {
                    throw new Error('Supabase 클라이언트가 초기화되지 않았습니다.');
                }

                console.log('📤 Supabase 쿼리 시작...');

                const { data, error } = await supabaseClient
                    .from('notices')
                    .select('*')
                    .order('important', { ascending: false })
                    .order('created_at', { ascending: false })
                    .limit(3);

                console.log('📥 Supabase 응답:');
                console.log('  - data:', data);
                console.log('  - error:', error);

                if (error) {
                    console.error('❌ Supabase 오류 상세:');
                    console.error('  - code:', error.code);
                    console.error('  - message:', error.message);
                    console.error('  - details:', error.details);
                    console.error('  - hint:', error.hint);
                    throw error;
                }

                console.log('✅ 공지사항 로드 성공:', data.length, '개');
                renderNotices(data);

            } catch (error) {
                console.error('❌ 공지사항 로드 오류:', error);
                const noticesList = document.getElementById('noticesList');
                if (noticesList) {
                    noticesList.innerHTML = `
                        <div style="text-align: center; padding: 20px; color: #dc3545; font-size: 11px;">
                            공지사항을 불러오는데 실패했습니다.<br>
                            <span style="font-size: 11px; color: #6c757d;">콘솔(F12)에서 오류를 확인하세요.</span>
                        </div>
                    `;
                }
            }
        }

        // 공지사항 렌더링 (최신 1개만 표시, 더보기는 h3 헤더에 있음)
        function renderNotices(notices) {
            const noticesList = document.getElementById('noticesList');

            if (!noticesList) {
                console.error('❌ noticesList 요소를 찾을 수 없습니다.');
                return;
            }

            if (!notices || notices.length === 0) {
                noticesList.innerHTML = `
                    <div style="text-align: center; padding: 20px; color: #6c757d; font-size: 14px;">
                        등록된 공지사항이 없습니다.
                    </div>
                `;
                return;
            }

            // 최신 1개만 표시
            const latestNotice = notices[0];
            const safeTitle = typeof DOMPurify !== 'undefined'
                ? DOMPurify.sanitize(latestNotice.title, { ALLOWED_TAGS: [] })
                : latestNotice.title.replace(/</g, '&lt;').replace(/>/g, '&gt;');

            const createdDate = new Date(latestNotice.created_at);
            const formattedDate = `${createdDate.getFullYear()}.${String(createdDate.getMonth() + 1).padStart(2, '0')}.${String(createdDate.getDate()).padStart(2, '0')} ${String(createdDate.getHours()).padStart(2, '0')}:${String(createdDate.getMinutes()).padStart(2, '0')}`;

            noticesList.innerHTML = `
                <div class="notice-item" onclick="showNoticeDetail('${latestNotice.id}', this)">
                    <div class="notice-title">
                        ${safeTitle}
                    </div>
                    <span class="notice-date">${formattedDate}</span>
                </div>
            `;
        }

        // 공지사항 상세 보기
        async function showNoticeDetail(noticeId, clickedElement) {
            console.log('📄 공지사항 상세 보기:', noticeId);

            try {
                if (!supabaseClient) {
                    throw new Error('Supabase 클라이언트가 초기화되지 않았습니다.');
                }

                const { data: notice, error } = await supabaseClient
                    .from('notices')
                    .select('*')
                    .eq('id', noticeId)
                    .single();

                if (error) throw error;

                // DOMPurify가 있으면 사용, 없으면 기본 텍스트만
                const safeTitle = typeof DOMPurify !== 'undefined'
                    ? DOMPurify.sanitize(notice.title, { ALLOWED_TAGS: [] })
                    : notice.title.replace(/</g, '&lt;').replace(/>/g, '&gt;');

                const safeContent = typeof DOMPurify !== 'undefined'
                    ? DOMPurify.sanitize(notice.content.replace(/\n/g, '<br>'), { ALLOWED_TAGS: ['br'] })
                    : notice.content.replace(/</g, '&lt;').replace(/>/g, '&gt;').replace(/\n/g, '<br>');

                const createdDate = new Date(notice.created_at).toLocaleDateString('ko-KR');
                const importanceBadge = notice.important
                    ? '<span style="display: inline-block; background: #dc3545; color: white; padding: 2px 8px; border-radius: 4px; font-size: 11px; margin-left: 8px;">중요</span>'
                    : '';

                // 클릭한 공지사항 항목 위치 계산
                const rect = clickedElement.getBoundingClientRect();

                console.log('📍 클릭한 요소 위치:', {
                    top: rect.top,
                    left: rect.left,
                    width: rect.width,
                    height: rect.height
                });

                // 모달 생성
                const overlay = document.createElement('div');
                overlay.style.cssText = `
                    position: fixed;
                    top: 0;
                    left: 0;
                    width: 100%;
                    height: 100%;
                    background: rgba(0, 0, 0, 0.5);
                    z-index: 10000;
                `;

                const modal = document.createElement('div');

                // 모달 위치 계산
                const modalWidth = 600;

                // 가로: 공지사항 항목과 같은 위치 (왼쪽 정렬)
                let modalLeft = rect.left;

                // 오른쪽으로 화면 벗어나면 왼쪽으로 조정
                if (modalLeft + modalWidth > window.innerWidth - 20) {
                    modalLeft = window.innerWidth - modalWidth - 20;
                }

                // 왼쪽으로 너무 벗어나면 최소 여백 확보
                if (modalLeft < 20) {
                    modalLeft = 20;
                }

                // 세로: 공지사항 바로 옆(아래 또는 위)에 표시
                const idealModalHeight = 500; // 팝업 이상적인 높이
                const spaceBelow = window.innerHeight - rect.bottom - 20; // 아래쪽 여유 공간
                const spaceAbove = rect.top - 20; // 위쪽 여유 공간

                let modalTop;
                let modalMaxHeight;

                if (spaceBelow >= 300) {
                    // 아래쪽에 공간 있음 → 공지사항 바로 아래에 표시
                    modalTop = rect.bottom + 10;
                    modalMaxHeight = Math.min(idealModalHeight, spaceBelow - 10);
                } else if (spaceAbove >= 300) {
                    // 위쪽에 공간 있음 → 공지사항 바로 위에 표시
                    modalMaxHeight = Math.min(idealModalHeight, spaceAbove - 10);
                    modalTop = rect.top - modalMaxHeight - 10;
                } else {
                    // 양쪽 다 부족 → 더 큰 쪽에 표시
                    if (spaceBelow >= spaceAbove) {
                        modalTop = rect.bottom + 10;
                        modalMaxHeight = spaceBelow - 10;
                    } else {
                        modalMaxHeight = spaceAbove - 10;
                        modalTop = rect.top - modalMaxHeight - 10;
                    }
                }

                // 최소 높이 보장 (너무 작으면 화면 중앙)
                if (modalMaxHeight < 200) {
                    modalMaxHeight = 400;
                    modalTop = (window.innerHeight - modalMaxHeight) / 2;
                }

                console.log('📍 팝업 위치:', {
                    '클릭한 요소 top': rect.top,
                    '클릭한 요소 left': rect.left,
                    'modalLeft': modalLeft,
                    'modalTop': modalTop,
                    'modalWidth': modalWidth,
                    'modalMaxHeight': modalMaxHeight,
                    'window.innerHeight': window.innerHeight
                });

                modal.style.cssText = `
                    position: fixed;
                    left: ${modalLeft}px;
                    top: ${modalTop}px;
                    background: white;
                    border-radius: 12px;
                    max-width: 600px;
                    width: 90%;
                    max-height: 80vh;
                    overflow-y: auto;
                    box-shadow: 0 10px 40px rgba(0, 0, 0, 0.2);
                `;

                modal.innerHTML = `
                    <div style="padding: 24px; border-bottom: 1px solid #dee2e6;">
                        <h3 style="margin: 0; font-size: 20px; color: #212529;">
                            📢 ${safeTitle}${importanceBadge}
                        </h3>
                        <div style="margin-top: 8px; font-size: 13px; color: #6c757d;">
                            작성일: ${createdDate}
                        </div>
                    </div>
                    <div style="padding: 24px; line-height: 1.6; color: #495057; font-size: 14px;">
                        ${safeContent}
                    </div>
                    <div style="padding: 16px 24px; border-top: 1px solid #dee2e6; text-align: right;">
                        <button onclick="this.closest('.notice-modal-overlay').remove()"
                                style="padding: 8px 24px; background: #6c757d; color: white; border: none; border-radius: 6px; cursor: pointer; font-size: 14px; font-weight: 500;">
                            닫기
                        </button>
                    </div>
                `;

                overlay.className = 'notice-modal-overlay';
                overlay.appendChild(modal);
                overlay.onclick = (e) => {
                    if (e.target === overlay) {
                        overlay.remove();
                    }
                };

                document.body.appendChild(overlay);

            } catch (error) {
                console.error('❌ 공지사항 상세 조회 오류:', error);
                alert('공지사항을 불러오는데 실패했습니다.');
            }
        }

        // ================================================
        // 학습용 콘텐츠 관련 기능
        // ================================================

        // 전역 변수: 학습 콘텐츠 데이터
        let allLearningContents = [];

        /**
         * 학습 콘텐츠 로드 및 렌더링
         */
        async function loadAndRenderLearningContents() {
            console.log('📚 학습 콘텐츠 로드 시작 (Frontend)');

            try {
                if (!supabaseClient) {
                    console.warn('⚠️ Supabase 클라이언트가 아직 초기화되지 않았습니다. 재시도 중...');
                    setTimeout(loadAndRenderLearningContents, 1000);
                    return;
                }

                const { data, error } = await supabaseClient
                    .from('learning_contents')
                    .select('*')
                    .order('depth1')
                    .order('depth2')
                    .order('display_order');

                if (error) throw error;

                console.log('✅ 학습 콘텐츠 로드 성공:', data.length, '개');

                // 전역 변수에 저장
                allLearningContents = data;

                // 트리 렌더링
                renderLearningContentsTree(data);

            } catch (error) {
                console.error('❌ 학습 콘텐츠 로드 오류:', error);
                // 오류 시 기존 하드코딩된 데이터 유지
            }
        }

        /**
         * 학습 콘텐츠 트리 렌더링
         */
        function renderLearningContentsTree(contents) {
            const treeContainer = document.getElementById('learningContentsTree');
            if (!treeContainer) return;

            // depth1별로 그룹화
            const depth1Groups = {};
            contents.forEach(item => {
                if (!depth1Groups[item.depth1]) {
                    depth1Groups[item.depth1] = [];
                }
                depth1Groups[item.depth1].push(item);
            });

            let html = '';

            Object.keys(depth1Groups).sort().forEach(depth1Name => {
                const depth1Items = depth1Groups[depth1Name];

                // depth2별로 그룹화
                const depth2Groups = {};
                depth1Items.forEach(item => {
                    if (item.depth2) {
                        if (!depth2Groups[item.depth2]) {
                            depth2Groups[item.depth2] = [];
                        }
                        depth2Groups[item.depth2].push(item);
                    }
                });

                html += `
                    <div class="knowledge-item">
                        <div class="knowledge-major" onclick="toggleKnowledge(this)">
                            <span class="knowledge-icon"></span>
                            <span class="knowledge-name">${depth1Name}</span>
                            <span class="knowledge-arrow">▶</span>
                        </div>
                        <div class="knowledge-medium-list">
                `;

                // depth2 렌더링
                Object.keys(depth2Groups).sort().forEach(depth2Name => {
                    const depth2Items = depth2Groups[depth2Name];

                    html += `
                        <div class="knowledge-medium" onclick="toggleKnowledgeSmall(this)">
                            <div class="knowledge-medium-content">
                                <span class="knowledge-medium-bullet">●</span>
                                <span>${depth2Name}</span>
                            </div>
                            <span class="knowledge-medium-arrow">▶</span>
                        </div>
                        <div class="knowledge-small-list">
                    `;

                    // depth3 렌더링
                    depth2Items
                        .filter(item => item.depth3)
                        .sort((a, b) => (a.display_order || 0) - (b.display_order || 0))
                        .forEach(item => {
                            const url = item.url || '#';
                            html += `
                                <div class="knowledge-small">
                                    <span class="knowledge-small-bullet">●</span>
                                    <span><a href="${url}" target="_blank" style="color: inherit; text-decoration: none;">${item.depth3}</a></span>
                                </div>
                            `;
                        });

                    html += `
                        </div>
                    `;
                });

                html += `
                        </div>
                    </div>
                `;
            });

            treeContainer.innerHTML = html;
        }

        /**
         * 학습 콘텐츠 검색 (실시간)
         */
        function searchLearningContents(query) {
            const searchInput = document.getElementById('learningSearchInput');
            const searchResults = document.getElementById('learningSearchResults');
            const contentsTree = document.getElementById('learningContentsTree');

            if (!query || query.trim() === '') {
                // 검색어 없으면 원래 트리 표시
                searchResults.style.display = 'none';
                contentsTree.style.display = 'block';

                // 검색창 스타일 초기화
                searchInput.style.borderColor = '#dee2e6';
                searchInput.style.boxShadow = 'none';
                return;
            }

            // 검색창 스타일 변경
            searchInput.style.borderColor = '#F59E0B';
            searchInput.style.boxShadow = '0 0 0 2px rgba(245, 158, 11, 0.1)';

            // 검색어로 필터링
            const searchTerm = query.toLowerCase();
            const results = allLearningContents.filter(item => {
                return (item.depth1 && item.depth1.toLowerCase().includes(searchTerm)) ||
                       (item.depth2 && item.depth2.toLowerCase().includes(searchTerm)) ||
                       (item.depth3 && item.depth3.toLowerCase().includes(searchTerm)) ||
                       (item.description && item.description.toLowerCase().includes(searchTerm));
            });

            // 검색 결과 렌더링
            if (results.length === 0) {
                searchResults.innerHTML = `
                    <div style="text-align: center; padding: 20px; color: #6c757d; font-size: 13px;">
                        검색 결과가 없습니다.
                    </div>
                `;
            } else {
                let html = `
                    <div style="margin-bottom: 10px; padding: 8px; background: rgba(245, 158, 11, 0.08); border-radius: 6px; font-size: 11px; color: #495057;">
                        🔍 검색 결과 (${results.length}개)
                        <button onclick="clearSearch()" style="float: right; background: none; border: none; cursor: pointer; color: #6c757d; font-size: 16px;">×</button>
                    </div>
                    <div style="max-height: 400px; overflow-y: auto;">
                `;

                results.forEach(item => {
                    if (item.depth3) {
                        const url = item.url || '#';
                        html += `
                            <div style="padding: 8px; margin-bottom: 6px; background: white; border: 1px solid #dee2e6; border-radius: 4px; font-size: 11px;">
                                <div style="font-weight: 700; color: #212529; margin-bottom: 2px;">
                                    <a href="${url}" target="_blank" style="color: inherit; text-decoration: none;">${item.depth3}</a>
                                </div>
                                <div style="font-size: 11px; color: #6c757d;">
                                    📂 ${item.depth1} > ${item.depth2}
                                </div>
                            </div>
                        `;
                    }
                });

                html += `</div>`;
                searchResults.innerHTML = html;
            }

            // 검색 결과 표시, 트리 숨김
            searchResults.style.display = 'block';
            contentsTree.style.display = 'none';
        }

        /**
         * 검색 초기화
         */
        function clearSearch() {
            const searchInput = document.getElementById('learningSearchInput');
            searchInput.value = '';
            searchLearningContents('');
        }

        // ================================================
        // FAQ 관련 기능
        // ================================================

        /**
         * FAQ 검색 기능
         */
        function searchFaqs(query) {
            const searchResults = document.getElementById('faqSearchResults');
            const faqContainer = document.getElementById('faqContainer');

            // 검색어가 비어있으면 기본 트리 표시
            if (!query || query.trim() === '') {
                searchResults.style.display = 'none';
                faqContainer.style.display = 'block';
                searchResults.innerHTML = '';
                return;
            }

            const searchTerm = query.toLowerCase().trim();

            // allFaqs에서 검색
            const results = allFaqs.filter(faq => {
                const depth1Match = faq.depth1 && faq.depth1.toLowerCase().includes(searchTerm);
                const depth2Match = faq.depth2 && faq.depth2.toLowerCase().includes(searchTerm);
                const depth3Match = faq.depth3 && faq.depth3.toLowerCase().includes(searchTerm);
                const answerMatch = faq.answer && faq.answer.toLowerCase().includes(searchTerm);
                return depth1Match || depth2Match || depth3Match || answerMatch;
            });

            // 검색 결과 렌더링
            if (results.length === 0) {
                searchResults.innerHTML = `
                    <div style="padding: 15px; text-align: center; color: #666; font-size: 13px;">
                        🔍 "${query}"에 대한 검색 결과가 없습니다.
                    </div>
                `;
            } else {
                let html = `
                    <div style="padding: 8px 12px; background: #f0f0f0; border-radius: 6px; margin-bottom: 8px; font-size: 11px; color: #666;">
                        🔍 검색 결과: ${results.length}개
                    </div>
                `;

                results.forEach(faq => {
                    // 검색어 하이라이트
                    const highlightedTitle = faq.depth3.replace(
                        new RegExp(`(${searchTerm})`, 'gi'),
                        '<span style="background: #FEF08A; padding: 0 2px; border-radius: 2px;">$1</span>'
                    );

                    html += `
                        <div class="knowledge-small"
                             style="padding: 10px 12px; margin-bottom: 6px; background: white; border-radius: 6px; cursor: pointer; border: 1px solid #e5e7eb; transition: all 0.2s;"
                             onclick="showFaqAnswer(${faq.id})"
                             onmouseover="this.style.borderColor='#2C4A8A'; this.style.background='#f8fafc';"
                             onmouseout="this.style.borderColor='#e5e7eb'; this.style.background='white';">
                            <div style="font-size: 13px; font-weight: 500; color: #333; margin-bottom: 4px;">
                                ${highlightedTitle}
                            </div>
                            <div style="font-size: 11px; color: #888;">
                                📂 ${faq.depth1} > ${faq.depth2}
                            </div>
                        </div>
                    `;
                });

                searchResults.innerHTML = html;
            }

            // 검색 결과 표시, 트리 숨김
            searchResults.style.display = 'block';
            faqContainer.style.display = 'none';
        }

        /**
         * FAQ 검색 초기화
         */
        function clearFaqSearch() {
            const searchInput = document.getElementById('faqSearchInput');
            searchInput.value = '';
            searchFaqs('');
        }

        // 전역 변수: FAQ 데이터
        let allFaqs = [];

        /**
         * FAQ 로드 및 렌더링
         */
        async function loadAndRenderFaqs() {
            console.log('🙋 FAQ 로드 시작 (Frontend)');

            const loadingEl = document.getElementById('faqLoading');
            const containerEl = document.getElementById('faqContainer');

            try {
                if (!supabaseClient) {
                    console.warn('⚠️ Supabase 클라이언트가 아직 초기화되지 않았습니다. 재시도 중...');
                    setTimeout(loadAndRenderFaqs, 1000);
                    return;
                }

                const { data, error } = await supabaseClient
                    .from('faqs')
                    .select('*')
                    .order('depth1')
                    .order('depth2')
                    .order('depth3');

                if (error) throw error;

                console.log('✅ FAQ 로드 성공:', data.length, '개');

                // 전역 변수에 저장
                allFaqs = data;

                // 트리 렌더링
                renderFaqTree(data);

                // 로딩 메시지 숨기기
                if (loadingEl) loadingEl.style.display = 'none';

            } catch (error) {
                console.error('❌ FAQ 로드 오류:', error);

                // 오류 메시지 표시
                if (containerEl) {
                    containerEl.innerHTML = `
                        <div style="padding: 12px; text-align: center; color: #dc3545; font-size: 13px;">
                            ❌ FAQ를 불러오는데 실패했습니다.<br/>
                            <small>${error.message}</small>
                        </div>
                    `;
                }
                if (loadingEl) loadingEl.style.display = 'none';
            }
        }

        /**
         * FAQ 트리 렌더링
         */
        function renderFaqTree(faqs) {
            const containerEl = document.getElementById('faqContainer');
            if (!containerEl) return;

            // depth1별로 그룹화
            const depth1Groups = {};
            faqs.forEach(item => {
                if (!depth1Groups[item.depth1]) {
                    depth1Groups[item.depth1] = [];
                }
                depth1Groups[item.depth1].push(item);
            });

            let html = '';

            Object.keys(depth1Groups).sort().forEach(depth1Name => {
                const depth1Items = depth1Groups[depth1Name];

                // depth2별로 그룹화
                const depth2Groups = {};
                depth1Items.forEach(item => {
                    if (item.depth2) {
                        if (!depth2Groups[item.depth2]) {
                            depth2Groups[item.depth2] = [];
                        }
                        depth2Groups[item.depth2].push(item);
                    }
                });

                html += `
                    <div class="knowledge-item">
                        <div class="knowledge-major" onclick="toggleKnowledge(this)">
                            <span class="knowledge-icon"></span>
                            <span class="knowledge-name">${depth1Name}</span>
                            <span class="knowledge-arrow">▶</span>
                        </div>
                        <div class="knowledge-medium-list">
                `;

                // depth2 렌더링
                Object.keys(depth2Groups).sort().forEach(depth2Name => {
                    const depth2Items = depth2Groups[depth2Name];

                    html += `
                        <div class="knowledge-medium" onclick="toggleKnowledgeSmall(this)">
                            <div class="knowledge-medium-content">
                                <span class="knowledge-medium-bullet">●</span>
                                <span>${depth2Name}</span>
                            </div>
                            <span class="knowledge-medium-arrow">▶</span>
                        </div>
                        <div class="knowledge-small-list">
                    `;

                    // depth3 렌더링 (질문 클릭 시 답변 모달)
                    depth2Items
                        .filter(item => item.depth3)
                        .sort((a, b) => (a.depth3 || '').localeCompare(b.depth3 || ''))
                        .forEach(item => {
                            html += `
                                <div class="knowledge-small" onclick="showFaqAnswer('${item.id}')" style="cursor: pointer;">
                                    <span class="knowledge-small-bullet">●</span>
                                    <span>${item.depth3}</span>
                                </div>
                            `;
                        });

                    html += `
                        </div>
                    `;
                });

                html += `
                        </div>
                    </div>
                `;
            });

            containerEl.innerHTML = html;
        }

        /**
         * FAQ 답변 모달 표시
         */
        async function showFaqAnswer(faqId) {
            try {
                // 전역 변수에서 FAQ 찾기
                const faq = allFaqs.find(f => f.id === faqId);

                if (!faq) {
                    alert('FAQ를 찾을 수 없습니다.');
                    return;
                }

                // DOMPurify로 HTML 정화
                const safeAnswer = DOMPurify.sanitize(faq.answer);

                // 모달 생성
                const overlay = document.createElement('div');
                const modal = document.createElement('div');

                modal.innerHTML = `
                    <div style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); padding: 20px 24px; display: flex; justify-content: space-between; align-items: center; border-radius: 12px 12px 0 0;">
                        <div>
                            <div style="font-size: 18px; font-weight: 700; color: white; margin-bottom: 4px;">
                                ${faq.depth3}
                            </div>
                            <div style="font-size: 11px; color: rgba(255, 255, 255, 0.9);">
                                📂 ${faq.depth1} > ${faq.depth2}
                            </div>
                        </div>
                        <button onclick="this.closest('.faq-modal-overlay').remove()"
                                style="background: rgba(255, 255, 255, 0.2); border: none; color: white; font-size: 24px; cursor: pointer; width: 32px; height: 32px; border-radius: 50%; display: flex; align-items: center; justify-content: center; transition: all 0.2s;"
                                onmouseover="this.style.background='rgba(255, 255, 255, 0.3)'"
                                onmouseout="this.style.background='rgba(255, 255, 255, 0.2)'">
                            ×
                        </button>
                    </div>
                    <div style="padding: 24px; line-height: 1.8; color: #495057; font-size: 14px; max-height: 60vh; overflow-y: auto;">
                        ${safeAnswer}
                    </div>
                    <div style="padding: 16px 24px; border-top: 1px solid #dee2e6; text-align: right; background: #f8f9fa;">
                        <button onclick="this.closest('.faq-modal-overlay').remove()"
                                style="padding: 10px 24px; background: #6c757d; color: white; border: none; border-radius: 6px; cursor: pointer; font-size: 14px; font-weight: 500; transition: all 0.2s;"
                                onmouseover="this.style.background='#5a6268'"
                                onmouseout="this.style.background='#6c757d'">
                            닫기
                        </button>
                    </div>
                `;

                overlay.className = 'faq-modal-overlay';
                overlay.style.cssText = 'position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0, 0, 0, 0.6); display: flex; align-items: center; justify-content: center; z-index: 10000;';

                modal.style.cssText = 'background: white; border-radius: 12px; max-width: 700px; width: 90%; box-shadow: 0 10px 40px rgba(0, 0, 0, 0.3);';

                overlay.appendChild(modal);
                overlay.onclick = (e) => {
                    if (e.target === overlay) {
                        overlay.remove();
                    }
                };

                document.body.appendChild(overlay);

            } catch (error) {
                console.error('❌ FAQ 답변 표시 오류:', error);
                alert('FAQ 답변을 불러오는데 실패했습니다.');
            }
        }

        // ================================================
        // 💡 Tips 로컬 배열 기반 시스템
        // ================================================

        // Tips 콘텐츠 배열 (48개, 12개 카테고리) - path 기반으로 MD 파일에서 로드
        const TIPS_CONTENTS = [
            // === 프로젝트 시작 (4개) ===
            { category: '프로젝트 시작', title: '작업 디렉터리 구조 먼저 생성하기', path: 'Tips/프로젝트_시작/작업_디렉터리_구조_먼저_생성하기.md' },
            { category: '프로젝트 시작', title: '디렉터리 구조 문서 만들기', path: 'Tips/프로젝트_시작/디렉터리_구조_문서_만들기.md' },
            { category: '프로젝트 시작', title: '프로젝트 진행 상황 문서 만들기', path: 'Tips/프로젝트_시작/프로젝트_진행_상황_문서_만들기.md' },
            { category: '프로젝트 시작', title: 'CLAUDE.md로 작업 참고사항 정리하기', path: 'Tips/프로젝트_시작/CLAUDE.md로_작업_참고사항_정리하기.md' },

            // === 설치/실행 (3개) ===
            { category: '설치/실행', title: 'Claude Code 설치 방법 및 오류 해결', path: 'Tips/설치_실행/Claude_Code_설치_방법_및_오류_해결.md' },
            { category: '설치/실행', title: '폴더에서 터미널 열어 실행하기', path: 'Tips/설치_실행/폴더에서_터미널_열어_실행하기.md' },
            { category: '설치/실행', title: '토큰 사용량 확인하기', path: 'Tips/설치_실행/토큰_사용량_확인하기.md' },

            // === 입력/편의 (2개) ===
            { category: '입력/편의', title: '음성으로 지시하기 - Windows 기본', path: 'Tips/입력_편의/음성으로_지시하기_-_Windows_기본.md' },
            { category: '입력/편의', title: '음성으로 지시하기 - AI 활용', path: 'Tips/입력_편의/음성으로_지시하기_-_AI_활용.md' },

            // === 도구 활용 (4개) ===
            { category: '도구 활용', title: '서브에이전트 효과적으로 활용하기', path: 'Tips/도구_활용/서브에이전트_효과적으로_활용하기.md' },
            { category: '도구 활용', title: 'Slash Commands 활용하기', path: 'Tips/도구_활용/Slash_Commands_활용하기.md' },
            { category: '도구 활용', title: 'MCP 서버 설정 방법', path: 'Tips/도구_활용/MCP_서버_설정_방법.md' },
            { category: '도구 활용', title: 'Skills 활용하기', path: 'Tips/도구_활용/Skills_활용하기.md' },

            // === 작업 기록/백업 (5개) ===
            { category: '작업 기록/백업', title: 'work_logs로 작업 기록 관리하기', path: 'Tips/작업_기록_백업/work_logs로_작업_기록_관리하기.md' },
            { category: '작업 기록/백업', title: 'Git으로 버전 관리하기', path: 'Tips/작업_기록_백업/Git으로_버전_관리하기.md' },
            { category: '작업 기록/백업', title: 'outbox에 작업 결과 저장하기', path: 'Tips/작업_기록_백업/outbox에_작업_결과_저장하기.md' },
            { category: '작업 기록/백업', title: '중요한 파일 주기적으로 백업하기', path: 'Tips/작업_기록_백업/중요한_파일_주기적으로_백업하기.md' },
            { category: '작업 기록/백업', title: '.gitignore로 민감정보 보호하기', path: 'Tips/작업_기록_백업/.gitignore로_민감정보_보호하기.md' },

            // === 세션 관리 (3개) ===
            { category: '세션 관리', title: '세션 끊어졌을 때 복구하기', path: 'Tips/세션_관리/세션_끊어졌을_때_복구하기.md' },
            { category: '세션 관리', title: '헤매면 미련 없이 세션 정리하기', path: 'Tips/세션_관리/헤매면_미련_없이_세션_정리하기.md' },
            { category: '세션 관리', title: 'Google Drive 동기화 문제 해결', path: 'Tips/세션_관리/Google_Drive_동기화_문제_해결.md' },

            // === 검증/문서화 (3개) ===
            { category: '검증/문서화', title: '별도 서브에이전트로 검증하기', path: 'Tips/검증_문서화/별도_서브에이전트로_검증하기.md' },
            { category: '검증/문서화', title: '수시로 문서화 지시하기', path: 'Tips/검증_문서화/수시로_문서화_지시하기.md' },
            { category: '검증/문서화', title: '작업 규칙 CLAUDE.md에 업데이트하기', path: 'Tips/검증_문서화/작업_규칙_CLAUDE.md에_업데이트하기.md' },

            // === 개발 실무 (6개) ===
            { category: '개발 실무', title: '반응형 디자인은 별도로 요청하기', path: 'Tips/개발_실무/반응형_디자인은_별도로_요청하기.md' },
            { category: '개발 실무', title: '최적화/성능 개선 작업 시키기', path: 'Tips/개발_실무/최적화_성능_개선_작업_시키기.md' },
            { category: '개발 실무', title: 'GitHub Push/Pull로 작업 반영하기', path: 'Tips/개발_실무/GitHub_Push_Pull로_작업_반영하기.md' },
            { category: '개발 실무', title: '인증 코드는 숫자 6자리로', path: 'Tips/개발_실무/인증_코드는_숫자_6자리로.md' },
            { category: '개발 실무', title: '폴더 정리 및 임의 생성 금지 규칙', path: 'Tips/개발_실무/폴더_정리_및_임의_생성_금지_규칙.md' },
            { category: '개발 실무', title: '파일 저장 위치 확인하기', path: 'Tips/개발_실무/파일_저장_위치_확인하기.md' },

            // === 효율적인 소통 (5개) ===
            { category: '효율적인 소통', title: '3가지 이상 대안 요청하기', path: 'Tips/효율적인_소통/3가지_이상_대안_요청하기.md' },
            { category: '효율적인 소통', title: '이해될 때까지 질문하기', path: 'Tips/효율적인_소통/이해될_때까지_질문하기.md' },
            { category: '효율적인 소통', title: 'Claude Code에게 사용법 물어보기', path: 'Tips/효율적인_소통/Claude_Code에게_사용법_물어보기.md' },
            { category: '효율적인 소통', title: '구체적으로 질문하는 방법', path: 'Tips/효율적인_소통/구체적으로_질문하는_방법.md' },
            { category: '효율적인 소통', title: '단계별로 요청하기', path: 'Tips/효율적인_소통/단계별로_요청하기.md' },

            // === 데이터베이스 (4개) ===
            { category: '데이터베이스', title: 'DB 삭제해도 복구 가능', path: 'Tips/데이터베이스/DB_삭제해도_복구_가능.md' },
            { category: '데이터베이스', title: 'SQL 직접 실행해야 할 경우', path: 'Tips/데이터베이스/SQL_직접_실행해야_할_경우.md' },
            { category: '데이터베이스', title: 'Supabase RLS 정책 관리', path: 'Tips/데이터베이스/Supabase_RLS_정책_관리.md' },
            { category: '데이터베이스', title: 'Supabase 쿼리 최적화', path: 'Tips/데이터베이스/Supabase_쿼리_최적화.md' },

            // === SAL Grid (4개) ===
            { category: 'SAL Grid', title: 'Task를 작게 나누는 기준', path: 'Tips/SAL_Grid/Task를_작게_나누는_기준.md' },
            { category: 'SAL Grid', title: 'Phase Gate 검증 체크리스트', path: 'Tips/SAL_Grid/Phase_Gate_검증_체크리스트.md' },
            { category: 'SAL Grid', title: 'Task ID로 파일 관리하기', path: 'Tips/SAL_Grid/Task_ID로_파일_관리하기.md' },
            { category: 'SAL Grid', title: '검증 완료 후 문서화하기', path: 'Tips/SAL_Grid/검증_완료_후_문서화하기.md' },

            // === 트러블슈팅 (5개) ===
            { category: '트러블슈팅', title: '브라우저 콘솔 에러 확인하기', path: 'Tips/트러블슈팅/브라우저_콘솔_에러_확인하기.md' },
            { category: '트러블슈팅', title: '에러 핸들링 패턴', path: 'Tips/트러블슈팅/에러_핸들링_패턴.md' },
            { category: '트러블슈팅', title: '로컬 서버 실행 방법', path: 'Tips/트러블슈팅/로컬_서버_실행_방법.md' },
            { category: '트러블슈팅', title: 'API 키 보안 관리', path: 'Tips/트러블슈팅/API_키_보안_관리.md' },
            { category: '트러블슈팅', title: '환경변수 관리 베스트 프랙티스', path: 'Tips/트러블슈팅/환경변수_관리_베스트_프랙티스.md' }
        ];

        // 현재 선택된 카테고리 (전체 보기용)
        let currentTipsCategory = '전체';

        /**
         * Tips 사이드바 검색
         */
        function searchTipsLocal(query) {
            const resultsDiv = document.getElementById('tipsSearchResults');

            if (!query || query.trim() === '') {
                resultsDiv.innerHTML = '';
                return;
            }

            const searchTerm = query.toLowerCase();
            const results = TIPS_CONTENTS.filter(item =>
                item.title.toLowerCase().includes(searchTerm) ||
                
                item.category.toLowerCase().includes(searchTerm)
            );

            if (results.length === 0) {
                resultsDiv.innerHTML = `
                    <div style="padding: 15px; text-align: center; color: #666; font-size: 13px;">
                        🔍 "${query}"에 대한 검색 결과가 없습니다.
                    </div>
                `;
                return;
            }

            let html = `
                <div style="padding: 8px 12px; background: #F5F3FF; border-radius: 6px; margin-bottom: 8px; font-size: 11px; color: #7C3AED;">
                    🔍 검색 결과: ${results.length}개
                </div>
            `;

            results.forEach(item => {
                html += `
                    <div style="padding: 10px 12px; margin-bottom: 6px; background: white; border-radius: 6px; cursor: pointer; border: 1px solid #e5e7eb; transition: all 0.2s;"
                         onclick="showTipDetail('${item.category}', '${item.title.replace(/'/g, "\\'")}')"
                         onmouseover="this.style.borderColor='#8B5CF6'; this.style.background='#F5F3FF';"
                         onmouseout="this.style.borderColor='#e5e7eb'; this.style.background='white';">
                        <div style="display: flex; align-items: center; gap: 8px; margin-bottom: 4px;">
                            <span style="font-size: 14px;">💡</span>
                            <span style="font-size: 14px; font-weight: 500; color: #333;">${item.title}</span>
                        </div>
                        <div style="font-size: 11px; color: #8B5CF6;">
                            ${item.category}
                        </div>
                    </div>
                `;
            });

            resultsDiv.innerHTML = html;
        }

        /**
         * Tip 상세 보기 (MD 파일 fetch)
         */
        async function showTipDetail(category, title) {
            const item = TIPS_CONTENTS.find(i => i.category === category && i.title === title);
            if (!item) return;

            // 로딩 오버레이 먼저 표시
            const overlay = document.createElement('div');
            overlay.className = 'tips-modal-overlay';
            overlay.style.cssText = 'position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0, 0, 0, 0.6); display: flex; align-items: center; justify-content: center; z-index: 10001;';

            const modal = document.createElement('div');
            modal.style.cssText = 'background: white; border-radius: 12px; max-width: 900px; width: 95%; max-height: 90vh; overflow: hidden; box-shadow: 0 10px 40px rgba(0, 0, 0, 0.3);';

            // 로딩 상태 표시
            modal.innerHTML = `
                <div style="background: linear-gradient(135deg, #8B5CF6 0%, #7C3AED 100%); padding: 20px 24px; display: flex; justify-content: space-between; align-items: flex-start; border-radius: 12px 12px 0 0;">
                    <div>
                        <div style="display: flex; align-items: center; gap: 8px; margin-bottom: 8px;">
                            <span style="font-size: 20px;">💡</span>
                            <span style="background: rgba(255,255,255,0.2); padding: 2px 8px; border-radius: 4px; font-size: 11px; color: white;">${item.category}</span>
                        </div>
                        <div style="font-size: 16px; font-weight: 700; color: white; line-height: 1.3;">
                            ${item.title}
                        </div>
                    </div>
                    <button onclick="this.closest('.tips-modal-overlay').remove()"
                            style="background: rgba(255, 255, 255, 0.2); border: none; color: white; font-size: 20px; cursor: pointer; width: 28px; height: 28px; border-radius: 50%; display: flex; align-items: center; justify-content: center; flex-shrink: 0;">
                        ×
                    </button>
                </div>
                <div id="tipContentArea" style="padding: 20px 24px; line-height: 1.7; color: #495057; font-size: 14px; overflow-y: auto; max-height: calc(90vh - 140px);">
                    <div style="text-align: center; padding: 40px;">
                        <div style="font-size: 24px; margin-bottom: 12px;">⏳</div>
                        <div>콘텐츠를 불러오는 중...</div>
                    </div>
                </div>
                <div style="padding: 12px 24px; border-top: 1px solid #dee2e6; text-align: right; background: #f8f9fa; border-radius: 0 0 12px 12px;">
                    <button onclick="this.closest('.tips-modal-overlay').remove()"
                            style="padding: 8px 20px; background: #8B5CF6; color: white; border: none; border-radius: 6px; cursor: pointer; font-size: 13px; font-weight: 500;">
                        닫기
                    </button>
                </div>
            `;

            overlay.appendChild(modal);
            overlay.onclick = (e) => {
                if (e.target === overlay) overlay.remove();
            };

            document.body.appendChild(overlay);

            // MD 파일 fetch
            try {
                const url = GITHUB_RAW_BASE + '/부수적_고유기능/콘텐츠/' + item.path;
                const response = await fetch(url);

                if (!response.ok) {
                    throw new Error('파일을 찾을 수 없습니다.');
                }

                const mdContent = await response.text();

                // marked.js로 MD를 HTML로 변환
                const htmlContent = marked.parse(mdContent);

                // 콘텐츠 영역 업데이트
                const contentArea = document.getElementById('tipContentArea');
                if (contentArea) {
                    contentArea.innerHTML = htmlContent;
                }
            } catch (error) {
                console.error('Tip 로드 오류:', error);
                const contentArea = document.getElementById('tipContentArea');
                if (contentArea) {
                    contentArea.innerHTML = `
                        <div style="text-align: center; padding: 40px; color: #dc3545;">
                            <div style="font-size: 24px; margin-bottom: 12px;">❌</div>
                            <div>콘텐츠를 불러올 수 없습니다.</div>
                            <div style="font-size: 11px; margin-top: 8px; color: #6c757d;">${error.message}</div>
                        </div>
                    `;
                }
            }
        }

        /**
         * 외부 연동 설정 Guide - MD 파일 경로 매핑
         */
        // GitHub Raw URL 베이스
        const GITHUB_RAW_BASE = 'https://raw.githubusercontent.com/SUNWOONGKYU/SSALWorks/master';

        const SERVICE_GUIDE_PATHS = {
            'database': `${GITHUB_RAW_BASE}/부수적_고유기능/콘텐츠/외부_연동_설정_Guide/01_데이터베이스_설정.md`,
            'auth': `${GITHUB_RAW_BASE}/부수적_고유기능/콘텐츠/외부_연동_설정_Guide/02_회원인증_설정.md`,
            'email': `${GITHUB_RAW_BASE}/부수적_고유기능/콘텐츠/외부_연동_설정_Guide/03_이메일_시스템_설정.md`,
            'deploy': `${GITHUB_RAW_BASE}/부수적_고유기능/콘텐츠/외부_연동_설정_Guide/04_배포_도메인_설정.md`,
            'payment': `${GITHUB_RAW_BASE}/부수적_고유기능/콘텐츠/외부_연동_설정_Guide/05_결제_시스템_설정.md`
        };

        const SERVICE_GUIDE_TITLES = {
            'database': '🗄️ 데이터베이스 설정 (Supabase DB + RLS)',
            'auth': '🔐 회원인증 설정 (Google OAuth + Supabase)',
            'email': '📧 이메일 시스템 설정 (Resend + SMTP)',
            'deploy': '🚀 배포/도메인 설정 (Vercel + Whois)',
            'payment': '💳 결제 시스템 설정 (토스 페이먼트)'
        };

        /**
         * 외부 연동 설정 Guide 전체 목록 뷰어
         */
        function openServiceGuideViewer() {
            const overlay = document.createElement('div');
            overlay.className = 'service-guide-viewer-overlay';
            overlay.style.cssText = 'position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0, 0, 0, 0.6); display: flex; align-items: center; justify-content: center; z-index: 10000;';

            const modal = document.createElement('div');
            modal.className = 'service-guide-viewer-modal';
            modal.style.cssText = 'background: white; border-radius: 12px; max-width: 900px; width: 95%; max-height: 90vh; display: flex; flex-direction: column; box-shadow: 0 10px 40px rgba(0, 0, 0, 0.3); position: relative;';

            const guideItems = [
                { id: 'database', icon: '🗄️', title: '데이터베이스 설정', desc: 'Supabase 프로젝트 + DB + RLS' },
                { id: 'auth', icon: '🔐', title: '회원인증 설정', desc: 'Google OAuth + Supabase Auth' },
                { id: 'email', icon: '📧', title: '이메일 시스템 설정', desc: 'Resend + SMTP + 템플릿' },
                { id: 'deploy', icon: '🚀', title: '배포/도메인 설정', desc: 'Vercel + Whois DNS' },
                { id: 'payment', icon: '💳', title: '결제 시스템 설정', desc: '토스 페이먼트 연동' }
            ];

            const itemsHtml = guideItems.map(item => `
                <div onclick="this.closest('.service-guide-viewer-overlay').remove(); openServiceGuide('${item.id}')"
                     style="padding: 14px 16px; border-bottom: 1px solid #E5E7EB; cursor: pointer; display: flex; align-items: center; gap: 12px; transition: background 0.2s;"
                     onmouseover="this.style.background='#FEF3C7'" onmouseout="this.style.background='transparent'">
                    <span style="font-size: 24px;">${item.icon}</span>
                    <div>
                        <div style="font-weight: 600; color: #1F2937; font-size: 14px;">${item.title}</div>
                        <div style="font-size: 11px; color: #6B7280; margin-top: 2px;">${item.desc}</div>
                    </div>
                    <span style="margin-left: auto; color: #9CA3AF;">▶</span>
                </div>
            `).join('');

            modal.innerHTML = `
                <div style="background: linear-gradient(135deg, #F59E0B 0%, #D97706 100%); padding: 16px 20px; display: flex; justify-content: space-between; align-items: center; border-radius: 12px 12px 0 0;">
                    <div style="font-size: 18px; font-weight: 700; color: white;">🔗 외부 연동 설정 Guide</div>
                    <button onclick="this.closest('.service-guide-viewer-overlay').remove()"
                            style="background: rgba(255, 255, 255, 0.2); border: none; color: white; font-size: 20px; cursor: pointer; width: 32px; height: 32px; border-radius: 50%; display: flex; align-items: center; justify-content: center;">
                        ×
                    </button>
                </div>
                <div style="padding: 12px 16px; background: #FEF3C7; border-bottom: 1px solid #F59E0B; font-size: 13px; color: #92400E; line-height: 1.5;">
                    ⚠️ <strong>안내:</strong> 아래 항목들은 AI가 직접 수행할 수 없어 <strong>사용자가 직접 설정</strong>해야 합니다.<br>
                    각 가이드의 내용을 복사하여 Claude Code에 붙여넣고 안내에 따라 진행하세요.
                </div>
                <div style="flex: 1; overflow-y: auto;">
                    ${itemsHtml}
                </div>
            `;

            overlay.appendChild(modal);
            overlay.onclick = (e) => {
                if (e.target === overlay) overlay.remove();
            };

            document.body.appendChild(overlay);
        }

        /**
         * 외부 연동 설정 Guide 열기
         */
        async function openServiceGuide(serviceId) {
            const fileUrl = SERVICE_GUIDE_PATHS[serviceId];
            const title = SERVICE_GUIDE_TITLES[serviceId];

            if (!fileUrl) {
                showStatus('⚠️ 해당 가이드는 아직 준비 중입니다.', 'warning');
                return;
            }

            try {
                // GitHub Raw URL에서 MD 파일 로드
                const response = await fetch(fileUrl);

                if (!response.ok) {
                    showStatus('❌ 가이드 파일을 불러올 수 없습니다.', 'error');
                    return;
                }

                const mdContent = await response.text();

                // 모달 생성
                const overlay = document.createElement('div');
                overlay.className = 'service-guide-overlay';
                overlay.style.cssText = 'position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0, 0, 0, 0.6); display: flex; align-items: center; justify-content: center; z-index: 10000;';

                const modal = document.createElement('div');
                modal.className = 'service-guide-modal';
                modal.style.cssText = 'background: white; border-radius: 12px; max-width: 900px; width: 95%; max-height: 90vh; display: flex; flex-direction: column; box-shadow: 0 10px 40px rgba(0, 0, 0, 0.3); position: relative;';

                modal.innerHTML = `
                    <div class="service-guide-modal-header" style="background: linear-gradient(135deg, #F59E0B 0%, #D97706 100%); padding: 16px 20px; display: flex; justify-content: space-between; align-items: center; border-radius: 12px 12px 0 0; cursor: move; user-select: none;">
                        <div style="font-size: 18px; font-weight: 700; color: white; pointer-events: none;">${title} <span style="font-size: 11px; opacity: 0.8;">- 드래그하여 이동</span></div>
                        <div style="display: flex; gap: 8px;">
                            <button onclick="copyServiceGuideContent()" title="마크다운 복사"
                                    style="background: rgba(255, 255, 255, 0.2); border: none; color: white; font-size: 14px; cursor: pointer; width: 32px; height: 32px; border-radius: 50%; display: flex; align-items: center; justify-content: center;">
                                📋
                            </button>
                            <button onclick="this.closest('.service-guide-overlay').remove()"
                                    style="background: rgba(255, 255, 255, 0.2); border: none; color: white; font-size: 20px; cursor: pointer; width: 32px; height: 32px; border-radius: 50%; display: flex; align-items: center; justify-content: center;">
                                ×
                            </button>
                        </div>
                    </div>
                    <div style="padding: 8px 16px; background: #FEF3C7; border-bottom: 1px solid #F59E0B; font-size: 11px; color: #92400E;">
                        💡 <strong>복사해서 사용하세요:</strong> 📋 버튼을 클릭하면 마크다운 원본이 클립보드에 복사됩니다.
                    </div>
                    <div id="serviceGuideContent" style="flex: 1; overflow-y: auto; padding: 20px;">
                        <pre style="white-space: pre-wrap; word-wrap: break-word; font-family: 'Noto Sans KR', monospace; font-size: 13px; line-height: 1.7; color: #374151; background: #F9FAFB; padding: 16px; border-radius: 8px; border: 1px solid #E5E7EB;">${escapeHtml(mdContent)}</pre>
                    </div>
                `;

                // 마크다운 원본 저장 (복사용)
                modal.dataset.mdContent = mdContent;

                overlay.appendChild(modal);
                overlay.onclick = (e) => {
                    if (e.target === overlay) overlay.remove();
                };

                document.body.appendChild(overlay);

                // 드래그 기능 추가
                const header = modal.querySelector('.service-guide-modal-header');
                let isDragging = false;
                let startX, startY, initialX, initialY;

                header.addEventListener('mousedown', (e) => {
                    if (e.target.tagName === 'BUTTON') return;
                    isDragging = true;
                    startX = e.clientX;
                    startY = e.clientY;
                    const rect = modal.getBoundingClientRect();
                    initialX = rect.left;
                    initialY = rect.top;
                    overlay.style.alignItems = 'flex-start';
                    overlay.style.justifyContent = 'flex-start';
                    modal.style.position = 'fixed';
                    modal.style.left = initialX + 'px';
                    modal.style.top = initialY + 'px';
                    modal.style.margin = '0';
                    e.preventDefault();
                });

                document.addEventListener('mousemove', (e) => {
                    if (!isDragging) return;
                    const deltaX = e.clientX - startX;
                    const deltaY = e.clientY - startY;
                    let newX = initialX + deltaX;
                    let newY = initialY + deltaY;
                    const modalRect = modal.getBoundingClientRect();
                    newX = Math.max(0, Math.min(newX, window.innerWidth - modalRect.width));
                    newY = Math.max(0, Math.min(newY, window.innerHeight - modalRect.height));
                    modal.style.left = newX + 'px';
                    modal.style.top = newY + 'px';
                });

                document.addEventListener('mouseup', () => {
                    isDragging = false;
                });

            } catch (error) {
                console.error('서비스 가이드 로드 실패:', error);
                showStatus('❌ 서버 연결 실패. Bridge 서버가 실행 중인지 확인하세요.', 'error');
            }
        }

        /**
         * 서비스 가이드 마크다운 복사
         */
        function copyServiceGuideContent() {
            const modal = document.querySelector('.service-guide-modal');
            if (modal && modal.dataset.mdContent) {
                navigator.clipboard.writeText(modal.dataset.mdContent).then(() => {
                    showStatus('✅ 마크다운이 클립보드에 복사되었습니다!', 'success');
                }).catch(err => {
                    showStatus('❌ 복사 실패', 'error');
                });
            }
        }

        /**
         * HTML 이스케이프 (XSS 방지)
         */
        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }

        /**
         * Tips 전체 보기 모달 (아코디언 방식)
         */
        function openTipsViewer() {
            // 카테고리 목록 추출
            const categories = [...new Set(TIPS_CONTENTS.map(item => item.category))];
            currentTipsCategory = '전체';

            const overlay = document.createElement('div');
            overlay.className = 'tips-viewer-overlay';
            overlay.style.cssText = 'position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0, 0, 0, 0.6); display: flex; align-items: center; justify-content: center; z-index: 10000;';

            const modal = document.createElement('div');
            modal.className = 'tips-modal-draggable';
            modal.style.cssText = 'background: white; border-radius: 12px; max-width: 900px; width: 95%; max-height: 90vh; display: flex; flex-direction: column; box-shadow: 0 10px 40px rgba(0, 0, 0, 0.3); position: relative;';

            // 카테고리 버튼 HTML 생성
            let categoryBtnsHtml = `<button class="tips-category-btn active" data-category="전체" onclick="filterTipsByCategory('전체')">전체</button>`;
            categories.forEach(cat => {
                categoryBtnsHtml += `<button class="tips-category-btn" data-category="${cat}" onclick="filterTipsByCategory('${cat}')">${cat}</button>`;
            });

            modal.innerHTML = `
                <div class="tips-modal-header" style="background: linear-gradient(135deg, #8B5CF6 0%, #7C3AED 100%); padding: 16px 20px; display: flex; justify-content: space-between; align-items: center; border-radius: 12px 12px 0 0; cursor: move; user-select: none;">
                    <div style="font-size: 18px; font-weight: 700; color: white; pointer-events: none;">💡 Tips (${TIPS_CONTENTS.length}개) <span style="font-size: 11px; opacity: 0.8;">- 드래그하여 이동</span></div>
                    <button onclick="this.closest('.tips-viewer-overlay').remove()"
                            style="background: rgba(255, 255, 255, 0.2); border: none; color: white; font-size: 20px; cursor: pointer; width: 32px; height: 32px; border-radius: 50%; display: flex; align-items: center; justify-content: center;">
                        ×
                    </button>
                </div>
                <div style="padding: 12px 16px; border-bottom: 1px solid #E5E7EB;">
                    <input type="text" id="tipsViewerSearch" placeholder="🔍 Tips 검색..."
                           oninput="filterTipsInViewer(this.value)"
                           style="width: 100%; padding: 10px 14px; border: 1px solid #DDD6FE; border-radius: 8px; font-size: 14px; outline: none; transition: border-color 0.2s;"
                           onfocus="this.style.borderColor='#8B5CF6'"
                           onblur="this.style.borderColor='#DDD6FE'">
                </div>
                <div style="padding: 8px 16px; border-bottom: 1px solid #E5E7EB; display: flex; gap: 6px; flex-wrap: wrap;">
                    ${categoryBtnsHtml}
                </div>
                <style>
                    .tips-category-btn {
                        padding: 5px 12px;
                        border: 1px solid #DDD6FE;
                        border-radius: 16px;
                        background: white;
                        color: #7C3AED;
                        font-size: 11px;
                        cursor: pointer;
                        transition: all 0.2s;
                    }
                    .tips-category-btn:hover {
                        background: #F5F3FF;
                    }
                    .tips-category-btn.active {
                        background: #8B5CF6;
                        color: white;
                        border-color: #8B5CF6;
                    }
                    .tip-accordion {
                        margin-bottom: 6px;
                        border: 1px solid #E5E7EB;
                        border-radius: 8px;
                        overflow: hidden;
                        transition: all 0.2s;
                    }
                    .tip-accordion:hover {
                        border-color: #8B5CF6;
                    }
                    .tip-accordion-header {
                        padding: 12px 14px;
                        background: #FAFAFA;
                        cursor: pointer;
                        display: flex;
                        align-items: center;
                        justify-content: space-between;
                        transition: background 0.2s;
                    }
                    .tip-accordion-header:hover {
                        background: #F5F3FF;
                    }
                    .tip-accordion.open .tip-accordion-header {
                        background: #F5F3FF;
                        border-bottom: 1px solid #E5E7EB;
                    }
                    .tip-accordion-title {
                        font-size: 14px;
                        font-weight: 500;
                        color: #374151;
                        display: flex;
                        align-items: center;
                        gap: 8px;
                    }
                    .tip-accordion-arrow {
                        font-size: 10px;
                        color: #8B5CF6;
                        transition: transform 0.2s;
                    }
                    .tip-accordion.open .tip-accordion-arrow {
                        transform: rotate(180deg);
                    }
                    .tip-accordion-content {
                        padding: 0;
                        max-height: 0;
                        overflow: hidden;
                        background: white;
                        transition: max-height 0.3s ease, padding 0.3s ease;
                    }
                    .tip-accordion.open .tip-accordion-content {
                        padding: 14px;
                        max-height: 200px;
                    }
                    .tip-accordion-text {
                        font-size: 14px;
                        line-height: 1.6;
                        color: #4B5563;
                    }
                </style>
                <div id="tipsViewerContent" style="flex: 1; overflow-y: auto; padding: 16px;">
                    <!-- Tips 목록이 여기에 렌더링됨 -->
                </div>
            `;

            overlay.appendChild(modal);
            overlay.onclick = (e) => {
                if (e.target === overlay) overlay.remove();
            };

            document.body.appendChild(overlay);

            // 드래그 기능 추가
            const header = modal.querySelector('.tips-modal-header');
            let isDragging = false;
            let startX, startY, initialX, initialY;

            header.addEventListener('mousedown', (e) => {
                if (e.target.tagName === 'BUTTON') return; // 닫기 버튼 클릭 시 드래그 안함

                isDragging = true;
                startX = e.clientX;
                startY = e.clientY;

                // 현재 모달 위치 계산
                const rect = modal.getBoundingClientRect();
                initialX = rect.left;
                initialY = rect.top;

                // 중앙 정렬 해제하고 절대 위치로 변경
                overlay.style.alignItems = 'flex-start';
                overlay.style.justifyContent = 'flex-start';
                modal.style.position = 'fixed';
                modal.style.left = initialX + 'px';
                modal.style.top = initialY + 'px';
                modal.style.margin = '0';

                e.preventDefault();
            });

            document.addEventListener('mousemove', (e) => {
                if (!isDragging) return;

                const deltaX = e.clientX - startX;
                const deltaY = e.clientY - startY;

                let newX = initialX + deltaX;
                let newY = initialY + deltaY;

                // 화면 밖으로 나가지 않도록 제한
                const modalRect = modal.getBoundingClientRect();
                newX = Math.max(0, Math.min(newX, window.innerWidth - modalRect.width));
                newY = Math.max(0, Math.min(newY, window.innerHeight - modalRect.height));

                modal.style.left = newX + 'px';
                modal.style.top = newY + 'px';
            });

            document.addEventListener('mouseup', () => {
                isDragging = false;
            });

            // 초기 렌더링
            renderTipsInViewer(TIPS_CONTENTS);
        }

        /**
         * Tips 뷰어 내 목록 렌더링 (아코디언 방식)
         */
        function renderTipsInViewer(tips) {
            const contentDiv = document.getElementById('tipsViewerContent');
            if (!contentDiv) return;

            if (tips.length === 0) {
                contentDiv.innerHTML = `
                    <div style="padding: 40px; text-align: center; color: #9CA3AF;">
                        검색 결과가 없습니다.
                    </div>
                `;
                return;
            }

            // 카테고리별로 그룹화
            const byCategory = {};
            tips.forEach(item => {
                if (!byCategory[item.category]) byCategory[item.category] = [];
                byCategory[item.category].push(item);
            });

            let html = '';
            let tipIndex = 0;
            Object.keys(byCategory).forEach(category => {
                html += `
                    <div style="margin-bottom: 10px;">
                        <div style="font-size: 11px; font-weight: 600; color: #8B5CF6; margin-bottom: 6px; padding-left: 4px;">
                            📂 ${category} (${byCategory[category].length})
                        </div>
                `;
                byCategory[category].forEach(item => {
                    const escapedCategory = item.category.replace(/'/g, "\\'");
                    const escapedTitle = item.title.replace(/'/g, "\\'");
                    html += `
                        <div class="tip-item" onclick="showTipDetail('${escapedCategory}', '${escapedTitle}')"
                             style="padding: 12px 16px; margin-bottom: 8px; background: white; border-radius: 8px; cursor: pointer; border: 1px solid #e5e7eb; transition: all 0.2s;"
                             onmouseover="this.style.borderColor='#8B5CF6'; this.style.background='#F5F3FF';"
                             onmouseout="this.style.borderColor='#e5e7eb'; this.style.background='white';">
                            <div style="display: flex; align-items: center; gap: 8px;">
                                <span style="color: #8B5CF6;">💡</span>
                                <span style="font-size: 14px; font-weight: 500; color: #333;">${item.title}</span>
                            </div>
                        </div>
                    `;
                    tipIndex++;
                });
                html += '</div>';
            });

            contentDiv.innerHTML = html;
        }

        /**
         * 아코디언 토글
         */
        function toggleTipAccordion(index) {
            const accordion = document.getElementById(`tipAccordion${index}`);
            if (accordion) {
                accordion.classList.toggle('open');
            }
        }

        /**
         * Tips 뷰어 내 검색
         */
        function filterTipsInViewer(query) {
            const searchTerm = query.toLowerCase().trim();
            let filtered = TIPS_CONTENTS;

            // 카테고리 필터 적용
            if (currentTipsCategory !== '전체') {
                filtered = filtered.filter(item => item.category === currentTipsCategory);
            }

            // 검색어 필터 적용
            if (searchTerm) {
                filtered = filtered.filter(item =>
                    item.title.toLowerCase().includes(searchTerm)
                );
            }

            renderTipsInViewer(filtered);
        }

        /**
         * 카테고리 필터
         */
        function filterTipsByCategory(category) {
            currentTipsCategory = category;

            // 버튼 활성화 상태 변경
            document.querySelectorAll('.tips-category-btn').forEach(btn => {
                if (btn.dataset.category === category) {
                    btn.classList.add('active');
                } else {
                    btn.classList.remove('active');
                }
            });

            // 검색어도 함께 적용
            const searchInput = document.getElementById('tipsViewerSearch');
            const query = searchInput ? searchInput.value : '';
            filterTipsInViewer(query);
        }

        // 페이지 로드 시 Supabase 초기화
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', initSupabase);
        } else {
            initSupabase();
        }

        // URL 파라미터로 섹션 이동 처리
        window.addEventListener('load', function() {
            const urlParams = new URLSearchParams(window.location.search);
            const section = urlParams.get('section');

            if (section === 'learning') {
                setTimeout(scrollToLearningContent, 500);
            } else if (section === 'faq') {
                setTimeout(scrollToFaq, 500);
            }
        });
    </script>
<script src="guides.js"></script>
<script src="ordersheets.js"></script>
</body>

</html>