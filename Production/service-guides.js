// Auto-generated Service Guides
// Generated at: 2025-12-25T15:25:47.229Z

window.SERVICE_GUIDES = {
  "01_데이터베이스_설정": "# 데이터베이스 설정 가이드\n\n> Supabase Database + RLS 정책 설정\n\n---\n\n# Part A - 기초\n\n> PO(Project Owner; 사람)가 직접 해야 할 설정\n\n---\n\n## Step 1: Supabase 계정 만들기\n\n1. https://supabase.com 접속\n2. **\"Start your project\"** 클릭\n3. **\"Continue with GitHub\"** 클릭하여 로그인\n\n---\n\n## Step 2: 프로젝트 만들기\n\n1. **\"New Project\"** 클릭\n2. 아래 정보 입력:\n\n| 항목 | 입력 |\n|------|------|\n| Name | ssalworks |\n| Database Password | 강력한 비밀번호 (메모 필수) |\n| Region | Northeast Asia (Seoul) |\n\n3. **\"Create new project\"** 클릭\n\n---\n\n## Step 3: API 키 복사\n\n1. 왼쪽 메뉴 → **톱니바퀴 (Project Settings)** → **API**\n2. 아래 3가지를 메모장에 복사:\n\n| 항목 | 용도 |\n|------|------|\n| Project URL | 프로젝트 주소 |\n| anon public | 브라우저에서 사용 |\n| service_role | 서버에서만 사용 (노출 금지) |\n\n---\n\n## 체크리스트\n\n- [ ] Supabase 로그인 완료\n- [ ] 프로젝트 생성 완료\n- [ ] Database Password 메모 완료\n- [ ] Project URL 복사 완료\n- [ ] anon public key 복사 완료\n- [ ] service_role key 복사 완료\n\n---\n\n# Part B - 심화\n\n> Claude Code 참조용 기술 문서\n\n**전제조건**: Part A 완료 (프로젝트 생성, API 키 확보)\n\n---\n\n## 1. 환경변수 설정\n\n### 1.1 필요한 환경변수\n\n```bash\nSUPABASE_URL=https://[프로젝트ID].supabase.co\nSUPABASE_ANON_KEY=eyJhbGci...\nSUPABASE_SERVICE_ROLE_KEY=eyJhbGci...\n```\n\n### 1.2 Vercel 환경변수 등록\n\n```\nVercel Dashboard → Project → Settings → Environment Variables\n\n| Key                       | Environment |\n|---------------------------|-------------|\n| SUPABASE_URL              | All         |\n| SUPABASE_ANON_KEY         | All         |\n| SUPABASE_SERVICE_ROLE_KEY | All         |\n```\n\n### 1.3 API 키 사용 구분\n\n```javascript\n// 브라우저용 (anon key)\nconst supabaseClient = supabase.createClient(\n  SUPABASE_URL,\n  SUPABASE_ANON_KEY\n);\n\n// 서버용 (service_role key, RLS 우회)\nconst supabaseAdmin = supabase.createClient(\n  SUPABASE_URL,\n  SUPABASE_SERVICE_ROLE_KEY\n);\n```\n\n---\n\n## 2. 테이블 생성\n\n### 2.1 SQL Editor 접근\n\n```\nSupabase Dashboard → SQL Editor → New query\n```\n\n### 2.2 users 테이블\n\n```sql\nCREATE TABLE users (\n  user_id UUID PRIMARY KEY REFERENCES auth.users(id) ON DELETE CASCADE,\n  email TEXT UNIQUE NOT NULL,\n  nickname TEXT,\n  name TEXT,\n  role TEXT DEFAULT 'user',\n  is_active BOOLEAN DEFAULT true,\n  subscription_status TEXT DEFAULT 'none',\n  terms_agreed BOOLEAN DEFAULT false,\n  privacy_agreed BOOLEAN DEFAULT false,\n  marketing_agreed BOOLEAN DEFAULT false,\n  created_at TIMESTAMPTZ DEFAULT NOW(),\n  updated_at TIMESTAMPTZ DEFAULT NOW()\n);\n\nALTER TABLE users ENABLE ROW LEVEL SECURITY;\n```\n\n### 2.3 notices 테이블\n\n```sql\nCREATE TABLE notices (\n  id UUID DEFAULT gen_random_uuid() PRIMARY KEY,\n  title TEXT NOT NULL,\n  content TEXT,\n  important BOOLEAN DEFAULT false,\n  created_at TIMESTAMPTZ DEFAULT NOW(),\n  updated_at TIMESTAMPTZ DEFAULT NOW()\n);\n\nALTER TABLE notices ENABLE ROW LEVEL SECURITY;\n```\n\n### 2.4 user_payment_methods 테이블\n\n```sql\nCREATE TABLE user_payment_methods (\n  id UUID DEFAULT gen_random_uuid() PRIMARY KEY,\n  user_id UUID REFERENCES users(user_id) ON DELETE CASCADE,\n  billing_key TEXT NOT NULL,\n  card_company TEXT,\n  card_number_masked TEXT,\n  is_default BOOLEAN DEFAULT false,\n  created_at TIMESTAMPTZ DEFAULT NOW()\n);\n\nALTER TABLE user_payment_methods ENABLE ROW LEVEL SECURITY;\n```\n\n---\n\n## 3. RLS 정책\n\n### 3.1 Role 구분\n\n| Role | 설명 |\n|------|------|\n| `public` | 모든 사용자 |\n| `anon` | 익명 사용자 |\n| `authenticated` | 로그인한 사용자 |\n\n### 3.2 users 테이블 RLS\n\n```sql\n-- 본인 데이터만 조회\nCREATE POLICY \"Users can view own data\"\nON users FOR SELECT\nTO authenticated\nUSING (auth.uid() = user_id);\n\n-- 본인 데이터만 수정\nCREATE POLICY \"Users can update own data\"\nON users FOR UPDATE\nTO authenticated\nUSING (auth.uid() = user_id);\n\n-- 회원가입 시 프로필 생성\nCREATE POLICY \"Users can insert own profile\"\nON users FOR INSERT\nTO authenticated\nWITH CHECK (auth.uid() = user_id);\n```\n\n### 3.3 notices 테이블 RLS\n\n```sql\n-- 모든 사용자 읽기 허용\nCREATE POLICY \"Anyone can read notices\"\nON notices FOR SELECT\nTO public\nUSING (true);\n\n-- 인증된 사용자만 쓰기\nCREATE POLICY \"Authenticated users can insert\"\nON notices FOR INSERT\nTO authenticated\nWITH CHECK (true);\n```\n\n---\n\n## 4. 트러블슈팅\n\n### 문제 1: 빈 결과 반환\n\n**증상**: 데이터가 있는데 빈 배열\n\n**해결**:\n```sql\nSELECT * FROM pg_policies WHERE tablename = '테이블명';\n```\n\n### 문제 2: 권한 오류 (403/401)\n\n**해결**: 서버에서는 `service_role key` 사용\n\n### 문제 3: API 키 오류\n\n**해결**: 키 복사 시 공백 확인, anon vs service_role 구분\n\n### 문제 4: Foreign Key 오류\n\n**해결**: 참조 테이블에 데이터 먼저 생성\n\n---\n\n## 5. 유용한 쿼리\n\n```sql\n-- 테이블 목록\nSELECT table_name FROM information_schema.tables\nWHERE table_schema = 'public';\n\n-- RLS 상태 확인\nSELECT tablename, rowsecurity FROM pg_tables\nWHERE schemaname = 'public';\n\n-- 정책 목록\nSELECT schemaname, tablename, policyname, cmd, roles\nFROM pg_policies\nWHERE schemaname = 'public';\n```\n\n---\n\n## 참고 문서\n\n- [Supabase 공식 문서](https://supabase.com/docs)\n- [RLS 가이드](https://supabase.com/docs/guides/auth/row-level-security)\n",
  "02_회원인증_설정": "# 회원인증 설정 가이드\n\n> Google OAuth + Supabase Auth 통합 설정\n\n---\n\n# Part A - 기초\n\n> PO(Project Owner; 사람)가 직접 해야 할 설정\n\n---\n\n## Step 1: Google Cloud Console 프로젝트 만들기\n\n1. https://console.cloud.google.com 접속\n2. Google 계정으로 로그인\n3. 상단 프로젝트 선택 → **\"새 프로젝트\"** 클릭\n4. 프로젝트 이름: `SSALWorks` 입력\n5. **\"만들기\"** 클릭\n\n---\n\n## Step 2: OAuth 동의 화면 설정\n\n1. 왼쪽 메뉴 → **\"API 및 서비스\"** → **\"OAuth 동의 화면\"**\n2. **\"외부\"** 선택 → **\"만들기\"**\n3. 아래 정보 입력:\n\n| 항목 | 입력 |\n|------|------|\n| 앱 이름 | SSALWorks |\n| 사용자 지원 이메일 | 본인 이메일 |\n| 개발자 연락처 | 본인 이메일 |\n\n4. **\"저장 후 계속\"** (범위 설정은 건너뛰기)\n5. 테스트 사용자에 본인 이메일 추가\n\n---\n\n## Step 3: OAuth 클라이언트 ID 만들기\n\n1. **\"사용자 인증 정보\"** → **\"+ 사용자 인증 정보 만들기\"** → **\"OAuth 클라이언트 ID\"**\n2. **\"웹 애플리케이션\"** 선택 (중요!)\n3. 이름: `SSALWorks Web Client`\n4. 승인된 리디렉션 URI 추가:\n   ```\n   https://[프로젝트ID].supabase.co/auth/v1/callback\n   ```\n5. **\"만들기\"** 클릭\n6. 아래 2가지 복사해서 메모:\n\n| 항목 | 형식 |\n|------|------|\n| 클라이언트 ID | `xxx.apps.googleusercontent.com` |\n| 클라이언트 보안 비밀번호 | `GOCSPX-xxx` |\n\n---\n\n## Step 4: Supabase에 Google 연결\n\n1. https://supabase.com 로그인 → 프로젝트 선택\n2. **\"Authentication\"** → **\"Providers\"** → **\"Google\"**\n3. 아래 정보 입력:\n\n| 항목 | 입력 |\n|------|------|\n| Google enabled | 켜기 |\n| Client ID | Step 3에서 복사한 클라이언트 ID |\n| Client Secret | Step 3에서 복사한 보안 비밀번호 |\n\n4. **\"Save\"** 클릭\n\n---\n\n## 체크리스트\n\n- [ ] Google Cloud 프로젝트 생성 완료\n- [ ] OAuth 동의 화면 설정 완료\n- [ ] OAuth 클라이언트 ID 생성 (**웹 애플리케이션** 타입)\n- [ ] 리디렉션 URI 추가 완료\n- [ ] 클라이언트 ID 복사 완료\n- [ ] 클라이언트 보안 비밀번호 복사 완료\n- [ ] Supabase Google Provider 활성화 완료\n\n---\n\n# Part B - 심화\n\n> Claude Code 참조용 기술 문서\n\n**전제조건**: Part A 완료 (Google OAuth 설정, Supabase Provider 활성화)\n\n---\n\n## 1. 환경변수 설정\n\n```bash\nSUPABASE_URL=https://xxx.supabase.co\nSUPABASE_ANON_KEY=eyJhbGci...\n\n# 선택 (Supabase Provider에서 관리)\nGOOGLE_CLIENT_ID=xxx.apps.googleusercontent.com\nGOOGLE_CLIENT_SECRET=GOCSPX-xxx\n```\n\n---\n\n## 2. Supabase Redirect URLs 설정\n\n```\nDashboard → Authentication → URL Configuration\n\nSite URL: https://yourdomain.com\n\nRedirect URLs:\n- http://localhost:3000/**\n- http://localhost:8888/**\n- https://yourdomain.com/**\n- https://*.vercel.app/**\n```\n\n---\n\n## 3. 프론트엔드 구현\n\n### 3.1 Supabase Client 초기화\n\n```html\n<script src=\"https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2\"></script>\n\n<script>\nconst SUPABASE_URL = 'https://[프로젝트ID].supabase.co';\nconst SUPABASE_ANON_KEY = 'eyJhbGci...';\n\nconst { createClient } = supabase;\nconst supabaseClient = createClient(SUPABASE_URL, SUPABASE_ANON_KEY);\n</script>\n```\n\n### 3.2 Google 로그인\n\n```javascript\nasync function handleGoogleLogin() {\n    const { data, error } = await supabaseClient.auth.signInWithOAuth({\n        provider: 'google',\n        options: {\n            redirectTo: window.location.origin + '/index.html',\n            queryParams: {\n                access_type: 'offline',\n                prompt: 'consent'\n            }\n        }\n    });\n\n    if (error) {\n        console.error('로그인 오류:', error.message);\n    }\n}\n```\n\n### 3.3 세션 확인\n\n```javascript\nasync function checkSession() {\n    const { data: { session } } = await supabaseClient.auth.getSession();\n\n    if (session) {\n        console.log('로그인됨:', session.user.email);\n        return session.user;\n    }\n    return null;\n}\n```\n\n### 3.4 로그아웃\n\n```javascript\nasync function handleLogout() {\n    const { error } = await supabaseClient.auth.signOut();\n    if (!error) {\n        window.location.href = '/pages/auth/login.html';\n    }\n}\n```\n\n### 3.5 인증 상태 변경 감지\n\n```javascript\nsupabaseClient.auth.onAuthStateChange((event, session) => {\n    switch (event) {\n        case 'SIGNED_IN':\n            console.log('로그인:', session.user);\n            break;\n        case 'SIGNED_OUT':\n            console.log('로그아웃');\n            window.location.href = '/login';\n            break;\n        case 'TOKEN_REFRESHED':\n            console.log('토큰 갱신됨');\n            break;\n    }\n});\n```\n\n---\n\n## 4. users 테이블 동기화\n\nGoogle 로그인 시 `auth.users`에만 데이터가 생성됨. `public.users`와 동기화 필요.\n\n### 4.1 Trigger 함수\n\n```sql\nCREATE OR REPLACE FUNCTION public.handle_new_user()\nRETURNS TRIGGER AS $$\nBEGIN\n    INSERT INTO public.users (user_id, email, nickname)\n    VALUES (NEW.id, NEW.email, NEW.raw_user_meta_data->>'name')\n    ON CONFLICT (user_id) DO UPDATE SET\n        email = EXCLUDED.email,\n        nickname = EXCLUDED.nickname;\n    RETURN NEW;\nEND;\n$$ LANGUAGE plpgsql SECURITY DEFINER;\n```\n\n### 4.2 Trigger 적용\n\n```sql\nCREATE TRIGGER on_auth_user_created\n    AFTER INSERT ON auth.users\n    FOR EACH ROW EXECUTE FUNCTION public.handle_new_user();\n```\n\n---\n\n## 5. 트러블슈팅\n\n### 문제 1: redirect_uri_mismatch\n\n**해결**: Google Cloud Console에서 리디렉션 URI 정확히 추가\n```\nhttps://[프로젝트ID].supabase.co/auth/v1/callback\n```\n\n### 문제 2: 리디렉션 URI 입력란이 안 보임\n\n**해결**: OAuth 클라이언트 타입을 **\"웹 애플리케이션\"**으로 다시 생성\n\n### 문제 3: Unsupported provider\n\n**해결**: Supabase Authentication → Providers → Google → Enable 켜기\n\n### 문제 4: 로컬 테스트 시 페이지 오류\n\n**해결**: `file://` 프로토콜 금지. 로컬 서버 사용:\n```bash\nnpx serve . -l 8888\n```\n\n### 문제 5: 로그인 성공했는데 users 테이블에 없음\n\n**해결**: 위 \"4. users 테이블 동기화\" Trigger 적용\n\n---\n\n## 참고 문서\n\n- [Supabase Auth 가이드](https://supabase.com/docs/guides/auth)\n- [Google OAuth 설정](https://supabase.com/docs/guides/auth/social-login/auth-google)\n",
  "03_이메일_시스템_설정": "# 이메일 시스템 설정 가이드\n\n> Resend + Supabase SMTP + DKIM 인증\n\n---\n\n# Part A - 기초\n\n> PO(Project Owner; 사람)가 직접 해야 할 설정\n\n---\n\n## Step 1: Resend 계정 만들기\n\n1. https://resend.com 접속\n2. **\"Sign up\"** 클릭\n3. Google 또는 이메일로 가입\n\n---\n\n## Step 2: API Key 발급\n\n1. Dashboard → **API Keys** → **Create API Key**\n2. 아래 정보 입력:\n\n| 항목 | 입력 |\n|------|------|\n| Name | ssalworks-production |\n| Permission | Full access |\n\n3. **생성 즉시 복사** (한 번만 표시됨)\n4. API Key 형식: `re_xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx`\n\n---\n\n## Step 3: 도메인 등록\n\n1. Dashboard → **Domains** → **Add Domain**\n2. 본인 도메인 입력: `ssalworks.ai.kr`\n3. 상태: Pending (DKIM 인증 대기)\n\n---\n\n## Step 4: DKIM DNS 설정 (Whois)\n\n1. Resend Dashboard에서 도메인 클릭 → DNS Records 확인\n2. 아래 정보 복사:\n\n| Type | Name | Value |\n|------|------|-------|\n| TXT | resend._domainkey | `p=MIGfMA0GCSqGSIb3DQEBA...` (Resend 제공) |\n\n3. Whois 로그인 → 도메인 관리 → 부가서비스 → **네임서버 고급설정**\n4. **SPF(TXT) 레코드 관리** → 관리페이지 열기\n5. 위 정보 입력 후 저장\n6. DNS 전파 대기 (보통 1-2시간)\n7. Resend Dashboard에서 **\"Verify\"** 클릭\n\n---\n\n## Step 5: Supabase SMTP 설정\n\n1. Supabase Dashboard → **Settings** → **Auth** → **SMTP Settings**\n2. **Enable Custom SMTP**: ON\n3. 아래 정보 입력:\n\n| 항목 | 입력 |\n|------|------|\n| SMTP Host | smtp.resend.com |\n| SMTP Port | 587 |\n| SMTP Username | resend |\n| SMTP Password | [Resend API Key] |\n| Sender Email | noreply@ssalworks.ai.kr |\n| Sender Name | SSALWorks |\n\n---\n\n## Step 6: 이메일 템플릿 URL 수정\n\n1. Supabase → **Authentication** → **Email Templates** → **Confirm signup**\n2. 템플릿에서 URL 하드코딩:\n\n**변경 전**:\n```html\n<a href=\"{{ .SiteURL }}/auth/confirm?token_hash={{ .TokenHash }}&type=signup\">\n```\n\n**변경 후**:\n```html\n<a href=\"https://www.ssalworks.ai.kr/auth/callback?token_hash={{ .TokenHash }}&type=signup\">\n```\n\n3. Reset Password, Magic Link 템플릿도 동일하게 수정\n\n---\n\n## 체크리스트\n\n- [ ] Resend 계정 생성 완료\n- [ ] API Key 발급 및 복사 완료\n- [ ] 도메인 등록 완료\n- [ ] Whois DNS에 TXT 레코드 추가 완료\n- [ ] DKIM 인증 완료 (Verified)\n- [ ] Supabase SMTP 설정 완료\n- [ ] 이메일 템플릿 URL 수정 완료\n\n---\n\n# Part B - 심화\n\n> Claude Code 참조용 기술 문서\n\n**전제조건**: Part A 완료 (Resend 설정, DKIM 인증, Supabase SMTP 연동)\n\n---\n\n## 1. 환경변수 설정\n\n```bash\n# Supabase\nSUPABASE_URL=https://[프로젝트ID].supabase.co\nSUPABASE_ANON_KEY=eyJhbGci...\nSUPABASE_SERVICE_ROLE_KEY=eyJhbGci...\n\n# Resend\nRESEND_API_KEY=re_xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx\n\n# Site URL\nNEXT_PUBLIC_SITE_URL=https://www.ssalworks.ai.kr\n```\n\n---\n\n## 2. 전체 흐름\n\n```\n사용자 (회원가입)\n    ↓\nSupabase Auth\n    ↓ SMTP 요청\nResend (SMTP)\n    ↓ DKIM 검증\nDNS (Whois)\n    ↓\n사용자 이메일 수신\n    ↓ 링크 클릭\n앱 (/auth/callback)\n    ↓\n로그인 완료\n```\n\n---\n\n## 3. auth.users ↔ users 동기화\n\n### 3.1 문제\n\n이메일 인증 완료 후 로그인 실패:\n- `auth.users`에는 존재\n- `users` 테이블에는 없음\n\n### 3.2 회원가입 API에서 동기화\n\n```javascript\n// 회원가입 API\nexport async function POST(request) {\n  const { email, password, nickname } = await request.json();\n\n  // 1. Supabase Auth에 사용자 생성\n  const { data: authData, error: authError } = await supabase.auth.signUp({\n    email,\n    password,\n    options: {\n      data: { name: nickname },\n      emailRedirectTo: 'https://www.ssalworks.ai.kr/auth/callback',\n    },\n  });\n\n  if (authError) {\n    return Response.json({ error: authError.message }, { status: 400 });\n  }\n\n  // 2. users 테이블에 프로필 생성\n  const { error: profileError } = await supabaseAdmin\n    .from('users')\n    .insert({\n      user_id: authData.user.id,\n      email,\n      nickname,\n      role: 'user',\n      is_active: true,\n    });\n\n  // 3. 실패 시 롤백\n  if (profileError) {\n    await supabaseAdmin.auth.admin.deleteUser(authData.user.id);\n    return Response.json({ error: '회원가입 실패' }, { status: 500 });\n  }\n\n  return Response.json({ success: true });\n}\n```\n\n---\n\n## 4. 트러블슈팅\n\n### 문제 1: 이메일 링크가 잘못된 도메인\n\n**증상**: `https://ssalworks.ai.kr/...` (www 없음)\n\n**해결**: 템플릿에서 URL 하드코딩\n```html\n<a href=\"https://www.ssalworks.ai.kr/auth/callback?token_hash={{ .TokenHash }}&type=signup\">\n```\n\n### 문제 2: 이메일이 스팸으로 분류\n\n**해결**: DKIM 인증 완료 확인 (Resend Dashboard → Verified)\n\n### 문제 3: 인증 후 로그인 실패\n\n**해결**: `users` 테이블 동기화 확인 (위 3.2 참조)\n\n### 문제 4: RESEND_API_KEY not set\n\n**해결**:\n1. `.env.local` 파일 확인\n2. 키 복사 시 공백 확인\n3. 개발 서버 재시작\n\n---\n\n## 5. 템플릿 변수 비교\n\n| 변수 | 동작 | 권장 |\n|------|------|------|\n| `{{ .SiteURL }}` | Dashboard 설정값 | ❌ |\n| `{{ .ConfirmationURL }}` | 자동 생성 | △ |\n| `{{ .RedirectTo }}` | emailRedirectTo 값 | △ |\n| **하드코딩** | 직접 입력 | ✅ 가장 확실 |\n\n---\n\n## 참고 문서\n\n- [Supabase SMTP Configuration](https://supabase.com/docs/guides/auth/auth-smtp)\n- [Supabase Email Templates](https://supabase.com/docs/guides/auth/auth-email-templates)\n- [Resend Documentation](https://resend.com/docs)\n",
  "04_배포_도메인_설정": "# 배포 및 도메인 설정 가이드\n\n> Vercel + Whois DNS + 환경변수\n\n---\n\n# Part A - 기초\n\n> PO(Project Owner; 사람)가 직접 해야 할 설정\n\n---\n\n## Step 1: Vercel 프로젝트 생성\n\n1. https://vercel.com 접속 → GitHub 로그인\n2. **Add New...** → **Project**\n3. GitHub 저장소 선택\n4. 아래 정보 입력:\n\n| 항목 | 입력 |\n|------|------|\n| Project Name | ssal-works (소문자, 하이픈만) |\n| Framework Preset | Other |\n| Root Directory | Production/Frontend |\n| Build Command | (비워두기) |\n\n5. **Deploy** 클릭\n\n---\n\n## Step 2: 환경변수 설정\n\n1. Vercel → Project → **Settings** → **Environment Variables**\n2. 아래 환경변수 추가:\n\n| Key | Value |\n|-----|-------|\n| SUPABASE_URL | https://xxx.supabase.co |\n| SUPABASE_ANON_KEY | eyJxxx... |\n| SUPABASE_SERVICE_ROLE_KEY | eyJxxx... |\n| RESEND_API_KEY | re_xxx... |\n\n3. Environment: **All** 선택\n\n---\n\n## Step 3: Vercel에 도메인 추가\n\n1. Vercel → Project → **Settings** → **Domains**\n2. 도메인 입력: `www.ssalworks.ai.kr`\n3. **Add** 클릭\n4. 아래 정보 복사:\n\n| Type | Name | Value |\n|------|------|-------|\n| A | www | 76.76.21.21 |\n| TXT | _vercel | vc-domain-verify=... |\n\n---\n\n## Step 4: Whois DNS 설정\n\n1. https://whois.co.kr 로그인\n2. 도메인 관리 → 해당 도메인 선택\n3. 부가서비스 → **네임서버 고급설정**\n\n### A 레코드 추가\n1. **A 레코드 관리** → 관리페이지 열기\n2. 입력:\n\n| 호스트명 | IP 주소 |\n|----------|---------|\n| www | 76.76.21.21 |\n\n### TXT 레코드 추가\n1. **SPF(TXT) 레코드 관리** → 관리페이지 열기\n2. 입력:\n\n| 호스트명 | 값 |\n|----------|-----|\n| _vercel | vc-domain-verify=... (Vercel에서 복사) |\n\n---\n\n## Step 5: DNS 전파 확인\n\n1. 명령어로 확인:\n   ```\n   nslookup www.ssalworks.ai.kr 8.8.8.8\n   ```\n\n2. Vercel Dashboard에서 상태 확인:\n   - ⚠️ Verification Needed → 전파 대기\n   - ✅ Valid Configuration → 성공\n\n---\n\n## 체크리스트\n\n- [ ] Vercel 프로젝트 생성 완료\n- [ ] 환경변수 설정 완료\n- [ ] Vercel에 도메인 추가 완료\n- [ ] Whois A 레코드 추가 완료\n- [ ] Whois TXT 레코드 추가 완료\n- [ ] DNS 전파 확인 완료\n- [ ] https://www.ssalworks.ai.kr 접속 성공\n\n---\n\n# Part B - 심화\n\n> Claude Code 참조용 기술 문서\n\n**전제조건**: Part A 완료 (Vercel 배포, 도메인 연결)\n\n---\n\n## 1. 폴더 구조\n\n```\nProduction/\n├── Database/          ← DB 스키마/SQL\n└── Frontend/          ← Vercel Root Directory\n    ├── api/           ← Serverless Functions\n    │   ├── auth/\n    │   ├── email/\n    │   └── subscription/\n    ├── assets/\n    ├── pages/\n    ├── index.html\n    └── vercel.json\n```\n\n---\n\n## 2. vercel.json 설정\n\n```json\n{\n  \"version\": 2,\n  \"name\": \"ssalworks-v1\",\n  \"buildCommand\": null,\n  \"outputDirectory\": \".\",\n  \"framework\": null,\n  \"rewrites\": [\n    {\n      \"source\": \"/api/:path*\",\n      \"destination\": \"/api/:path*\"\n    }\n  ],\n  \"headers\": [\n    {\n      \"source\": \"/api/(.*)\",\n      \"headers\": [\n        { \"key\": \"Access-Control-Allow-Credentials\", \"value\": \"true\" },\n        { \"key\": \"Access-Control-Allow-Origin\", \"value\": \"*\" },\n        { \"key\": \"Access-Control-Allow-Methods\", \"value\": \"GET,POST,PUT,DELETE,OPTIONS\" },\n        { \"key\": \"Access-Control-Allow-Headers\", \"value\": \"X-CSRF-Token, X-Requested-With, Accept, Accept-Version, Content-Length, Content-MD5, Content-Type, Date, X-Api-Version, Authorization\" }\n      ]\n    }\n  ],\n  \"functions\": {\n    \"api/**/*.js\": {\n      \"maxDuration\": 30,\n      \"memory\": 1024\n    }\n  }\n}\n```\n\n---\n\n## 3. 트러블슈팅\n\n### 문제 1: Project Name 에러\n\n**증상**: `The name contains invalid characters`\n\n**해결**: 소문자, 숫자, 하이픈만 사용\n- ❌ `SSALWorks`\n- ✅ `ssal-works`\n\n### 문제 2: 함수 패턴 에러\n\n**증상**: `The pattern doesn't match any Serverless Functions`\n\n**해결**: vercel.json에서 존재하지 않는 패턴 제거\n\n### 문제 3: 도메인 소유권 확인\n\n**증상**: `This domain is linked to another Vercel account`\n\n**해결**:\n1. TXT 레코드 추가 (_vercel)\n2. DNS 전파 대기\n3. Vercel에서 \"Refresh\" 클릭\n\n### 문제 4: DNS_PROBE_FINISHED_NXDOMAIN\n\n**해결**: DNS 전파 완료까지 대기 (최대 48시간)\n\n### 문제 5: 특수문자 입력 불가\n\n**해결**: 일반 DNS 관리가 아닌 **네임서버 고급설정** 사용\n\n---\n\n## 4. 권장 설정\n\n| 항목 | 권장 값 |\n|------|---------|\n| 네임서버 | Whois 기본값 (ns1.whoisdomain.kr) |\n| DNS 관리 | Whois 네임서버 고급설정 |\n| 도메인 | www.ssalworks.ai.kr (www 포함) |\n| A 레코드 | 76.76.21.21 |\n\n---\n\n## 참고 문서\n\n- [Vercel - Adding a Domain](https://vercel.com/docs/projects/domains/add-a-domain)\n- [Vercel - Serverless Functions](https://vercel.com/docs/functions)\n- [Vercel - Environment Variables](https://vercel.com/docs/projects/environment-variables)\n",
  "05_결제_시스템_설정": "# 결제 시스템 설정 가이드\n\n> 토스페이먼츠 연동\n\n---\n\n# Part A - 기초\n\n> PO(Project Owner; 사람)가 직접 해야 할 설정\n\n---\n\n## Step 1: 토스페이먼츠 가입\n\n1. https://developers.tosspayments.com 접속\n2. 회원가입\n3. 개발자센터 로그인\n\n---\n\n## Step 2: 가맹점 신청\n\n1. 가맹점 심사 신청\n2. 필요 서류:\n\n| 서류 | 비고 |\n|------|------|\n| 사업자등록증 | 필수 |\n| 대표자 신분증 | 필수 |\n| 통장 사본 | 필수 |\n| 서비스 URL | 필수 |\n\n3. 심사 완료 대기 (1-2주 소요)\n\n---\n\n## Step 3: API 키 확인\n\n1. 개발자센터 → **내 개발정보** → **API 키**\n2. 아래 키 복사:\n\n**테스트 키** (심사 전 개발용):\n\n| 항목 | 형식 |\n|------|------|\n| 클라이언트 키 | test_ck_xxxxxxxxxxxxxxxx |\n| 시크릿 키 | test_sk_xxxxxxxxxxxxxxxx |\n\n**라이브 키** (심사 완료 후):\n\n| 항목 | 형식 |\n|------|------|\n| 클라이언트 키 | live_ck_xxxxxxxxxxxxxxxx |\n| 시크릿 키 | live_sk_xxxxxxxxxxxxxxxx |\n\n---\n\n## Step 4: 환경변수 설정\n\n1. Vercel → **Settings** → **Environment Variables**\n2. 아래 환경변수 추가:\n\n| Key | Value | Environment |\n|-----|-------|-------------|\n| TOSS_CLIENT_KEY | test_ck_xxx... | Preview, Development |\n| TOSS_SECRET_KEY | test_sk_xxx... | Preview, Development |\n| TOSS_CLIENT_KEY | live_ck_xxx... | Production |\n| TOSS_SECRET_KEY | live_sk_xxx... | Production |\n\n---\n\n## Step 5: 웹훅 URL 등록\n\n1. 개발자센터 → **웹훅 설정**\n2. 웹훅 URL 입력:\n   ```\n   https://www.ssalworks.ai.kr/api/webhook/toss\n   ```\n\n---\n\n## 체크리스트\n\n- [ ] 토스페이먼츠 개발자센터 가입 완료\n- [ ] 가맹점 심사 신청 완료\n- [ ] 테스트 API 키 확인 완료\n- [ ] 환경변수 설정 완료\n- [ ] 웹훅 URL 등록 완료\n- [ ] (심사 완료 후) 라이브 키 확인 완료\n\n---\n\n# Part B - 심화\n\n> Claude Code 참조용 기술 문서\n\n**전제조건**: Part A 완료 (토스페이먼츠 가입, API 키 확보)\n\n---\n\n## 1. 전체 흐름\n\n```\n사용자\n    ↓ 구독 결제 요청\nSSALWorks 앱\n    ↓ 카드 정보 입력 (토스 SDK)\n토스페이먼츠\n    ↓ 빌링키 발급\nSSALWorks API\n    ↓ 빌링키 저장\nSupabase (user_payment_methods)\n    ↓ 정기결제 실행\n토스페이먼츠\n    ↓ 결제 결과 웹훅\nSSALWorks API (/api/webhook/toss)\n    ↓ 구독 상태 업데이트\nSupabase (users.subscription_status)\n```\n\n---\n\n## 2. 토스 SDK 연동\n\n### 2.1 SDK 로드\n\n```html\n<script src=\"https://js.tosspayments.com/v1/payment\"></script>\n```\n\n### 2.2 빌링키 발급 요청\n\n```javascript\nconst tossPayments = TossPayments('test_ck_xxxxxxxxxxxxxxxx');\n\nasync function requestBillingKey() {\n  await tossPayments.requestBillingAuth('카드', {\n    customerKey: 'user_uuid_here',\n    successUrl: 'https://www.ssalworks.ai.kr/api/payment/billing/success',\n    failUrl: 'https://www.ssalworks.ai.kr/api/payment/billing/fail',\n  });\n}\n```\n\n---\n\n## 3. 빌링키 저장 (서버)\n\n```javascript\n// /api/payment/billing/success\nexport async function GET(request) {\n  const { authKey, customerKey } = request.query;\n\n  // 토스 API로 빌링키 발급 확정\n  const response = await fetch('https://api.tosspayments.com/v1/billing/authorizations/issue', {\n    method: 'POST',\n    headers: {\n      'Authorization': `Basic ${Buffer.from(TOSS_SECRET_KEY + ':').toString('base64')}`,\n      'Content-Type': 'application/json',\n    },\n    body: JSON.stringify({ authKey, customerKey }),\n  });\n\n  const { billingKey, card } = await response.json();\n\n  // Supabase에 빌링키 저장\n  await supabase.from('user_payment_methods').insert({\n    user_id: customerKey,\n    billing_key: billingKey,\n    card_company: card.company,\n    card_number_masked: card.number,\n  });\n}\n```\n\n---\n\n## 4. 정기결제 실행\n\n```javascript\nasync function executeSubscriptionPayment(userId, billingKey, amount) {\n  const response = await fetch('https://api.tosspayments.com/v1/billing/' + billingKey, {\n    method: 'POST',\n    headers: {\n      'Authorization': `Basic ${Buffer.from(TOSS_SECRET_KEY + ':').toString('base64')}`,\n      'Content-Type': 'application/json',\n    },\n    body: JSON.stringify({\n      customerKey: userId,\n      amount: amount,\n      orderId: `order_${Date.now()}`,\n      orderName: 'SSALWorks 월 구독',\n    }),\n  });\n\n  return response.json();\n}\n```\n\n---\n\n## 5. 웹훅 엔드포인트\n\n```javascript\n// /api/webhook/toss\nexport async function POST(request) {\n  const payload = await request.json();\n\n  switch (payload.eventType) {\n    case 'PAYMENT_STATUS_CHANGED':\n      if (payload.status === 'DONE') {\n        await supabase.from('users').update({\n          subscription_status: 'active',\n          subscription_start_date: new Date(),\n        }).eq('user_id', payload.customerKey);\n      }\n      break;\n\n    case 'BILLING_KEY_DELETED':\n      await supabase.from('user_payment_methods')\n        .delete()\n        .eq('billing_key', payload.billingKey);\n      break;\n  }\n\n  return new Response('OK');\n}\n```\n\n---\n\n## 6. PG 약관 동의 UI (법적 필수)\n\n```html\n<div class=\"payment-terms\">\n  <label>\n    <input type=\"checkbox\" required>\n    [필수] 전자금융거래 이용약관\n  </label>\n\n  <label>\n    <input type=\"checkbox\" required>\n    [필수] 개인정보 제3자 제공 동의 (토스페이먼트)\n  </label>\n\n  <label>\n    <input type=\"checkbox\" required>\n    [필수] 결제대행 서비스 이용약관\n  </label>\n</div>\n```\n\n---\n\n## 7. 키 용도 구분\n\n| 키 종류 | 용도 | 노출 가능 |\n|---------|------|----------|\n| 클라이언트 키 | 프론트엔드 SDK | ✅ |\n| 시크릿 키 | 서버 API 호출 | ❌ |\n\n---\n\n## 참고 문서\n\n- [토스페이먼츠 개발자 문서](https://docs.tosspayments.com/)\n- [빌링키 발급 가이드](https://docs.tosspayments.com/guides/billing)\n- [결제 웹훅 가이드](https://docs.tosspayments.com/guides/webhook)\n- [테스트 카드 정보](https://docs.tosspayments.com/reference/test-card)\n"
};
