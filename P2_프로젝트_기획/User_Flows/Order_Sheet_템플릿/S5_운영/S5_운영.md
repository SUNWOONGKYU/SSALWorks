# Order Sheet - S5 운영 (Operations)

> **작성일**: 2025-12-17
> **버전**: 2.0 (S2 경험 기반 역설계)
> **목적**: S5 Stage 작업을 위한 종합 Order Sheet

---

## 1. Stage 개요

### 1.1 Stage 목표

**S5 (운영 - Operations)**는 프로덕션 배포 및 운영 단계입니다.

- 프로덕션 배포 (Vercel)
- 도메인 연결 및 SSL 설정
- 모니터링 시스템 구축
- 백업 및 복구 체계
- 운영 문서화

### 1.2 S5 Task 목록 (예상)

| Task ID | Task Name | Area | 유형 |
|---------|-----------|------|------|
| S5O1 | 프로덕션 배포 | DevOps | **Human-AI** |
| S5O2 | 도메인 연결 | DevOps | **Human-AI** |
| S5O3 | 모니터링 설정 | DevOps | **Human-AI** |
| S5O4 | 백업 설정 | DevOps | **Human-AI** |
| S5S1 | RLS 정책 프로덕션 적용 | Security | **PO 실행** |
| S5S2 | 보안 감사 | Security | AI-Only |
| S5D1 | DB 백업 설정 | Database | **Human-AI** |
| S5M1 | 운영 문서화 | Documentation | AI-Only |
| S5M2 | 사용자 가이드 | Documentation | AI-Only |

### 1.3 의존성 관계

```
S4 Stage 완료 (필수 선행)
    │
    ├── S5O1 (프로덕션 배포) ─────► S5O2
    │
    ├── S5O2 (도메인 연결) ───────► S5O3
    │
    ├── S5S1 (RLS 프로덕션) ──────► 배포 직전 필수!
    │
    ├── S5O3, O4 (모니터링/백업) ──► 배포 후
    │
    └── S5M1, M2 (문서화) ─────────► 최종 단계
```

---

## 2. 작업 규칙 (필수 준수)

### 2.1 파일 저장 규칙

| Area | Stage 폴더 |
|------|------------|
| O (DevOps) | `S5_운영/DevOps/` |
| S (Security) | `S5_운영/Security/` |
| D (Database) | `S5_운영/Database/` |
| M (Documentation) | `S5_운영/Documentation/` |

**⚠️ S5는 운영 단계이므로 Production 폴더 이중 저장 불필요**

### 2.2 배포 전 필수 확인

```
⚠️ CRITICAL: 배포 전 필수 체크리스트

- [ ] RLS 정책 프로덕션 버전으로 교체
- [ ] 환경변수 프로덕션 값 설정
- [ ] 테스트 모드 API 키 → 프로덕션 키 교체
- [ ] 디버그 로그 비활성화
- [ ] 에러 메시지 사용자 친화적으로 변경
```

### 2.3 3단계 검증 시스템

```
[1단계] Task Agent → 작업 수행
[2단계] Verification Agent → 검증 (작성자 ≠ 검증자)
[3단계] Stage Gate → Main Agent 직접 수행
[4단계] PO 승인 → 최종 배포 승인
```

---

## 3. Order Sheet 템플릿

### S5O1 - 프로덕션 배포 (Human-AI)

```json
{
  "task_id": "S5O1",
  "task_name": "프로덕션 배포",
  "stage": "S5",
  "area": "O",
  "execution_type": "Human-AI",
  "task_instruction": {
    "AI_작업": "배포 스크립트 및 가이드 작성",
    "PO_작업": "Vercel 프로덕션 배포 실행",
    "체크리스트": [
      "환경변수 확인",
      "빌드 테스트",
      "프로덕션 배포",
      "배포 후 확인"
    ]
  },
  "task_agent": "devops-troubleshooter",
  "verification_agent": "qa-specialist",
  "po_action_required": {
    "필요": true,
    "내용": "Vercel Dashboard에서 프로덕션 배포 실행"
  }
}
```

### S5O2 - 도메인 연결 (Human-AI)

```json
{
  "task_id": "S5O2",
  "task_name": "도메인 연결",
  "stage": "S5",
  "area": "O",
  "execution_type": "Human-AI",
  "task_instruction": {
    "AI_작업": "DNS 설정 가이드 작성",
    "PO_작업": "도메인 등록기관 DNS 설정 + Vercel 도메인 추가",
    "DNS_설정": {
      "A_레코드": "76.76.21.21",
      "CNAME": "cname.vercel-dns.com",
      "TXT": "Vercel 검증 값"
    }
  },
  "task_agent": "devops-troubleshooter",
  "verification_agent": "qa-specialist",
  "po_action_required": {
    "필요": true,
    "내용": "도메인 등록기관 DNS 설정 + Vercel 도메인 추가"
  }
}
```

### S5S1 - RLS 정책 프로덕션 적용 (PO 실행)

```json
{
  "task_id": "S5S1",
  "task_name": "RLS 정책 프로덕션 적용",
  "stage": "S5",
  "area": "S",
  "execution_type": "Human-AI",
  "task_instruction": {
    "AI_작업": "프로덕션용 RLS 정책 SQL 작성",
    "PO_작업": "Supabase SQL Editor에서 RLS 정책 적용",
    "중요": [
      "개발용 _dev.sql 파일 → 프로덕션 .sql 파일로 교체",
      "anon 역할 INSERT/UPDATE/DELETE 차단",
      "authenticated 역할만 쓰기 가능"
    ]
  },
  "task_agent": "security-specialist",
  "verification_agent": "security-auditor",
  "po_action_required": {
    "필요": true,
    "내용": "Supabase SQL Editor에서 프로덕션 RLS 정책 실행"
  }
}
```

### S5O3 - 모니터링 설정 (Human-AI)

```json
{
  "task_id": "S5O3",
  "task_name": "모니터링 설정",
  "stage": "S5",
  "area": "O",
  "execution_type": "Human-AI",
  "task_instruction": {
    "AI_작업": "모니터링 설정 가이드 및 코드 작성",
    "PO_작업": "Sentry 또는 선택한 모니터링 서비스 설정",
    "모니터링_항목": [
      "에러 추적 (Sentry)",
      "성능 모니터링",
      "알림 설정"
    ]
  },
  "task_agent": "devops-troubleshooter",
  "verification_agent": "qa-specialist",
  "po_action_required": {
    "필요": true,
    "내용": "모니터링 서비스 계정 생성 + 설정"
  }
}
```

---

## 4. PO 필수 작업 가이드

### 4.1 프로덕션 배포 (S5O1)

```
[배포 전 체크리스트]
1. 모든 테스트 통과 확인
2. 환경변수 프로덕션 값 설정
3. RLS 정책 프로덕션 버전 적용 (S5S1)
4. 빌드 테스트 성공

[Vercel 배포]
1. Vercel Dashboard → 프로젝트 선택
2. Settings → Environment Variables 확인
3. Deployments → Redeploy (프로덕션)
4. 배포 완료 대기
5. 프로덕션 URL 접속 테스트
```

### 4.2 도메인 연결 (S5O2)

```
[Whois DNS 설정 - 네임서버 고급설정]

1. A 레코드:
   - 호스트명: @ 또는 www
   - IP: 76.76.21.21

2. CNAME 레코드:
   - 호스트명: www
   - 값: cname.vercel-dns.com

3. TXT 레코드 (Vercel 검증용):
   - 호스트명: _vercel
   - 값: (Vercel Dashboard에서 제공)

[Vercel 도메인 추가]
1. Settings → Domains
2. Add Domain → 도메인 입력
3. DNS 레코드 확인
4. SSL 인증서 발급 대기 (최대 24시간)
```

### 4.3 RLS 프로덕션 적용 (S5S1)

```
⚠️ 매우 중요! 배포 전 필수 실행!

[Supabase SQL Editor]
1. 개발용 RLS 정책 (_dev.sql) 제거:
   - 07_learning_contents_rls_dev.sql → 원래 파일로 교체
   - 10_faqs_rls_dev.sql → 원래 파일로 교체

2. 프로덕션 RLS 정책 실행:
   - 07_learning_contents_rls.sql 실행
   - 10_faqs_rls.sql 실행

3. 테스트:
   - anon 역할로 INSERT 시도 → 차단 확인
   - authenticated 역할로 INSERT 시도 → 성공 확인
```

### 4.4 모니터링 설정 (S5O3)

```
[Sentry 설정]
1. https://sentry.io 접속
2. 새 프로젝트 생성 (JavaScript)
3. DSN 복사
4. Vercel 환경변수 추가:
   - SENTRY_DSN = [복사한 DSN]
5. 알림 설정 (이메일/Slack)
```

---

## 5. Stage Gate 완료 기준

### PO 테스트 체크리스트

- [ ] S5O1: 프로덕션 배포 성공
- [ ] S5O2: 도메인 접속 가능 (HTTPS)
- [ ] S5S1: RLS 프로덕션 정책 적용 확인
- [ ] S5O3: 에러 발생 시 Sentry 알림 확인
- [ ] S5O4: 백업 동작 확인
- [ ] S5M1: 운영 문서 완성

### 프로젝트 완료 기준

```
S5 Stage 완료 = 프로젝트 런칭!

필수 조건:
1. 프로덕션 배포 완료
2. 커스텀 도메인 연결 + SSL 활성화
3. 모니터링 시스템 가동
4. 백업 체계 구축
5. 운영 문서 완성
6. PO 최종 승인
```

---

## 6. 주의사항

```
⚠️ 배포 전 RLS 프로덕션 정책 필수 적용!
⚠️ 테스트 API 키 → 프로덕션 키 교체 필수!
⚠️ 도메인 SSL 인증서 발급까지 최대 24시간 소요!
⚠️ 배포 후 즉시 기능 테스트 수행!
```

---

## 버전 이력

| 버전 | 날짜 | 내용 |
|------|------|------|
| 1.0 | - | 기본 템플릿 |
| 2.0 | 2025-12-17 | S2 경험 기반 역설계 종합 템플릿 |
