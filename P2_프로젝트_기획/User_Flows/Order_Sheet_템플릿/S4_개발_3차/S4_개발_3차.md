# Order Sheet - S4 개발 3차 (QA & Optimization)

> **작성일**: 2025-12-17
> **버전**: 2.0
> **목적**: S4 Stage 작업을 위한 종합 Order Sheet

---

## 1. Stage 개요

### 1.1 Stage 목표

**S4 (개발 3차 - QA & Optimization)**는 품질 보증 및 최적화 단계입니다.

- 결제 시스템 연동 (토스 페이먼트)
- 종합 테스트 (Unit, Integration, E2E)
- 성능 최적화
- 버그 수정 및 안정화
- 보안 감사

### 1.2 S4 Task 목록 (예상)

| Task ID | Task Name | Area | 유형 |
|---------|-----------|------|------|
| S4F1 | 결제 페이지 UI | Frontend | AI-Only |
| S4F2 | 결제 완료/실패 페이지 | Frontend | AI-Only |
| S4BA1 | 결제 API (토스) | Backend_APIs | **Human-AI** |
| S4BA2 | 웹훅 처리 API | Backend_APIs | AI-Only |
| S4BI1 | 토스 페이먼트 모듈 | Backend_Infra | **Human-AI** |
| S4S1 | 결제 보안 검증 | Security | AI-Only |
| S4T1 | Unit 테스트 | Testing | AI-Only |
| S4T2 | Integration 테스트 | Testing | AI-Only |
| S4T3 | E2E 테스트 | Testing | AI-Only |
| S4O1 | 성능 최적화 | DevOps | AI-Only |
| S4M1 | 테스트 문서화 | Documentation | AI-Only |

### 1.3 의존성 관계

```
S3 Stage 완료 (필수 선행)
    │
    ├── S4BI1 (토스 모듈) ────────► S4BA1
    │
    ├── S4BA1 (결제 API) ─────────► S4F1, S4F2
    │
    ├── S4BA2 (웹훅 처리) ────────► S4S1
    │
    ├── S4T1, T2, T3 (테스트) ────► 모든 기능 완료 후
    │
    └── S4O1 (최적화) ────────────► 모든 테스트 완료 후
```

---

## 2. 작업 규칙 (필수 준수)

### 2.1 파일 저장 규칙 (이중 저장)

| Area | Stage 폴더 | Production 폴더 |
|------|------------|-----------------|
| F (Frontend) | `S4_개발-3차/Frontend/` | `Production/Frontend/` |
| BA (Backend_APIs) | `S4_개발-3차/Backend_APIs/` | `Production/Backend_APIs/` |
| BI (Backend_Infra) | `S4_개발-3차/Backend_Infra/` | `Production/Backend_Infra/` |

**문서 파일은 Stage 폴더에만:**
- M (Documentation) → `S4_개발-3차/Documentation/`
- T (Testing) → `S4_개발-3차/Testing/`

### 2.2 Task ID 코멘트 규칙

```javascript
// Task ID: S4BA1 - 결제 API (토스)
```

```html
<!-- Task ID: S4F1 - 결제 페이지 UI -->
```

### 2.3 3단계 검증 시스템

```
[1단계] Task Agent → 작업 수행
[2단계] Verification Agent → 검증 (작성자 ≠ 검증자)
[3단계] Stage Gate → Main Agent 직접 수행
[4단계] PO 승인 → 테스트 후 승인/거부
```

---

## 3. Order Sheet 템플릿

### S4F1 - 결제 페이지 UI

```json
{
  "task_id": "S4F1",
  "task_name": "결제 페이지 UI",
  "stage": "S4",
  "area": "F",
  "execution_type": "AI-Only",
  "task_instruction": {
    "목표": "토스 페이먼트 연동 결제 페이지 구현",
    "기능": [
      "구독 플랜 선택",
      "카드 정보 입력 (토스 SDK)",
      "PG 이용약관 동의",
      "결제 버튼"
    ],
    "파일_생성": [
      "S4_개발-3차/Frontend/pages/payment/",
      "Production/Frontend/pages/payment/"
    ]
  },
  "task_agent": "frontend-developer",
  "verification_agent": "code-reviewer"
}
```

### S4BA1 - 결제 API (토스) (Human-AI)

```json
{
  "task_id": "S4BA1",
  "task_name": "결제 API (토스 페이먼트)",
  "stage": "S4",
  "area": "BA",
  "execution_type": "Human-AI",
  "task_instruction": {
    "AI_작업": "토스 페이먼트 API 연동 코드 작성",
    "PO_작업": "토스 페이먼트 가맹점 등록 + API 키 발급",
    "엔드포인트": [
      "POST /api/payment/billing-key - 빌링키 발급",
      "POST /api/payment/subscribe - 정기결제 시작",
      "POST /api/payment/cancel - 결제 취소",
      "POST /api/payment/webhook - 웹훅 수신"
    ]
  },
  "task_agent": "backend-developer",
  "verification_agent": "code-reviewer",
  "po_action_required": {
    "필요": true,
    "내용": "토스 페이먼트 가맹점 등록 (심사 1-2주) + API 키 발급"
  }
}
```

### S4T1 - Unit 테스트

```json
{
  "task_id": "S4T1",
  "task_name": "Unit 테스트",
  "stage": "S4",
  "area": "T",
  "execution_type": "AI-Only",
  "task_instruction": {
    "목표": "모든 핵심 함수/모듈 단위 테스트 작성",
    "커버리지_목표": "80% 이상",
    "테스트_프레임워크": "Jest",
    "테스트_대상": [
      "인증 함수",
      "결제 로직",
      "크레딧 계산",
      "유효성 검사"
    ]
  },
  "task_agent": "test-engineer",
  "verification_agent": "qa-specialist"
}
```

---

## 4. PO 필수 작업 가이드

### 4.1 토스 페이먼트 설정 (S4BI1)

```
[1단계: 가맹점 등록 - 심사 1-2주 소요!]
1. https://developers.tosspayments.com 접속
2. 가맹점 등록 신청
3. 사업자등록증 제출
4. 심사 완료 대기

[2단계: API 키 발급]
1. 테스트용 API 키 발급
2. 프로덕션용 API 키 발급 (심사 후)
3. Vercel 환경변수 설정:
   - TOSS_CLIENT_KEY
   - TOSS_SECRET_KEY

[3단계: 웹훅 설정]
1. 토스 페이먼트 대시보드 → 웹훅 설정
2. 웹훅 URL 등록: https://도메인/api/payment/webhook
```

### 4.2 테스트 실행 (S4T1, T2, T3)

```
[테스트 실행 명령]
npm test                    # Unit 테스트
npm run test:integration    # Integration 테스트
npm run test:e2e            # E2E 테스트

[테스트 결과 확인]
- 모든 테스트 통과 여부
- 커버리지 80% 이상 확인
- 실패한 테스트 리포트 검토
```

---

## 5. Stage Gate 완료 기준

### PO 테스트 체크리스트

- [ ] S4F1: 결제 페이지 UI 렌더링 확인
- [ ] S4F2: 결제 완료/실패 페이지 동작 확인
- [ ] S4BA1: 결제 API 테스트 (토스 테스트 모드)
- [ ] S4T1: Unit 테스트 80% 이상 통과
- [ ] S4T2: Integration 테스트 통과
- [ ] S4T3: E2E 테스트 통과
- [ ] S4O1: 페이지 로딩 3초 이내

### 다음 Stage 진행 조건

```
S4 Stage 완료 → S5 Stage 시작 가능

조건:
1. 모든 S4 Task 완료 및 검증 통과
2. 테스트 커버리지 80% 이상
3. 심각한 버그 0개
4. 성능 목표 달성
5. 토스 페이먼트 가맹점 심사 완료 (또는 테스트 모드)
```

---

## 6. 주의사항

```
⚠️ 토스 페이먼트 가맹점 심사에 1-2주 소요!
⚠️ 실제 결제 테스트 전 테스트 모드 확인!
⚠️ PG 이용약관 동의 체크박스 필수!
⚠️ 테스트 실패 시 배포 금지!
```

---

## 버전 이력

| 버전 | 날짜 | 내용 |
|------|------|------|
| 1.0 | - | 기본 템플릿 |
| 2.0 | 2025-12-17 | 종합 템플릿 |
