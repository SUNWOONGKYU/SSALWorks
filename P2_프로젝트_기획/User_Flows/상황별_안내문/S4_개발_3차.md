# S4 개발 3차 (QA & Optimization) 안내문

> **작성일**: 2025-12-18
> **버전**: 2.2 (Grid 동기화)

---

## 1. Stage 맥락 (Context)

### 현재 위치
```
┌─────────────────────────────────────────────────────────────────────────┐
│                        SSAL Works 개발 흐름                              │
├─────────────────────────────────────────────────────────────────────────┤
│                                                                         │
│   P0~P3        ▶▶▶   S1   ▶▶▶   S2   ▶▶▶   S3   ▶▶▶   [S4]   ▶▶▶   S5  │
│   예비단계           개발준비     개발1차     개발2차      개발3차      운영  │
│   (기획/설계)        (기반구축)   (핵심기능)  (고급기능)   (QA/최적화)  (배포) │
│                                                         ────────       │
│                                                         현재 Stage     │
│                                                                         │
└─────────────────────────────────────────────────────────────────────────┘
```

### Stage 간 관계

| 단계 | Stage | 설명 | 비고 |
|------|-------|------|------|
| 이전 | S3 | 개발 2차 - 고급 기능 완료 | ✅ 완료됨 |
| **현재** | **S4** | **개발 3차 - QA 및 최적화** | **🔄 진행 중** |
| 다음 | S5 | 운영 - 프로덕션 배포 | ⏳ 대기 |

### 이전 단계에서 완료된 것 (S3)
- ✅ AI 서비스 연동 (OpenAI, Claude 등)
- ✅ 결제 시스템 기반 구축
- ✅ 대시보드 기능 고도화
- ✅ 알림 시스템 구축
- ✅ 크레딧 관리 기능
- ✅ API Rate Limiting

### 현재 단계에서 수행할 것 (S4)
- 🔄 결제 시스템 연동 (토스 페이먼트)
- 🔄 종합 테스트 (Unit, Integration, E2E)
- 🔄 성능 최적화
- 🔄 버그 수정 및 안정화
- 🔄 결제 보안 검증
- 🔄 테스트 문서화

### 다음 단계에서 수행할 것 (S5)
- ⏳ 프로덕션 배포 (Vercel)
- ⏳ 도메인 연결 및 SSL 설정
- ⏳ 모니터링 시스템 구축
- ⏳ 백업 및 복구 체계
- ⏳ RLS 정책 프로덕션 적용
- ⏳ 운영 문서화

---

## 2. Stage 개요

**S4 (개발 3차)**는 품질 보증 및 최적화 단계입니다.

### Stage 목표
- 결제 시스템 연동 (토스 페이먼트)
- 종합 테스트 (Unit, Integration, E2E)
- 성능 최적화
- 버그 수정 및 안정화
- 보안 감사

---

## 3. Task 목록 (10개)

| Task ID | Task Name | Area | 유형 |
|---------|-----------|------|------|
| S4M1 | 테스트 문서화 | Documentation | AI-Only |
| S4F1 | 결제 페이지 UI | Frontend | AI-Only |
| S4F2 | 결제 완료/실패 페이지 | Frontend | AI-Only |
| S4BI1 | 토스 페이먼트 모듈 | Backend_Infra | **Human-AI** |
| S4BA1 | 결제 API (토스) | Backend_APIs | **Human-AI** |
| S4BA2 | 웹훅 처리 API | Backend_APIs | AI-Only |
| S4S1 | 결제 보안 검증 | Security | AI-Only |
| S4T1 | Unit 테스트 | Testing | AI-Only |
| S4T2 | Integration 테스트 | Testing | AI-Only |
| S4O1 | 성능 최적화 | DevOps | AI-Only |

---

## 4. 작업 규칙

### 파일 저장 규칙 (이중 저장)
- Frontend, Backend_APIs → Stage 폴더 + Production 폴더
- Testing, Documentation → Stage 폴더에만

### Task ID 코멘트
```javascript
// Task ID: S4BA1 - 결제 API (토스)
```

---

## 5. 실행 프로세스 (10단계)

```
[Step 0] Order Sheet 저장
[Step 1] SSAL Grid 확인 - Stage Task 목록 조회
[Step 2] Task 실행 순서 결정 - Dependencies 기반
[Step 3] 각 Task 실행 - Task Agent 서브에이전트 투입
[Step 3-1] Human-AI Task 처리 (해당 시)
[Step 4] 결과물 저장 - Stage/Area 폴더 + Production 이중 저장
[Step 5] 검증 - Verification Agent 서브에이전트로 검증
[Step 6] Grid 업데이트 - Status, Files, Progress 기록
[Step 7] Stage Gate - 모든 Task 완료 후 Stage Gate 검증
[Step 8] PO 기능 테스트 요청 - 최종 승인
```

**핵심 원칙**:
- Task Agent ≠ Verification Agent (작성자와 검증자 분리)
- Grid가 진실의 원천: 모든 Task 정보는 SSAL Grid에 있음
- 서브에이전트 투입: Task Agent(#7), Verification Agent(#15) 사용

---

## 6. PO(Project Owner) 필수 작업

### S4BI1: 토스 페이먼트 설정

**⚠️ 가맹점 심사에 1-2주 소요!**

```
[1단계: 가맹점 등록]
1. https://developers.tosspayments.com 접속
2. 가맹점 등록 신청
3. 사업자등록증 제출
4. 심사 완료 대기

[2단계: API 키 발급]
1. 테스트용 API 키 발급
2. 프로덕션용 API 키 발급 (심사 후)
3. Vercel 환경변수 설정:
   - TOSS_CLIENT_KEY
   - TOSS_SECRET_KEY

[3단계: 웹훅 설정]
1. 토스 대시보드 → 웹훅 설정
2. 웹훅 URL: https://도메인/api/payment/webhook
```

### 테스트 실행
```
npm test                    # Unit 테스트
npm run test:integration    # Integration 테스트
npm run test:e2e            # E2E 테스트
```

---

## 7. Stage Gate 완료 기준

### 체크리스트
- [ ] S4M1: 테스트 문서 완성
- [ ] S4F1: 결제 페이지 UI 렌더링 확인
- [ ] S4F2: 결제 완료/실패 페이지 동작 확인
- [ ] S4BI1: 토스 페이먼트 모듈 설정 완료
- [ ] S4BA1: 결제 API 테스트 (토스 테스트 모드)
- [ ] S4BA2: 웹훅 처리 동작 확인
- [ ] S4S1: 결제 보안 검증 통과
- [ ] S4T1: Unit 테스트 80% 이상 통과
- [ ] S4T2: Integration 테스트 통과
- [ ] S4O1: 성능 최적화 (페이지 로딩 3초 이내)

### 다음 Stage 조건
S4 완료 → S5 시작 가능

---

## 8. 주의사항

```
⚠️ 토스 페이먼트 가맹점 심사에 1-2주 소요!
⚠️ 실제 결제 테스트 전 테스트 모드 확인!
⚠️ PG 이용약관 동의 체크박스 필수!
⚠️ 테스트 실패 시 배포 금지!
```

---

**확인 버튼을 클릭하면 Workspace에 Order Sheet가 로드됩니다.**
