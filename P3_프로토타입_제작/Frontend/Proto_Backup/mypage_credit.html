<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>í¬ë ˆë”§ ê´€ë¦¬ - SSAL Works</title>

    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="https://cdn.jsdelivr.net/npm/dompurify@3.0.6/dist/purify.min.js"></script>

    <style>
        :root {
            --primary: #2C4A8A;
            --primary-dark: #1F3563;
            --secondary: #F59E0B;
            --secondary-dark: #D97706;
            --accent: #10B981;
            --success: #10B981;
            --warning: #F59E0B;
            --danger: #EF4444;
            --gray-50: #F9FAFB;
            --gray-100: #F3F4F6;
            --gray-200: #E5E7EB;
            --gray-300: #D1D5DB;
            --gray-500: #6B7280;
            --gray-700: #374151;
            --gray-900: #111827;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }

        body {
            font-family: 'Malgun Gothic', 'ë§‘ì€ ê³ ë”•', sans-serif;
            background: var(--gray-100);
            min-height: 100vh;
            color: var(--gray-900);
        }

        .nav {
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
            padding: 0 32px;
            height: 70px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }

        .nav-logo {
            display: flex;
            align-items: center;
            gap: 12px;
            text-decoration: none;
        }

        .rice-logo {
            display: flex;
            align-items: center;
            gap: 3px;
            transform: rotate(-15deg);
        }

        .rice-grain {
            width: 10px;
            height: 18px;
            background: linear-gradient(135deg, #F59E0B 0%, #D97706 100%);
            border-radius: 40%;
        }

        .rice-grain:nth-child(1) { transform: rotate(-5deg); }
        .rice-grain:nth-child(2) { transform: rotate(5deg); margin-top: 2px; }
        .rice-grain:nth-child(3) { transform: rotate(-3deg); margin-top: -1px; }

        .nav-logo-text { font-size: 28px; font-weight: 800; color: white; }

        .nav-links { display: flex; gap: 24px; align-items: center; }
        .nav-link { color: rgba(255,255,255,0.9); text-decoration: none; font-weight: 500; font-size: 14px; }
        .nav-link:hover, .nav-link.active { color: white; }

        .btn-logout {
            padding: 8px 16px;
            border: 1px solid rgba(255,255,255,0.4);
            background: transparent;
            border-radius: 8px;
            cursor: pointer;
            color: rgba(255,255,255,0.9);
            font-family: inherit;
        }

        .container { max-width: 900px; margin: 0 auto; padding: 32px 24px; }

        .breadcrumb {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-bottom: 24px;
            font-size: 14px;
            color: var(--gray-500);
        }

        .breadcrumb a { color: var(--primary); text-decoration: none; }

        .page-title { font-size: 28px; font-weight: 700; margin-bottom: 32px; }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 16px;
            margin-bottom: 24px;
        }

        @media (max-width: 700px) {
            .stats-grid { grid-template-columns: 1fr; }
        }

        .stat-card {
            background: white;
            border-radius: 12px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
            padding: 24px;
            text-align: center;
        }

        .stat-icon { font-size: 36px; margin-bottom: 12px; }
        .stat-value { font-size: 28px; font-weight: 700; }
        .stat-label { font-size: 14px; color: var(--gray-500); margin-top: 4px; }
        .stat-value.credit { color: var(--secondary); }

        .card {
            background: white;
            border-radius: 12px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
            padding: 24px;
            margin-bottom: 24px;
        }

        .card-header {
            margin-bottom: 20px;
            padding-bottom: 16px;
            border-bottom: 1px solid var(--gray-100);
        }

        .card-title { font-size: 18px; font-weight: 600; }

        .charge-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 12px;
        }

        .btn {
            padding: 12px 20px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            font-family: inherit;
            transition: all 0.2s;
        }

        .btn-charge {
            background: var(--gray-100);
            color: var(--gray-700);
            font-size: 15px;
        }

        .btn-charge:hover {
            background: var(--secondary);
            color: white;
        }

        .notice-box {
            margin-top: 16px;
            padding: 16px;
            background: var(--gray-50);
            border-radius: 8px;
            color: var(--gray-500);
            font-size: 14px;
        }

        .history-empty {
            text-align: center;
            padding: 40px;
            color: var(--gray-500);
        }

        .loading-overlay {
            position: fixed;
            top: 0; left: 0;
            width: 100%; height: 100%;
            background: rgba(255,255,255,0.8);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }

        .loading-overlay.hidden { display: none; }

        .spinner {
            width: 48px;
            height: 48px;
            border: 4px solid var(--gray-200);
            border-top-color: var(--primary);
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin { to { transform: rotate(360deg); } }

        .toast {
            position: fixed;
            bottom: 24px;
            right: 24px;
            padding: 16px 24px;
            border-radius: 12px;
            color: white;
            font-weight: 500;
            z-index: 1000;
        }

        .toast.error { background: var(--danger); }
        .toast.info { background: var(--primary); }
    </style>
</head>
<body>
    <nav class="nav">
        <a href="prototype_index_ìµœì¢…ê°œì„ .html" class="nav-logo">
            <div class="rice-logo">
                <span class="rice-grain"></span>
                <span class="rice-grain"></span>
                <span class="rice-grain"></span>
            </div>
            <span class="nav-logo-text">SSAL Works</span>
        </a>
        <div class="nav-links">
            <a href="prototype_index_ìµœì¢…ê°œì„ .html" class="nav-link">í™ˆ</a>
            <a href="learning_content.html" class="nav-link">í•™ìŠµìš© ì½˜í…ì¸ </a>
            <a href="faq.html" class="nav-link">FAQ</a>
            <a href="mypage_profile.html" class="nav-link active">ë§ˆì´í˜ì´ì§€</a>
            <button class="btn-logout" onclick="logout()">ë¡œê·¸ì•„ì›ƒ</button>
        </div>
    </nav>

    <div class="loading-overlay" id="loadingOverlay">
        <div class="spinner"></div>
    </div>

    <div class="container">
        <div class="breadcrumb">
            <a href="prototype_index_ìµœì¢…ê°œì„ .html">í™ˆ</a>
            <span>â€º</span>
            <span>ë§ˆì´í˜ì´ì§€</span>
            <span>â€º</span>
            <span>í¬ë ˆë”§ ê´€ë¦¬</span>
        </div>

        <h1 class="page-title">ğŸ’° í¬ë ˆë”§ ê´€ë¦¬</h1>

        <!-- Stats -->
        <div class="stats-grid">
            <div class="stat-card">
                <div class="stat-icon">ğŸ’°</div>
                <div class="stat-value credit" id="creditBalance">â‚©0</div>
                <div class="stat-label">í˜„ì¬ í¬ë ˆë”§</div>
            </div>
            <div class="stat-card">
                <div class="stat-icon">ğŸ“ˆ</div>
                <div class="stat-value" id="creditUsed">â‚©0</div>
                <div class="stat-label">ì´ë²ˆ ë‹¬ ì‚¬ìš©</div>
            </div>
            <div class="stat-card">
                <div class="stat-icon">ğŸ</div>
                <div class="stat-value" id="creditBonus">â‚©0</div>
                <div class="stat-label">ë³´ë„ˆìŠ¤ í¬ë ˆë”§</div>
            </div>
        </div>

        <!-- Charge Card -->
        <div class="card">
            <div class="card-header">
                <h3 class="card-title">í¬ë ˆë”§ ì¶©ì „</h3>
            </div>
            <div class="charge-grid">
                <button class="btn btn-charge" onclick="chargeCredit(10000)">â‚©10,000</button>
                <button class="btn btn-charge" onclick="chargeCredit(30000)">â‚©30,000</button>
                <button class="btn btn-charge" onclick="chargeCredit(50000)">â‚©50,000</button>
                <button class="btn btn-charge" onclick="chargeCredit(100000)">â‚©100,000</button>
                <button class="btn btn-charge" onclick="chargeCredit(200000)">â‚©200,000</button>
                <button class="btn btn-charge" onclick="chargeCredit(500000)">â‚©500,000</button>
            </div>
            <div class="notice-box">
                í¬ë ˆë”§ ì¶©ì „ì€ í˜„ì¬ ì¤€ë¹„ ì¤‘ì…ë‹ˆë‹¤. ê³§ ì„œë¹„ìŠ¤ë  ì˜ˆì •ì…ë‹ˆë‹¤.
            </div>
        </div>

        <!-- History Card -->
        <div class="card">
            <div class="card-header">
                <h3 class="card-title">í¬ë ˆë”§ ì‚¬ìš© ë‚´ì—­</h3>
            </div>
            <div id="creditHistory" class="history-empty">
                ì‚¬ìš© ë‚´ì—­ì´ ì—†ìŠµë‹ˆë‹¤.
            </div>
        </div>
    </div>

    <div id="toastContainer"></div>

    <script>
        const SUPABASE_URL = 'https://zwjmfewyshhwpgwdtrus.supabase.co';
        const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Inp3am1mZXd5c2hod3Bnd2R0cnVzIiwicm9sZSI6ImFub24iLCJpYXQiOjE3MzI3NjM3NzIsImV4cCI6MjA0ODMzOTc3Mn0.kICaQ8jF_OKGVXhdGOGvDQFekOlvluXMMOkaCmBLqRY';
        const supabaseClient = supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

        let currentUser = null;
        let userData = null;

        document.addEventListener('DOMContentLoaded', checkAuth);

        async function checkAuth() {
            showLoading();
            try {
                const { data: { session }, error } = await supabaseClient.auth.getSession();
                if (error || !session) {
                    console.log('ë¡œê·¸ì¸ë˜ì§€ ì•ŠìŒ - ìƒ˜í”Œ ë°ì´í„° í‘œì‹œ');
                    showSampleData();
                    hideLoading();
                    return;
                }
                currentUser = session.user;
                await loadUserData();
            } catch (error) {
                console.log('ì¸ì¦ í™•ì¸ ì‹¤íŒ¨ - ìƒ˜í”Œ ë°ì´í„° í‘œì‹œ');
                showSampleData();
            } finally {
                hideLoading();
            }
        }

        function showSampleData() {
            document.getElementById('creditBalance').textContent = 'â‚©50,000';
            document.getElementById('creditUsed').textContent = 'â‚©10,000';
            document.getElementById('creditBonus').textContent = 'â‚©5,000';
        }

        async function loadUserData() {
            try {
                const { data, error } = await supabaseClient
                    .from('users')
                    .select('*')
                    .eq('id', currentUser.id)
                    .single();

                if (error) throw error;
                userData = data;
                renderCredit();
            } catch (error) {
                showToast('í¬ë ˆë”§ ì •ë³´ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ”ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.', 'error');
            }
        }

        function renderCredit() {
            if (!userData) return;

            const balance = userData.credit_balance || 0;
            document.getElementById('creditBalance').textContent = `â‚©${balance.toLocaleString()}`;
            document.getElementById('creditUsed').textContent = 'â‚©0';
            document.getElementById('creditBonus').textContent = 'â‚©0';
        }

        function chargeCredit(amount) {
            showToast(`â‚©${amount.toLocaleString()} ì¶©ì „ ê¸°ëŠ¥ì€ ì¤€ë¹„ ì¤‘ì…ë‹ˆë‹¤.`, 'info');
        }

        async function logout() {
            await supabaseClient.auth.signOut();
            window.location.href = 'login.html';
        }

        function showLoading() { document.getElementById('loadingOverlay').classList.remove('hidden'); }
        function hideLoading() { document.getElementById('loadingOverlay').classList.add('hidden'); }
        function showToast(msg, type) {
            const toast = document.createElement('div');
            toast.className = `toast ${type}`;
            toast.textContent = msg;
            document.getElementById('toastContainer').appendChild(toast);
            setTimeout(() => toast.remove(), 3000);
        }
    </script>
</body>
</html>
