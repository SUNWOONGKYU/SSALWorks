<!--
@task S4M1
@description 관리자 대시보드 사용 가이드
-->

# 관리자 대시보드 사용 가이드

> SSAL Works Admin Dashboard 완벽 가이드

---

## 📋 목차

1. [관리자 대시보드 접속](#1-관리자-대시보드-접속)
2. [대시보드 주요 기능](#2-대시보드-주요-기능)
3. [사용자 관리](#3-사용자-관리)
4. [구독 승인 프로세스](#4-구독-승인-프로세스)
5. [설치비 입금 확인](#5-설치비-입금-확인)
6. [구독 관리](#6-구독-관리)
7. [결제 관리](#7-결제-관리)
8. [콘텐츠 관리](#8-콘텐츠-관리)
9. [시스템 설정](#9-시스템-설정)
10. [트러블슈팅 가이드](#10-트러블슈팅-가이드)

---

## 1. 관리자 대시보드 접속

### 1.1 접속 URL

| 환경 | URL |
|------|-----|
| **프로덕션** | https://ssalworks.ai.kr/admin |
| **개발** | http://localhost:3000/admin |

### 1.2 접속 권한

관리자 대시보드는 **관리자 권한이 있는 계정만** 접속할 수 있습니다.

**권한 확인 방법:**
1. Supabase 대시보드 접속
2. Table Editor → `users` 테이블 선택
3. 해당 사용자의 `role` 컬럼이 `'admin'`인지 확인

**권한 부여 방법:**
```sql
-- Supabase SQL Editor에서 실행
UPDATE users
SET role = 'admin'
WHERE email = '관리자이메일@example.com';
```

### 1.3 로그인 방법

1. 관리자 URL 접속
2. Google 로그인 또는 이메일 로그인
3. 로그인 후 자동으로 Admin Dashboard로 리디렉션

**주의사항:**
- 일반 사용자가 `/admin` 경로로 접속 시 자동으로 메인 대시보드로 리디렉션됩니다.
- 관리자 권한이 없으면 "접근 권한이 없습니다" 메시지가 표시됩니다.

---

## 2. 대시보드 주요 기능

### 2.1 통계 대시보드 (메인 화면)

관리자 대시보드 메인 화면에서는 주요 통계를 한눈에 확인할 수 있습니다.

**주요 지표:**

| 항목 | 설명 |
|------|------|
| **총 가입자 수** | 전체 회원 수 |
| **활성 구독자** | 현재 구독 중인 사용자 수 |
| **AI 사용량** | 금일/금주/금월 AI 사용 횟수 |
| **총 매출** | 누적 결제 금액 |
| **신규 가입 (7일)** | 최근 7일간 신규 가입자 |
| **구독 승인 대기** | 승인 대기 중인 구독 신청 건수 |

**그래프:**
- 일별 가입자 추이
- 월별 매출 추이
- AI 사용량 추이

### 2.2 메뉴 구조

```
Admin Dashboard
├── 📊 통계 대시보드 (메인)
├── 👥 사용자 관리
├── 💳 구독 관리
├── 💰 결제 관리
├── 📝 콘텐츠 관리
└── ⚙️ 시스템 설정
```

---

## 3. 사용자 관리

### 3.1 사용자 목록 보기

**접속 경로:** Admin Dashboard → 사용자 관리

**표시 항목:**
- 사용자 이름
- 이메일
- 가입일
- 구독 상태 (미구독/활성/정지)
- 권한 (user/admin)
- 작업 버튼

### 3.2 사용자 검색

**검색 방법:**
1. 상단 검색창에 키워드 입력
2. 이름, 이메일로 검색 가능
3. 실시간으로 필터링됨

**필터 옵션:**
- 구독 상태별 (전체/활성/정지/미구독)
- 권한별 (전체/일반 사용자/관리자)
- 가입일 기준 정렬

### 3.3 사용자 상세 정보 보기

**방법:**
1. 사용자 목록에서 "상세보기" 버튼 클릭
2. 팝업 또는 새 페이지에서 상세 정보 표시

**표시 내용:**
- 기본 정보 (이름, 이메일, 전화번호)
- 가입 정보 (가입일, 인증 방법)
- 구독 정보 (구독 플랜, 시작일, 종료일)
- AI 사용 내역 (총 사용 횟수, 최근 사용일)
- 결제 내역 (결제 일시, 금액, 상태)
- 활동 로그 (로그인 기록, 주요 활동)

### 3.4 사용자 작업

#### 3.4.1 구독 변경

**방법:**
1. 사용자 상세 정보 → "구독 변경" 버튼
2. 새로운 구독 플랜 선택
3. 시작일/종료일 설정
4. "저장" 클릭

**주의사항:**
- 구독 변경 시 이전 구독은 자동으로 종료됩니다.
- 환불은 별도로 처리해야 합니다.

#### 3.4.2 계정 정지

**방법:**
1. 사용자 상세 정보 → "계정 정지" 버튼
2. 정지 사유 입력
3. 정지 기간 선택 (무기한/기간 설정)
4. "정지" 클릭

**정지 시 효과:**
- 로그인 차단
- 구독 자동 정지
- AI 사용 불가
- 결제 자동 중단

**정지 해제:**
1. 사용자 상세 정보 → "정지 해제" 버튼
2. "확인" 클릭

#### 3.4.3 권한 부여

**방법:**
1. 사용자 상세 정보 → "권한 변경" 버튼
2. 권한 선택 (user/admin)
3. "저장" 클릭

**주의사항:**
- 관리자 권한 부여 시 모든 관리 기능 사용 가능
- 권한 변경은 즉시 적용됩니다.

---

## 4. 구독 승인 프로세스

### 4.1 신규 신청 확인

**접속 경로:** Admin Dashboard → 구독 관리 → "승인 대기" 탭

**표시 항목:**
- 신청자 이름/이메일
- 신청 플랜 (Basic/Standard/Premium)
- 신청 일시
- 입금 상태 (미확인/확인 완료)
- 승인/거부 버튼

### 4.2 승인 절차

**1단계: 입금 확인** (Premium 플랜만 해당)
1. "입금 확인" 버튼 클릭
2. 입금자명, 입금액 확인
3. 은행 거래내역과 대조
4. 확인 완료 체크

**2단계: 구독 승인**
1. "승인" 버튼 클릭
2. 승인 확인 팝업에서 내용 검토:
   - 사용자 정보
   - 구독 플랜
   - 결제 정보
3. "승인" 버튼 클릭

**승인 완료 시 자동 처리:**
- 구독 상태 → `active`
- 빌링 시작일 설정
- 다음 결제일 설정
- 사용자에게 승인 알림 이메일 발송
- AI 사용 가능 상태로 전환

### 4.3 거부 절차

**방법:**
1. "거부" 버튼 클릭
2. 거부 사유 입력 (필수)
3. "거부" 클릭

**거부 완료 시 자동 처리:**
- 구독 신청 삭제
- 사용자에게 거부 알림 이메일 발송 (사유 포함)
- 입금 확인 시 → 환불 안내 이메일 발송

**거부 사유 예시:**
- 입금 미확인
- 입금액 불일치
- 중복 신청
- 사용자 요청

---

## 5. 설치비 입금 확인

### 5.1 입금 확인 절차

**대상:** Premium 플랜 신규 구독자 (설치비 ₩3,000,000)

**절차:**
1. 구독 관리 → "승인 대기" 탭 → Premium 플랜 신청 확인
2. "입금 확인" 버튼 클릭
3. 입금 정보 확인:
   - 입금자명 (사용자 이름과 일치 여부)
   - 입금액 (₩3,000,000 정확한지)
   - 입금일시
4. 은행 거래내역 확인:
   - 회사 계좌로 이동
   - 거래내역에서 해당 입금 찾기
   - 금액, 입금자명 대조
5. 확인 완료:
   - "입금 확인 완료" 버튼 클릭
   - 입금일시 자동 기록

### 5.2 입금자명/금액 대조

**체크리스트:**
- [ ] 입금자명이 신청자 이름과 일치하는가?
- [ ] 입금액이 정확히 ₩3,000,000인가?
- [ ] 입금일이 신청일 이후인가?
- [ ] 중복 입금이 아닌가?

**불일치 시 처리:**
- 입금자명 불일치: 사용자에게 연락하여 확인
- 금액 불일치: 사용자에게 추가 입금 또는 환불 안내
- 중복 입금: 환불 처리

### 5.3 주의사항

**필수 확인:**
- 설치비는 **1회만** 결제됩니다.
- 기존 Premium 사용자가 해지 후 재가입 시 설치비 면제
- 입금 확인 후 승인까지 **24시간 이내** 처리 권장

**보안:**
- 입금 확인은 반드시 은행 거래내역으로 확인
- 사용자가 제공한 입금증 스크린샷만으로 승인 금지

**기록:**
- 모든 입금 확인은 자동으로 `billing_transactions` 테이블에 기록됨
- 입금 확인자 (관리자), 확인 일시 자동 저장

---

## 6. 구독 관리

### 6.1 활성 구독 목록

**표시 항목:**
- 사용자 정보
- 구독 플랜
- 시작일/종료일
- 상태 (활성/정지/만료)
- 다음 결제일
- 자동 결제 여부

### 6.2 구독 수정

**수정 가능 항목:**
- 구독 플랜 변경
- 종료일 연장
- 자동 결제 활성화/비활성화
- 구독 정지/재개

**방법:**
1. 구독 목록에서 "수정" 버튼
2. 항목 변경
3. "저장" 클릭

### 6.3 구독 강제 종료

**사용 케이스:**
- 사용자 요청
- 결제 실패 반복
- 약관 위반

**방법:**
1. 구독 상세 → "강제 종료" 버튼
2. 종료 사유 입력
3. 환불 여부 선택
4. "종료" 클릭

---

## 7. 결제 관리

### 7.1 결제 내역 조회

**검색 옵션:**
- 기간별 (오늘/이번 주/이번 달/사용자 지정)
- 상태별 (성공/실패/환불)
- 사용자별

**표시 항목:**
- 결제 일시
- 사용자 정보
- 결제 금액
- 결제 방법 (카드/계좌이체)
- 상태
- 영수증 링크

### 7.2 결제 실패 처리

**자동 처리:**
- 결제 실패 시 자동으로 재시도 (3회)
- 3회 실패 시 구독 자동 정지
- 사용자에게 실패 알림 이메일 발송

**수동 처리:**
1. 결제 실패 목록 확인
2. 사용자 연락하여 결제 수단 확인
3. 수동 결제 처리 또는 결제 수단 변경 요청

### 7.3 환불 처리

**방법:**
1. 결제 내역 → "환불" 버튼
2. 환불 사유 입력
3. 환불 금액 확인 (전액/부분)
4. "환불" 클릭

**자동 처리:**
- 토스페이먼츠 API를 통한 자동 환불
- 환불 완료 시 사용자에게 이메일 발송
- 구독 상태 자동 조정

---

## 8. 콘텐츠 관리

### 8.1 학습 콘텐츠 관리

**접속 경로:** Admin Dashboard → 콘텐츠 관리 → 학습 콘텐츠

**가능 작업:**
- 콘텐츠 추가/수정/삭제
- 카테고리 관리
- 콘텐츠 순서 변경
- 공개/비공개 설정

**콘텐츠 추가:**
1. "새 콘텐츠 추가" 버튼
2. 제목, 설명, 카테고리 입력
3. 콘텐츠 본문 작성 (Markdown 지원)
4. 난이도 선택 (입문/초급/중급/고급)
5. "저장" 클릭

### 8.2 FAQ 관리

**접속 경로:** Admin Dashboard → 콘텐츠 관리 → FAQ

**가능 작업:**
- FAQ 추가/수정/삭제
- 카테고리 관리
- 순서 변경
- 공개/비공개

### 8.3 공지사항 관리

**접속 경로:** Admin Dashboard → 콘텐츠 관리 → 공지사항

**가능 작업:**
- 공지사항 작성/수정/삭제
- 중요 공지 상단 고정
- 공지 기간 설정

---

## 9. 시스템 설정

### 9.1 구독 플랜 설정

**접속 경로:** Admin Dashboard → 시스템 설정 → 구독 플랜

**설정 항목:**
- 플랜 이름
- 월 이용료
- AI 사용 제한 (회/월)
- 설치비 (Premium만)
- 기능 제한

### 9.2 이메일 템플릿 관리

**접속 경로:** Admin Dashboard → 시스템 설정 → 이메일 템플릿

**템플릿 종류:**
- 회원가입 환영 이메일
- 구독 승인 이메일
- 구독 거부 이메일
- 결제 성공 이메일
- 결제 실패 이메일
- 구독 만료 알림

**수정 방법:**
1. 템플릿 선택
2. HTML 에디터에서 수정
3. 변수 사용: `{{user_name}}`, `{{subscription_plan}}` 등
4. "미리보기" 확인
5. "저장" 클릭

### 9.3 API 키 관리

**접속 경로:** Admin Dashboard → 시스템 설정 → API 키

**관리 항목:**
- OpenAI API 키
- 토스페이먼츠 API 키
- Resend API 키

**주의사항:**
- API 키는 암호화되어 저장됨
- 변경 시 즉시 적용됨
- 테스트 환경과 프로덕션 환경 분리

---

## 10. 트러블슈팅 가이드

### 10.1 결제 실패 처리

**문제:** 사용자의 정기 결제가 실패함

**확인 사항:**
1. 결제 수단 유효성
   - 카드 유효기간 만료
   - 한도 초과
   - 카드 정지

2. 시스템 상태
   - 토스페이먼츠 API 정상 여부
   - 네트워크 연결 상태

**해결 방법:**
1. 사용자에게 결제 수단 확인 요청 (자동 이메일 발송됨)
2. 48시간 후 자동 재시도
3. 재시도 실패 시 구독 정지
4. 수동 결제 요청

### 10.2 구독 상태 불일치

**문제:** 결제는 성공했는데 구독이 활성화되지 않음

**확인 사항:**
1. `subscriptions` 테이블 상태 확인
2. `billing_transactions` 테이블에 결제 기록 있는지 확인
3. 웹훅 로그 확인

**해결 방법:**
1. Supabase 대시보드 접속
2. SQL Editor에서 수동 업데이트:
```sql
UPDATE subscriptions
SET status = 'active'
WHERE user_id = '사용자ID' AND subscription_id = '구독ID';
```
3. 사용자에게 확인 요청

### 10.3 API 에러 대응

**문제:** 관리자 대시보드에서 "API Error" 메시지 표시

**확인 사항:**
1. 브라우저 콘솔 에러 확인 (F12)
2. Vercel 로그 확인
3. Supabase 로그 확인

**일반적인 원인:**
- API 키 만료
- RLS 정책 권한 문제
- 네트워크 타임아웃

**해결 방법:**
1. API 키 재설정
2. Supabase RLS 정책 확인
3. Vercel 재배포

### 10.4 사용자 로그인 실패

**문제:** 사용자가 로그인할 수 없다고 보고

**확인 사항:**
1. 계정 상태 (활성/정지/삭제)
2. 이메일 인증 여부
3. OAuth Provider 설정 (Google)

**해결 방법:**
1. 계정 정지 시 → 정지 해제
2. 이메일 미인증 시 → 인증 메일 재발송
3. OAuth 문제 시 → Supabase Auth 설정 확인

### 10.5 AI 사용량 초과

**문제:** 사용자가 AI 사용 한도를 초과함

**확인 사항:**
1. `ai_usage_logs` 테이블에서 사용량 확인
2. 구독 플랜의 월 한도 확인

**해결 방법:**
1. 일시적 한도 증가 (관리자 권한)
2. 플랜 업그레이드 제안
3. 다음 달까지 대기

---

## 📞 지원 및 문의

**기술 지원:**
- 이메일: support@ssalworks.ai.kr
- 관리자 전용 Slack 채널

**긴급 문의:**
- 24/7 지원 핫라인: 02-XXXX-XXXX

---

## 📚 관련 문서

- [API 명세서](./API_SPECIFICATION.md)
- [데이터베이스 스키마](./DATABASE_SCHEMA.md)
- [사용자 가이드](./USER_GUIDE.md)
- [보안 정책](./SECURITY_POLICY.md)

---

**문서 버전:** 1.0
**최종 수정일:** 2025-12-20
**작성자:** Claude Code (Task S4M1)
