<svg width="1200" height="800" viewBox="0 0 1200 800" xmlns="http://www.w3.org/2000/svg">
  <!-- 도 4: Graph Builder DAG 자동 구성 블록도 -->
  <defs>
    <marker id="arrowhead" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
      <polygon points="0 0, 10 3.5, 0 7" fill="black"/>
    </marker>
  </defs>

  <!-- 제목 -->
  <text x="600" y="35" text-anchor="middle" font-family="Arial, sans-serif" font-size="24" font-weight="bold">Graph Builder 모듈 (60) - DAG 자동 구성</text>

  <!-- 입력: Task 목록 -->
  <rect x="50" y="60" width="200" height="80" fill="none" stroke="black" stroke-width="3" rx="5"/>
  <text x="150" y="100" text-anchor="middle" font-family="Arial, sans-serif" font-size="20" font-weight="bold">Task 목록</text>
  <text x="150" y="125" text-anchor="middle" font-family="Arial, sans-serif" font-size="16">(SAL ID 포함)</text>

  <!-- 화살표: 입력 → Cell 그룹화 -->
  <line x1="250" y1="100" x2="310" y2="100" stroke="black" stroke-width="2" marker-end="url(#arrowhead)"/>

  <!-- 1단계: Cell 그룹화부 (61) -->
  <rect x="320" y="60" width="240" height="80" fill="none" stroke="black" stroke-width="2" rx="5"/>
  <text x="440" y="95" text-anchor="middle" font-family="Arial, sans-serif" font-size="18" font-weight="bold">Cell 그룹화부 (61)</text>
  <text x="440" y="120" text-anchor="middle" font-family="Arial, sans-serif" font-size="14">좌표 기준 Task 그룹화</text>

  <!-- 화살표: Cell 그룹화 → 규칙 적용 -->
  <line x1="560" y1="100" x2="620" y2="100" stroke="black" stroke-width="2" marker-end="url(#arrowhead)"/>

  <!-- 중앙: 엣지 생성부 (62) + 3가지 규칙 -->
  <rect x="630" y="50" width="350" height="200" fill="none" stroke="black" stroke-width="3" rx="5"/>
  <text x="805" y="80" text-anchor="middle" font-family="Arial, sans-serif" font-size="20" font-weight="bold">엣지 생성부 (62)</text>

  <!-- 규칙 1 -->
  <rect x="650" y="95" width="310" height="40" fill="none" stroke="black" stroke-width="1" rx="3"/>
  <text x="805" y="122" text-anchor="middle" font-family="Arial, sans-serif" font-size="14" font-weight="bold">규칙1: 동일 Cell 내 → 병렬 (엣지 없음)</text>

  <!-- 규칙 2 -->
  <rect x="650" y="145" width="310" height="40" fill="none" stroke="black" stroke-width="1" rx="3"/>
  <text x="805" y="172" text-anchor="middle" font-family="Arial, sans-serif" font-size="14" font-weight="bold">규칙2: Level 증가 → 후행 의존 엣지</text>

  <!-- 규칙 3 -->
  <rect x="650" y="195" width="310" height="40" fill="none" stroke="black" stroke-width="1" rx="3"/>
  <text x="805" y="222" text-anchor="middle" font-family="Arial, sans-serif" font-size="14" font-weight="bold">규칙3: 외부 의존(predecessors) 병합</text>

  <!-- 화살표: 규칙 적용 → 순환 검출 -->
  <line x1="805" y1="250" x2="805" y2="290" stroke="black" stroke-width="2" marker-end="url(#arrowhead)"/>

  <!-- 순환 검출부 (63) -->
  <rect x="630" y="300" width="350" height="100" fill="none" stroke="black" stroke-width="2" rx="5"/>
  <text x="805" y="340" text-anchor="middle" font-family="Arial, sans-serif" font-size="20" font-weight="bold">순환 검출부 (63)</text>
  <text x="805" y="370" text-anchor="middle" font-family="Arial, sans-serif" font-size="16">DFS/Kahn 알고리즘으로 Cycle 탐지</text>
  <text x="805" y="390" text-anchor="middle" font-family="Arial, sans-serif" font-size="14">발견 시 오류 반환</text>

  <!-- 오류 분기 -->
  <line x1="980" y1="350" x2="1050" y2="350" stroke="black" stroke-width="2"/>
  <rect x="1050" y="320" width="120" height="60" rx="3" fill="white" stroke="black" stroke-width="2" stroke-dasharray="5,3"/>
  <text x="1110" y="355" text-anchor="middle" font-family="Arial, sans-serif" font-size="16">순환 오류</text>
  <text x="1010" y="340" font-family="Arial, sans-serif" font-size="14">발견</text>

  <!-- 화살표: 순환 검출 → 병목 마킹 -->
  <line x1="805" y1="400" x2="805" y2="440" stroke="black" stroke-width="2" marker-end="url(#arrowhead)"/>

  <!-- 병목 마킹부 (64) -->
  <rect x="630" y="450" width="350" height="100" fill="none" stroke="black" stroke-width="2" rx="5"/>
  <text x="805" y="490" text-anchor="middle" font-family="Arial, sans-serif" font-size="20" font-weight="bold">병목 마킹부 (64)</text>
  <text x="805" y="520" text-anchor="middle" font-family="Arial, sans-serif" font-size="16">진출 차수 분석, Critical 노드 마킹</text>
  <text x="805" y="540" text-anchor="middle" font-family="Arial, sans-serif" font-size="14">후행 작업이 많은 노드 식별</text>

  <!-- 화살표: 병목 마킹 → DAG 출력 -->
  <line x1="805" y1="550" x2="805" y2="600" stroke="black" stroke-width="2" marker-end="url(#arrowhead)"/>

  <!-- 출력: DAG -->
  <rect x="680" y="610" width="250" height="80" fill="none" stroke="black" stroke-width="3" rx="5"/>
  <text x="805" y="650" text-anchor="middle" font-family="Arial, sans-serif" font-size="20" font-weight="bold">완성된 DAG</text>
  <text x="805" y="675" text-anchor="middle" font-family="Arial, sans-serif" font-size="16">노드+엣지+병목정보</text>

  <!-- 좌측: Graph Builder 모듈 전체 표시 -->
  <rect x="30" y="200" width="250" height="280" fill="none" stroke="black" stroke-width="2" rx="5"/>
  <text x="155" y="235" text-anchor="middle" font-family="Arial, sans-serif" font-size="18" font-weight="bold">Graph Builder (60)</text>
  <line x1="40" y1="250" x2="270" y2="250" stroke="black" stroke-width="1"/>
  <text x="155" y="280" text-anchor="middle" font-family="Arial, sans-serif" font-size="14">입력: SAL ID 목록</text>
  <text x="155" y="310" text-anchor="middle" font-family="Arial, sans-serif" font-size="14">출력: DAG 구조</text>
  <line x1="40" y1="330" x2="270" y2="330" stroke="black" stroke-width="1"/>
  <text x="155" y="360" text-anchor="middle" font-family="Arial, sans-serif" font-size="14" font-weight="bold">하위 모듈:</text>
  <text x="155" y="385" text-anchor="middle" font-family="Arial, sans-serif" font-size="13">61: Cell 그룹화부</text>
  <text x="155" y="405" text-anchor="middle" font-family="Arial, sans-serif" font-size="13">62: 엣지 생성부</text>
  <text x="155" y="425" text-anchor="middle" font-family="Arial, sans-serif" font-size="13">63: 순환 검출부</text>
  <text x="155" y="445" text-anchor="middle" font-family="Arial, sans-serif" font-size="13">64: 병목 마킹부</text>
  <text x="155" y="470" text-anchor="middle" font-family="Arial, sans-serif" font-size="13">110: 의존 엣지</text>

  <!-- 하단: 엣지 유형 설명 -->
  <rect x="50" y="700" width="400" height="80" fill="none" stroke="black" stroke-width="1" rx="5"/>
  <text x="250" y="725" text-anchor="middle" font-family="Arial, sans-serif" font-size="16" font-weight="bold">엣지 유형 (110)</text>
  <text x="250" y="750" text-anchor="middle" font-family="Arial, sans-serif" font-size="14">111: 일반 의존 엣지</text>
  <text x="250" y="770" text-anchor="middle" font-family="Arial, sans-serif" font-size="14">112: Critical Path 엣지 (강조 표시)</text>

</svg>
